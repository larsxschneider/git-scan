<!doctype html>
<html>
<head>
<title>diff.c</title>
<style type="text/css">
 body { color:#000000; background-color:#ffffff }
 body { font-family:Helvetica, sans-serif; font-size:10pt }
 h1 { font-size:14pt }
 .code { border-collapse:collapse; width:100%; }
 .code { font-family: "Monospace", monospace; font-size:10pt }
 .code { line-height: 1.2em }
 .comment { color: green; font-style: oblique }
 .keyword { color: blue }
 .string_literal { color: red }
 .directive { color: darkmagenta }
 .expansion { display: none; }
 .macro:hover .expansion { display: block; border: 2px solid #FF0000; padding: 2px; background-color:#FFF0F0; font-weight: normal;   -webkit-border-radius:5px;  -webkit-box-shadow:1px 1px 7px #000; position: absolute; top: -1em; left:10em; z-index: 1 } 
 .macro { color: darkmagenta; background-color:LemonChiffon; position: relative }
 .num { width:2.5em; padding-right:2ex; background-color:#eeeeee }
 .num { text-align:right; font-size:8pt }
 .num { color:#444444 }
 .line { padding-left: 1ex; border-left: 3px solid #ccc }
 .line { white-space: pre }
 .msg { -webkit-box-shadow:1px 1px 7px #000 }
 .msg { -webkit-border-radius:5px }
 .msg { font-family:Helvetica, sans-serif; font-size:8pt }
 .msg { float:left }
 .msg { padding:0.25em 1ex 0.25em 1ex }
 .msg { margin-top:10px; margin-bottom:10px }
 .msg { font-weight:bold }
 .msg { max-width:60em; word-wrap: break-word; white-space: pre-wrap }
 .msgT { padding:0x; spacing:0x }
 .msgEvent { background-color:#fff8b4; color:#000000 }
 .msgControl { background-color:#bbbbbb; color:#000000 }
 .mrange { background-color:#dfddf3 }
 .mrange { border-bottom:1px solid #6F9DBE }
 .PathIndex { font-weight: bold; padding:0px 5px; margin-right:5px; }
 .PathIndex { -webkit-border-radius:8px }
 .PathIndexEvent { background-color:#bfba87 }
 .PathIndexControl { background-color:#8c8c8c }
 .PathNav a { text-decoration:none; font-size: larger }
 .CodeInsertionHint { font-weight: bold; background-color: #10dd10 }
 .CodeRemovalHint { background-color:#de1010 }
 .CodeRemovalHint { border-bottom:1px solid #6F9DBE }
 table.simpletable {
   padding: 5px;
   font-size:12pt;
   margin:20px;
   border-collapse: collapse; border-spacing: 0px;
 }
 td.rowname {
   text-align:right; font-weight:bold; color:#444444;
   padding-right:2ex; }
</style>
</head>
<body>
<!-- BUGDESC Division by zero -->

<!-- BUGTYPE Division by zero -->

<!-- BUGCATEGORY Logic error -->

<!-- BUGFILE /Users/lars/Code/git/diff.c -->

<!-- FILENAME diff.c -->

<!-- FUNCTIONNAME scale_linear -->

<!-- ISSUEHASHCONTENTOFLINEINCONTEXT 9a72389b9d5ad620316dec44398eab72 -->

<!-- BUGLINE 1521 -->

<!-- BUGCOLUMN 31 -->

<!-- BUGPATHLENGTH 29 -->

<!-- BUGMETAEND -->
<!-- REPORTHEADER -->
<h3>Bug Summary</h3>
<table class="simpletable">
<tr><td class="rowname">File:</td><td>diff.c</td></tr>
<tr><td class="rowname">Location:</td><td><a href="#EndPath">line 1521, column 31</a></td></tr>
<tr><td class="rowname">Description:</td><td>Division by zero</td></tr>
</table>
<!-- REPORTSUMMARYEXTRA -->
<h3>Annotated Source Code</h3>
<table class="code">
<tr><td class="num" id="LN1">1</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2">2</td><td class="line"> <span class='comment'>* Copyright (C) 2005 Junio C Hamano</span></td></tr>
<tr><td class="num" id="LN3">3</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN4">4</td><td class="line"><span class='directive'>#include "cache.h"</span></td></tr>
<tr><td class="num" id="LN5">5</td><td class="line"><span class='directive'>#include "tempfile.h"</span></td></tr>
<tr><td class="num" id="LN6">6</td><td class="line"><span class='directive'>#include "quote.h"</span></td></tr>
<tr><td class="num" id="LN7">7</td><td class="line"><span class='directive'>#include "diff.h"</span></td></tr>
<tr><td class="num" id="LN8">8</td><td class="line"><span class='directive'>#include "diffcore.h"</span></td></tr>
<tr><td class="num" id="LN9">9</td><td class="line"><span class='directive'>#include "delta.h"</span></td></tr>
<tr><td class="num" id="LN10">10</td><td class="line"><span class='directive'>#include "xdiff-interface.h"</span></td></tr>
<tr><td class="num" id="LN11">11</td><td class="line"><span class='directive'>#include "color.h"</span></td></tr>
<tr><td class="num" id="LN12">12</td><td class="line"><span class='directive'>#include "attr.h"</span></td></tr>
<tr><td class="num" id="LN13">13</td><td class="line"><span class='directive'>#include "run-command.h"</span></td></tr>
<tr><td class="num" id="LN14">14</td><td class="line"><span class='directive'>#include "utf8.h"</span></td></tr>
<tr><td class="num" id="LN15">15</td><td class="line"><span class='directive'>#include "userdiff.h"</span></td></tr>
<tr><td class="num" id="LN16">16</td><td class="line"><span class='directive'>#include "submodule-config.h"</span></td></tr>
<tr><td class="num" id="LN17">17</td><td class="line"><span class='directive'>#include "submodule.h"</span></td></tr>
<tr><td class="num" id="LN18">18</td><td class="line"><span class='directive'>#include "ll-merge.h"</span></td></tr>
<tr><td class="num" id="LN19">19</td><td class="line"><span class='directive'>#include "string-list.h"</span></td></tr>
<tr><td class="num" id="LN20">20</td><td class="line"><span class='directive'>#include "argv-array.h"</span></td></tr>
<tr><td class="num" id="LN21">21</td><td class="line"><span class='directive'>#include "graph.h"</span></td></tr>
<tr><td class="num" id="LN22">22</td><td class="line"> </td></tr>
<tr><td class="num" id="LN23">23</td><td class="line"><span class='directive'>#ifdef NO_FAST_WORKING_DIRECTORY</span></td></tr>
<tr><td class="num" id="LN24">24</td><td class="line"><span class='directive'>#define <span class='macro'>FAST_WORKING_DIRECTORY<span class='expansion'>1</span></span> 0</span></td></tr>
<tr><td class="num" id="LN25">25</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr><td class="num" id="LN26">26</td><td class="line"><span class='directive'>#define <span class='macro'>FAST_WORKING_DIRECTORY<span class='expansion'>1</span></span> 1</span></td></tr>
<tr><td class="num" id="LN27">27</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr><td class="num" id="LN28">28</td><td class="line"> </td></tr>
<tr><td class="num" id="LN29">29</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_detect_rename_default;</td></tr>
<tr><td class="num" id="LN30">30</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_indent_heuristic; <span class='comment'>/* experimental */</span></td></tr>
<tr><td class="num" id="LN31">31</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_rename_limit_default = 400;</td></tr>
<tr><td class="num" id="LN32">32</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_suppress_blank_empty;</td></tr>
<tr><td class="num" id="LN33">33</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_use_color_default = -1;</td></tr>
<tr><td class="num" id="LN34">34</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_context_default = 3;</td></tr>
<tr><td class="num" id="LN35">35</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_interhunk_context_default;</td></tr>
<tr><td class="num" id="LN36">36</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *diff_word_regex_cfg;</td></tr>
<tr><td class="num" id="LN37">37</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *external_diff_cmd_cfg;</td></tr>
<tr><td class="num" id="LN38">38</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *diff_order_file_cfg;</td></tr>
<tr><td class="num" id="LN39">39</td><td class="line"><span class='keyword'>int</span> diff_auto_refresh_index = 1;</td></tr>
<tr><td class="num" id="LN40">40</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_mnemonic_prefix;</td></tr>
<tr><td class="num" id="LN41">41</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_no_prefix;</td></tr>
<tr><td class="num" id="LN42">42</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_stat_graph_width;</td></tr>
<tr><td class="num" id="LN43">43</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_dirstat_permille_default = 30;</td></tr>
<tr><td class="num" id="LN44">44</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>struct</span> diff_options default_diff_options;</td></tr>
<tr><td class="num" id="LN45">45</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>long</span> diff_algorithm;</td></tr>
<tr><td class="num" id="LN46">46</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>unsigned</span> ws_error_highlight_default = <span class='macro'>WSEH_NEW<span class='expansion'>1</span></span>;</td></tr>
<tr><td class="num" id="LN47">47</td><td class="line"> </td></tr>
<tr><td class="num" id="LN48">48</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>char</span> diff_colors[][<span class='macro'>COLOR_MAXLEN<span class='expansion'>75</span></span>] = {</td></tr>
<tr><td class="num" id="LN49">49</td><td class="line">	<span class='macro'>GIT_COLOR_RESET<span class='expansion'>"\033[m"</span></span>,</td></tr>
<tr><td class="num" id="LN50">50</td><td class="line">	<span class='macro'>GIT_COLOR_NORMAL<span class='expansion'>""</span></span>,	<span class='comment'>/* CONTEXT */</span></td></tr>
<tr><td class="num" id="LN51">51</td><td class="line">	<span class='macro'>GIT_COLOR_BOLD<span class='expansion'>"\033[1m"</span></span>,		<span class='comment'>/* METAINFO */</span></td></tr>
<tr><td class="num" id="LN52">52</td><td class="line">	<span class='macro'>GIT_COLOR_CYAN<span class='expansion'>"\033[36m"</span></span>,		<span class='comment'>/* FRAGINFO */</span></td></tr>
<tr><td class="num" id="LN53">53</td><td class="line">	<span class='macro'>GIT_COLOR_RED<span class='expansion'>"\033[31m"</span></span>,		<span class='comment'>/* OLD */</span></td></tr>
<tr><td class="num" id="LN54">54</td><td class="line">	<span class='macro'>GIT_COLOR_GREEN<span class='expansion'>"\033[32m"</span></span>,	<span class='comment'>/* NEW */</span></td></tr>
<tr><td class="num" id="LN55">55</td><td class="line">	<span class='macro'>GIT_COLOR_YELLOW<span class='expansion'>"\033[33m"</span></span>,	<span class='comment'>/* COMMIT */</span></td></tr>
<tr><td class="num" id="LN56">56</td><td class="line">	<span class='macro'>GIT_COLOR_BG_RED<span class='expansion'>"\033[41m"</span></span>,	<span class='comment'>/* WHITESPACE */</span></td></tr>
<tr><td class="num" id="LN57">57</td><td class="line">	<span class='macro'>GIT_COLOR_NORMAL<span class='expansion'>""</span></span>,	<span class='comment'>/* FUNCINFO */</span></td></tr>
<tr><td class="num" id="LN58">58</td><td class="line">};</td></tr>
<tr><td class="num" id="LN59">59</td><td class="line"> </td></tr>
<tr><td class="num" id="LN60">60</td><td class="line"><span class='keyword'>static</span> <span class='macro'>NORETURN<span class='expansion'>__attribute__((__noreturn__))</span></span> <span class='keyword'>void</span> die_want_option(<span class='keyword'>const</span> <span class='keyword'>char</span> *option_name)</td></tr>
<tr><td class="num" id="LN61">61</td><td class="line">{</td></tr>
<tr><td class="num" id="LN62">62</td><td class="line">	die(_(<span class='string_literal'>"option '%s' requires a value"</span>), option_name);</td></tr>
<tr><td class="num" id="LN63">63</td><td class="line">}</td></tr>
<tr><td class="num" id="LN64">64</td><td class="line"> </td></tr>
<tr><td class="num" id="LN65">65</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> parse_diff_color_slot(<span class='keyword'>const</span> <span class='keyword'>char</span> *var)</td></tr>
<tr><td class="num" id="LN66">66</td><td class="line">{</td></tr>
<tr><td class="num" id="LN67">67</td><td class="line">	<span class='keyword'>if</span> (!strcasecmp(var, <span class='string_literal'>"context"</span>) || !strcasecmp(var, <span class='string_literal'>"plain"</span>))</td></tr>
<tr><td class="num" id="LN68">68</td><td class="line">		<span class='keyword'>return</span> DIFF_CONTEXT;</td></tr>
<tr><td class="num" id="LN69">69</td><td class="line">	<span class='keyword'>if</span> (!strcasecmp(var, <span class='string_literal'>"meta"</span>))</td></tr>
<tr><td class="num" id="LN70">70</td><td class="line">		<span class='keyword'>return</span> DIFF_METAINFO;</td></tr>
<tr><td class="num" id="LN71">71</td><td class="line">	<span class='keyword'>if</span> (!strcasecmp(var, <span class='string_literal'>"frag"</span>))</td></tr>
<tr><td class="num" id="LN72">72</td><td class="line">		<span class='keyword'>return</span> DIFF_FRAGINFO;</td></tr>
<tr><td class="num" id="LN73">73</td><td class="line">	<span class='keyword'>if</span> (!strcasecmp(var, <span class='string_literal'>"old"</span>))</td></tr>
<tr><td class="num" id="LN74">74</td><td class="line">		<span class='keyword'>return</span> DIFF_FILE_OLD;</td></tr>
<tr><td class="num" id="LN75">75</td><td class="line">	<span class='keyword'>if</span> (!strcasecmp(var, <span class='string_literal'>"new"</span>))</td></tr>
<tr><td class="num" id="LN76">76</td><td class="line">		<span class='keyword'>return</span> DIFF_FILE_NEW;</td></tr>
<tr><td class="num" id="LN77">77</td><td class="line">	<span class='keyword'>if</span> (!strcasecmp(var, <span class='string_literal'>"commit"</span>))</td></tr>
<tr><td class="num" id="LN78">78</td><td class="line">		<span class='keyword'>return</span> DIFF_COMMIT;</td></tr>
<tr><td class="num" id="LN79">79</td><td class="line">	<span class='keyword'>if</span> (!strcasecmp(var, <span class='string_literal'>"whitespace"</span>))</td></tr>
<tr><td class="num" id="LN80">80</td><td class="line">		<span class='keyword'>return</span> DIFF_WHITESPACE;</td></tr>
<tr><td class="num" id="LN81">81</td><td class="line">	<span class='keyword'>if</span> (!strcasecmp(var, <span class='string_literal'>"func"</span>))</td></tr>
<tr><td class="num" id="LN82">82</td><td class="line">		<span class='keyword'>return</span> DIFF_FUNCINFO;</td></tr>
<tr><td class="num" id="LN83">83</td><td class="line">	<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN84">84</td><td class="line">}</td></tr>
<tr><td class="num" id="LN85">85</td><td class="line"> </td></tr>
<tr><td class="num" id="LN86">86</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> parse_dirstat_params(<span class='keyword'>struct</span> diff_options *options, <span class='keyword'>const</span> <span class='keyword'>char</span> *params_string,</td></tr>
<tr><td class="num" id="LN87">87</td><td class="line">				<span class='keyword'>struct</span> strbuf *errmsg)</td></tr>
<tr><td class="num" id="LN88">88</td><td class="line">{</td></tr>
<tr><td class="num" id="LN89">89</td><td class="line">	<span class='keyword'>char</span> *params_copy = xstrdup(params_string);</td></tr>
<tr><td class="num" id="LN90">90</td><td class="line">	<span class='keyword'>struct</span> string_list params = <span class='macro'>STRING_LIST_INIT_NODUP<span class='expansion'>{ ((void*)0), 0, 0, 0, ((void*)0) }</span></span>;</td></tr>
<tr><td class="num" id="LN91">91</td><td class="line">	<span class='keyword'>int</span> ret = 0;</td></tr>
<tr><td class="num" id="LN92">92</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN93">93</td><td class="line"> </td></tr>
<tr><td class="num" id="LN94">94</td><td class="line">	<span class='keyword'>if</span> (*params_copy)</td></tr>
<tr><td class="num" id="LN95">95</td><td class="line">		string_list_split_in_place(&amp;params, params_copy, ',', -1);</td></tr>
<tr><td class="num" id="LN96">96</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; params.nr; i++) {</td></tr>
<tr><td class="num" id="LN97">97</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *p = params.items[i].string;</td></tr>
<tr><td class="num" id="LN98">98</td><td class="line">		<span class='keyword'>if</span> (!strcmp(p, <span class='string_literal'>"changes"</span>)) {</td></tr>
<tr><td class="num" id="LN99">99</td><td class="line">			<span class='macro'>DIFF_OPT_CLR(options, DIRSTAT_BY_LINE)<span class='expansion'>(((options)-&gt;flags &amp;= ~(1 &lt;&lt; 28)),((options)-&gt;<br>touched_flags |= (1 &lt;&lt; 28)))</span></span>;</td></tr>
<tr><td class="num" id="LN100">100</td><td class="line">			<span class='macro'>DIFF_OPT_CLR(options, DIRSTAT_BY_FILE)<span class='expansion'>(((options)-&gt;flags &amp;= ~(1 &lt;&lt; 20)),((options)-&gt;<br>touched_flags |= (1 &lt;&lt; 20)))</span></span>;</td></tr>
<tr><td class="num" id="LN101">101</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(p, <span class='string_literal'>"lines"</span>)) {</td></tr>
<tr><td class="num" id="LN102">102</td><td class="line">			<span class='macro'>DIFF_OPT_SET(options, DIRSTAT_BY_LINE)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 28)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 28)))</span></span>;</td></tr>
<tr><td class="num" id="LN103">103</td><td class="line">			<span class='macro'>DIFF_OPT_CLR(options, DIRSTAT_BY_FILE)<span class='expansion'>(((options)-&gt;flags &amp;= ~(1 &lt;&lt; 20)),((options)-&gt;<br>touched_flags |= (1 &lt;&lt; 20)))</span></span>;</td></tr>
<tr><td class="num" id="LN104">104</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(p, <span class='string_literal'>"files"</span>)) {</td></tr>
<tr><td class="num" id="LN105">105</td><td class="line">			<span class='macro'>DIFF_OPT_CLR(options, DIRSTAT_BY_LINE)<span class='expansion'>(((options)-&gt;flags &amp;= ~(1 &lt;&lt; 28)),((options)-&gt;<br>touched_flags |= (1 &lt;&lt; 28)))</span></span>;</td></tr>
<tr><td class="num" id="LN106">106</td><td class="line">			<span class='macro'>DIFF_OPT_SET(options, DIRSTAT_BY_FILE)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 20)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 20)))</span></span>;</td></tr>
<tr><td class="num" id="LN107">107</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(p, <span class='string_literal'>"noncumulative"</span>)) {</td></tr>
<tr><td class="num" id="LN108">108</td><td class="line">			<span class='macro'>DIFF_OPT_CLR(options, DIRSTAT_CUMULATIVE)<span class='expansion'>(((options)-&gt;flags &amp;= ~(1 &lt;&lt; 19)),((options)-&gt;<br>touched_flags |= (1 &lt;&lt; 19)))</span></span>;</td></tr>
<tr><td class="num" id="LN109">109</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(p, <span class='string_literal'>"cumulative"</span>)) {</td></tr>
<tr><td class="num" id="LN110">110</td><td class="line">			<span class='macro'>DIFF_OPT_SET(options, DIRSTAT_CUMULATIVE)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 19)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 19)))</span></span>;</td></tr>
<tr><td class="num" id="LN111">111</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (<span class='macro'>isdigit(*p)<span class='expansion'>((sane_ctype[(unsigned char)(*p)] &amp; (0x02)) != 0)</span></span>) {</td></tr>
<tr><td class="num" id="LN112">112</td><td class="line">			<span class='keyword'>char</span> *end;</td></tr>
<tr><td class="num" id="LN113">113</td><td class="line">			<span class='keyword'>int</span> permille = strtoul(p, &amp;end, 10) * 10;</td></tr>
<tr><td class="num" id="LN114">114</td><td class="line">			<span class='keyword'>if</span> (*end == '.' &amp;&amp; <span class='macro'>isdigit(*++end)<span class='expansion'>((sane_ctype[(unsigned char)(*++end)] &amp; (0x02)) != 0)</span></span>) {</td></tr>
<tr><td class="num" id="LN115">115</td><td class="line">				<span class='comment'>/* only use first digit */</span></td></tr>
<tr><td class="num" id="LN116">116</td><td class="line">				permille += *end - '0';</td></tr>
<tr><td class="num" id="LN117">117</td><td class="line">				<span class='comment'>/* .. and ignore any further digits */</span></td></tr>
<tr><td class="num" id="LN118">118</td><td class="line">				<span class='keyword'>while</span> (<span class='macro'>isdigit(*++end)<span class='expansion'>((sane_ctype[(unsigned char)(*++end)] &amp; (0x02)) != 0)</span></span>)</td></tr>
<tr><td class="num" id="LN119">119</td><td class="line">					; <span class='comment'>/* nothing */</span></td></tr>
<tr><td class="num" id="LN120">120</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN121">121</td><td class="line">			<span class='keyword'>if</span> (!*end)</td></tr>
<tr><td class="num" id="LN122">122</td><td class="line">				options-&gt;dirstat_permille = permille;</td></tr>
<tr><td class="num" id="LN123">123</td><td class="line">			<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN124">124</td><td class="line">				strbuf_addf(errmsg, _(<span class='string_literal'>"  Failed to parse dirstat cut-off percentage '%s'\n"</span>),</td></tr>
<tr><td class="num" id="LN125">125</td><td class="line">					    p);</td></tr>
<tr><td class="num" id="LN126">126</td><td class="line">				ret++;</td></tr>
<tr><td class="num" id="LN127">127</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN128">128</td><td class="line">		} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN129">129</td><td class="line">			strbuf_addf(errmsg, _(<span class='string_literal'>"  Unknown dirstat parameter '%s'\n"</span>), p);</td></tr>
<tr><td class="num" id="LN130">130</td><td class="line">			ret++;</td></tr>
<tr><td class="num" id="LN131">131</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN132">132</td><td class="line"> </td></tr>
<tr><td class="num" id="LN133">133</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN134">134</td><td class="line">	string_list_clear(&amp;params, 0);</td></tr>
<tr><td class="num" id="LN135">135</td><td class="line">	free(params_copy);</td></tr>
<tr><td class="num" id="LN136">136</td><td class="line">	<span class='keyword'>return</span> ret;</td></tr>
<tr><td class="num" id="LN137">137</td><td class="line">}</td></tr>
<tr><td class="num" id="LN138">138</td><td class="line"> </td></tr>
<tr><td class="num" id="LN139">139</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> parse_submodule_params(<span class='keyword'>struct</span> diff_options *options, <span class='keyword'>const</span> <span class='keyword'>char</span> *value)</td></tr>
<tr><td class="num" id="LN140">140</td><td class="line">{</td></tr>
<tr><td class="num" id="LN141">141</td><td class="line">	<span class='keyword'>if</span> (!strcmp(value, <span class='string_literal'>"log"</span>))</td></tr>
<tr><td class="num" id="LN142">142</td><td class="line">		options-&gt;submodule_format = DIFF_SUBMODULE_LOG;</td></tr>
<tr><td class="num" id="LN143">143</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(value, <span class='string_literal'>"short"</span>))</td></tr>
<tr><td class="num" id="LN144">144</td><td class="line">		options-&gt;submodule_format = DIFF_SUBMODULE_SHORT;</td></tr>
<tr><td class="num" id="LN145">145</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(value, <span class='string_literal'>"diff"</span>))</td></tr>
<tr><td class="num" id="LN146">146</td><td class="line">		options-&gt;submodule_format = DIFF_SUBMODULE_INLINE_DIFF;</td></tr>
<tr><td class="num" id="LN147">147</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN148">148</td><td class="line">		<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN149">149</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN150">150</td><td class="line">}</td></tr>
<tr><td class="num" id="LN151">151</td><td class="line"> </td></tr>
<tr><td class="num" id="LN152">152</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> git_config_rename(<span class='keyword'>const</span> <span class='keyword'>char</span> *var, <span class='keyword'>const</span> <span class='keyword'>char</span> *value)</td></tr>
<tr><td class="num" id="LN153">153</td><td class="line">{</td></tr>
<tr><td class="num" id="LN154">154</td><td class="line">	<span class='keyword'>if</span> (!value)</td></tr>
<tr><td class="num" id="LN155">155</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>DIFF_DETECT_RENAME<span class='expansion'>1</span></span>;</td></tr>
<tr><td class="num" id="LN156">156</td><td class="line">	<span class='keyword'>if</span> (!strcasecmp(value, <span class='string_literal'>"copies"</span>) || !strcasecmp(value, <span class='string_literal'>"copy"</span>))</td></tr>
<tr><td class="num" id="LN157">157</td><td class="line">		<span class='keyword'>return</span>  <span class='macro'>DIFF_DETECT_COPY<span class='expansion'>2</span></span>;</td></tr>
<tr><td class="num" id="LN158">158</td><td class="line">	<span class='keyword'>return</span> git_config_bool(var,value) ? <span class='macro'>DIFF_DETECT_RENAME<span class='expansion'>1</span></span> : 0;</td></tr>
<tr><td class="num" id="LN159">159</td><td class="line">}</td></tr>
<tr><td class="num" id="LN160">160</td><td class="line"> </td></tr>
<tr><td class="num" id="LN161">161</td><td class="line"><span class='keyword'>long</span> parse_algorithm_value(<span class='keyword'>const</span> <span class='keyword'>char</span> *value)</td></tr>
<tr><td class="num" id="LN162">162</td><td class="line">{</td></tr>
<tr><td class="num" id="LN163">163</td><td class="line">	<span class='keyword'>if</span> (!value)</td></tr>
<tr><td class="num" id="LN164">164</td><td class="line">		<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN165">165</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcasecmp(value, <span class='string_literal'>"myers"</span>) || !strcasecmp(value, <span class='string_literal'>"default"</span>))</td></tr>
<tr><td class="num" id="LN166">166</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN167">167</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcasecmp(value, <span class='string_literal'>"minimal"</span>))</td></tr>
<tr><td class="num" id="LN168">168</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>XDF_NEED_MINIMAL<span class='expansion'>(1 &lt;&lt; 1)</span></span>;</td></tr>
<tr><td class="num" id="LN169">169</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcasecmp(value, <span class='string_literal'>"patience"</span>))</td></tr>
<tr><td class="num" id="LN170">170</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>XDF_PATIENCE_DIFF<span class='expansion'>(1 &lt;&lt; 5)</span></span>;</td></tr>
<tr><td class="num" id="LN171">171</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcasecmp(value, <span class='string_literal'>"histogram"</span>))</td></tr>
<tr><td class="num" id="LN172">172</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>XDF_HISTOGRAM_DIFF<span class='expansion'>(1 &lt;&lt; 6)</span></span>;</td></tr>
<tr><td class="num" id="LN173">173</td><td class="line">	<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN174">174</td><td class="line">}</td></tr>
<tr><td class="num" id="LN175">175</td><td class="line"> </td></tr>
<tr><td class="num" id="LN176">176</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> parse_one_token(<span class='keyword'>const</span> <span class='keyword'>char</span> **arg, <span class='keyword'>const</span> <span class='keyword'>char</span> *token)</td></tr>
<tr><td class="num" id="LN177">177</td><td class="line">{</td></tr>
<tr><td class="num" id="LN178">178</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *rest;</td></tr>
<tr><td class="num" id="LN179">179</td><td class="line">	<span class='keyword'>if</span> (skip_prefix(*arg, token, &amp;rest) &amp;&amp; (!*rest || *rest == ',')) {</td></tr>
<tr><td class="num" id="LN180">180</td><td class="line">		*arg = rest;</td></tr>
<tr><td class="num" id="LN181">181</td><td class="line">		<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN182">182</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN183">183</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN184">184</td><td class="line">}</td></tr>
<tr><td class="num" id="LN185">185</td><td class="line"> </td></tr>
<tr><td class="num" id="LN186">186</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> parse_ws_error_highlight(<span class='keyword'>const</span> <span class='keyword'>char</span> *arg)</td></tr>
<tr><td class="num" id="LN187">187</td><td class="line">{</td></tr>
<tr><td class="num" id="LN188">188</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *orig_arg = arg;</td></tr>
<tr><td class="num" id="LN189">189</td><td class="line">	<span class='keyword'>unsigned</span> val = 0;</td></tr>
<tr><td class="num" id="LN190">190</td><td class="line"> </td></tr>
<tr><td class="num" id="LN191">191</td><td class="line">	<span class='keyword'>while</span> (*arg) {</td></tr>
<tr><td class="num" id="LN192">192</td><td class="line">		<span class='keyword'>if</span> (parse_one_token(&amp;arg, <span class='string_literal'>"none"</span>))</td></tr>
<tr><td class="num" id="LN193">193</td><td class="line">			val = 0;</td></tr>
<tr><td class="num" id="LN194">194</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (parse_one_token(&amp;arg, <span class='string_literal'>"default"</span>))</td></tr>
<tr><td class="num" id="LN195">195</td><td class="line">			val = <span class='macro'>WSEH_NEW<span class='expansion'>1</span></span>;</td></tr>
<tr><td class="num" id="LN196">196</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (parse_one_token(&amp;arg, <span class='string_literal'>"all"</span>))</td></tr>
<tr><td class="num" id="LN197">197</td><td class="line">			val = <span class='macro'>WSEH_NEW<span class='expansion'>1</span></span> | <span class='macro'>WSEH_OLD<span class='expansion'>4</span></span> | <span class='macro'>WSEH_CONTEXT<span class='expansion'>2</span></span>;</td></tr>
<tr><td class="num" id="LN198">198</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (parse_one_token(&amp;arg, <span class='string_literal'>"new"</span>))</td></tr>
<tr><td class="num" id="LN199">199</td><td class="line">			val |= <span class='macro'>WSEH_NEW<span class='expansion'>1</span></span>;</td></tr>
<tr><td class="num" id="LN200">200</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (parse_one_token(&amp;arg, <span class='string_literal'>"old"</span>))</td></tr>
<tr><td class="num" id="LN201">201</td><td class="line">			val |= <span class='macro'>WSEH_OLD<span class='expansion'>4</span></span>;</td></tr>
<tr><td class="num" id="LN202">202</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (parse_one_token(&amp;arg, <span class='string_literal'>"context"</span>))</td></tr>
<tr><td class="num" id="LN203">203</td><td class="line">			val |= <span class='macro'>WSEH_CONTEXT<span class='expansion'>2</span></span>;</td></tr>
<tr><td class="num" id="LN204">204</td><td class="line">		<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN205">205</td><td class="line">			<span class='keyword'>return</span> -1 - (<span class='keyword'>int</span>)(arg - orig_arg);</td></tr>
<tr><td class="num" id="LN206">206</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN207">207</td><td class="line">		<span class='keyword'>if</span> (*arg)</td></tr>
<tr><td class="num" id="LN208">208</td><td class="line">			arg++;</td></tr>
<tr><td class="num" id="LN209">209</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN210">210</td><td class="line">	<span class='keyword'>return</span> val;</td></tr>
<tr><td class="num" id="LN211">211</td><td class="line">}</td></tr>
<tr><td class="num" id="LN212">212</td><td class="line"> </td></tr>
<tr><td class="num" id="LN213">213</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN214">214</td><td class="line"> <span class='comment'>* These are to give UI layer defaults.</span></td></tr>
<tr><td class="num" id="LN215">215</td><td class="line"> <span class='comment'>* The core-level commands such as git-diff-files should</span></td></tr>
<tr><td class="num" id="LN216">216</td><td class="line"> <span class='comment'>* never be affected by the setting of diff.renames</span></td></tr>
<tr><td class="num" id="LN217">217</td><td class="line"> <span class='comment'>* the user happens to have in the configuration file.</span></td></tr>
<tr><td class="num" id="LN218">218</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN219">219</td><td class="line"><span class='keyword'>void</span> init_diff_ui_defaults(<span class='keyword'>void</span>)</td></tr>
<tr><td class="num" id="LN220">220</td><td class="line">{</td></tr>
<tr><td class="num" id="LN221">221</td><td class="line">	diff_detect_rename_default = 1;</td></tr>
<tr><td class="num" id="LN222">222</td><td class="line">}</td></tr>
<tr><td class="num" id="LN223">223</td><td class="line"> </td></tr>
<tr><td class="num" id="LN224">224</td><td class="line"><span class='keyword'>int</span> git_diff_heuristic_config(<span class='keyword'>const</span> <span class='keyword'>char</span> *var, <span class='keyword'>const</span> <span class='keyword'>char</span> *value, <span class='keyword'>void</span> *cb)</td></tr>
<tr><td class="num" id="LN225">225</td><td class="line">{</td></tr>
<tr><td class="num" id="LN226">226</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.indentheuristic"</span>))</td></tr>
<tr><td class="num" id="LN227">227</td><td class="line">		diff_indent_heuristic = git_config_bool(var, value);</td></tr>
<tr><td class="num" id="LN228">228</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN229">229</td><td class="line">}</td></tr>
<tr><td class="num" id="LN230">230</td><td class="line"> </td></tr>
<tr><td class="num" id="LN231">231</td><td class="line"><span class='keyword'>int</span> git_diff_ui_config(<span class='keyword'>const</span> <span class='keyword'>char</span> *var, <span class='keyword'>const</span> <span class='keyword'>char</span> *value, <span class='keyword'>void</span> *cb)</td></tr>
<tr><td class="num" id="LN232">232</td><td class="line">{</td></tr>
<tr><td class="num" id="LN233">233</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.color"</span>) || !strcmp(var, <span class='string_literal'>"color.diff"</span>)) {</td></tr>
<tr><td class="num" id="LN234">234</td><td class="line">		diff_use_color_default = git_config_colorbool(var, value);</td></tr>
<tr><td class="num" id="LN235">235</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN236">236</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN237">237</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.context"</span>)) {</td></tr>
<tr><td class="num" id="LN238">238</td><td class="line">		diff_context_default = git_config_int(var, value);</td></tr>
<tr><td class="num" id="LN239">239</td><td class="line">		<span class='keyword'>if</span> (diff_context_default &lt; 0)</td></tr>
<tr><td class="num" id="LN240">240</td><td class="line">			<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN241">241</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN242">242</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN243">243</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.interhunkcontext"</span>)) {</td></tr>
<tr><td class="num" id="LN244">244</td><td class="line">		diff_interhunk_context_default = git_config_int(var, value);</td></tr>
<tr><td class="num" id="LN245">245</td><td class="line">		<span class='keyword'>if</span> (diff_interhunk_context_default &lt; 0)</td></tr>
<tr><td class="num" id="LN246">246</td><td class="line">			<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN247">247</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN248">248</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN249">249</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.renames"</span>)) {</td></tr>
<tr><td class="num" id="LN250">250</td><td class="line">		diff_detect_rename_default = git_config_rename(var, value);</td></tr>
<tr><td class="num" id="LN251">251</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN252">252</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN253">253</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.autorefreshindex"</span>)) {</td></tr>
<tr><td class="num" id="LN254">254</td><td class="line">		diff_auto_refresh_index = git_config_bool(var, value);</td></tr>
<tr><td class="num" id="LN255">255</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN256">256</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN257">257</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.mnemonicprefix"</span>)) {</td></tr>
<tr><td class="num" id="LN258">258</td><td class="line">		diff_mnemonic_prefix = git_config_bool(var, value);</td></tr>
<tr><td class="num" id="LN259">259</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN260">260</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN261">261</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.noprefix"</span>)) {</td></tr>
<tr><td class="num" id="LN262">262</td><td class="line">		diff_no_prefix = git_config_bool(var, value);</td></tr>
<tr><td class="num" id="LN263">263</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN264">264</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN265">265</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.statgraphwidth"</span>)) {</td></tr>
<tr><td class="num" id="LN266">266</td><td class="line">		diff_stat_graph_width = git_config_int(var, value);</td></tr>
<tr><td class="num" id="LN267">267</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN268">268</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN269">269</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.external"</span>))</td></tr>
<tr><td class="num" id="LN270">270</td><td class="line">		<span class='keyword'>return</span> git_config_string(&amp;external_diff_cmd_cfg, var, value);</td></tr>
<tr><td class="num" id="LN271">271</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.wordregex"</span>))</td></tr>
<tr><td class="num" id="LN272">272</td><td class="line">		<span class='keyword'>return</span> git_config_string(&amp;diff_word_regex_cfg, var, value);</td></tr>
<tr><td class="num" id="LN273">273</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.orderfile"</span>))</td></tr>
<tr><td class="num" id="LN274">274</td><td class="line">		<span class='keyword'>return</span> git_config_pathname(&amp;diff_order_file_cfg, var, value);</td></tr>
<tr><td class="num" id="LN275">275</td><td class="line"> </td></tr>
<tr><td class="num" id="LN276">276</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.ignoresubmodules"</span>))</td></tr>
<tr><td class="num" id="LN277">277</td><td class="line">		handle_ignore_submodules_arg(&amp;default_diff_options, value);</td></tr>
<tr><td class="num" id="LN278">278</td><td class="line"> </td></tr>
<tr><td class="num" id="LN279">279</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.submodule"</span>)) {</td></tr>
<tr><td class="num" id="LN280">280</td><td class="line">		<span class='keyword'>if</span> (parse_submodule_params(&amp;default_diff_options, value))</td></tr>
<tr><td class="num" id="LN281">281</td><td class="line">			warning(_(<span class='string_literal'>"Unknown value for 'diff.submodule' config variable: '%s'"</span>),</td></tr>
<tr><td class="num" id="LN282">282</td><td class="line">				value);</td></tr>
<tr><td class="num" id="LN283">283</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN284">284</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN285">285</td><td class="line"> </td></tr>
<tr><td class="num" id="LN286">286</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.algorithm"</span>)) {</td></tr>
<tr><td class="num" id="LN287">287</td><td class="line">		diff_algorithm = parse_algorithm_value(value);</td></tr>
<tr><td class="num" id="LN288">288</td><td class="line">		<span class='keyword'>if</span> (diff_algorithm &lt; 0)</td></tr>
<tr><td class="num" id="LN289">289</td><td class="line">			<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN290">290</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN291">291</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN292">292</td><td class="line"> </td></tr>
<tr><td class="num" id="LN293">293</td><td class="line">	<span class='keyword'>if</span> (git_diff_heuristic_config(var, value, cb) &lt; 0)</td></tr>
<tr><td class="num" id="LN294">294</td><td class="line">		<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN295">295</td><td class="line"> </td></tr>
<tr><td class="num" id="LN296">296</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.wserrorhighlight"</span>)) {</td></tr>
<tr><td class="num" id="LN297">297</td><td class="line">		<span class='keyword'>int</span> val = parse_ws_error_highlight(value);</td></tr>
<tr><td class="num" id="LN298">298</td><td class="line">		<span class='keyword'>if</span> (val &lt; 0)</td></tr>
<tr><td class="num" id="LN299">299</td><td class="line">			<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN300">300</td><td class="line">		ws_error_highlight_default = val;</td></tr>
<tr><td class="num" id="LN301">301</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN302">302</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN303">303</td><td class="line"> </td></tr>
<tr><td class="num" id="LN304">304</td><td class="line">	<span class='keyword'>if</span> (git_color_config(var, value, cb) &lt; 0)</td></tr>
<tr><td class="num" id="LN305">305</td><td class="line">		<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN306">306</td><td class="line"> </td></tr>
<tr><td class="num" id="LN307">307</td><td class="line">	<span class='keyword'>return</span> git_diff_basic_config(var, value, cb);</td></tr>
<tr><td class="num" id="LN308">308</td><td class="line">}</td></tr>
<tr><td class="num" id="LN309">309</td><td class="line"> </td></tr>
<tr><td class="num" id="LN310">310</td><td class="line"><span class='keyword'>int</span> git_diff_basic_config(<span class='keyword'>const</span> <span class='keyword'>char</span> *var, <span class='keyword'>const</span> <span class='keyword'>char</span> *value, <span class='keyword'>void</span> *cb)</td></tr>
<tr><td class="num" id="LN311">311</td><td class="line">{</td></tr>
<tr><td class="num" id="LN312">312</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *name;</td></tr>
<tr><td class="num" id="LN313">313</td><td class="line"> </td></tr>
<tr><td class="num" id="LN314">314</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.renamelimit"</span>)) {</td></tr>
<tr><td class="num" id="LN315">315</td><td class="line">		diff_rename_limit_default = git_config_int(var, value);</td></tr>
<tr><td class="num" id="LN316">316</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN317">317</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN318">318</td><td class="line"> </td></tr>
<tr><td class="num" id="LN319">319</td><td class="line">	<span class='keyword'>if</span> (userdiff_config(var, value) &lt; 0)</td></tr>
<tr><td class="num" id="LN320">320</td><td class="line">		<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN321">321</td><td class="line"> </td></tr>
<tr><td class="num" id="LN322">322</td><td class="line">	<span class='keyword'>if</span> (skip_prefix(var, <span class='string_literal'>"diff.color."</span>, &amp;name) ||</td></tr>
<tr><td class="num" id="LN323">323</td><td class="line">	    skip_prefix(var, <span class='string_literal'>"color.diff."</span>, &amp;name)) {</td></tr>
<tr><td class="num" id="LN324">324</td><td class="line">		<span class='keyword'>int</span> slot = parse_diff_color_slot(name);</td></tr>
<tr><td class="num" id="LN325">325</td><td class="line">		<span class='keyword'>if</span> (slot &lt; 0)</td></tr>
<tr><td class="num" id="LN326">326</td><td class="line">			<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN327">327</td><td class="line">		<span class='keyword'>if</span> (!value)</td></tr>
<tr><td class="num" id="LN328">328</td><td class="line">			<span class='keyword'>return</span> <span class='macro'>config_error_nonbool(var)<span class='expansion'>(config_error_nonbool(var), const_error())</span></span>;</td></tr>
<tr><td class="num" id="LN329">329</td><td class="line">		<span class='keyword'>return</span> color_parse(value, diff_colors[slot]);</td></tr>
<tr><td class="num" id="LN330">330</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN331">331</td><td class="line"> </td></tr>
<tr><td class="num" id="LN332">332</td><td class="line">	<span class='comment'>/* like GNU diff's --suppress-blank-empty option  */</span></td></tr>
<tr><td class="num" id="LN333">333</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.suppressblankempty"</span>) ||</td></tr>
<tr><td class="num" id="LN334">334</td><td class="line">			<span class='comment'>/* for backwards compatibility */</span></td></tr>
<tr><td class="num" id="LN335">335</td><td class="line">			!strcmp(var, <span class='string_literal'>"diff.suppress-blank-empty"</span>)) {</td></tr>
<tr><td class="num" id="LN336">336</td><td class="line">		diff_suppress_blank_empty = git_config_bool(var, value);</td></tr>
<tr><td class="num" id="LN337">337</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN338">338</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN339">339</td><td class="line"> </td></tr>
<tr><td class="num" id="LN340">340</td><td class="line">	<span class='keyword'>if</span> (!strcmp(var, <span class='string_literal'>"diff.dirstat"</span>)) {</td></tr>
<tr><td class="num" id="LN341">341</td><td class="line">		<span class='keyword'>struct</span> strbuf errmsg = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN342">342</td><td class="line">		default_diff_options.dirstat_permille = diff_dirstat_permille_default;</td></tr>
<tr><td class="num" id="LN343">343</td><td class="line">		<span class='keyword'>if</span> (parse_dirstat_params(&amp;default_diff_options, value, &amp;errmsg))</td></tr>
<tr><td class="num" id="LN344">344</td><td class="line">			warning(_(<span class='string_literal'>"Found errors in 'diff.dirstat' config variable:\n%s"</span>),</td></tr>
<tr><td class="num" id="LN345">345</td><td class="line">				errmsg.buf);</td></tr>
<tr><td class="num" id="LN346">346</td><td class="line">		strbuf_release(&amp;errmsg);</td></tr>
<tr><td class="num" id="LN347">347</td><td class="line">		diff_dirstat_permille_default = default_diff_options.dirstat_permille;</td></tr>
<tr><td class="num" id="LN348">348</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN349">349</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN350">350</td><td class="line"> </td></tr>
<tr><td class="num" id="LN351">351</td><td class="line">	<span class='keyword'>if</span> (starts_with(var, <span class='string_literal'>"submodule."</span>))</td></tr>
<tr><td class="num" id="LN352">352</td><td class="line">		<span class='keyword'>return</span> parse_submodule_config_option(var, value);</td></tr>
<tr><td class="num" id="LN353">353</td><td class="line"> </td></tr>
<tr><td class="num" id="LN354">354</td><td class="line">	<span class='keyword'>return</span> git_default_config(var, value, cb);</td></tr>
<tr><td class="num" id="LN355">355</td><td class="line">}</td></tr>
<tr><td class="num" id="LN356">356</td><td class="line"> </td></tr>
<tr><td class="num" id="LN357">357</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>char</span> *quote_two(<span class='keyword'>const</span> <span class='keyword'>char</span> *one, <span class='keyword'>const</span> <span class='keyword'>char</span> *two)</td></tr>
<tr><td class="num" id="LN358">358</td><td class="line">{</td></tr>
<tr><td class="num" id="LN359">359</td><td class="line">	<span class='keyword'>int</span> need_one = quote_c_style(one, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 1);</td></tr>
<tr><td class="num" id="LN360">360</td><td class="line">	<span class='keyword'>int</span> need_two = quote_c_style(two, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 1);</td></tr>
<tr><td class="num" id="LN361">361</td><td class="line">	<span class='keyword'>struct</span> strbuf res = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN362">362</td><td class="line"> </td></tr>
<tr><td class="num" id="LN363">363</td><td class="line">	<span class='keyword'>if</span> (need_one + need_two) {</td></tr>
<tr><td class="num" id="LN364">364</td><td class="line">		strbuf_addch(&amp;res, '"');</td></tr>
<tr><td class="num" id="LN365">365</td><td class="line">		quote_c_style(one, &amp;res, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 1);</td></tr>
<tr><td class="num" id="LN366">366</td><td class="line">		quote_c_style(two, &amp;res, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 1);</td></tr>
<tr><td class="num" id="LN367">367</td><td class="line">		strbuf_addch(&amp;res, '"');</td></tr>
<tr><td class="num" id="LN368">368</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN369">369</td><td class="line">		strbuf_addstr(&amp;res, one);</td></tr>
<tr><td class="num" id="LN370">370</td><td class="line">		strbuf_addstr(&amp;res, two);</td></tr>
<tr><td class="num" id="LN371">371</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN372">372</td><td class="line">	<span class='keyword'>return</span> strbuf_detach(&amp;res, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>);</td></tr>
<tr><td class="num" id="LN373">373</td><td class="line">}</td></tr>
<tr><td class="num" id="LN374">374</td><td class="line"> </td></tr>
<tr><td class="num" id="LN375">375</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *external_diff(<span class='keyword'>void</span>)</td></tr>
<tr><td class="num" id="LN376">376</td><td class="line">{</td></tr>
<tr><td class="num" id="LN377">377</td><td class="line">	<span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *external_diff_cmd = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN378">378</td><td class="line">	<span class='keyword'>static</span> <span class='keyword'>int</span> done_preparing = 0;</td></tr>
<tr><td class="num" id="LN379">379</td><td class="line"> </td></tr>
<tr><td class="num" id="LN380">380</td><td class="line">	<span class='keyword'>if</span> (done_preparing)</td></tr>
<tr><td class="num" id="LN381">381</td><td class="line">		<span class='keyword'>return</span> external_diff_cmd;</td></tr>
<tr><td class="num" id="LN382">382</td><td class="line">	external_diff_cmd = getenv(<span class='string_literal'>"GIT_EXTERNAL_DIFF"</span>);</td></tr>
<tr><td class="num" id="LN383">383</td><td class="line">	<span class='keyword'>if</span> (!external_diff_cmd)</td></tr>
<tr><td class="num" id="LN384">384</td><td class="line">		external_diff_cmd = external_diff_cmd_cfg;</td></tr>
<tr><td class="num" id="LN385">385</td><td class="line">	done_preparing = 1;</td></tr>
<tr><td class="num" id="LN386">386</td><td class="line">	<span class='keyword'>return</span> external_diff_cmd;</td></tr>
<tr><td class="num" id="LN387">387</td><td class="line">}</td></tr>
<tr><td class="num" id="LN388">388</td><td class="line"> </td></tr>
<tr><td class="num" id="LN389">389</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN390">390</td><td class="line"> <span class='comment'>* Keep track of files used for diffing. Sometimes such an entry</span></td></tr>
<tr><td class="num" id="LN391">391</td><td class="line"> <span class='comment'>* refers to a temporary file, sometimes to an existing file, and</span></td></tr>
<tr><td class="num" id="LN392">392</td><td class="line"> <span class='comment'>* sometimes to "/dev/null".</span></td></tr>
<tr><td class="num" id="LN393">393</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN394">394</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>struct</span> diff_tempfile {</td></tr>
<tr><td class="num" id="LN395">395</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN396">396</td><td class="line">	 <span class='comment'>* filename external diff should read from, or NULL if this</span></td></tr>
<tr><td class="num" id="LN397">397</td><td class="line">	 <span class='comment'>* entry is currently not in use:</span></td></tr>
<tr><td class="num" id="LN398">398</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN399">399</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *name;</td></tr>
<tr><td class="num" id="LN400">400</td><td class="line"> </td></tr>
<tr><td class="num" id="LN401">401</td><td class="line">	<span class='keyword'>char</span> hex[<span class='macro'>GIT_SHA1_HEXSZ<span class='expansion'>(2 * 20)</span></span> + 1];</td></tr>
<tr><td class="num" id="LN402">402</td><td class="line">	<span class='keyword'>char</span> mode[10];</td></tr>
<tr><td class="num" id="LN403">403</td><td class="line"> </td></tr>
<tr><td class="num" id="LN404">404</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN405">405</td><td class="line">	 <span class='comment'>* If this diff_tempfile instance refers to a temporary file,</span></td></tr>
<tr><td class="num" id="LN406">406</td><td class="line">	 <span class='comment'>* this tempfile object is used to manage its lifetime.</span></td></tr>
<tr><td class="num" id="LN407">407</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN408">408</td><td class="line">	<span class='keyword'>struct</span> tempfile tempfile;</td></tr>
<tr><td class="num" id="LN409">409</td><td class="line">} diff_temp[2];</td></tr>
<tr><td class="num" id="LN410">410</td><td class="line"> </td></tr>
<tr><td class="num" id="LN411">411</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>long</span> (*sane_truncate_fn)(<span class='keyword'>char</span> *line, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> len);</td></tr>
<tr><td class="num" id="LN412">412</td><td class="line"> </td></tr>
<tr><td class="num" id="LN413">413</td><td class="line"><span class='keyword'>struct</span> emit_callback {</td></tr>
<tr><td class="num" id="LN414">414</td><td class="line">	<span class='keyword'>int</span> color_diff;</td></tr>
<tr><td class="num" id="LN415">415</td><td class="line">	<span class='keyword'>unsigned</span> ws_rule;</td></tr>
<tr><td class="num" id="LN416">416</td><td class="line">	<span class='keyword'>int</span> blank_at_eof_in_preimage;</td></tr>
<tr><td class="num" id="LN417">417</td><td class="line">	<span class='keyword'>int</span> blank_at_eof_in_postimage;</td></tr>
<tr><td class="num" id="LN418">418</td><td class="line">	<span class='keyword'>int</span> lno_in_preimage;</td></tr>
<tr><td class="num" id="LN419">419</td><td class="line">	<span class='keyword'>int</span> lno_in_postimage;</td></tr>
<tr><td class="num" id="LN420">420</td><td class="line">	sane_truncate_fn truncate;</td></tr>
<tr><td class="num" id="LN421">421</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> **label_path;</td></tr>
<tr><td class="num" id="LN422">422</td><td class="line">	<span class='keyword'>struct</span> diff_words_data *diff_words;</td></tr>
<tr><td class="num" id="LN423">423</td><td class="line">	<span class='keyword'>struct</span> diff_options *opt;</td></tr>
<tr><td class="num" id="LN424">424</td><td class="line">	<span class='keyword'>struct</span> strbuf *header;</td></tr>
<tr><td class="num" id="LN425">425</td><td class="line">};</td></tr>
<tr><td class="num" id="LN426">426</td><td class="line"> </td></tr>
<tr><td class="num" id="LN427">427</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> count_lines(<span class='keyword'>const</span> <span class='keyword'>char</span> *data, <span class='keyword'>int</span> size)</td></tr>
<tr><td class="num" id="LN428">428</td><td class="line">{</td></tr>
<tr><td class="num" id="LN429">429</td><td class="line">	<span class='keyword'>int</span> count, ch, completely_empty = 1, nl_just_seen = 0;</td></tr>
<tr><td class="num" id="LN430">430</td><td class="line">	count = 0;</td></tr>
<tr><td class="num" id="LN431">431</td><td class="line">	<span class='keyword'>while</span> (0 &lt; size--) {</td></tr>
<tr><td class="num" id="LN432">432</td><td class="line">		ch = *data++;</td></tr>
<tr><td class="num" id="LN433">433</td><td class="line">		<span class='keyword'>if</span> (ch == '\n') {</td></tr>
<tr><td class="num" id="LN434">434</td><td class="line">			count++;</td></tr>
<tr><td class="num" id="LN435">435</td><td class="line">			nl_just_seen = 1;</td></tr>
<tr><td class="num" id="LN436">436</td><td class="line">			completely_empty = 0;</td></tr>
<tr><td class="num" id="LN437">437</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN438">438</td><td class="line">		<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN439">439</td><td class="line">			nl_just_seen = 0;</td></tr>
<tr><td class="num" id="LN440">440</td><td class="line">			completely_empty = 0;</td></tr>
<tr><td class="num" id="LN441">441</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN442">442</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN443">443</td><td class="line">	<span class='keyword'>if</span> (completely_empty)</td></tr>
<tr><td class="num" id="LN444">444</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN445">445</td><td class="line">	<span class='keyword'>if</span> (!nl_just_seen)</td></tr>
<tr><td class="num" id="LN446">446</td><td class="line">		count++; <span class='comment'>/* no trailing newline */</span></td></tr>
<tr><td class="num" id="LN447">447</td><td class="line">	<span class='keyword'>return</span> count;</td></tr>
<tr><td class="num" id="LN448">448</td><td class="line">}</td></tr>
<tr><td class="num" id="LN449">449</td><td class="line"> </td></tr>
<tr><td class="num" id="LN450">450</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> fill_mmfile(mmfile_t *mf, <span class='keyword'>struct</span> diff_filespec *one)</td></tr>
<tr><td class="num" id="LN451">451</td><td class="line">{</td></tr>
<tr><td class="num" id="LN452">452</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>DIFF_FILE_VALID(one)<span class='expansion'>(((one)-&gt;mode) != 0)</span></span>) {</td></tr>
<tr><td class="num" id="LN453">453</td><td class="line">		mf-&gt;ptr = (<span class='keyword'>char</span> *)<span class='string_literal'>""</span>; <span class='comment'>/* does not matter */</span></td></tr>
<tr><td class="num" id="LN454">454</td><td class="line">		mf-&gt;size = 0;</td></tr>
<tr><td class="num" id="LN455">455</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN456">456</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN457">457</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (diff_populate_filespec(one, 0))</td></tr>
<tr><td class="num" id="LN458">458</td><td class="line">		<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN459">459</td><td class="line"> </td></tr>
<tr><td class="num" id="LN460">460</td><td class="line">	mf-&gt;ptr = one-&gt;data;</td></tr>
<tr><td class="num" id="LN461">461</td><td class="line">	mf-&gt;size = one-&gt;size;</td></tr>
<tr><td class="num" id="LN462">462</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN463">463</td><td class="line">}</td></tr>
<tr><td class="num" id="LN464">464</td><td class="line"> </td></tr>
<tr><td class="num" id="LN465">465</td><td class="line"><span class='comment'>/* like fill_mmfile, but only for size, so we can avoid retrieving blob */</span></td></tr>
<tr><td class="num" id="LN466">466</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>long</span> diff_filespec_size(<span class='keyword'>struct</span> diff_filespec *one)</td></tr>
<tr><td class="num" id="LN467">467</td><td class="line">{</td></tr>
<tr><td class="num" id="LN468">468</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>DIFF_FILE_VALID(one)<span class='expansion'>(((one)-&gt;mode) != 0)</span></span>)</td></tr>
<tr><td class="num" id="LN469">469</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN470">470</td><td class="line">	diff_populate_filespec(one, <span class='macro'>CHECK_SIZE_ONLY<span class='expansion'>1</span></span>);</td></tr>
<tr><td class="num" id="LN471">471</td><td class="line">	<span class='keyword'>return</span> one-&gt;size;</td></tr>
<tr><td class="num" id="LN472">472</td><td class="line">}</td></tr>
<tr><td class="num" id="LN473">473</td><td class="line"> </td></tr>
<tr><td class="num" id="LN474">474</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> count_trailing_blank(mmfile_t *mf, <span class='keyword'>unsigned</span> ws_rule)</td></tr>
<tr><td class="num" id="LN475">475</td><td class="line">{</td></tr>
<tr><td class="num" id="LN476">476</td><td class="line">	<span class='keyword'>char</span> *ptr = mf-&gt;ptr;</td></tr>
<tr><td class="num" id="LN477">477</td><td class="line">	<span class='keyword'>long</span> size = mf-&gt;size;</td></tr>
<tr><td class="num" id="LN478">478</td><td class="line">	<span class='keyword'>int</span> cnt = 0;</td></tr>
<tr><td class="num" id="LN479">479</td><td class="line"> </td></tr>
<tr><td class="num" id="LN480">480</td><td class="line">	<span class='keyword'>if</span> (!size)</td></tr>
<tr><td class="num" id="LN481">481</td><td class="line">		<span class='keyword'>return</span> cnt;</td></tr>
<tr><td class="num" id="LN482">482</td><td class="line">	ptr += size - 1; <span class='comment'>/* pointing at the very end */</span></td></tr>
<tr><td class="num" id="LN483">483</td><td class="line">	<span class='keyword'>if</span> (*ptr != '\n')</td></tr>
<tr><td class="num" id="LN484">484</td><td class="line">		; <span class='comment'>/* incomplete line */</span></td></tr>
<tr><td class="num" id="LN485">485</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN486">486</td><td class="line">		ptr--; <span class='comment'>/* skip the last LF */</span></td></tr>
<tr><td class="num" id="LN487">487</td><td class="line">	<span class='keyword'>while</span> (mf-&gt;ptr &lt; ptr) {</td></tr>
<tr><td class="num" id="LN488">488</td><td class="line">		<span class='keyword'>char</span> *prev_eol;</td></tr>
<tr><td class="num" id="LN489">489</td><td class="line">		<span class='keyword'>for</span> (prev_eol = ptr; mf-&gt;ptr &lt;= prev_eol; prev_eol--)</td></tr>
<tr><td class="num" id="LN490">490</td><td class="line">			<span class='keyword'>if</span> (*prev_eol == '\n')</td></tr>
<tr><td class="num" id="LN491">491</td><td class="line">				<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN492">492</td><td class="line">		<span class='keyword'>if</span> (!ws_blank_line(prev_eol + 1, ptr - prev_eol, ws_rule))</td></tr>
<tr><td class="num" id="LN493">493</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN494">494</td><td class="line">		cnt++;</td></tr>
<tr><td class="num" id="LN495">495</td><td class="line">		ptr = prev_eol - 1;</td></tr>
<tr><td class="num" id="LN496">496</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN497">497</td><td class="line">	<span class='keyword'>return</span> cnt;</td></tr>
<tr><td class="num" id="LN498">498</td><td class="line">}</td></tr>
<tr><td class="num" id="LN499">499</td><td class="line"> </td></tr>
<tr><td class="num" id="LN500">500</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> check_blank_at_eof(mmfile_t *mf1, mmfile_t *mf2,</td></tr>
<tr><td class="num" id="LN501">501</td><td class="line">			       <span class='keyword'>struct</span> emit_callback *ecbdata)</td></tr>
<tr><td class="num" id="LN502">502</td><td class="line">{</td></tr>
<tr><td class="num" id="LN503">503</td><td class="line">	<span class='keyword'>int</span> l1, l2, at;</td></tr>
<tr><td class="num" id="LN504">504</td><td class="line">	<span class='keyword'>unsigned</span> ws_rule = ecbdata-&gt;ws_rule;</td></tr>
<tr><td class="num" id="LN505">505</td><td class="line">	l1 = count_trailing_blank(mf1, ws_rule);</td></tr>
<tr><td class="num" id="LN506">506</td><td class="line">	l2 = count_trailing_blank(mf2, ws_rule);</td></tr>
<tr><td class="num" id="LN507">507</td><td class="line">	<span class='keyword'>if</span> (l2 &lt;= l1) {</td></tr>
<tr><td class="num" id="LN508">508</td><td class="line">		ecbdata-&gt;blank_at_eof_in_preimage = 0;</td></tr>
<tr><td class="num" id="LN509">509</td><td class="line">		ecbdata-&gt;blank_at_eof_in_postimage = 0;</td></tr>
<tr><td class="num" id="LN510">510</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN511">511</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN512">512</td><td class="line">	at = count_lines(mf1-&gt;ptr, mf1-&gt;size);</td></tr>
<tr><td class="num" id="LN513">513</td><td class="line">	ecbdata-&gt;blank_at_eof_in_preimage = (at - l1) + 1;</td></tr>
<tr><td class="num" id="LN514">514</td><td class="line"> </td></tr>
<tr><td class="num" id="LN515">515</td><td class="line">	at = count_lines(mf2-&gt;ptr, mf2-&gt;size);</td></tr>
<tr><td class="num" id="LN516">516</td><td class="line">	ecbdata-&gt;blank_at_eof_in_postimage = (at - l2) + 1;</td></tr>
<tr><td class="num" id="LN517">517</td><td class="line">}</td></tr>
<tr><td class="num" id="LN518">518</td><td class="line"> </td></tr>
<tr><td class="num" id="LN519">519</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> emit_line_0(<span class='keyword'>struct</span> diff_options *o, <span class='keyword'>const</span> <span class='keyword'>char</span> *set, <span class='keyword'>const</span> <span class='keyword'>char</span> *reset,</td></tr>
<tr><td class="num" id="LN520">520</td><td class="line">			<span class='keyword'>int</span> first, <span class='keyword'>const</span> <span class='keyword'>char</span> *line, <span class='keyword'>int</span> len)</td></tr>
<tr><td class="num" id="LN521">521</td><td class="line">{</td></tr>
<tr><td class="num" id="LN522">522</td><td class="line">	<span class='keyword'>int</span> has_trailing_newline, has_trailing_carriage_return;</td></tr>
<tr><td class="num" id="LN523">523</td><td class="line">	<span class='keyword'>int</span> nofirst;</td></tr>
<tr><td class="num" id="LN524">524</td><td class="line">	FILE *file = o-&gt;file;</td></tr>
<tr><td class="num" id="LN525">525</td><td class="line"> </td></tr>
<tr><td class="num" id="LN526">526</td><td class="line">	fputs(diff_line_prefix(o), file);</td></tr>
<tr><td class="num" id="LN527">527</td><td class="line"> </td></tr>
<tr><td class="num" id="LN528">528</td><td class="line">	<span class='keyword'>if</span> (len == 0) {</td></tr>
<tr><td class="num" id="LN529">529</td><td class="line">		has_trailing_newline = (first == '\n');</td></tr>
<tr><td class="num" id="LN530">530</td><td class="line">		has_trailing_carriage_return = (!has_trailing_newline &amp;&amp;</td></tr>
<tr><td class="num" id="LN531">531</td><td class="line">						(first == '\r'));</td></tr>
<tr><td class="num" id="LN532">532</td><td class="line">		nofirst = has_trailing_newline || has_trailing_carriage_return;</td></tr>
<tr><td class="num" id="LN533">533</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN534">534</td><td class="line">		has_trailing_newline = (len &gt; 0 &amp;&amp; line[len-1] == '\n');</td></tr>
<tr><td class="num" id="LN535">535</td><td class="line">		<span class='keyword'>if</span> (has_trailing_newline)</td></tr>
<tr><td class="num" id="LN536">536</td><td class="line">			len--;</td></tr>
<tr><td class="num" id="LN537">537</td><td class="line">		has_trailing_carriage_return = (len &gt; 0 &amp;&amp; line[len-1] == '\r');</td></tr>
<tr><td class="num" id="LN538">538</td><td class="line">		<span class='keyword'>if</span> (has_trailing_carriage_return)</td></tr>
<tr><td class="num" id="LN539">539</td><td class="line">			len--;</td></tr>
<tr><td class="num" id="LN540">540</td><td class="line">		nofirst = 0;</td></tr>
<tr><td class="num" id="LN541">541</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN542">542</td><td class="line"> </td></tr>
<tr><td class="num" id="LN543">543</td><td class="line">	<span class='keyword'>if</span> (len || !nofirst) {</td></tr>
<tr><td class="num" id="LN544">544</td><td class="line">		fputs(set, file);</td></tr>
<tr><td class="num" id="LN545">545</td><td class="line">		<span class='keyword'>if</span> (!nofirst)</td></tr>
<tr><td class="num" id="LN546">546</td><td class="line">			fputc(first, file);</td></tr>
<tr><td class="num" id="LN547">547</td><td class="line">		fwrite(line, len, 1, file);</td></tr>
<tr><td class="num" id="LN548">548</td><td class="line">		fputs(reset, file);</td></tr>
<tr><td class="num" id="LN549">549</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN550">550</td><td class="line">	<span class='keyword'>if</span> (has_trailing_carriage_return)</td></tr>
<tr><td class="num" id="LN551">551</td><td class="line">		fputc('\r', file);</td></tr>
<tr><td class="num" id="LN552">552</td><td class="line">	<span class='keyword'>if</span> (has_trailing_newline)</td></tr>
<tr><td class="num" id="LN553">553</td><td class="line">		fputc('\n', file);</td></tr>
<tr><td class="num" id="LN554">554</td><td class="line">}</td></tr>
<tr><td class="num" id="LN555">555</td><td class="line"> </td></tr>
<tr><td class="num" id="LN556">556</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> emit_line(<span class='keyword'>struct</span> diff_options *o, <span class='keyword'>const</span> <span class='keyword'>char</span> *set, <span class='keyword'>const</span> <span class='keyword'>char</span> *reset,</td></tr>
<tr><td class="num" id="LN557">557</td><td class="line">		      <span class='keyword'>const</span> <span class='keyword'>char</span> *line, <span class='keyword'>int</span> len)</td></tr>
<tr><td class="num" id="LN558">558</td><td class="line">{</td></tr>
<tr><td class="num" id="LN559">559</td><td class="line">	emit_line_0(o, set, reset, line[0], line+1, len-1);</td></tr>
<tr><td class="num" id="LN560">560</td><td class="line">}</td></tr>
<tr><td class="num" id="LN561">561</td><td class="line"> </td></tr>
<tr><td class="num" id="LN562">562</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> new_blank_line_at_eof(<span class='keyword'>struct</span> emit_callback *ecbdata, <span class='keyword'>const</span> <span class='keyword'>char</span> *line, <span class='keyword'>int</span> len)</td></tr>
<tr><td class="num" id="LN563">563</td><td class="line">{</td></tr>
<tr><td class="num" id="LN564">564</td><td class="line">	<span class='keyword'>if</span> (!((ecbdata-&gt;ws_rule &amp; <span class='macro'>WS_BLANK_AT_EOF<span class='expansion'>02000</span></span>) &amp;&amp;</td></tr>
<tr><td class="num" id="LN565">565</td><td class="line">	      ecbdata-&gt;blank_at_eof_in_preimage &amp;&amp;</td></tr>
<tr><td class="num" id="LN566">566</td><td class="line">	      ecbdata-&gt;blank_at_eof_in_postimage &amp;&amp;</td></tr>
<tr><td class="num" id="LN567">567</td><td class="line">	      ecbdata-&gt;blank_at_eof_in_preimage &lt;= ecbdata-&gt;lno_in_preimage &amp;&amp;</td></tr>
<tr><td class="num" id="LN568">568</td><td class="line">	      ecbdata-&gt;blank_at_eof_in_postimage &lt;= ecbdata-&gt;lno_in_postimage))</td></tr>
<tr><td class="num" id="LN569">569</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN570">570</td><td class="line">	<span class='keyword'>return</span> ws_blank_line(line, len, ecbdata-&gt;ws_rule);</td></tr>
<tr><td class="num" id="LN571">571</td><td class="line">}</td></tr>
<tr><td class="num" id="LN572">572</td><td class="line"> </td></tr>
<tr><td class="num" id="LN573">573</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> emit_line_checked(<span class='keyword'>const</span> <span class='keyword'>char</span> *reset,</td></tr>
<tr><td class="num" id="LN574">574</td><td class="line">			      <span class='keyword'>struct</span> emit_callback *ecbdata,</td></tr>
<tr><td class="num" id="LN575">575</td><td class="line">			      <span class='keyword'>const</span> <span class='keyword'>char</span> *line, <span class='keyword'>int</span> len,</td></tr>
<tr><td class="num" id="LN576">576</td><td class="line">			      <span class='keyword'>enum</span> color_diff color,</td></tr>
<tr><td class="num" id="LN577">577</td><td class="line">			      <span class='keyword'>unsigned</span> ws_error_highlight,</td></tr>
<tr><td class="num" id="LN578">578</td><td class="line">			      <span class='keyword'>char</span> sign)</td></tr>
<tr><td class="num" id="LN579">579</td><td class="line">{</td></tr>
<tr><td class="num" id="LN580">580</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *set = diff_get_color(ecbdata-&gt;color_diff, color);</td></tr>
<tr><td class="num" id="LN581">581</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *ws = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN582">582</td><td class="line"> </td></tr>
<tr><td class="num" id="LN583">583</td><td class="line">	<span class='keyword'>if</span> (ecbdata-&gt;opt-&gt;ws_error_highlight &amp; ws_error_highlight) {</td></tr>
<tr><td class="num" id="LN584">584</td><td class="line">		ws = diff_get_color(ecbdata-&gt;color_diff, DIFF_WHITESPACE);</td></tr>
<tr><td class="num" id="LN585">585</td><td class="line">		<span class='keyword'>if</span> (!*ws)</td></tr>
<tr><td class="num" id="LN586">586</td><td class="line">			ws = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN587">587</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN588">588</td><td class="line"> </td></tr>
<tr><td class="num" id="LN589">589</td><td class="line">	<span class='keyword'>if</span> (!ws)</td></tr>
<tr><td class="num" id="LN590">590</td><td class="line">		emit_line_0(ecbdata-&gt;opt, set, reset, sign, line, len);</td></tr>
<tr><td class="num" id="LN591">591</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (sign == '+' &amp;&amp; new_blank_line_at_eof(ecbdata, line, len))</td></tr>
<tr><td class="num" id="LN592">592</td><td class="line">		<span class='comment'>/* Blank line at EOF - paint '+' as well */</span></td></tr>
<tr><td class="num" id="LN593">593</td><td class="line">		emit_line_0(ecbdata-&gt;opt, ws, reset, sign, line, len);</td></tr>
<tr><td class="num" id="LN594">594</td><td class="line">	<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN595">595</td><td class="line">		<span class='comment'>/* Emit just the prefix, then the rest. */</span></td></tr>
<tr><td class="num" id="LN596">596</td><td class="line">		emit_line_0(ecbdata-&gt;opt, set, reset, sign, <span class='string_literal'>""</span>, 0);</td></tr>
<tr><td class="num" id="LN597">597</td><td class="line">		ws_check_emit(line, len, ecbdata-&gt;ws_rule,</td></tr>
<tr><td class="num" id="LN598">598</td><td class="line">			      ecbdata-&gt;opt-&gt;file, set, reset, ws);</td></tr>
<tr><td class="num" id="LN599">599</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN600">600</td><td class="line">}</td></tr>
<tr><td class="num" id="LN601">601</td><td class="line"> </td></tr>
<tr><td class="num" id="LN602">602</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> emit_add_line(<span class='keyword'>const</span> <span class='keyword'>char</span> *reset,</td></tr>
<tr><td class="num" id="LN603">603</td><td class="line">			  <span class='keyword'>struct</span> emit_callback *ecbdata,</td></tr>
<tr><td class="num" id="LN604">604</td><td class="line">			  <span class='keyword'>const</span> <span class='keyword'>char</span> *line, <span class='keyword'>int</span> len)</td></tr>
<tr><td class="num" id="LN605">605</td><td class="line">{</td></tr>
<tr><td class="num" id="LN606">606</td><td class="line">	emit_line_checked(reset, ecbdata, line, len,</td></tr>
<tr><td class="num" id="LN607">607</td><td class="line">			  DIFF_FILE_NEW, <span class='macro'>WSEH_NEW<span class='expansion'>1</span></span>, '+');</td></tr>
<tr><td class="num" id="LN608">608</td><td class="line">}</td></tr>
<tr><td class="num" id="LN609">609</td><td class="line"> </td></tr>
<tr><td class="num" id="LN610">610</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> emit_del_line(<span class='keyword'>const</span> <span class='keyword'>char</span> *reset,</td></tr>
<tr><td class="num" id="LN611">611</td><td class="line">			  <span class='keyword'>struct</span> emit_callback *ecbdata,</td></tr>
<tr><td class="num" id="LN612">612</td><td class="line">			  <span class='keyword'>const</span> <span class='keyword'>char</span> *line, <span class='keyword'>int</span> len)</td></tr>
<tr><td class="num" id="LN613">613</td><td class="line">{</td></tr>
<tr><td class="num" id="LN614">614</td><td class="line">	emit_line_checked(reset, ecbdata, line, len,</td></tr>
<tr><td class="num" id="LN615">615</td><td class="line">			  DIFF_FILE_OLD, <span class='macro'>WSEH_OLD<span class='expansion'>4</span></span>, '-');</td></tr>
<tr><td class="num" id="LN616">616</td><td class="line">}</td></tr>
<tr><td class="num" id="LN617">617</td><td class="line"> </td></tr>
<tr><td class="num" id="LN618">618</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> emit_context_line(<span class='keyword'>const</span> <span class='keyword'>char</span> *reset,</td></tr>
<tr><td class="num" id="LN619">619</td><td class="line">			      <span class='keyword'>struct</span> emit_callback *ecbdata,</td></tr>
<tr><td class="num" id="LN620">620</td><td class="line">			      <span class='keyword'>const</span> <span class='keyword'>char</span> *line, <span class='keyword'>int</span> len)</td></tr>
<tr><td class="num" id="LN621">621</td><td class="line">{</td></tr>
<tr><td class="num" id="LN622">622</td><td class="line">	emit_line_checked(reset, ecbdata, line, len,</td></tr>
<tr><td class="num" id="LN623">623</td><td class="line">			  DIFF_CONTEXT, <span class='macro'>WSEH_CONTEXT<span class='expansion'>2</span></span>, ' ');</td></tr>
<tr><td class="num" id="LN624">624</td><td class="line">}</td></tr>
<tr><td class="num" id="LN625">625</td><td class="line"> </td></tr>
<tr><td class="num" id="LN626">626</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> emit_hunk_header(<span class='keyword'>struct</span> emit_callback *ecbdata,</td></tr>
<tr><td class="num" id="LN627">627</td><td class="line">			     <span class='keyword'>const</span> <span class='keyword'>char</span> *line, <span class='keyword'>int</span> len)</td></tr>
<tr><td class="num" id="LN628">628</td><td class="line">{</td></tr>
<tr><td class="num" id="LN629">629</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *context = diff_get_color(ecbdata-&gt;color_diff, DIFF_CONTEXT);</td></tr>
<tr><td class="num" id="LN630">630</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *frag = diff_get_color(ecbdata-&gt;color_diff, DIFF_FRAGINFO);</td></tr>
<tr><td class="num" id="LN631">631</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *func = diff_get_color(ecbdata-&gt;color_diff, DIFF_FUNCINFO);</td></tr>
<tr><td class="num" id="LN632">632</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *reset = diff_get_color(ecbdata-&gt;color_diff, DIFF_RESET);</td></tr>
<tr><td class="num" id="LN633">633</td><td class="line">	<span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> atat[2] = { '@', '@' };</td></tr>
<tr><td class="num" id="LN634">634</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *cp, *ep;</td></tr>
<tr><td class="num" id="LN635">635</td><td class="line">	<span class='keyword'>struct</span> strbuf msgbuf = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN636">636</td><td class="line">	<span class='keyword'>int</span> org_len = len;</td></tr>
<tr><td class="num" id="LN637">637</td><td class="line">	<span class='keyword'>int</span> i = 1;</td></tr>
<tr><td class="num" id="LN638">638</td><td class="line"> </td></tr>
<tr><td class="num" id="LN639">639</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN640">640</td><td class="line">	 <span class='comment'>* As a hunk header must begin with "@@ -&lt;old&gt;, +&lt;new&gt; @@",</span></td></tr>
<tr><td class="num" id="LN641">641</td><td class="line">	 <span class='comment'>* it always is at least 10 bytes long.</span></td></tr>
<tr><td class="num" id="LN642">642</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN643">643</td><td class="line">	<span class='keyword'>if</span> (len &lt; 10 ||</td></tr>
<tr><td class="num" id="LN644">644</td><td class="line">	    memcmp(line, atat, 2) ||</td></tr>
<tr><td class="num" id="LN645">645</td><td class="line">	    !(ep = <span class='macro'>memmem<span class='expansion'>gitmemmem</span></span>(line + 2, len - 2, atat, 2))) {</td></tr>
<tr><td class="num" id="LN646">646</td><td class="line">		emit_line(ecbdata-&gt;opt, context, reset, line, len);</td></tr>
<tr><td class="num" id="LN647">647</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN648">648</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN649">649</td><td class="line">	ep += 2; <span class='comment'>/* skip over @@ */</span></td></tr>
<tr><td class="num" id="LN650">650</td><td class="line"> </td></tr>
<tr><td class="num" id="LN651">651</td><td class="line">	<span class='comment'>/* The hunk header in fraginfo color */</span></td></tr>
<tr><td class="num" id="LN652">652</td><td class="line">	strbuf_addstr(&amp;msgbuf, frag);</td></tr>
<tr><td class="num" id="LN653">653</td><td class="line">	strbuf_add(&amp;msgbuf, line, ep - line);</td></tr>
<tr><td class="num" id="LN654">654</td><td class="line">	strbuf_addstr(&amp;msgbuf, reset);</td></tr>
<tr><td class="num" id="LN655">655</td><td class="line"> </td></tr>
<tr><td class="num" id="LN656">656</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN657">657</td><td class="line">	 <span class='comment'>* trailing "\r\n"</span></td></tr>
<tr><td class="num" id="LN658">658</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN659">659</td><td class="line">	<span class='keyword'>for</span> ( ; i &lt; 3; i++)</td></tr>
<tr><td class="num" id="LN660">660</td><td class="line">		<span class='keyword'>if</span> (line[len - i] == '\r' || line[len - i] == '\n')</td></tr>
<tr><td class="num" id="LN661">661</td><td class="line">			len--;</td></tr>
<tr><td class="num" id="LN662">662</td><td class="line"> </td></tr>
<tr><td class="num" id="LN663">663</td><td class="line">	<span class='comment'>/* blank before the func header */</span></td></tr>
<tr><td class="num" id="LN664">664</td><td class="line">	<span class='keyword'>for</span> (cp = ep; ep - line &lt; len; ep++)</td></tr>
<tr><td class="num" id="LN665">665</td><td class="line">		<span class='keyword'>if</span> (*ep != ' ' &amp;&amp; *ep != '\t')</td></tr>
<tr><td class="num" id="LN666">666</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN667">667</td><td class="line">	<span class='keyword'>if</span> (ep != cp) {</td></tr>
<tr><td class="num" id="LN668">668</td><td class="line">		strbuf_addstr(&amp;msgbuf, context);</td></tr>
<tr><td class="num" id="LN669">669</td><td class="line">		strbuf_add(&amp;msgbuf, cp, ep - cp);</td></tr>
<tr><td class="num" id="LN670">670</td><td class="line">		strbuf_addstr(&amp;msgbuf, reset);</td></tr>
<tr><td class="num" id="LN671">671</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN672">672</td><td class="line"> </td></tr>
<tr><td class="num" id="LN673">673</td><td class="line">	<span class='keyword'>if</span> (ep &lt; line + len) {</td></tr>
<tr><td class="num" id="LN674">674</td><td class="line">		strbuf_addstr(&amp;msgbuf, func);</td></tr>
<tr><td class="num" id="LN675">675</td><td class="line">		strbuf_add(&amp;msgbuf, ep, line + len - ep);</td></tr>
<tr><td class="num" id="LN676">676</td><td class="line">		strbuf_addstr(&amp;msgbuf, reset);</td></tr>
<tr><td class="num" id="LN677">677</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN678">678</td><td class="line"> </td></tr>
<tr><td class="num" id="LN679">679</td><td class="line">	strbuf_add(&amp;msgbuf, line + len, org_len - len);</td></tr>
<tr><td class="num" id="LN680">680</td><td class="line">	emit_line(ecbdata-&gt;opt, <span class='string_literal'>""</span>, <span class='string_literal'>""</span>, msgbuf.buf, msgbuf.len);</td></tr>
<tr><td class="num" id="LN681">681</td><td class="line">	strbuf_release(&amp;msgbuf);</td></tr>
<tr><td class="num" id="LN682">682</td><td class="line">}</td></tr>
<tr><td class="num" id="LN683">683</td><td class="line"> </td></tr>
<tr><td class="num" id="LN684">684</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>struct</span> diff_tempfile *claim_diff_tempfile(<span class='keyword'>void</span>) {</td></tr>
<tr><td class="num" id="LN685">685</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN686">686</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; <span class='macro'>ARRAY_SIZE(diff_temp)<span class='expansion'>(sizeof(diff_temp) / sizeof((diff_temp)[0]) + (sizeof(char [1<br> - 2*!(!__builtin_types_compatible_p(__typeof__(diff_temp), __typeof__<br>(&amp;(diff_temp)[0])))]) - 1))</span></span>; i++)</td></tr>
<tr><td class="num" id="LN687">687</td><td class="line">		<span class='keyword'>if</span> (!diff_temp[i].name)</td></tr>
<tr><td class="num" id="LN688">688</td><td class="line">			<span class='keyword'>return</span> diff_temp + i;</td></tr>
<tr><td class="num" id="LN689">689</td><td class="line">	die(<span class='string_literal'>"BUG: diff is failing to clean up its tempfiles"</span>);</td></tr>
<tr><td class="num" id="LN690">690</td><td class="line">}</td></tr>
<tr><td class="num" id="LN691">691</td><td class="line"> </td></tr>
<tr><td class="num" id="LN692">692</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> remove_tempfile(<span class='keyword'>void</span>)</td></tr>
<tr><td class="num" id="LN693">693</td><td class="line">{</td></tr>
<tr><td class="num" id="LN694">694</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN695">695</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; <span class='macro'>ARRAY_SIZE(diff_temp)<span class='expansion'>(sizeof(diff_temp) / sizeof((diff_temp)[0]) + (sizeof(char [1<br> - 2*!(!__builtin_types_compatible_p(__typeof__(diff_temp), __typeof__<br>(&amp;(diff_temp)[0])))]) - 1))</span></span>; i++) {</td></tr>
<tr><td class="num" id="LN696">696</td><td class="line">		<span class='keyword'>if</span> (is_tempfile_active(&amp;diff_temp[i].tempfile))</td></tr>
<tr><td class="num" id="LN697">697</td><td class="line">			delete_tempfile(&amp;diff_temp[i].tempfile);</td></tr>
<tr><td class="num" id="LN698">698</td><td class="line">		diff_temp[i].name = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN699">699</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN700">700</td><td class="line">}</td></tr>
<tr><td class="num" id="LN701">701</td><td class="line"> </td></tr>
<tr><td class="num" id="LN702">702</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> print_line_count(FILE *file, <span class='keyword'>int</span> count)</td></tr>
<tr><td class="num" id="LN703">703</td><td class="line">{</td></tr>
<tr><td class="num" id="LN704">704</td><td class="line">	<span class='keyword'>switch</span> (count) {</td></tr>
<tr><td class="num" id="LN705">705</td><td class="line">	<span class='keyword'>case</span> 0:</td></tr>
<tr><td class="num" id="LN706">706</td><td class="line">		fprintf(file, <span class='string_literal'>"0,0"</span>);</td></tr>
<tr><td class="num" id="LN707">707</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN708">708</td><td class="line">	<span class='keyword'>case</span> 1:</td></tr>
<tr><td class="num" id="LN709">709</td><td class="line">		fprintf(file, <span class='string_literal'>"1"</span>);</td></tr>
<tr><td class="num" id="LN710">710</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN711">711</td><td class="line">	<span class='keyword'>default</span>:</td></tr>
<tr><td class="num" id="LN712">712</td><td class="line">		fprintf(file, <span class='string_literal'>"1,%d"</span>, count);</td></tr>
<tr><td class="num" id="LN713">713</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN714">714</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN715">715</td><td class="line">}</td></tr>
<tr><td class="num" id="LN716">716</td><td class="line"> </td></tr>
<tr><td class="num" id="LN717">717</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> emit_rewrite_lines(<span class='keyword'>struct</span> emit_callback *ecb,</td></tr>
<tr><td class="num" id="LN718">718</td><td class="line">			       <span class='keyword'>int</span> prefix, <span class='keyword'>const</span> <span class='keyword'>char</span> *data, <span class='keyword'>int</span> size)</td></tr>
<tr><td class="num" id="LN719">719</td><td class="line">{</td></tr>
<tr><td class="num" id="LN720">720</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *endp = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN721">721</td><td class="line">	<span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *nneof = <span class='string_literal'>" No newline at end of file\n"</span>;</td></tr>
<tr><td class="num" id="LN722">722</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *reset = diff_get_color(ecb-&gt;color_diff, DIFF_RESET);</td></tr>
<tr><td class="num" id="LN723">723</td><td class="line"> </td></tr>
<tr><td class="num" id="LN724">724</td><td class="line">	<span class='keyword'>while</span> (0 &lt; size) {</td></tr>
<tr><td class="num" id="LN725">725</td><td class="line">		<span class='keyword'>int</span> len;</td></tr>
<tr><td class="num" id="LN726">726</td><td class="line"> </td></tr>
<tr><td class="num" id="LN727">727</td><td class="line">		endp = memchr(data, '\n', size);</td></tr>
<tr><td class="num" id="LN728">728</td><td class="line">		len = endp ? (endp - data + 1) : size;</td></tr>
<tr><td class="num" id="LN729">729</td><td class="line">		<span class='keyword'>if</span> (prefix != '+') {</td></tr>
<tr><td class="num" id="LN730">730</td><td class="line">			ecb-&gt;lno_in_preimage++;</td></tr>
<tr><td class="num" id="LN731">731</td><td class="line">			emit_del_line(reset, ecb, data, len);</td></tr>
<tr><td class="num" id="LN732">732</td><td class="line">		} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN733">733</td><td class="line">			ecb-&gt;lno_in_postimage++;</td></tr>
<tr><td class="num" id="LN734">734</td><td class="line">			emit_add_line(reset, ecb, data, len);</td></tr>
<tr><td class="num" id="LN735">735</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN736">736</td><td class="line">		size -= len;</td></tr>
<tr><td class="num" id="LN737">737</td><td class="line">		data += len;</td></tr>
<tr><td class="num" id="LN738">738</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN739">739</td><td class="line">	<span class='keyword'>if</span> (!endp) {</td></tr>
<tr><td class="num" id="LN740">740</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *context = diff_get_color(ecb-&gt;color_diff,</td></tr>
<tr><td class="num" id="LN741">741</td><td class="line">						     DIFF_CONTEXT);</td></tr>
<tr><td class="num" id="LN742">742</td><td class="line">		putc('\n', ecb-&gt;opt-&gt;file);</td></tr>
<tr><td class="num" id="LN743">743</td><td class="line">		emit_line_0(ecb-&gt;opt, context, reset, '\\',</td></tr>
<tr><td class="num" id="LN744">744</td><td class="line">			    nneof, strlen(nneof));</td></tr>
<tr><td class="num" id="LN745">745</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN746">746</td><td class="line">}</td></tr>
<tr><td class="num" id="LN747">747</td><td class="line"> </td></tr>
<tr><td class="num" id="LN748">748</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> emit_rewrite_diff(<span class='keyword'>const</span> <span class='keyword'>char</span> *name_a,</td></tr>
<tr><td class="num" id="LN749">749</td><td class="line">			      <span class='keyword'>const</span> <span class='keyword'>char</span> *name_b,</td></tr>
<tr><td class="num" id="LN750">750</td><td class="line">			      <span class='keyword'>struct</span> diff_filespec *one,</td></tr>
<tr><td class="num" id="LN751">751</td><td class="line">			      <span class='keyword'>struct</span> diff_filespec *two,</td></tr>
<tr><td class="num" id="LN752">752</td><td class="line">			      <span class='keyword'>struct</span> userdiff_driver *textconv_one,</td></tr>
<tr><td class="num" id="LN753">753</td><td class="line">			      <span class='keyword'>struct</span> userdiff_driver *textconv_two,</td></tr>
<tr><td class="num" id="LN754">754</td><td class="line">			      <span class='keyword'>struct</span> diff_options *o)</td></tr>
<tr><td class="num" id="LN755">755</td><td class="line">{</td></tr>
<tr><td class="num" id="LN756">756</td><td class="line">	<span class='keyword'>int</span> lc_a, lc_b;</td></tr>
<tr><td class="num" id="LN757">757</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *name_a_tab, *name_b_tab;</td></tr>
<tr><td class="num" id="LN758">758</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *metainfo = diff_get_color(o-&gt;use_color, DIFF_METAINFO);</td></tr>
<tr><td class="num" id="LN759">759</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *fraginfo = diff_get_color(o-&gt;use_color, DIFF_FRAGINFO);</td></tr>
<tr><td class="num" id="LN760">760</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *reset = diff_get_color(o-&gt;use_color, DIFF_RESET);</td></tr>
<tr><td class="num" id="LN761">761</td><td class="line">	<span class='keyword'>static</span> <span class='keyword'>struct</span> strbuf a_name = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>, b_name = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN762">762</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *a_prefix, *b_prefix;</td></tr>
<tr><td class="num" id="LN763">763</td><td class="line">	<span class='keyword'>char</span> *data_one, *data_two;</td></tr>
<tr><td class="num" id="LN764">764</td><td class="line">	size_t size_one, size_two;</td></tr>
<tr><td class="num" id="LN765">765</td><td class="line">	<span class='keyword'>struct</span> emit_callback ecbdata;</td></tr>
<tr><td class="num" id="LN766">766</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *line_prefix = diff_line_prefix(o);</td></tr>
<tr><td class="num" id="LN767">767</td><td class="line"> </td></tr>
<tr><td class="num" id="LN768">768</td><td class="line">	<span class='keyword'>if</span> (diff_mnemonic_prefix &amp;&amp; <span class='macro'>DIFF_OPT_TST(o, REVERSE_DIFF)<span class='expansion'>((o)-&gt;flags &amp; (1 &lt;&lt; 15))</span></span>) {</td></tr>
<tr><td class="num" id="LN769">769</td><td class="line">		a_prefix = o-&gt;b_prefix;</td></tr>
<tr><td class="num" id="LN770">770</td><td class="line">		b_prefix = o-&gt;a_prefix;</td></tr>
<tr><td class="num" id="LN771">771</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN772">772</td><td class="line">		a_prefix = o-&gt;a_prefix;</td></tr>
<tr><td class="num" id="LN773">773</td><td class="line">		b_prefix = o-&gt;b_prefix;</td></tr>
<tr><td class="num" id="LN774">774</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN775">775</td><td class="line"> </td></tr>
<tr><td class="num" id="LN776">776</td><td class="line">	name_a += (*name_a == '/');</td></tr>
<tr><td class="num" id="LN777">777</td><td class="line">	name_b += (*name_b == '/');</td></tr>
<tr><td class="num" id="LN778">778</td><td class="line">	name_a_tab = strchr(name_a, ' ') ? <span class='string_literal'>"\t"</span> : <span class='string_literal'>""</span>;</td></tr>
<tr><td class="num" id="LN779">779</td><td class="line">	name_b_tab = strchr(name_b, ' ') ? <span class='string_literal'>"\t"</span> : <span class='string_literal'>""</span>;</td></tr>
<tr><td class="num" id="LN780">780</td><td class="line"> </td></tr>
<tr><td class="num" id="LN781">781</td><td class="line">	<span class='macro'>strbuf_reset(&amp;a_name)<span class='expansion'>strbuf_setlen(&amp;a_name, 0)</span></span>;</td></tr>
<tr><td class="num" id="LN782">782</td><td class="line">	<span class='macro'>strbuf_reset(&amp;b_name)<span class='expansion'>strbuf_setlen(&amp;b_name, 0)</span></span>;</td></tr>
<tr><td class="num" id="LN783">783</td><td class="line">	quote_two_c_style(&amp;a_name, a_prefix, name_a, 0);</td></tr>
<tr><td class="num" id="LN784">784</td><td class="line">	quote_two_c_style(&amp;b_name, b_prefix, name_b, 0);</td></tr>
<tr><td class="num" id="LN785">785</td><td class="line"> </td></tr>
<tr><td class="num" id="LN786">786</td><td class="line">	size_one = fill_textconv(textconv_one, one, &amp;data_one);</td></tr>
<tr><td class="num" id="LN787">787</td><td class="line">	size_two = fill_textconv(textconv_two, two, &amp;data_two);</td></tr>
<tr><td class="num" id="LN788">788</td><td class="line"> </td></tr>
<tr><td class="num" id="LN789">789</td><td class="line">	<span class='macro'>memset(&amp;ecbdata, 0, <span class='keyword'>sizeof</span>(ecbdata))<span class='expansion'>__builtin___memset_chk (&amp;ecbdata, 0, sizeof(ecbdata), __builtin_object_size<br> (&amp;ecbdata, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN790">790</td><td class="line">	ecbdata.color_diff = want_color(o-&gt;use_color);</td></tr>
<tr><td class="num" id="LN791">791</td><td class="line">	ecbdata.ws_rule = whitespace_rule(name_b);</td></tr>
<tr><td class="num" id="LN792">792</td><td class="line">	ecbdata.opt = o;</td></tr>
<tr><td class="num" id="LN793">793</td><td class="line">	<span class='keyword'>if</span> (ecbdata.ws_rule &amp; <span class='macro'>WS_BLANK_AT_EOF<span class='expansion'>02000</span></span>) {</td></tr>
<tr><td class="num" id="LN794">794</td><td class="line">		mmfile_t mf1, mf2;</td></tr>
<tr><td class="num" id="LN795">795</td><td class="line">		mf1.ptr = (<span class='keyword'>char</span> *)data_one;</td></tr>
<tr><td class="num" id="LN796">796</td><td class="line">		mf2.ptr = (<span class='keyword'>char</span> *)data_two;</td></tr>
<tr><td class="num" id="LN797">797</td><td class="line">		mf1.size = size_one;</td></tr>
<tr><td class="num" id="LN798">798</td><td class="line">		mf2.size = size_two;</td></tr>
<tr><td class="num" id="LN799">799</td><td class="line">		check_blank_at_eof(&amp;mf1, &amp;mf2, &amp;ecbdata);</td></tr>
<tr><td class="num" id="LN800">800</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN801">801</td><td class="line">	ecbdata.lno_in_preimage = 1;</td></tr>
<tr><td class="num" id="LN802">802</td><td class="line">	ecbdata.lno_in_postimage = 1;</td></tr>
<tr><td class="num" id="LN803">803</td><td class="line"> </td></tr>
<tr><td class="num" id="LN804">804</td><td class="line">	lc_a = count_lines(data_one, size_one);</td></tr>
<tr><td class="num" id="LN805">805</td><td class="line">	lc_b = count_lines(data_two, size_two);</td></tr>
<tr><td class="num" id="LN806">806</td><td class="line">	fprintf(o-&gt;file,</td></tr>
<tr><td class="num" id="LN807">807</td><td class="line">		<span class='string_literal'>"%s%s--- %s%s%s\n%s%s+++ %s%s%s\n%s%s@@ -"</span>,</td></tr>
<tr><td class="num" id="LN808">808</td><td class="line">		line_prefix, metainfo, a_name.buf, name_a_tab, reset,</td></tr>
<tr><td class="num" id="LN809">809</td><td class="line">		line_prefix, metainfo, b_name.buf, name_b_tab, reset,</td></tr>
<tr><td class="num" id="LN810">810</td><td class="line">		line_prefix, fraginfo);</td></tr>
<tr><td class="num" id="LN811">811</td><td class="line">	<span class='keyword'>if</span> (!o-&gt;irreversible_delete)</td></tr>
<tr><td class="num" id="LN812">812</td><td class="line">		print_line_count(o-&gt;file, lc_a);</td></tr>
<tr><td class="num" id="LN813">813</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN814">814</td><td class="line">		fprintf(o-&gt;file, <span class='string_literal'>"?,?"</span>);</td></tr>
<tr><td class="num" id="LN815">815</td><td class="line">	fprintf(o-&gt;file, <span class='string_literal'>" +"</span>);</td></tr>
<tr><td class="num" id="LN816">816</td><td class="line">	print_line_count(o-&gt;file, lc_b);</td></tr>
<tr><td class="num" id="LN817">817</td><td class="line">	fprintf(o-&gt;file, <span class='string_literal'>" @@%s\n"</span>, reset);</td></tr>
<tr><td class="num" id="LN818">818</td><td class="line">	<span class='keyword'>if</span> (lc_a &amp;&amp; !o-&gt;irreversible_delete)</td></tr>
<tr><td class="num" id="LN819">819</td><td class="line">		emit_rewrite_lines(&amp;ecbdata, '-', data_one, size_one);</td></tr>
<tr><td class="num" id="LN820">820</td><td class="line">	<span class='keyword'>if</span> (lc_b)</td></tr>
<tr><td class="num" id="LN821">821</td><td class="line">		emit_rewrite_lines(&amp;ecbdata, '+', data_two, size_two);</td></tr>
<tr><td class="num" id="LN822">822</td><td class="line">	<span class='keyword'>if</span> (textconv_one)</td></tr>
<tr><td class="num" id="LN823">823</td><td class="line">		free((<span class='keyword'>char</span> *)data_one);</td></tr>
<tr><td class="num" id="LN824">824</td><td class="line">	<span class='keyword'>if</span> (textconv_two)</td></tr>
<tr><td class="num" id="LN825">825</td><td class="line">		free((<span class='keyword'>char</span> *)data_two);</td></tr>
<tr><td class="num" id="LN826">826</td><td class="line">}</td></tr>
<tr><td class="num" id="LN827">827</td><td class="line"> </td></tr>
<tr><td class="num" id="LN828">828</td><td class="line"><span class='keyword'>struct</span> diff_words_buffer {</td></tr>
<tr><td class="num" id="LN829">829</td><td class="line">	mmfile_t text;</td></tr>
<tr><td class="num" id="LN830">830</td><td class="line">	<span class='keyword'>long</span> alloc;</td></tr>
<tr><td class="num" id="LN831">831</td><td class="line">	<span class='keyword'>struct</span> diff_words_orig {</td></tr>
<tr><td class="num" id="LN832">832</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *begin, *end;</td></tr>
<tr><td class="num" id="LN833">833</td><td class="line">	} *orig;</td></tr>
<tr><td class="num" id="LN834">834</td><td class="line">	<span class='keyword'>int</span> orig_nr, orig_alloc;</td></tr>
<tr><td class="num" id="LN835">835</td><td class="line">};</td></tr>
<tr><td class="num" id="LN836">836</td><td class="line"> </td></tr>
<tr><td class="num" id="LN837">837</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> diff_words_append(<span class='keyword'>char</span> *line, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> len,</td></tr>
<tr><td class="num" id="LN838">838</td><td class="line">		<span class='keyword'>struct</span> diff_words_buffer *buffer)</td></tr>
<tr><td class="num" id="LN839">839</td><td class="line">{</td></tr>
<tr><td class="num" id="LN840">840</td><td class="line">	<span class='macro'>ALLOC_GROW(buffer-&gt;text.ptr, buffer-&gt;text.size + len, buffer-&gt;alloc)<span class='expansion'>do { if ((buffer-&gt;text.size + len) &gt; buffer-&gt;alloc) {<br> if ((((buffer-&gt;alloc)+16)*3/2) &lt; (buffer-&gt;text.size<br> + len)) buffer-&gt;alloc = (buffer-&gt;text.size + len); else<br> buffer-&gt;alloc = (((buffer-&gt;alloc)+16)*3/2); (buffer-&gt;<br>text.ptr) = xrealloc((buffer-&gt;text.ptr), st_mult(sizeof(*(<br>buffer-&gt;text.ptr)), (buffer-&gt;alloc))); } } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN841">841</td><td class="line">	line++;</td></tr>
<tr><td class="num" id="LN842">842</td><td class="line">	len--;</td></tr>
<tr><td class="num" id="LN843">843</td><td class="line">	<span class='macro'>memcpy(buffer-&gt;text.ptr + buffer-&gt;text.size, line, len)<span class='expansion'>__builtin___memcpy_chk (buffer-&gt;text.ptr + buffer-&gt;text<br>.size, line, len, __builtin_object_size (buffer-&gt;text.ptr +<br> buffer-&gt;text.size, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN844">844</td><td class="line">	buffer-&gt;text.size += len;</td></tr>
<tr><td class="num" id="LN845">845</td><td class="line">	buffer-&gt;text.ptr[buffer-&gt;text.size] = '\0';</td></tr>
<tr><td class="num" id="LN846">846</td><td class="line">}</td></tr>
<tr><td class="num" id="LN847">847</td><td class="line"> </td></tr>
<tr><td class="num" id="LN848">848</td><td class="line"><span class='keyword'>struct</span> diff_words_style_elem {</td></tr>
<tr><td class="num" id="LN849">849</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *prefix;</td></tr>
<tr><td class="num" id="LN850">850</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *suffix;</td></tr>
<tr><td class="num" id="LN851">851</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *color; <span class='comment'>/* NULL; filled in by the setup code if</span></td></tr>
<tr><td class="num" id="LN852">852</td><td class="line">			    <span class='comment'>* color is enabled */</span></td></tr>
<tr><td class="num" id="LN853">853</td><td class="line">};</td></tr>
<tr><td class="num" id="LN854">854</td><td class="line"> </td></tr>
<tr><td class="num" id="LN855">855</td><td class="line"><span class='keyword'>struct</span> diff_words_style {</td></tr>
<tr><td class="num" id="LN856">856</td><td class="line">	<span class='keyword'>enum</span> diff_words_type type;</td></tr>
<tr><td class="num" id="LN857">857</td><td class="line">	<span class='keyword'>struct</span> diff_words_style_elem new, old, ctx;</td></tr>
<tr><td class="num" id="LN858">858</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *newline;</td></tr>
<tr><td class="num" id="LN859">859</td><td class="line">};</td></tr>
<tr><td class="num" id="LN860">860</td><td class="line"> </td></tr>
<tr><td class="num" id="LN861">861</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>struct</span> diff_words_style diff_words_styles[] = {</td></tr>
<tr><td class="num" id="LN862">862</td><td class="line">	{ DIFF_WORDS_PORCELAIN, {<span class='string_literal'>"+"</span>, <span class='string_literal'>"\n"</span>}, {<span class='string_literal'>"-"</span>, <span class='string_literal'>"\n"</span>}, {<span class='string_literal'>" "</span>, <span class='string_literal'>"\n"</span>}, <span class='string_literal'>"~\n"</span> },</td></tr>
<tr><td class="num" id="LN863">863</td><td class="line">	{ DIFF_WORDS_PLAIN, {<span class='string_literal'>"{+"</span>, <span class='string_literal'>"+}"</span>}, {<span class='string_literal'>"[-"</span>, <span class='string_literal'>"-]"</span>}, {<span class='string_literal'>""</span>, <span class='string_literal'>""</span>}, <span class='string_literal'>"\n"</span> },</td></tr>
<tr><td class="num" id="LN864">864</td><td class="line">	{ DIFF_WORDS_COLOR, {<span class='string_literal'>""</span>, <span class='string_literal'>""</span>}, {<span class='string_literal'>""</span>, <span class='string_literal'>""</span>}, {<span class='string_literal'>""</span>, <span class='string_literal'>""</span>}, <span class='string_literal'>"\n"</span> }</td></tr>
<tr><td class="num" id="LN865">865</td><td class="line">};</td></tr>
<tr><td class="num" id="LN866">866</td><td class="line"> </td></tr>
<tr><td class="num" id="LN867">867</td><td class="line"><span class='keyword'>struct</span> diff_words_data {</td></tr>
<tr><td class="num" id="LN868">868</td><td class="line">	<span class='keyword'>struct</span> diff_words_buffer minus, plus;</td></tr>
<tr><td class="num" id="LN869">869</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *current_plus;</td></tr>
<tr><td class="num" id="LN870">870</td><td class="line">	<span class='keyword'>int</span> last_minus;</td></tr>
<tr><td class="num" id="LN871">871</td><td class="line">	<span class='keyword'>struct</span> diff_options *opt;</td></tr>
<tr><td class="num" id="LN872">872</td><td class="line">	regex_t *word_regex;</td></tr>
<tr><td class="num" id="LN873">873</td><td class="line">	<span class='keyword'>enum</span> diff_words_type type;</td></tr>
<tr><td class="num" id="LN874">874</td><td class="line">	<span class='keyword'>struct</span> diff_words_style *style;</td></tr>
<tr><td class="num" id="LN875">875</td><td class="line">};</td></tr>
<tr><td class="num" id="LN876">876</td><td class="line"> </td></tr>
<tr><td class="num" id="LN877">877</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> fn_out_diff_words_write_helper(FILE *fp,</td></tr>
<tr><td class="num" id="LN878">878</td><td class="line">					  <span class='keyword'>struct</span> diff_words_style_elem *st_el,</td></tr>
<tr><td class="num" id="LN879">879</td><td class="line">					  <span class='keyword'>const</span> <span class='keyword'>char</span> *newline,</td></tr>
<tr><td class="num" id="LN880">880</td><td class="line">					  size_t count, <span class='keyword'>const</span> <span class='keyword'>char</span> *buf,</td></tr>
<tr><td class="num" id="LN881">881</td><td class="line">					  <span class='keyword'>const</span> <span class='keyword'>char</span> *line_prefix)</td></tr>
<tr><td class="num" id="LN882">882</td><td class="line">{</td></tr>
<tr><td class="num" id="LN883">883</td><td class="line">	<span class='keyword'>int</span> print = 0;</td></tr>
<tr><td class="num" id="LN884">884</td><td class="line"> </td></tr>
<tr><td class="num" id="LN885">885</td><td class="line">	<span class='keyword'>while</span> (count) {</td></tr>
<tr><td class="num" id="LN886">886</td><td class="line">		<span class='keyword'>char</span> *p = memchr(buf, '\n', count);</td></tr>
<tr><td class="num" id="LN887">887</td><td class="line">		<span class='keyword'>if</span> (print)</td></tr>
<tr><td class="num" id="LN888">888</td><td class="line">			fputs(line_prefix, fp);</td></tr>
<tr><td class="num" id="LN889">889</td><td class="line">		<span class='keyword'>if</span> (p != buf) {</td></tr>
<tr><td class="num" id="LN890">890</td><td class="line">			<span class='keyword'>if</span> (st_el-&gt;color &amp;&amp; fputs(st_el-&gt;color, fp) &lt; 0)</td></tr>
<tr><td class="num" id="LN891">891</td><td class="line">				<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN892">892</td><td class="line">			<span class='keyword'>if</span> (fputs(st_el-&gt;prefix, fp) &lt; 0 ||</td></tr>
<tr><td class="num" id="LN893">893</td><td class="line">			    fwrite(buf, p ? p - buf : count, 1, fp) != 1 ||</td></tr>
<tr><td class="num" id="LN894">894</td><td class="line">			    fputs(st_el-&gt;suffix, fp) &lt; 0)</td></tr>
<tr><td class="num" id="LN895">895</td><td class="line">				<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN896">896</td><td class="line">			<span class='keyword'>if</span> (st_el-&gt;color &amp;&amp; *st_el-&gt;color</td></tr>
<tr><td class="num" id="LN897">897</td><td class="line">			    &amp;&amp; fputs(<span class='macro'>GIT_COLOR_RESET<span class='expansion'>"\033[m"</span></span>, fp) &lt; 0)</td></tr>
<tr><td class="num" id="LN898">898</td><td class="line">				<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN899">899</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN900">900</td><td class="line">		<span class='keyword'>if</span> (!p)</td></tr>
<tr><td class="num" id="LN901">901</td><td class="line">			<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN902">902</td><td class="line">		<span class='keyword'>if</span> (fputs(newline, fp) &lt; 0)</td></tr>
<tr><td class="num" id="LN903">903</td><td class="line">			<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN904">904</td><td class="line">		count -= p + 1 - buf;</td></tr>
<tr><td class="num" id="LN905">905</td><td class="line">		buf = p + 1;</td></tr>
<tr><td class="num" id="LN906">906</td><td class="line">		print = 1;</td></tr>
<tr><td class="num" id="LN907">907</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN908">908</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN909">909</td><td class="line">}</td></tr>
<tr><td class="num" id="LN910">910</td><td class="line"> </td></tr>
<tr><td class="num" id="LN911">911</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN912">912</td><td class="line"> <span class='comment'>* '--color-words' algorithm can be described as:</span></td></tr>
<tr><td class="num" id="LN913">913</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN914">914</td><td class="line"> <span class='comment'>*   1. collect a the minus/plus lines of a diff hunk, divided into</span></td></tr>
<tr><td class="num" id="LN915">915</td><td class="line"> <span class='comment'>*      minus-lines and plus-lines;</span></td></tr>
<tr><td class="num" id="LN916">916</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN917">917</td><td class="line"> <span class='comment'>*   2. break both minus-lines and plus-lines into words and</span></td></tr>
<tr><td class="num" id="LN918">918</td><td class="line"> <span class='comment'>*      place them into two mmfile_t with one word for each line;</span></td></tr>
<tr><td class="num" id="LN919">919</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN920">920</td><td class="line"> <span class='comment'>*   3. use xdiff to run diff on the two mmfile_t to get the words level diff;</span></td></tr>
<tr><td class="num" id="LN921">921</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN922">922</td><td class="line"> <span class='comment'>* And for the common parts of the both file, we output the plus side text.</span></td></tr>
<tr><td class="num" id="LN923">923</td><td class="line"> <span class='comment'>* diff_words-&gt;current_plus is used to trace the current position of the plus file</span></td></tr>
<tr><td class="num" id="LN924">924</td><td class="line"> <span class='comment'>* which printed. diff_words-&gt;last_minus is used to trace the last minus word</span></td></tr>
<tr><td class="num" id="LN925">925</td><td class="line"> <span class='comment'>* printed.</span></td></tr>
<tr><td class="num" id="LN926">926</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN927">927</td><td class="line"> <span class='comment'>* For '--graph' to work with '--color-words', we need to output the graph prefix</span></td></tr>
<tr><td class="num" id="LN928">928</td><td class="line"> <span class='comment'>* on each line of color words output. Generally, there are two conditions on</span></td></tr>
<tr><td class="num" id="LN929">929</td><td class="line"> <span class='comment'>* which we should output the prefix.</span></td></tr>
<tr><td class="num" id="LN930">930</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN931">931</td><td class="line"> <span class='comment'>*   1. diff_words-&gt;last_minus == 0 &amp;&amp;</span></td></tr>
<tr><td class="num" id="LN932">932</td><td class="line"> <span class='comment'>*      diff_words-&gt;current_plus == diff_words-&gt;plus.text.ptr</span></td></tr>
<tr><td class="num" id="LN933">933</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN934">934</td><td class="line"> <span class='comment'>*      that is: the plus text must start as a new line, and if there is no minus</span></td></tr>
<tr><td class="num" id="LN935">935</td><td class="line"> <span class='comment'>*      word printed, a graph prefix must be printed.</span></td></tr>
<tr><td class="num" id="LN936">936</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN937">937</td><td class="line"> <span class='comment'>*   2. diff_words-&gt;current_plus &gt; diff_words-&gt;plus.text.ptr &amp;&amp;</span></td></tr>
<tr><td class="num" id="LN938">938</td><td class="line"> <span class='comment'>*      *(diff_words-&gt;current_plus - 1) == '\n'</span></td></tr>
<tr><td class="num" id="LN939">939</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN940">940</td><td class="line"> <span class='comment'>*      that is: a graph prefix must be printed following a '\n'</span></td></tr>
<tr><td class="num" id="LN941">941</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN942">942</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> color_words_output_graph_prefix(<span class='keyword'>struct</span> diff_words_data *diff_words)</td></tr>
<tr><td class="num" id="LN943">943</td><td class="line">{</td></tr>
<tr><td class="num" id="LN944">944</td><td class="line">	<span class='keyword'>if</span> ((diff_words-&gt;last_minus == 0 &amp;&amp;</td></tr>
<tr><td class="num" id="LN945">945</td><td class="line">		diff_words-&gt;current_plus == diff_words-&gt;plus.text.ptr) ||</td></tr>
<tr><td class="num" id="LN946">946</td><td class="line">		(diff_words-&gt;current_plus &gt; diff_words-&gt;plus.text.ptr &amp;&amp;</td></tr>
<tr><td class="num" id="LN947">947</td><td class="line">		*(diff_words-&gt;current_plus - 1) == '\n')) {</td></tr>
<tr><td class="num" id="LN948">948</td><td class="line">		<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN949">949</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN950">950</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN951">951</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN952">952</td><td class="line">}</td></tr>
<tr><td class="num" id="LN953">953</td><td class="line"> </td></tr>
<tr><td class="num" id="LN954">954</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> fn_out_diff_words_aux(<span class='keyword'>void</span> *priv, <span class='keyword'>char</span> *line, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> len)</td></tr>
<tr><td class="num" id="LN955">955</td><td class="line">{</td></tr>
<tr><td class="num" id="LN956">956</td><td class="line">	<span class='keyword'>struct</span> diff_words_data *diff_words = priv;</td></tr>
<tr><td class="num" id="LN957">957</td><td class="line">	<span class='keyword'>struct</span> diff_words_style *style = diff_words-&gt;style;</td></tr>
<tr><td class="num" id="LN958">958</td><td class="line">	<span class='keyword'>int</span> minus_first, minus_len, plus_first, plus_len;</td></tr>
<tr><td class="num" id="LN959">959</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *minus_begin, *minus_end, *plus_begin, *plus_end;</td></tr>
<tr><td class="num" id="LN960">960</td><td class="line">	<span class='keyword'>struct</span> diff_options *opt = diff_words-&gt;opt;</td></tr>
<tr><td class="num" id="LN961">961</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *line_prefix;</td></tr>
<tr><td class="num" id="LN962">962</td><td class="line"> </td></tr>
<tr><td class="num" id="LN963">963</td><td class="line">	<span class='keyword'>if</span> (line[0] != '@' || parse_hunk_header(line, len,</td></tr>
<tr><td class="num" id="LN964">964</td><td class="line">			&amp;minus_first, &amp;minus_len, &amp;plus_first, &amp;plus_len))</td></tr>
<tr><td class="num" id="LN965">965</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN966">966</td><td class="line"> </td></tr>
<tr><td class="num" id="LN967">967</td><td class="line">	<span class='macro'>assert(opt)<span class='expansion'>(__builtin_expect(!(opt), 0) ? __assert_rtn(__func__, "diff.c"<br>, 967, "opt") : (void)0)</span></span>;</td></tr>
<tr><td class="num" id="LN968">968</td><td class="line">	line_prefix = diff_line_prefix(opt);</td></tr>
<tr><td class="num" id="LN969">969</td><td class="line"> </td></tr>
<tr><td class="num" id="LN970">970</td><td class="line">	<span class='comment'>/* POSIX requires that first be decremented by one if len == 0... */</span></td></tr>
<tr><td class="num" id="LN971">971</td><td class="line">	<span class='keyword'>if</span> (minus_len) {</td></tr>
<tr><td class="num" id="LN972">972</td><td class="line">		minus_begin = diff_words-&gt;minus.orig[minus_first].begin;</td></tr>
<tr><td class="num" id="LN973">973</td><td class="line">		minus_end =</td></tr>
<tr><td class="num" id="LN974">974</td><td class="line">			diff_words-&gt;minus.orig[minus_first + minus_len - 1].end;</td></tr>
<tr><td class="num" id="LN975">975</td><td class="line">	} <span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN976">976</td><td class="line">		minus_begin = minus_end =</td></tr>
<tr><td class="num" id="LN977">977</td><td class="line">			diff_words-&gt;minus.orig[minus_first].end;</td></tr>
<tr><td class="num" id="LN978">978</td><td class="line"> </td></tr>
<tr><td class="num" id="LN979">979</td><td class="line">	<span class='keyword'>if</span> (plus_len) {</td></tr>
<tr><td class="num" id="LN980">980</td><td class="line">		plus_begin = diff_words-&gt;plus.orig[plus_first].begin;</td></tr>
<tr><td class="num" id="LN981">981</td><td class="line">		plus_end = diff_words-&gt;plus.orig[plus_first + plus_len - 1].end;</td></tr>
<tr><td class="num" id="LN982">982</td><td class="line">	} <span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN983">983</td><td class="line">		plus_begin = plus_end = diff_words-&gt;plus.orig[plus_first].end;</td></tr>
<tr><td class="num" id="LN984">984</td><td class="line"> </td></tr>
<tr><td class="num" id="LN985">985</td><td class="line">	<span class='keyword'>if</span> (color_words_output_graph_prefix(diff_words)) {</td></tr>
<tr><td class="num" id="LN986">986</td><td class="line">		fputs(line_prefix, diff_words-&gt;opt-&gt;file);</td></tr>
<tr><td class="num" id="LN987">987</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN988">988</td><td class="line">	<span class='keyword'>if</span> (diff_words-&gt;current_plus != plus_begin) {</td></tr>
<tr><td class="num" id="LN989">989</td><td class="line">		fn_out_diff_words_write_helper(diff_words-&gt;opt-&gt;file,</td></tr>
<tr><td class="num" id="LN990">990</td><td class="line">				&amp;style-&gt;ctx, style-&gt;newline,</td></tr>
<tr><td class="num" id="LN991">991</td><td class="line">				plus_begin - diff_words-&gt;current_plus,</td></tr>
<tr><td class="num" id="LN992">992</td><td class="line">				diff_words-&gt;current_plus, line_prefix);</td></tr>
<tr><td class="num" id="LN993">993</td><td class="line">		<span class='keyword'>if</span> (*(plus_begin - 1) == '\n')</td></tr>
<tr><td class="num" id="LN994">994</td><td class="line">			fputs(line_prefix, diff_words-&gt;opt-&gt;file);</td></tr>
<tr><td class="num" id="LN995">995</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN996">996</td><td class="line">	<span class='keyword'>if</span> (minus_begin != minus_end) {</td></tr>
<tr><td class="num" id="LN997">997</td><td class="line">		fn_out_diff_words_write_helper(diff_words-&gt;opt-&gt;file,</td></tr>
<tr><td class="num" id="LN998">998</td><td class="line">				&amp;style-&gt;old, style-&gt;newline,</td></tr>
<tr><td class="num" id="LN999">999</td><td class="line">				minus_end - minus_begin, minus_begin,</td></tr>
<tr><td class="num" id="LN1000">1000</td><td class="line">				line_prefix);</td></tr>
<tr><td class="num" id="LN1001">1001</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1002">1002</td><td class="line">	<span class='keyword'>if</span> (plus_begin != plus_end) {</td></tr>
<tr><td class="num" id="LN1003">1003</td><td class="line">		fn_out_diff_words_write_helper(diff_words-&gt;opt-&gt;file,</td></tr>
<tr><td class="num" id="LN1004">1004</td><td class="line">				&amp;style-&gt;new, style-&gt;newline,</td></tr>
<tr><td class="num" id="LN1005">1005</td><td class="line">				plus_end - plus_begin, plus_begin,</td></tr>
<tr><td class="num" id="LN1006">1006</td><td class="line">				line_prefix);</td></tr>
<tr><td class="num" id="LN1007">1007</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1008">1008</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1009">1009</td><td class="line">	diff_words-&gt;current_plus = plus_end;</td></tr>
<tr><td class="num" id="LN1010">1010</td><td class="line">	diff_words-&gt;last_minus = minus_first;</td></tr>
<tr><td class="num" id="LN1011">1011</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1012">1012</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1013">1013</td><td class="line"><span class='comment'>/* This function starts looking at *begin, and returns 0 iff a word was found. */</span></td></tr>
<tr><td class="num" id="LN1014">1014</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> find_word_boundaries(mmfile_t *buffer, regex_t *word_regex,</td></tr>
<tr><td class="num" id="LN1015">1015</td><td class="line">		<span class='keyword'>int</span> *begin, <span class='keyword'>int</span> *end)</td></tr>
<tr><td class="num" id="LN1016">1016</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1017">1017</td><td class="line">	<span class='keyword'>if</span> (word_regex &amp;&amp; *begin &lt; buffer-&gt;size) {</td></tr>
<tr><td class="num" id="LN1018">1018</td><td class="line">		regmatch_t match[1];</td></tr>
<tr><td class="num" id="LN1019">1019</td><td class="line">		<span class='keyword'>if</span> (!regexec_buf(word_regex, buffer-&gt;ptr + *begin,</td></tr>
<tr><td class="num" id="LN1020">1020</td><td class="line">				 buffer-&gt;size - *begin, 1, match, 0)) {</td></tr>
<tr><td class="num" id="LN1021">1021</td><td class="line">			<span class='keyword'>char</span> *p = memchr(buffer-&gt;ptr + *begin + match[0].rm_so,</td></tr>
<tr><td class="num" id="LN1022">1022</td><td class="line">					'\n', match[0].rm_eo - match[0].rm_so);</td></tr>
<tr><td class="num" id="LN1023">1023</td><td class="line">			*end = p ? p - buffer-&gt;ptr : match[0].rm_eo + *begin;</td></tr>
<tr><td class="num" id="LN1024">1024</td><td class="line">			*begin += match[0].rm_so;</td></tr>
<tr><td class="num" id="LN1025">1025</td><td class="line">			<span class='keyword'>return</span> *begin &gt;= *end;</td></tr>
<tr><td class="num" id="LN1026">1026</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1027">1027</td><td class="line">		<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN1028">1028</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1029">1029</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1030">1030</td><td class="line">	<span class='comment'>/* find the next word */</span></td></tr>
<tr><td class="num" id="LN1031">1031</td><td class="line">	<span class='keyword'>while</span> (*begin &lt; buffer-&gt;size &amp;&amp; <span class='macro'>isspace(buffer-&gt;ptr[*begin])<span class='expansion'>((sane_ctype[(unsigned char)(buffer-&gt;ptr[*begin])] &amp; (<br>0x01)) != 0)</span></span>)</td></tr>
<tr><td class="num" id="LN1032">1032</td><td class="line">		(*begin)++;</td></tr>
<tr><td class="num" id="LN1033">1033</td><td class="line">	<span class='keyword'>if</span> (*begin &gt;= buffer-&gt;size)</td></tr>
<tr><td class="num" id="LN1034">1034</td><td class="line">		<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN1035">1035</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1036">1036</td><td class="line">	<span class='comment'>/* find the end of the word */</span></td></tr>
<tr><td class="num" id="LN1037">1037</td><td class="line">	*end = *begin + 1;</td></tr>
<tr><td class="num" id="LN1038">1038</td><td class="line">	<span class='keyword'>while</span> (*end &lt; buffer-&gt;size &amp;&amp; !<span class='macro'>isspace(buffer-&gt;ptr[*end])<span class='expansion'>((sane_ctype[(unsigned char)(buffer-&gt;ptr[*end])] &amp; (0x01<br>)) != 0)</span></span>)</td></tr>
<tr><td class="num" id="LN1039">1039</td><td class="line">		(*end)++;</td></tr>
<tr><td class="num" id="LN1040">1040</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1041">1041</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN1042">1042</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1043">1043</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1044">1044</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1045">1045</td><td class="line"> <span class='comment'>* This function splits the words in buffer-&gt;text, stores the list with</span></td></tr>
<tr><td class="num" id="LN1046">1046</td><td class="line"> <span class='comment'>* newline separator into out, and saves the offsets of the original words</span></td></tr>
<tr><td class="num" id="LN1047">1047</td><td class="line"> <span class='comment'>* in buffer-&gt;orig.</span></td></tr>
<tr><td class="num" id="LN1048">1048</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1049">1049</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> diff_words_fill(<span class='keyword'>struct</span> diff_words_buffer *buffer, mmfile_t *out,</td></tr>
<tr><td class="num" id="LN1050">1050</td><td class="line">		regex_t *word_regex)</td></tr>
<tr><td class="num" id="LN1051">1051</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1052">1052</td><td class="line">	<span class='keyword'>int</span> i, j;</td></tr>
<tr><td class="num" id="LN1053">1053</td><td class="line">	<span class='keyword'>long</span> alloc = 0;</td></tr>
<tr><td class="num" id="LN1054">1054</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1055">1055</td><td class="line">	out-&gt;size = 0;</td></tr>
<tr><td class="num" id="LN1056">1056</td><td class="line">	out-&gt;ptr = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN1057">1057</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1058">1058</td><td class="line">	<span class='comment'>/* fake an empty "0th" word */</span></td></tr>
<tr><td class="num" id="LN1059">1059</td><td class="line">	<span class='macro'>ALLOC_GROW(buffer-&gt;orig, 1, buffer-&gt;orig_alloc)<span class='expansion'>do { if ((1) &gt; buffer-&gt;orig_alloc) { if ((((buffer-&gt;<br>orig_alloc)+16)*3/2) &lt; (1)) buffer-&gt;orig_alloc = (1); else<br> buffer-&gt;orig_alloc = (((buffer-&gt;orig_alloc)+16)*3/2); (<br>buffer-&gt;orig) = xrealloc((buffer-&gt;orig), st_mult(sizeof<br>(*(buffer-&gt;orig)), (buffer-&gt;orig_alloc))); } } while (0<br>)</span></span>;</td></tr>
<tr><td class="num" id="LN1060">1060</td><td class="line">	buffer-&gt;orig[0].begin = buffer-&gt;orig[0].end = buffer-&gt;text.ptr;</td></tr>
<tr><td class="num" id="LN1061">1061</td><td class="line">	buffer-&gt;orig_nr = 1;</td></tr>
<tr><td class="num" id="LN1062">1062</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1063">1063</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; buffer-&gt;text.size; i++) {</td></tr>
<tr><td class="num" id="LN1064">1064</td><td class="line">		<span class='keyword'>if</span> (find_word_boundaries(&amp;buffer-&gt;text, word_regex, &amp;i, &amp;j))</td></tr>
<tr><td class="num" id="LN1065">1065</td><td class="line">			<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN1066">1066</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1067">1067</td><td class="line">		<span class='comment'>/* store original boundaries */</span></td></tr>
<tr><td class="num" id="LN1068">1068</td><td class="line">		<span class='macro'>ALLOC_GROW(buffer-&gt;orig, buffer-&gt;orig_nr + 1,<span class='expansion'>do { if ((buffer-&gt;orig_nr + 1) &gt; buffer-&gt;orig_alloc)<br> { if ((((buffer-&gt;orig_alloc)+16)*3/2) &lt; (buffer-&gt;orig_nr<br> + 1)) buffer-&gt;orig_alloc = (buffer-&gt;orig_nr + 1); else<br> buffer-&gt;orig_alloc = (((buffer-&gt;orig_alloc)+16)*3/2); (<br>buffer-&gt;orig) = xrealloc((buffer-&gt;orig), st_mult(sizeof<br>(*(buffer-&gt;orig)), (buffer-&gt;orig_alloc))); } } while (0<br>)</span></span></td></tr>
<tr><td class="num" id="LN1069">1069</td><td class="line">				<span class='macro'>buffer-&gt;orig_alloc)<span class='expansion'>do { if ((buffer-&gt;orig_nr + 1) &gt; buffer-&gt;orig_alloc)<br> { if ((((buffer-&gt;orig_alloc)+16)*3/2) &lt; (buffer-&gt;orig_nr<br> + 1)) buffer-&gt;orig_alloc = (buffer-&gt;orig_nr + 1); else<br> buffer-&gt;orig_alloc = (((buffer-&gt;orig_alloc)+16)*3/2); (<br>buffer-&gt;orig) = xrealloc((buffer-&gt;orig), st_mult(sizeof<br>(*(buffer-&gt;orig)), (buffer-&gt;orig_alloc))); } } while (0<br>)</span></span>;</td></tr>
<tr><td class="num" id="LN1070">1070</td><td class="line">		buffer-&gt;orig[buffer-&gt;orig_nr].begin = buffer-&gt;text.ptr + i;</td></tr>
<tr><td class="num" id="LN1071">1071</td><td class="line">		buffer-&gt;orig[buffer-&gt;orig_nr].end = buffer-&gt;text.ptr + j;</td></tr>
<tr><td class="num" id="LN1072">1072</td><td class="line">		buffer-&gt;orig_nr++;</td></tr>
<tr><td class="num" id="LN1073">1073</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1074">1074</td><td class="line">		<span class='comment'>/* store one word */</span></td></tr>
<tr><td class="num" id="LN1075">1075</td><td class="line">		<span class='macro'>ALLOC_GROW(out-&gt;ptr, out-&gt;size + j - i + 1, alloc)<span class='expansion'>do { if ((out-&gt;size + j - i + 1) &gt; alloc) { if ((((alloc<br>)+16)*3/2) &lt; (out-&gt;size + j - i + 1)) alloc = (out-&gt;<br>size + j - i + 1); else alloc = (((alloc)+16)*3/2); (out-&gt;<br>ptr) = xrealloc((out-&gt;ptr), st_mult(sizeof(*(out-&gt;ptr))<br>, (alloc))); } } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN1076">1076</td><td class="line">		<span class='macro'>memcpy(out-&gt;ptr + out-&gt;size, buffer-&gt;text.ptr + i, j - i)<span class='expansion'>__builtin___memcpy_chk (out-&gt;ptr + out-&gt;size, buffer-&gt;<br>text.ptr + i, j - i, __builtin_object_size (out-&gt;ptr + out<br>-&gt;size, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN1077">1077</td><td class="line">		out-&gt;ptr[out-&gt;size + j - i] = '\n';</td></tr>
<tr><td class="num" id="LN1078">1078</td><td class="line">		out-&gt;size += j - i + 1;</td></tr>
<tr><td class="num" id="LN1079">1079</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1080">1080</td><td class="line">		i = j - 1;</td></tr>
<tr><td class="num" id="LN1081">1081</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1082">1082</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1083">1083</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1084">1084</td><td class="line"><span class='comment'>/* this executes the word diff on the accumulated buffers */</span></td></tr>
<tr><td class="num" id="LN1085">1085</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> diff_words_show(<span class='keyword'>struct</span> diff_words_data *diff_words)</td></tr>
<tr><td class="num" id="LN1086">1086</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1087">1087</td><td class="line">	xpparam_t xpp;</td></tr>
<tr><td class="num" id="LN1088">1088</td><td class="line">	xdemitconf_t xecfg;</td></tr>
<tr><td class="num" id="LN1089">1089</td><td class="line">	mmfile_t minus, plus;</td></tr>
<tr><td class="num" id="LN1090">1090</td><td class="line">	<span class='keyword'>struct</span> diff_words_style *style = diff_words-&gt;style;</td></tr>
<tr><td class="num" id="LN1091">1091</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1092">1092</td><td class="line">	<span class='keyword'>struct</span> diff_options *opt = diff_words-&gt;opt;</td></tr>
<tr><td class="num" id="LN1093">1093</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *line_prefix;</td></tr>
<tr><td class="num" id="LN1094">1094</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1095">1095</td><td class="line">	<span class='macro'>assert(opt)<span class='expansion'>(__builtin_expect(!(opt), 0) ? __assert_rtn(__func__, "diff.c"<br>, 1095, "opt") : (void)0)</span></span>;</td></tr>
<tr><td class="num" id="LN1096">1096</td><td class="line">	line_prefix = diff_line_prefix(opt);</td></tr>
<tr><td class="num" id="LN1097">1097</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1098">1098</td><td class="line">	<span class='comment'>/* special case: only removal */</span></td></tr>
<tr><td class="num" id="LN1099">1099</td><td class="line">	<span class='keyword'>if</span> (!diff_words-&gt;plus.text.size) {</td></tr>
<tr><td class="num" id="LN1100">1100</td><td class="line">		fputs(line_prefix, diff_words-&gt;opt-&gt;file);</td></tr>
<tr><td class="num" id="LN1101">1101</td><td class="line">		fn_out_diff_words_write_helper(diff_words-&gt;opt-&gt;file,</td></tr>
<tr><td class="num" id="LN1102">1102</td><td class="line">			&amp;style-&gt;old, style-&gt;newline,</td></tr>
<tr><td class="num" id="LN1103">1103</td><td class="line">			diff_words-&gt;minus.text.size,</td></tr>
<tr><td class="num" id="LN1104">1104</td><td class="line">			diff_words-&gt;minus.text.ptr, line_prefix);</td></tr>
<tr><td class="num" id="LN1105">1105</td><td class="line">		diff_words-&gt;minus.text.size = 0;</td></tr>
<tr><td class="num" id="LN1106">1106</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN1107">1107</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1108">1108</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1109">1109</td><td class="line">	diff_words-&gt;current_plus = diff_words-&gt;plus.text.ptr;</td></tr>
<tr><td class="num" id="LN1110">1110</td><td class="line">	diff_words-&gt;last_minus = 0;</td></tr>
<tr><td class="num" id="LN1111">1111</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1112">1112</td><td class="line">	<span class='macro'>memset(&amp;xpp, 0, <span class='keyword'>sizeof</span>(xpp))<span class='expansion'>__builtin___memset_chk (&amp;xpp, 0, sizeof(xpp), __builtin_object_size<br> (&amp;xpp, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN1113">1113</td><td class="line">	<span class='macro'>memset(&amp;xecfg, 0, <span class='keyword'>sizeof</span>(xecfg))<span class='expansion'>__builtin___memset_chk (&amp;xecfg, 0, sizeof(xecfg), __builtin_object_size<br> (&amp;xecfg, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN1114">1114</td><td class="line">	diff_words_fill(&amp;diff_words-&gt;minus, &amp;minus, diff_words-&gt;word_regex);</td></tr>
<tr><td class="num" id="LN1115">1115</td><td class="line">	diff_words_fill(&amp;diff_words-&gt;plus, &amp;plus, diff_words-&gt;word_regex);</td></tr>
<tr><td class="num" id="LN1116">1116</td><td class="line">	xpp.flags = 0;</td></tr>
<tr><td class="num" id="LN1117">1117</td><td class="line">	<span class='comment'>/* as only the hunk header will be parsed, we need a 0-context */</span></td></tr>
<tr><td class="num" id="LN1118">1118</td><td class="line">	xecfg.ctxlen = 0;</td></tr>
<tr><td class="num" id="LN1119">1119</td><td class="line">	<span class='keyword'>if</span> (xdi_diff_outf(&amp;minus, &amp;plus, fn_out_diff_words_aux, diff_words,</td></tr>
<tr><td class="num" id="LN1120">1120</td><td class="line">			  &amp;xpp, &amp;xecfg))</td></tr>
<tr><td class="num" id="LN1121">1121</td><td class="line">		die(<span class='string_literal'>"unable to generate word diff"</span>);</td></tr>
<tr><td class="num" id="LN1122">1122</td><td class="line">	free(minus.ptr);</td></tr>
<tr><td class="num" id="LN1123">1123</td><td class="line">	free(plus.ptr);</td></tr>
<tr><td class="num" id="LN1124">1124</td><td class="line">	<span class='keyword'>if</span> (diff_words-&gt;current_plus != diff_words-&gt;plus.text.ptr +</td></tr>
<tr><td class="num" id="LN1125">1125</td><td class="line">			diff_words-&gt;plus.text.size) {</td></tr>
<tr><td class="num" id="LN1126">1126</td><td class="line">		<span class='keyword'>if</span> (color_words_output_graph_prefix(diff_words))</td></tr>
<tr><td class="num" id="LN1127">1127</td><td class="line">			fputs(line_prefix, diff_words-&gt;opt-&gt;file);</td></tr>
<tr><td class="num" id="LN1128">1128</td><td class="line">		fn_out_diff_words_write_helper(diff_words-&gt;opt-&gt;file,</td></tr>
<tr><td class="num" id="LN1129">1129</td><td class="line">			&amp;style-&gt;ctx, style-&gt;newline,</td></tr>
<tr><td class="num" id="LN1130">1130</td><td class="line">			diff_words-&gt;plus.text.ptr + diff_words-&gt;plus.text.size</td></tr>
<tr><td class="num" id="LN1131">1131</td><td class="line">			- diff_words-&gt;current_plus, diff_words-&gt;current_plus,</td></tr>
<tr><td class="num" id="LN1132">1132</td><td class="line">			line_prefix);</td></tr>
<tr><td class="num" id="LN1133">1133</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1134">1134</td><td class="line">	diff_words-&gt;minus.text.size = diff_words-&gt;plus.text.size = 0;</td></tr>
<tr><td class="num" id="LN1135">1135</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1136">1136</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1137">1137</td><td class="line"><span class='comment'>/* In "color-words" mode, show word-diff of words accumulated in the buffer */</span></td></tr>
<tr><td class="num" id="LN1138">1138</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> diff_words_flush(<span class='keyword'>struct</span> emit_callback *ecbdata)</td></tr>
<tr><td class="num" id="LN1139">1139</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1140">1140</td><td class="line">	<span class='keyword'>if</span> (ecbdata-&gt;diff_words-&gt;minus.text.size ||</td></tr>
<tr><td class="num" id="LN1141">1141</td><td class="line">	    ecbdata-&gt;diff_words-&gt;plus.text.size)</td></tr>
<tr><td class="num" id="LN1142">1142</td><td class="line">		diff_words_show(ecbdata-&gt;diff_words);</td></tr>
<tr><td class="num" id="LN1143">1143</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1144">1144</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1145">1145</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> diff_filespec_load_driver(<span class='keyword'>struct</span> diff_filespec *one)</td></tr>
<tr><td class="num" id="LN1146">1146</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1147">1147</td><td class="line">	<span class='comment'>/* Use already-loaded driver */</span></td></tr>
<tr><td class="num" id="LN1148">1148</td><td class="line">	<span class='keyword'>if</span> (one-&gt;driver)</td></tr>
<tr><td class="num" id="LN1149">1149</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN1150">1150</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1151">1151</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>S_ISREG(one-&gt;mode)<span class='expansion'>(((one-&gt;mode) &amp; 0170000) == 0100000)</span></span>)</td></tr>
<tr><td class="num" id="LN1152">1152</td><td class="line">		one-&gt;driver = userdiff_find_by_path(one-&gt;path);</td></tr>
<tr><td class="num" id="LN1153">1153</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1154">1154</td><td class="line">	<span class='comment'>/* Fallback to default settings */</span></td></tr>
<tr><td class="num" id="LN1155">1155</td><td class="line">	<span class='keyword'>if</span> (!one-&gt;driver)</td></tr>
<tr><td class="num" id="LN1156">1156</td><td class="line">		one-&gt;driver = userdiff_find_by_name(<span class='string_literal'>"default"</span>);</td></tr>
<tr><td class="num" id="LN1157">1157</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1158">1158</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1159">1159</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *userdiff_word_regex(<span class='keyword'>struct</span> diff_filespec *one)</td></tr>
<tr><td class="num" id="LN1160">1160</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1161">1161</td><td class="line">	diff_filespec_load_driver(one);</td></tr>
<tr><td class="num" id="LN1162">1162</td><td class="line">	<span class='keyword'>return</span> one-&gt;driver-&gt;word_regex;</td></tr>
<tr><td class="num" id="LN1163">1163</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1164">1164</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1165">1165</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> init_diff_words_data(<span class='keyword'>struct</span> emit_callback *ecbdata,</td></tr>
<tr><td class="num" id="LN1166">1166</td><td class="line">				 <span class='keyword'>struct</span> diff_options *orig_opts,</td></tr>
<tr><td class="num" id="LN1167">1167</td><td class="line">				 <span class='keyword'>struct</span> diff_filespec *one,</td></tr>
<tr><td class="num" id="LN1168">1168</td><td class="line">				 <span class='keyword'>struct</span> diff_filespec *two)</td></tr>
<tr><td class="num" id="LN1169">1169</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1170">1170</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN1171">1171</td><td class="line">	<span class='keyword'>struct</span> diff_options *o = xmalloc(<span class='keyword'>sizeof</span>(<span class='keyword'>struct</span> diff_options));</td></tr>
<tr><td class="num" id="LN1172">1172</td><td class="line">	<span class='macro'>memcpy(o, orig_opts, <span class='keyword'>sizeof</span>(<span class='keyword'>struct</span> diff_options))<span class='expansion'>__builtin___memcpy_chk (o, orig_opts, sizeof(struct diff_options<br>), __builtin_object_size (o, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN1173">1173</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1174">1174</td><td class="line">	ecbdata-&gt;diff_words =</td></tr>
<tr><td class="num" id="LN1175">1175</td><td class="line">		xcalloc(1, <span class='keyword'>sizeof</span>(<span class='keyword'>struct</span> diff_words_data));</td></tr>
<tr><td class="num" id="LN1176">1176</td><td class="line">	ecbdata-&gt;diff_words-&gt;type = o-&gt;word_diff;</td></tr>
<tr><td class="num" id="LN1177">1177</td><td class="line">	ecbdata-&gt;diff_words-&gt;opt = o;</td></tr>
<tr><td class="num" id="LN1178">1178</td><td class="line">	<span class='keyword'>if</span> (!o-&gt;word_regex)</td></tr>
<tr><td class="num" id="LN1179">1179</td><td class="line">		o-&gt;word_regex = userdiff_word_regex(one);</td></tr>
<tr><td class="num" id="LN1180">1180</td><td class="line">	<span class='keyword'>if</span> (!o-&gt;word_regex)</td></tr>
<tr><td class="num" id="LN1181">1181</td><td class="line">		o-&gt;word_regex = userdiff_word_regex(two);</td></tr>
<tr><td class="num" id="LN1182">1182</td><td class="line">	<span class='keyword'>if</span> (!o-&gt;word_regex)</td></tr>
<tr><td class="num" id="LN1183">1183</td><td class="line">		o-&gt;word_regex = diff_word_regex_cfg;</td></tr>
<tr><td class="num" id="LN1184">1184</td><td class="line">	<span class='keyword'>if</span> (o-&gt;word_regex) {</td></tr>
<tr><td class="num" id="LN1185">1185</td><td class="line">		ecbdata-&gt;diff_words-&gt;word_regex = (regex_t *)</td></tr>
<tr><td class="num" id="LN1186">1186</td><td class="line">			xmalloc(<span class='keyword'>sizeof</span>(regex_t));</td></tr>
<tr><td class="num" id="LN1187">1187</td><td class="line">		<span class='keyword'>if</span> (regcomp(ecbdata-&gt;diff_words-&gt;word_regex,</td></tr>
<tr><td class="num" id="LN1188">1188</td><td class="line">			    o-&gt;word_regex,</td></tr>
<tr><td class="num" id="LN1189">1189</td><td class="line">			    <span class='macro'>REG_EXTENDED<span class='expansion'>1</span></span> | <span class='macro'>REG_NEWLINE<span class='expansion'>((1 &lt;&lt; 1) &lt;&lt; 1)</span></span>))</td></tr>
<tr><td class="num" id="LN1190">1190</td><td class="line">			die (<span class='string_literal'>"Invalid regular expression: %s"</span>,</td></tr>
<tr><td class="num" id="LN1191">1191</td><td class="line">			     o-&gt;word_regex);</td></tr>
<tr><td class="num" id="LN1192">1192</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1193">1193</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; <span class='macro'>ARRAY_SIZE(diff_words_styles)<span class='expansion'>(sizeof(diff_words_styles) / sizeof((diff_words_styles)[0]) +<br> (sizeof(char [1 - 2*!(!__builtin_types_compatible_p(__typeof__<br>(diff_words_styles), __typeof__(&amp;(diff_words_styles)[0]))<br>)]) - 1))</span></span>; i++) {</td></tr>
<tr><td class="num" id="LN1194">1194</td><td class="line">		<span class='keyword'>if</span> (o-&gt;word_diff == diff_words_styles[i].type) {</td></tr>
<tr><td class="num" id="LN1195">1195</td><td class="line">			ecbdata-&gt;diff_words-&gt;style =</td></tr>
<tr><td class="num" id="LN1196">1196</td><td class="line">				&amp;diff_words_styles[i];</td></tr>
<tr><td class="num" id="LN1197">1197</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN1198">1198</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1199">1199</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1200">1200</td><td class="line">	<span class='keyword'>if</span> (want_color(o-&gt;use_color)) {</td></tr>
<tr><td class="num" id="LN1201">1201</td><td class="line">		<span class='keyword'>struct</span> diff_words_style *st = ecbdata-&gt;diff_words-&gt;style;</td></tr>
<tr><td class="num" id="LN1202">1202</td><td class="line">		st-&gt;old.color = <span class='macro'>diff_get_color_opt(o, DIFF_FILE_OLD)<span class='expansion'>diff_get_color((o)-&gt;use_color, DIFF_FILE_OLD)</span></span>;</td></tr>
<tr><td class="num" id="LN1203">1203</td><td class="line">		st-&gt;new.color = <span class='macro'>diff_get_color_opt(o, DIFF_FILE_NEW)<span class='expansion'>diff_get_color((o)-&gt;use_color, DIFF_FILE_NEW)</span></span>;</td></tr>
<tr><td class="num" id="LN1204">1204</td><td class="line">		st-&gt;ctx.color = <span class='macro'>diff_get_color_opt(o, DIFF_CONTEXT)<span class='expansion'>diff_get_color((o)-&gt;use_color, DIFF_CONTEXT)</span></span>;</td></tr>
<tr><td class="num" id="LN1205">1205</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1206">1206</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1207">1207</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1208">1208</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> free_diff_words_data(<span class='keyword'>struct</span> emit_callback *ecbdata)</td></tr>
<tr><td class="num" id="LN1209">1209</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1210">1210</td><td class="line">	<span class='keyword'>if</span> (ecbdata-&gt;diff_words) {</td></tr>
<tr><td class="num" id="LN1211">1211</td><td class="line">		diff_words_flush(ecbdata);</td></tr>
<tr><td class="num" id="LN1212">1212</td><td class="line">		free (ecbdata-&gt;diff_words-&gt;opt);</td></tr>
<tr><td class="num" id="LN1213">1213</td><td class="line">		free (ecbdata-&gt;diff_words-&gt;minus.text.ptr);</td></tr>
<tr><td class="num" id="LN1214">1214</td><td class="line">		free (ecbdata-&gt;diff_words-&gt;minus.orig);</td></tr>
<tr><td class="num" id="LN1215">1215</td><td class="line">		free (ecbdata-&gt;diff_words-&gt;plus.text.ptr);</td></tr>
<tr><td class="num" id="LN1216">1216</td><td class="line">		free (ecbdata-&gt;diff_words-&gt;plus.orig);</td></tr>
<tr><td class="num" id="LN1217">1217</td><td class="line">		<span class='keyword'>if</span> (ecbdata-&gt;diff_words-&gt;word_regex) {</td></tr>
<tr><td class="num" id="LN1218">1218</td><td class="line">			regfree(ecbdata-&gt;diff_words-&gt;word_regex);</td></tr>
<tr><td class="num" id="LN1219">1219</td><td class="line">			free(ecbdata-&gt;diff_words-&gt;word_regex);</td></tr>
<tr><td class="num" id="LN1220">1220</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1221">1221</td><td class="line">		free(ecbdata-&gt;diff_words);</td></tr>
<tr><td class="num" id="LN1222">1222</td><td class="line">		ecbdata-&gt;diff_words = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN1223">1223</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1224">1224</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1225">1225</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1226">1226</td><td class="line"><span class='keyword'>const</span> <span class='keyword'>char</span> *diff_get_color(<span class='keyword'>int</span> diff_use_color, <span class='keyword'>enum</span> color_diff ix)</td></tr>
<tr><td class="num" id="LN1227">1227</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1228">1228</td><td class="line">	<span class='keyword'>if</span> (want_color(diff_use_color))</td></tr>
<tr><td class="num" id="LN1229">1229</td><td class="line">		<span class='keyword'>return</span> diff_colors[ix];</td></tr>
<tr><td class="num" id="LN1230">1230</td><td class="line">	<span class='keyword'>return</span> <span class='string_literal'>""</span>;</td></tr>
<tr><td class="num" id="LN1231">1231</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1232">1232</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1233">1233</td><td class="line"><span class='keyword'>const</span> <span class='keyword'>char</span> *diff_line_prefix(<span class='keyword'>struct</span> diff_options *opt)</td></tr>
<tr><td class="num" id="LN1234">1234</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1235">1235</td><td class="line">	<span class='keyword'>struct</span> strbuf *msgbuf;</td></tr>
<tr><td class="num" id="LN1236">1236</td><td class="line">	<span class='keyword'>if</span> (!opt-&gt;output_prefix)</td></tr>
<tr><td class="num" id="LN1237">1237</td><td class="line">		<span class='keyword'>return</span> <span class='string_literal'>""</span>;</td></tr>
<tr><td class="num" id="LN1238">1238</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1239">1239</td><td class="line">	msgbuf = opt-&gt;output_prefix(opt, opt-&gt;output_prefix_data);</td></tr>
<tr><td class="num" id="LN1240">1240</td><td class="line">	<span class='keyword'>return</span> msgbuf-&gt;buf;</td></tr>
<tr><td class="num" id="LN1241">1241</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1242">1242</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1243">1243</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>long</span> sane_truncate_line(<span class='keyword'>struct</span> emit_callback *ecb, <span class='keyword'>char</span> *line, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> len)</td></tr>
<tr><td class="num" id="LN1244">1244</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1245">1245</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *cp;</td></tr>
<tr><td class="num" id="LN1246">1246</td><td class="line">	<span class='keyword'>unsigned</span> <span class='keyword'>long</span> allot;</td></tr>
<tr><td class="num" id="LN1247">1247</td><td class="line">	size_t l = len;</td></tr>
<tr><td class="num" id="LN1248">1248</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1249">1249</td><td class="line">	<span class='keyword'>if</span> (ecb-&gt;truncate)</td></tr>
<tr><td class="num" id="LN1250">1250</td><td class="line">		<span class='keyword'>return</span> ecb-&gt;truncate(line, len);</td></tr>
<tr><td class="num" id="LN1251">1251</td><td class="line">	cp = line;</td></tr>
<tr><td class="num" id="LN1252">1252</td><td class="line">	allot = l;</td></tr>
<tr><td class="num" id="LN1253">1253</td><td class="line">	<span class='keyword'>while</span> (0 &lt; l) {</td></tr>
<tr><td class="num" id="LN1254">1254</td><td class="line">		(<span class='keyword'>void</span>) utf8_width(&amp;cp, &amp;l);</td></tr>
<tr><td class="num" id="LN1255">1255</td><td class="line">		<span class='keyword'>if</span> (!cp)</td></tr>
<tr><td class="num" id="LN1256">1256</td><td class="line">			<span class='keyword'>break</span>; <span class='comment'>/* truncated in the middle? */</span></td></tr>
<tr><td class="num" id="LN1257">1257</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1258">1258</td><td class="line">	<span class='keyword'>return</span> allot - l;</td></tr>
<tr><td class="num" id="LN1259">1259</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1260">1260</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1261">1261</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> find_lno(<span class='keyword'>const</span> <span class='keyword'>char</span> *line, <span class='keyword'>struct</span> emit_callback *ecbdata)</td></tr>
<tr><td class="num" id="LN1262">1262</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1263">1263</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *p;</td></tr>
<tr><td class="num" id="LN1264">1264</td><td class="line">	ecbdata-&gt;lno_in_preimage = 0;</td></tr>
<tr><td class="num" id="LN1265">1265</td><td class="line">	ecbdata-&gt;lno_in_postimage = 0;</td></tr>
<tr><td class="num" id="LN1266">1266</td><td class="line">	p = strchr(line, '-');</td></tr>
<tr><td class="num" id="LN1267">1267</td><td class="line">	<span class='keyword'>if</span> (!p)</td></tr>
<tr><td class="num" id="LN1268">1268</td><td class="line">		<span class='keyword'>return</span>; <span class='comment'>/* cannot happen */</span></td></tr>
<tr><td class="num" id="LN1269">1269</td><td class="line">	ecbdata-&gt;lno_in_preimage = strtol(p + 1, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 10);</td></tr>
<tr><td class="num" id="LN1270">1270</td><td class="line">	p = strchr(p, '+');</td></tr>
<tr><td class="num" id="LN1271">1271</td><td class="line">	<span class='keyword'>if</span> (!p)</td></tr>
<tr><td class="num" id="LN1272">1272</td><td class="line">		<span class='keyword'>return</span>; <span class='comment'>/* cannot happen */</span></td></tr>
<tr><td class="num" id="LN1273">1273</td><td class="line">	ecbdata-&gt;lno_in_postimage = strtol(p + 1, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 10);</td></tr>
<tr><td class="num" id="LN1274">1274</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1275">1275</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1276">1276</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> fn_out_consume(<span class='keyword'>void</span> *priv, <span class='keyword'>char</span> *line, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> len)</td></tr>
<tr><td class="num" id="LN1277">1277</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1278">1278</td><td class="line">	<span class='keyword'>struct</span> emit_callback *ecbdata = priv;</td></tr>
<tr><td class="num" id="LN1279">1279</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *meta = diff_get_color(ecbdata-&gt;color_diff, DIFF_METAINFO);</td></tr>
<tr><td class="num" id="LN1280">1280</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *context = diff_get_color(ecbdata-&gt;color_diff, DIFF_CONTEXT);</td></tr>
<tr><td class="num" id="LN1281">1281</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *reset = diff_get_color(ecbdata-&gt;color_diff, DIFF_RESET);</td></tr>
<tr><td class="num" id="LN1282">1282</td><td class="line">	<span class='keyword'>struct</span> diff_options *o = ecbdata-&gt;opt;</td></tr>
<tr><td class="num" id="LN1283">1283</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *line_prefix = diff_line_prefix(o);</td></tr>
<tr><td class="num" id="LN1284">1284</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1285">1285</td><td class="line">	o-&gt;found_changes = 1;</td></tr>
<tr><td class="num" id="LN1286">1286</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1287">1287</td><td class="line">	<span class='keyword'>if</span> (ecbdata-&gt;header) {</td></tr>
<tr><td class="num" id="LN1288">1288</td><td class="line">		fprintf(o-&gt;file, <span class='string_literal'>"%s"</span>, ecbdata-&gt;header-&gt;buf);</td></tr>
<tr><td class="num" id="LN1289">1289</td><td class="line">		<span class='macro'>strbuf_reset(ecbdata-&gt;header)<span class='expansion'>strbuf_setlen(ecbdata-&gt;header, 0)</span></span>;</td></tr>
<tr><td class="num" id="LN1290">1290</td><td class="line">		ecbdata-&gt;header = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN1291">1291</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1292">1292</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1293">1293</td><td class="line">	<span class='keyword'>if</span> (ecbdata-&gt;label_path[0]) {</td></tr>
<tr><td class="num" id="LN1294">1294</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *name_a_tab, *name_b_tab;</td></tr>
<tr><td class="num" id="LN1295">1295</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1296">1296</td><td class="line">		name_a_tab = strchr(ecbdata-&gt;label_path[0], ' ') ? <span class='string_literal'>"\t"</span> : <span class='string_literal'>""</span>;</td></tr>
<tr><td class="num" id="LN1297">1297</td><td class="line">		name_b_tab = strchr(ecbdata-&gt;label_path[1], ' ') ? <span class='string_literal'>"\t"</span> : <span class='string_literal'>""</span>;</td></tr>
<tr><td class="num" id="LN1298">1298</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1299">1299</td><td class="line">		fprintf(o-&gt;file, <span class='string_literal'>"%s%s--- %s%s%s\n"</span>,</td></tr>
<tr><td class="num" id="LN1300">1300</td><td class="line">			line_prefix, meta, ecbdata-&gt;label_path[0], reset, name_a_tab);</td></tr>
<tr><td class="num" id="LN1301">1301</td><td class="line">		fprintf(o-&gt;file, <span class='string_literal'>"%s%s+++ %s%s%s\n"</span>,</td></tr>
<tr><td class="num" id="LN1302">1302</td><td class="line">			line_prefix, meta, ecbdata-&gt;label_path[1], reset, name_b_tab);</td></tr>
<tr><td class="num" id="LN1303">1303</td><td class="line">		ecbdata-&gt;label_path[0] = ecbdata-&gt;label_path[1] = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN1304">1304</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1305">1305</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1306">1306</td><td class="line">	<span class='keyword'>if</span> (diff_suppress_blank_empty</td></tr>
<tr><td class="num" id="LN1307">1307</td><td class="line">	    &amp;&amp; len == 2 &amp;&amp; line[0] == ' ' &amp;&amp; line[1] == '\n') {</td></tr>
<tr><td class="num" id="LN1308">1308</td><td class="line">		line[0] = '\n';</td></tr>
<tr><td class="num" id="LN1309">1309</td><td class="line">		len = 1;</td></tr>
<tr><td class="num" id="LN1310">1310</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1311">1311</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1312">1312</td><td class="line">	<span class='keyword'>if</span> (line[0] == '@') {</td></tr>
<tr><td class="num" id="LN1313">1313</td><td class="line">		<span class='keyword'>if</span> (ecbdata-&gt;diff_words)</td></tr>
<tr><td class="num" id="LN1314">1314</td><td class="line">			diff_words_flush(ecbdata);</td></tr>
<tr><td class="num" id="LN1315">1315</td><td class="line">		len = sane_truncate_line(ecbdata, line, len);</td></tr>
<tr><td class="num" id="LN1316">1316</td><td class="line">		find_lno(line, ecbdata);</td></tr>
<tr><td class="num" id="LN1317">1317</td><td class="line">		emit_hunk_header(ecbdata, line, len);</td></tr>
<tr><td class="num" id="LN1318">1318</td><td class="line">		<span class='keyword'>if</span> (line[len-1] != '\n')</td></tr>
<tr><td class="num" id="LN1319">1319</td><td class="line">			putc('\n', o-&gt;file);</td></tr>
<tr><td class="num" id="LN1320">1320</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN1321">1321</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1322">1322</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1323">1323</td><td class="line">	<span class='keyword'>if</span> (ecbdata-&gt;diff_words) {</td></tr>
<tr><td class="num" id="LN1324">1324</td><td class="line">		<span class='keyword'>if</span> (line[0] == '-') {</td></tr>
<tr><td class="num" id="LN1325">1325</td><td class="line">			diff_words_append(line, len,</td></tr>
<tr><td class="num" id="LN1326">1326</td><td class="line">					  &amp;ecbdata-&gt;diff_words-&gt;minus);</td></tr>
<tr><td class="num" id="LN1327">1327</td><td class="line">			<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN1328">1328</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (line[0] == '+') {</td></tr>
<tr><td class="num" id="LN1329">1329</td><td class="line">			diff_words_append(line, len,</td></tr>
<tr><td class="num" id="LN1330">1330</td><td class="line">					  &amp;ecbdata-&gt;diff_words-&gt;plus);</td></tr>
<tr><td class="num" id="LN1331">1331</td><td class="line">			<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN1332">1332</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (starts_with(line, <span class='string_literal'>"\\ "</span>)) {</td></tr>
<tr><td class="num" id="LN1333">1333</td><td class="line">			<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1334">1334</td><td class="line">			 <span class='comment'>* Eat the "no newline at eof" marker as if we</span></td></tr>
<tr><td class="num" id="LN1335">1335</td><td class="line">			 <span class='comment'>* saw a "+" or "-" line with nothing on it,</span></td></tr>
<tr><td class="num" id="LN1336">1336</td><td class="line">			 <span class='comment'>* and return without diff_words_flush() to</span></td></tr>
<tr><td class="num" id="LN1337">1337</td><td class="line">			 <span class='comment'>* defer processing. If this is the end of</span></td></tr>
<tr><td class="num" id="LN1338">1338</td><td class="line">			 <span class='comment'>* preimage, more "+" lines may come after it.</span></td></tr>
<tr><td class="num" id="LN1339">1339</td><td class="line">			 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1340">1340</td><td class="line">			<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN1341">1341</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1342">1342</td><td class="line">		diff_words_flush(ecbdata);</td></tr>
<tr><td class="num" id="LN1343">1343</td><td class="line">		<span class='keyword'>if</span> (ecbdata-&gt;diff_words-&gt;type == DIFF_WORDS_PORCELAIN) {</td></tr>
<tr><td class="num" id="LN1344">1344</td><td class="line">			emit_line(o, context, reset, line, len);</td></tr>
<tr><td class="num" id="LN1345">1345</td><td class="line">			fputs(<span class='string_literal'>"~\n"</span>, o-&gt;file);</td></tr>
<tr><td class="num" id="LN1346">1346</td><td class="line">		} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN1347">1347</td><td class="line">			<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1348">1348</td><td class="line">			 <span class='comment'>* Skip the prefix character, if any.  With</span></td></tr>
<tr><td class="num" id="LN1349">1349</td><td class="line">			 <span class='comment'>* diff_suppress_blank_empty, there may be</span></td></tr>
<tr><td class="num" id="LN1350">1350</td><td class="line">			 <span class='comment'>* none.</span></td></tr>
<tr><td class="num" id="LN1351">1351</td><td class="line">			 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1352">1352</td><td class="line">			<span class='keyword'>if</span> (line[0] != '\n') {</td></tr>
<tr><td class="num" id="LN1353">1353</td><td class="line">			      line++;</td></tr>
<tr><td class="num" id="LN1354">1354</td><td class="line">			      len--;</td></tr>
<tr><td class="num" id="LN1355">1355</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN1356">1356</td><td class="line">			emit_line(o, context, reset, line, len);</td></tr>
<tr><td class="num" id="LN1357">1357</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1358">1358</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN1359">1359</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1360">1360</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1361">1361</td><td class="line">	<span class='keyword'>switch</span> (line[0]) {</td></tr>
<tr><td class="num" id="LN1362">1362</td><td class="line">	<span class='keyword'>case</span> '+':</td></tr>
<tr><td class="num" id="LN1363">1363</td><td class="line">		ecbdata-&gt;lno_in_postimage++;</td></tr>
<tr><td class="num" id="LN1364">1364</td><td class="line">		emit_add_line(reset, ecbdata, line + 1, len - 1);</td></tr>
<tr><td class="num" id="LN1365">1365</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN1366">1366</td><td class="line">	<span class='keyword'>case</span> '-':</td></tr>
<tr><td class="num" id="LN1367">1367</td><td class="line">		ecbdata-&gt;lno_in_preimage++;</td></tr>
<tr><td class="num" id="LN1368">1368</td><td class="line">		emit_del_line(reset, ecbdata, line + 1, len - 1);</td></tr>
<tr><td class="num" id="LN1369">1369</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN1370">1370</td><td class="line">	<span class='keyword'>case</span> ' ':</td></tr>
<tr><td class="num" id="LN1371">1371</td><td class="line">		ecbdata-&gt;lno_in_postimage++;</td></tr>
<tr><td class="num" id="LN1372">1372</td><td class="line">		ecbdata-&gt;lno_in_preimage++;</td></tr>
<tr><td class="num" id="LN1373">1373</td><td class="line">		emit_context_line(reset, ecbdata, line + 1, len - 1);</td></tr>
<tr><td class="num" id="LN1374">1374</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN1375">1375</td><td class="line">	<span class='keyword'>default</span>:</td></tr>
<tr><td class="num" id="LN1376">1376</td><td class="line">		<span class='comment'>/* incomplete line at the end */</span></td></tr>
<tr><td class="num" id="LN1377">1377</td><td class="line">		ecbdata-&gt;lno_in_preimage++;</td></tr>
<tr><td class="num" id="LN1378">1378</td><td class="line">		emit_line(o, diff_get_color(ecbdata-&gt;color_diff, DIFF_CONTEXT),</td></tr>
<tr><td class="num" id="LN1379">1379</td><td class="line">			  reset, line, len);</td></tr>
<tr><td class="num" id="LN1380">1380</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN1381">1381</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1382">1382</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1383">1383</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1384">1384</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>char</span> *pprint_rename(<span class='keyword'>const</span> <span class='keyword'>char</span> *a, <span class='keyword'>const</span> <span class='keyword'>char</span> *b)</td></tr>
<tr><td class="num" id="LN1385">1385</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1386">1386</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *old = a;</td></tr>
<tr><td class="num" id="LN1387">1387</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *new = b;</td></tr>
<tr><td class="num" id="LN1388">1388</td><td class="line">	<span class='keyword'>struct</span> strbuf name = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN1389">1389</td><td class="line">	<span class='keyword'>int</span> pfx_length, sfx_length;</td></tr>
<tr><td class="num" id="LN1390">1390</td><td class="line">	<span class='keyword'>int</span> pfx_adjust_for_slash;</td></tr>
<tr><td class="num" id="LN1391">1391</td><td class="line">	<span class='keyword'>int</span> len_a = strlen(a);</td></tr>
<tr><td class="num" id="LN1392">1392</td><td class="line">	<span class='keyword'>int</span> len_b = strlen(b);</td></tr>
<tr><td class="num" id="LN1393">1393</td><td class="line">	<span class='keyword'>int</span> a_midlen, b_midlen;</td></tr>
<tr><td class="num" id="LN1394">1394</td><td class="line">	<span class='keyword'>int</span> qlen_a = quote_c_style(a, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 0);</td></tr>
<tr><td class="num" id="LN1395">1395</td><td class="line">	<span class='keyword'>int</span> qlen_b = quote_c_style(b, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 0);</td></tr>
<tr><td class="num" id="LN1396">1396</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1397">1397</td><td class="line">	<span class='keyword'>if</span> (qlen_a || qlen_b) {</td></tr>
<tr><td class="num" id="LN1398">1398</td><td class="line">		quote_c_style(a, &amp;name, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 0);</td></tr>
<tr><td class="num" id="LN1399">1399</td><td class="line">		strbuf_addstr(&amp;name, <span class='string_literal'>" =&gt; "</span>);</td></tr>
<tr><td class="num" id="LN1400">1400</td><td class="line">		quote_c_style(b, &amp;name, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 0);</td></tr>
<tr><td class="num" id="LN1401">1401</td><td class="line">		<span class='keyword'>return</span> strbuf_detach(&amp;name, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>);</td></tr>
<tr><td class="num" id="LN1402">1402</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1403">1403</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1404">1404</td><td class="line">	<span class='comment'>/* Find common prefix */</span></td></tr>
<tr><td class="num" id="LN1405">1405</td><td class="line">	pfx_length = 0;</td></tr>
<tr><td class="num" id="LN1406">1406</td><td class="line">	<span class='keyword'>while</span> (*old &amp;&amp; *new &amp;&amp; *old == *new) {</td></tr>
<tr><td class="num" id="LN1407">1407</td><td class="line">		<span class='keyword'>if</span> (*old == '/')</td></tr>
<tr><td class="num" id="LN1408">1408</td><td class="line">			pfx_length = old - a + 1;</td></tr>
<tr><td class="num" id="LN1409">1409</td><td class="line">		old++;</td></tr>
<tr><td class="num" id="LN1410">1410</td><td class="line">		new++;</td></tr>
<tr><td class="num" id="LN1411">1411</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1412">1412</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1413">1413</td><td class="line">	<span class='comment'>/* Find common suffix */</span></td></tr>
<tr><td class="num" id="LN1414">1414</td><td class="line">	old = a + len_a;</td></tr>
<tr><td class="num" id="LN1415">1415</td><td class="line">	new = b + len_b;</td></tr>
<tr><td class="num" id="LN1416">1416</td><td class="line">	sfx_length = 0;</td></tr>
<tr><td class="num" id="LN1417">1417</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1418">1418</td><td class="line">	 <span class='comment'>* If there is a common prefix, it must end in a slash.  In</span></td></tr>
<tr><td class="num" id="LN1419">1419</td><td class="line">	 <span class='comment'>* that case we let this loop run 1 into the prefix to see the</span></td></tr>
<tr><td class="num" id="LN1420">1420</td><td class="line">	 <span class='comment'>* same slash.</span></td></tr>
<tr><td class="num" id="LN1421">1421</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN1422">1422</td><td class="line">	 <span class='comment'>* If there is no common prefix, we cannot do this as it would</span></td></tr>
<tr><td class="num" id="LN1423">1423</td><td class="line">	 <span class='comment'>* underrun the input strings.</span></td></tr>
<tr><td class="num" id="LN1424">1424</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1425">1425</td><td class="line">	pfx_adjust_for_slash = (pfx_length ? 1 : 0);</td></tr>
<tr><td class="num" id="LN1426">1426</td><td class="line">	<span class='keyword'>while</span> (a + pfx_length - pfx_adjust_for_slash &lt;= old &amp;&amp;</td></tr>
<tr><td class="num" id="LN1427">1427</td><td class="line">	       b + pfx_length - pfx_adjust_for_slash &lt;= new &amp;&amp;</td></tr>
<tr><td class="num" id="LN1428">1428</td><td class="line">	       *old == *new) {</td></tr>
<tr><td class="num" id="LN1429">1429</td><td class="line">		<span class='keyword'>if</span> (*old == '/')</td></tr>
<tr><td class="num" id="LN1430">1430</td><td class="line">			sfx_length = len_a - (old - a);</td></tr>
<tr><td class="num" id="LN1431">1431</td><td class="line">		old--;</td></tr>
<tr><td class="num" id="LN1432">1432</td><td class="line">		new--;</td></tr>
<tr><td class="num" id="LN1433">1433</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1434">1434</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1435">1435</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1436">1436</td><td class="line">	 <span class='comment'>* pfx{mid-a =&gt; mid-b}sfx</span></td></tr>
<tr><td class="num" id="LN1437">1437</td><td class="line">	 <span class='comment'>* {pfx-a =&gt; pfx-b}sfx</span></td></tr>
<tr><td class="num" id="LN1438">1438</td><td class="line">	 <span class='comment'>* pfx{sfx-a =&gt; sfx-b}</span></td></tr>
<tr><td class="num" id="LN1439">1439</td><td class="line">	 <span class='comment'>* name-a =&gt; name-b</span></td></tr>
<tr><td class="num" id="LN1440">1440</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1441">1441</td><td class="line">	a_midlen = len_a - pfx_length - sfx_length;</td></tr>
<tr><td class="num" id="LN1442">1442</td><td class="line">	b_midlen = len_b - pfx_length - sfx_length;</td></tr>
<tr><td class="num" id="LN1443">1443</td><td class="line">	<span class='keyword'>if</span> (a_midlen &lt; 0)</td></tr>
<tr><td class="num" id="LN1444">1444</td><td class="line">		a_midlen = 0;</td></tr>
<tr><td class="num" id="LN1445">1445</td><td class="line">	<span class='keyword'>if</span> (b_midlen &lt; 0)</td></tr>
<tr><td class="num" id="LN1446">1446</td><td class="line">		b_midlen = 0;</td></tr>
<tr><td class="num" id="LN1447">1447</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1448">1448</td><td class="line">	strbuf_grow(&amp;name, pfx_length + a_midlen + b_midlen + sfx_length + 7);</td></tr>
<tr><td class="num" id="LN1449">1449</td><td class="line">	<span class='keyword'>if</span> (pfx_length + sfx_length) {</td></tr>
<tr><td class="num" id="LN1450">1450</td><td class="line">		strbuf_add(&amp;name, a, pfx_length);</td></tr>
<tr><td class="num" id="LN1451">1451</td><td class="line">		strbuf_addch(&amp;name, '{');</td></tr>
<tr><td class="num" id="LN1452">1452</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1453">1453</td><td class="line">	strbuf_add(&amp;name, a + pfx_length, a_midlen);</td></tr>
<tr><td class="num" id="LN1454">1454</td><td class="line">	strbuf_addstr(&amp;name, <span class='string_literal'>" =&gt; "</span>);</td></tr>
<tr><td class="num" id="LN1455">1455</td><td class="line">	strbuf_add(&amp;name, b + pfx_length, b_midlen);</td></tr>
<tr><td class="num" id="LN1456">1456</td><td class="line">	<span class='keyword'>if</span> (pfx_length + sfx_length) {</td></tr>
<tr><td class="num" id="LN1457">1457</td><td class="line">		strbuf_addch(&amp;name, '}');</td></tr>
<tr><td class="num" id="LN1458">1458</td><td class="line">		strbuf_add(&amp;name, a + len_a - sfx_length, sfx_length);</td></tr>
<tr><td class="num" id="LN1459">1459</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1460">1460</td><td class="line">	<span class='keyword'>return</span> strbuf_detach(&amp;name, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>);</td></tr>
<tr><td class="num" id="LN1461">1461</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1462">1462</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1463">1463</td><td class="line"><span class='keyword'>struct</span> diffstat_t {</td></tr>
<tr><td class="num" id="LN1464">1464</td><td class="line">	<span class='keyword'>int</span> nr;</td></tr>
<tr><td class="num" id="LN1465">1465</td><td class="line">	<span class='keyword'>int</span> alloc;</td></tr>
<tr><td class="num" id="LN1466">1466</td><td class="line">	<span class='keyword'>struct</span> diffstat_file {</td></tr>
<tr><td class="num" id="LN1467">1467</td><td class="line">		<span class='keyword'>char</span> *from_name;</td></tr>
<tr><td class="num" id="LN1468">1468</td><td class="line">		<span class='keyword'>char</span> *name;</td></tr>
<tr><td class="num" id="LN1469">1469</td><td class="line">		<span class='keyword'>char</span> *print_name;</td></tr>
<tr><td class="num" id="LN1470">1470</td><td class="line">		<span class='keyword'>unsigned</span> is_unmerged:1;</td></tr>
<tr><td class="num" id="LN1471">1471</td><td class="line">		<span class='keyword'>unsigned</span> is_binary:1;</td></tr>
<tr><td class="num" id="LN1472">1472</td><td class="line">		<span class='keyword'>unsigned</span> is_renamed:1;</td></tr>
<tr><td class="num" id="LN1473">1473</td><td class="line">		<span class='keyword'>unsigned</span> is_interesting:1;</td></tr>
<tr><td class="num" id="LN1474">1474</td><td class="line">		uintmax_t added, deleted;</td></tr>
<tr><td class="num" id="LN1475">1475</td><td class="line">	} **files;</td></tr>
<tr><td class="num" id="LN1476">1476</td><td class="line">};</td></tr>
<tr><td class="num" id="LN1477">1477</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1478">1478</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>struct</span> diffstat_file *diffstat_add(<span class='keyword'>struct</span> diffstat_t *diffstat,</td></tr>
<tr><td class="num" id="LN1479">1479</td><td class="line">					  <span class='keyword'>const</span> <span class='keyword'>char</span> *name_a,</td></tr>
<tr><td class="num" id="LN1480">1480</td><td class="line">					  <span class='keyword'>const</span> <span class='keyword'>char</span> *name_b)</td></tr>
<tr><td class="num" id="LN1481">1481</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1482">1482</td><td class="line">	<span class='keyword'>struct</span> diffstat_file *x;</td></tr>
<tr><td class="num" id="LN1483">1483</td><td class="line">	x = xcalloc(1, <span class='keyword'>sizeof</span>(*x));</td></tr>
<tr><td class="num" id="LN1484">1484</td><td class="line">	<span class='macro'>ALLOC_GROW(diffstat-&gt;files, diffstat-&gt;nr + 1, diffstat-&gt;alloc)<span class='expansion'>do { if ((diffstat-&gt;nr + 1) &gt; diffstat-&gt;alloc) { if (<br>(((diffstat-&gt;alloc)+16)*3/2) &lt; (diffstat-&gt;nr + 1)) diffstat<br>-&gt;alloc = (diffstat-&gt;nr + 1); else diffstat-&gt;alloc =<br> (((diffstat-&gt;alloc)+16)*3/2); (diffstat-&gt;files) = xrealloc<br>((diffstat-&gt;files), st_mult(sizeof(*(diffstat-&gt;files)),<br> (diffstat-&gt;alloc))); } } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN1485">1485</td><td class="line">	diffstat-&gt;files[diffstat-&gt;nr++] = x;</td></tr>
<tr><td class="num" id="LN1486">1486</td><td class="line">	<span class='keyword'>if</span> (name_b) {</td></tr>
<tr><td class="num" id="LN1487">1487</td><td class="line">		x-&gt;from_name = xstrdup(name_a);</td></tr>
<tr><td class="num" id="LN1488">1488</td><td class="line">		x-&gt;name = xstrdup(name_b);</td></tr>
<tr><td class="num" id="LN1489">1489</td><td class="line">		x-&gt;is_renamed = 1;</td></tr>
<tr><td class="num" id="LN1490">1490</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1491">1491</td><td class="line">	<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN1492">1492</td><td class="line">		x-&gt;from_name = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN1493">1493</td><td class="line">		x-&gt;name = xstrdup(name_a);</td></tr>
<tr><td class="num" id="LN1494">1494</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1495">1495</td><td class="line">	<span class='keyword'>return</span> x;</td></tr>
<tr><td class="num" id="LN1496">1496</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1497">1497</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1498">1498</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> diffstat_consume(<span class='keyword'>void</span> *priv, <span class='keyword'>char</span> *line, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> len)</td></tr>
<tr><td class="num" id="LN1499">1499</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1500">1500</td><td class="line">	<span class='keyword'>struct</span> diffstat_t *diffstat = priv;</td></tr>
<tr><td class="num" id="LN1501">1501</td><td class="line">	<span class='keyword'>struct</span> diffstat_file *x = diffstat-&gt;files[diffstat-&gt;nr - 1];</td></tr>
<tr><td class="num" id="LN1502">1502</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1503">1503</td><td class="line">	<span class='keyword'>if</span> (line[0] == '+')</td></tr>
<tr><td class="num" id="LN1504">1504</td><td class="line">		x-&gt;added++;</td></tr>
<tr><td class="num" id="LN1505">1505</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (line[0] == '-')</td></tr>
<tr><td class="num" id="LN1506">1506</td><td class="line">		x-&gt;deleted++;</td></tr>
<tr><td class="num" id="LN1507">1507</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1508">1508</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1509">1509</td><td class="line"><span class='keyword'>const</span> <span class='keyword'>char</span> mime_boundary_leader[] = <span class='string_literal'>"------------"</span>;</td></tr>
<tr><td class="num" id="LN1510">1510</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1511">1511</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> scale_linear(<span class='keyword'>int</span> it, <span class='keyword'>int</span> width, <span class='keyword'>int</span> max_change)</td></tr>
<tr><td class="num" id="LN1512">1512</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1513">1513</td><td class="line">	<span class='keyword'>if</span> (<span class="mrange">!it</span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path27" class="msg msgEvent" style="margin-left:13ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">27</div></td><td><div class="PathNav"><a href="#Path26" title="Previous event (26)">&#x2190;</a></div></td></td><td>Assuming 'it' is not equal to 0</td><td><div class="PathNav"><a href="#Path28" title="Next event (28)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path28" class="msg msgControl" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">28</div></td><td><div class="PathNav"><a href="#Path27" title="Previous event (27)">&#x2190;</a></div></td></td><td>Taking false branch</td><td><div class="PathNav"><a href="#EndPath" title="Next event (29)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1514">1514</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN1515">1515</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1516">1516</td><td class="line">	 <span class='comment'>* make sure that at least one '-' or '+' is printed if</span></td></tr>
<tr><td class="num" id="LN1517">1517</td><td class="line">	 <span class='comment'>* there is any change to this path. The easiest way is to</span></td></tr>
<tr><td class="num" id="LN1518">1518</td><td class="line">	 <span class='comment'>* scale linearly as if the alloted width is one column shorter</span></td></tr>
<tr><td class="num" id="LN1519">1519</td><td class="line">	 <span class='comment'>* than it is, and then add 1 to the result.</span></td></tr>
<tr><td class="num" id="LN1520">1520</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1521">1521</td><td class="line">	<span class='keyword'>return</span> 1 + (<span class="mrange">it * (width - 1) / max_change</span>);</td></tr>
<tr><td class="num"></td><td class="line"><div id="EndPath" class="msg msgEvent" style="margin-left:38ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">29</div></td><td><div class="PathNav"><a href="#Path28" title="Previous event (28)">&#x2190;</a></div></td></td><td>Division by zero</td></tr></table></div></td></tr>
<tr><td class="num" id="LN1522">1522</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1523">1523</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1524">1524</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> show_name(FILE *file,</td></tr>
<tr><td class="num" id="LN1525">1525</td><td class="line">		      <span class='keyword'>const</span> <span class='keyword'>char</span> *prefix, <span class='keyword'>const</span> <span class='keyword'>char</span> *name, <span class='keyword'>int</span> len)</td></tr>
<tr><td class="num" id="LN1526">1526</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1527">1527</td><td class="line">	fprintf(file, <span class='string_literal'>" %s%-*s |"</span>, prefix, len, name);</td></tr>
<tr><td class="num" id="LN1528">1528</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1529">1529</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1530">1530</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> show_graph(FILE *file, <span class='keyword'>char</span> ch, <span class='keyword'>int</span> cnt, <span class='keyword'>const</span> <span class='keyword'>char</span> *set, <span class='keyword'>const</span> <span class='keyword'>char</span> *reset)</td></tr>
<tr><td class="num" id="LN1531">1531</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1532">1532</td><td class="line">	<span class='keyword'>if</span> (cnt &lt;= 0)</td></tr>
<tr><td class="num" id="LN1533">1533</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN1534">1534</td><td class="line">	fprintf(file, <span class='string_literal'>"%s"</span>, set);</td></tr>
<tr><td class="num" id="LN1535">1535</td><td class="line">	<span class='keyword'>while</span> (cnt--)</td></tr>
<tr><td class="num" id="LN1536">1536</td><td class="line">		putc(ch, file);</td></tr>
<tr><td class="num" id="LN1537">1537</td><td class="line">	fprintf(file, <span class='string_literal'>"%s"</span>, reset);</td></tr>
<tr><td class="num" id="LN1538">1538</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1539">1539</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1540">1540</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> fill_print_name(<span class='keyword'>struct</span> diffstat_file *file)</td></tr>
<tr><td class="num" id="LN1541">1541</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1542">1542</td><td class="line">	<span class='keyword'>char</span> *pname;</td></tr>
<tr><td class="num" id="LN1543">1543</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1544">1544</td><td class="line">	<span class='keyword'>if</span> (file-&gt;print_name)</td></tr>
<tr><td class="num" id="LN1545">1545</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN1546">1546</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1547">1547</td><td class="line">	<span class='keyword'>if</span> (!file-&gt;is_renamed) {</td></tr>
<tr><td class="num" id="LN1548">1548</td><td class="line">		<span class='keyword'>struct</span> strbuf buf = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN1549">1549</td><td class="line">		<span class='keyword'>if</span> (quote_c_style(file-&gt;name, &amp;buf, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 0)) {</td></tr>
<tr><td class="num" id="LN1550">1550</td><td class="line">			pname = strbuf_detach(&amp;buf, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>);</td></tr>
<tr><td class="num" id="LN1551">1551</td><td class="line">		} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN1552">1552</td><td class="line">			pname = file-&gt;name;</td></tr>
<tr><td class="num" id="LN1553">1553</td><td class="line">			strbuf_release(&amp;buf);</td></tr>
<tr><td class="num" id="LN1554">1554</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1555">1555</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN1556">1556</td><td class="line">		pname = pprint_rename(file-&gt;from_name, file-&gt;name);</td></tr>
<tr><td class="num" id="LN1557">1557</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1558">1558</td><td class="line">	file-&gt;print_name = pname;</td></tr>
<tr><td class="num" id="LN1559">1559</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1560">1560</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1561">1561</td><td class="line"><span class='keyword'>int</span> print_stat_summary(FILE *fp, <span class='keyword'>int</span> files, <span class='keyword'>int</span> insertions, <span class='keyword'>int</span> deletions)</td></tr>
<tr><td class="num" id="LN1562">1562</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1563">1563</td><td class="line">	<span class='keyword'>struct</span> strbuf sb = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN1564">1564</td><td class="line">	<span class='keyword'>int</span> ret;</td></tr>
<tr><td class="num" id="LN1565">1565</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1566">1566</td><td class="line">	<span class='keyword'>if</span> (!files) {</td></tr>
<tr><td class="num" id="LN1567">1567</td><td class="line">		<span class='macro'>assert(insertions == 0 &amp;&amp; deletions == 0)<span class='expansion'>(__builtin_expect(!(insertions == 0 &amp;&amp; deletions == 0<br>), 0) ? __assert_rtn(__func__, "diff.c", 1567, "insertions == 0 &amp;&amp; deletions == 0"<br>) : (void)0)</span></span>;</td></tr>
<tr><td class="num" id="LN1568">1568</td><td class="line">		<span class='keyword'>return</span> fprintf(fp, <span class='string_literal'>"%s\n"</span>, <span class='string_literal'>" 0 files changed"</span>);</td></tr>
<tr><td class="num" id="LN1569">1569</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1570">1570</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1571">1571</td><td class="line">	strbuf_addf(&amp;sb,</td></tr>
<tr><td class="num" id="LN1572">1572</td><td class="line">		    (files == 1) ? <span class='string_literal'>" %d file changed"</span> : <span class='string_literal'>" %d files changed"</span>,</td></tr>
<tr><td class="num" id="LN1573">1573</td><td class="line">		    files);</td></tr>
<tr><td class="num" id="LN1574">1574</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1575">1575</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1576">1576</td><td class="line">	 <span class='comment'>* For binary diff, the caller may want to print "x files</span></td></tr>
<tr><td class="num" id="LN1577">1577</td><td class="line">	 <span class='comment'>* changed" with insertions == 0 &amp;&amp; deletions == 0.</span></td></tr>
<tr><td class="num" id="LN1578">1578</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN1579">1579</td><td class="line">	 <span class='comment'>* Not omitting "0 insertions(+), 0 deletions(-)" in this case</span></td></tr>
<tr><td class="num" id="LN1580">1580</td><td class="line">	 <span class='comment'>* is probably less confusing (i.e skip over "2 files changed</span></td></tr>
<tr><td class="num" id="LN1581">1581</td><td class="line">	 <span class='comment'>* but nothing about added/removed lines? Is this a bug in Git?").</span></td></tr>
<tr><td class="num" id="LN1582">1582</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1583">1583</td><td class="line">	<span class='keyword'>if</span> (insertions || deletions == 0) {</td></tr>
<tr><td class="num" id="LN1584">1584</td><td class="line">		strbuf_addf(&amp;sb,</td></tr>
<tr><td class="num" id="LN1585">1585</td><td class="line">			    (insertions == 1) ? <span class='string_literal'>", %d insertion(+)"</span> : <span class='string_literal'>", %d insertions(+)"</span>,</td></tr>
<tr><td class="num" id="LN1586">1586</td><td class="line">			    insertions);</td></tr>
<tr><td class="num" id="LN1587">1587</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1588">1588</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1589">1589</td><td class="line">	<span class='keyword'>if</span> (deletions || insertions == 0) {</td></tr>
<tr><td class="num" id="LN1590">1590</td><td class="line">		strbuf_addf(&amp;sb,</td></tr>
<tr><td class="num" id="LN1591">1591</td><td class="line">			    (deletions == 1) ? <span class='string_literal'>", %d deletion(-)"</span> : <span class='string_literal'>", %d deletions(-)"</span>,</td></tr>
<tr><td class="num" id="LN1592">1592</td><td class="line">			    deletions);</td></tr>
<tr><td class="num" id="LN1593">1593</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1594">1594</td><td class="line">	strbuf_addch(&amp;sb, '\n');</td></tr>
<tr><td class="num" id="LN1595">1595</td><td class="line">	ret = fputs(sb.buf, fp);</td></tr>
<tr><td class="num" id="LN1596">1596</td><td class="line">	strbuf_release(&amp;sb);</td></tr>
<tr><td class="num" id="LN1597">1597</td><td class="line">	<span class='keyword'>return</span> ret;</td></tr>
<tr><td class="num" id="LN1598">1598</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1599">1599</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1600">1600</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> show_stats(<span class='keyword'>struct</span> diffstat_t *data, <span class='keyword'>struct</span> diff_options *options)</td></tr>
<tr><td class="num" id="LN1601">1601</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1602">1602</td><td class="line">	<span class='keyword'>int</span> i, len, add, del, adds = 0, dels = 0;</td></tr>
<tr><td class="num" id="LN1603">1603</td><td class="line">	uintmax_t <span class="mrange">max_change</span> = 0, max_len = 0;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path1" class="msg msgEvent" style="margin-left:19ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">1</div></td><td>'max_change' initialized to 0</td><td><div class="PathNav"><a href="#Path2" title="Next event (2)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1604">1604</td><td class="line">	<span class='keyword'>int</span> total_files = data-&gt;nr, count;</td></tr>
<tr><td class="num" id="LN1605">1605</td><td class="line">	<span class='keyword'>int</span> width, name_width, graph_width, number_width = 0, bin_width = 0;</td></tr>
<tr><td class="num" id="LN1606">1606</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *reset, *add_c, *del_c;</td></tr>
<tr><td class="num" id="LN1607">1607</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *line_prefix = <span class='string_literal'>""</span>;</td></tr>
<tr><td class="num" id="LN1608">1608</td><td class="line">	<span class='keyword'>int</span> extra_shown = 0;</td></tr>
<tr><td class="num" id="LN1609">1609</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1610">1610</td><td class="line">	<span class='keyword'>if</span> (data-&gt;nr == 0)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path2" class="msg msgControl" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">2</div></td><td><div class="PathNav"><a href="#Path1" title="Previous event (1)">&#x2190;</a></div></td></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path3" title="Next event (3)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1611">1611</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN1612">1612</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1613">1613</td><td class="line">	line_prefix = diff_line_prefix(options);</td></tr>
<tr><td class="num" id="LN1614">1614</td><td class="line">	count = options-&gt;stat_count ? options-&gt;stat_count : data-&gt;nr;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path3" class="msg msgControl" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">3</div></td><td><div class="PathNav"><a href="#Path2" title="Previous event (2)">&#x2190;</a></div></td></td><td>'?' condition is false</td><td><div class="PathNav"><a href="#Path4" title="Next event (4)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1615">1615</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1616">1616</td><td class="line">	reset = <span class='macro'>diff_get_color_opt(options, DIFF_RESET)<span class='expansion'>diff_get_color((options)-&gt;use_color, DIFF_RESET)</span></span>;</td></tr>
<tr><td class="num" id="LN1617">1617</td><td class="line">	add_c = <span class='macro'>diff_get_color_opt(options, DIFF_FILE_NEW)<span class='expansion'>diff_get_color((options)-&gt;use_color, DIFF_FILE_NEW)</span></span>;</td></tr>
<tr><td class="num" id="LN1618">1618</td><td class="line">	del_c = <span class='macro'>diff_get_color_opt(options, DIFF_FILE_OLD)<span class='expansion'>diff_get_color((options)-&gt;use_color, DIFF_FILE_OLD)</span></span>;</td></tr>
<tr><td class="num" id="LN1619">1619</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1620">1620</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1621">1621</td><td class="line">	 <span class='comment'>* Find the longest filename and max number of changes</span></td></tr>
<tr><td class="num" id="LN1622">1622</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1623">1623</td><td class="line">	<span class='keyword'>for</span> (i = 0; (<span class="mrange"><span class="mrange">i &lt; count</span></span>) &amp;&amp; (i &lt; data-&gt;nr); i++) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path4" class="msg msgEvent" style="margin-left:22ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">4</div></td><td><div class="PathNav"><a href="#Path3" title="Previous event (3)">&#x2190;</a></div></td></td><td>Assuming 'i' is &lt; 'count'</td><td><div class="PathNav"><a href="#Path5" title="Next event (5)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path5" class="msg msgControl" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">5</div></td><td><div class="PathNav"><a href="#Path4" title="Previous event (4)">&#x2190;</a></div></td></td><td>Loop condition is true.  Entering loop body</td><td><div class="PathNav"><a href="#Path6" title="Next event (6)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path12" class="msg msgEvent" style="margin-left:22ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">12</div></td><td><div class="PathNav"><a href="#Path11" title="Previous event (11)">&#x2190;</a></div></td></td><td>Assuming 'i' is &gt;= 'count'</td><td><div class="PathNav"><a href="#Path13" title="Next event (13)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1624">1624</td><td class="line">		<span class='keyword'>struct</span> diffstat_file *file = data-&gt;files[i];</td></tr>
<tr><td class="num" id="LN1625">1625</td><td class="line">		uintmax_t change = file-&gt;added + file-&gt;deleted;</td></tr>
<tr><td class="num" id="LN1626">1626</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1627">1627</td><td class="line">		<span class='keyword'>if</span> (!file-&gt;is_interesting &amp;&amp; (change == 0)) {</td></tr>
<tr><td class="num" id="LN1628">1628</td><td class="line">			count++; <span class='comment'>/* not shown == room for one more */</span></td></tr>
<tr><td class="num" id="LN1629">1629</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN1630">1630</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1631">1631</td><td class="line">		fill_print_name(file);</td></tr>
<tr><td class="num" id="LN1632">1632</td><td class="line">		len = strlen(file-&gt;print_name);</td></tr>
<tr><td class="num" id="LN1633">1633</td><td class="line">		<span class='keyword'>if</span> (<span class="mrange">max_len &lt; len</span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path6" class="msg msgEvent" style="margin-left:21ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">6</div></td><td><div class="PathNav"><a href="#Path5" title="Previous event (5)">&#x2190;</a></div></td></td><td>Assuming 'max_len' is &gt;= 'len'</td><td><div class="PathNav"><a href="#Path7" title="Next event (7)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path7" class="msg msgControl" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">7</div></td><td><div class="PathNav"><a href="#Path6" title="Previous event (6)">&#x2190;</a></div></td></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path8" title="Next event (8)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1634">1634</td><td class="line">			max_len = len;</td></tr>
<tr><td class="num" id="LN1635">1635</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1636">1636</td><td class="line">		<span class='keyword'>if</span> (file-&gt;is_unmerged) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path8" class="msg msgControl" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">8</div></td><td><div class="PathNav"><a href="#Path7" title="Previous event (7)">&#x2190;</a></div></td></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path9" title="Next event (9)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1637">1637</td><td class="line">			<span class='comment'>/* "Unmerged" is 8 characters */</span></td></tr>
<tr><td class="num" id="LN1638">1638</td><td class="line">			bin_width = bin_width &lt; 8 ? 8 : bin_width;</td></tr>
<tr><td class="num" id="LN1639">1639</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN1640">1640</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1641">1641</td><td class="line">		<span class='keyword'>if</span> (file-&gt;is_binary) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path9" class="msg msgControl" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">9</div></td><td><div class="PathNav"><a href="#Path8" title="Previous event (8)">&#x2190;</a></div></td></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path10" title="Next event (10)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1642">1642</td><td class="line">			<span class='comment'>/* "Bin XXX -&gt; YYY bytes" */</span></td></tr>
<tr><td class="num" id="LN1643">1643</td><td class="line">			<span class='keyword'>int</span> w = 14 + decimal_width(file-&gt;added)</td></tr>
<tr><td class="num" id="LN1644">1644</td><td class="line">				+ decimal_width(file-&gt;deleted);</td></tr>
<tr><td class="num" id="LN1645">1645</td><td class="line">			bin_width = bin_width &lt; w ? w : bin_width;</td></tr>
<tr><td class="num" id="LN1646">1646</td><td class="line">			<span class='comment'>/* Display change counts aligned with "Bin" */</span></td></tr>
<tr><td class="num" id="LN1647">1647</td><td class="line">			number_width = 3;</td></tr>
<tr><td class="num" id="LN1648">1648</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN1649">1649</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1650">1650</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1651">1651</td><td class="line">		<span class='keyword'>if</span> (<span class="mrange">max_change &lt; change</span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path10" class="msg msgEvent" style="margin-left:21ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">10</div></td><td><div class="PathNav"><a href="#Path9" title="Previous event (9)">&#x2190;</a></div></td></td><td>Assuming 'max_change' is &gt;= 'change'</td><td><div class="PathNav"><a href="#Path11" title="Next event (11)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path11" class="msg msgControl" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">11</div></td><td><div class="PathNav"><a href="#Path10" title="Previous event (10)">&#x2190;</a></div></td></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path12" title="Next event (12)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1652">1652</td><td class="line">			max_change = change;</td></tr>
<tr><td class="num" id="LN1653">1653</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1654">1654</td><td class="line">	count = i; <span class='comment'>/* where we can stop scanning in data-&gt;files[] */</span></td></tr>
<tr><td class="num" id="LN1655">1655</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1656">1656</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1657">1657</td><td class="line">	 <span class='comment'>* We have width = stat_width or term_columns() columns total.</span></td></tr>
<tr><td class="num" id="LN1658">1658</td><td class="line">	 <span class='comment'>* We want a maximum of min(max_len, stat_name_width) for the name part.</span></td></tr>
<tr><td class="num" id="LN1659">1659</td><td class="line">	 <span class='comment'>* We want a maximum of min(max_change, stat_graph_width) for the +- part.</span></td></tr>
<tr><td class="num" id="LN1660">1660</td><td class="line">	 <span class='comment'>* We also need 1 for " " and 4 + decimal_width(max_change)</span></td></tr>
<tr><td class="num" id="LN1661">1661</td><td class="line">	 <span class='comment'>* for " | NNNN " and one the empty column at the end, altogether</span></td></tr>
<tr><td class="num" id="LN1662">1662</td><td class="line">	 <span class='comment'>* 6 + decimal_width(max_change).</span></td></tr>
<tr><td class="num" id="LN1663">1663</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN1664">1664</td><td class="line">	 <span class='comment'>* If there's not enough space, we will use the smaller of</span></td></tr>
<tr><td class="num" id="LN1665">1665</td><td class="line">	 <span class='comment'>* stat_name_width (if set) and 5/8*width for the filename,</span></td></tr>
<tr><td class="num" id="LN1666">1666</td><td class="line">	 <span class='comment'>* and the rest for constant elements + graph part, but no more</span></td></tr>
<tr><td class="num" id="LN1667">1667</td><td class="line">	 <span class='comment'>* than stat_graph_width for the graph part.</span></td></tr>
<tr><td class="num" id="LN1668">1668</td><td class="line">	 <span class='comment'>* (5/8 gives 50 for filename and 30 for the constant parts + graph</span></td></tr>
<tr><td class="num" id="LN1669">1669</td><td class="line">	 <span class='comment'>* for the standard terminal size).</span></td></tr>
<tr><td class="num" id="LN1670">1670</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN1671">1671</td><td class="line">	 <span class='comment'>* In other words: stat_width limits the maximum width, and</span></td></tr>
<tr><td class="num" id="LN1672">1672</td><td class="line">	 <span class='comment'>* stat_name_width fixes the maximum width of the filename,</span></td></tr>
<tr><td class="num" id="LN1673">1673</td><td class="line">	 <span class='comment'>* and is also used to divide available columns if there</span></td></tr>
<tr><td class="num" id="LN1674">1674</td><td class="line">	 <span class='comment'>* aren't enough.</span></td></tr>
<tr><td class="num" id="LN1675">1675</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN1676">1676</td><td class="line">	 <span class='comment'>* Binary files are displayed with "Bin XXX -&gt; YYY bytes"</span></td></tr>
<tr><td class="num" id="LN1677">1677</td><td class="line">	 <span class='comment'>* instead of the change count and graph. This part is treated</span></td></tr>
<tr><td class="num" id="LN1678">1678</td><td class="line">	 <span class='comment'>* similarly to the graph part, except that it is not</span></td></tr>
<tr><td class="num" id="LN1679">1679</td><td class="line">	 <span class='comment'>* "scaled". If total width is too small to accommodate the</span></td></tr>
<tr><td class="num" id="LN1680">1680</td><td class="line">	 <span class='comment'>* guaranteed minimum width of the filename part and the</span></td></tr>
<tr><td class="num" id="LN1681">1681</td><td class="line">	 <span class='comment'>* separators and this message, this message will "overflow"</span></td></tr>
<tr><td class="num" id="LN1682">1682</td><td class="line">	 <span class='comment'>* making the line longer than the maximum width.</span></td></tr>
<tr><td class="num" id="LN1683">1683</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1684">1684</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1685">1685</td><td class="line">	<span class='keyword'>if</span> (options-&gt;stat_width == -1)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path13" class="msg msgControl" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">13</div></td><td><div class="PathNav"><a href="#Path12" title="Previous event (12)">&#x2190;</a></div></td></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path14" title="Next event (14)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1686">1686</td><td class="line">		width = term_columns() - strlen(line_prefix);</td></tr>
<tr><td class="num" id="LN1687">1687</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN1688">1688</td><td class="line">		width = options-&gt;stat_width ? options-&gt;stat_width : 80;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path14" class="msg msgControl" style="margin-left:25ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">14</div></td><td><div class="PathNav"><a href="#Path13" title="Previous event (13)">&#x2190;</a></div></td></td><td>'?' condition is false</td><td><div class="PathNav"><a href="#Path15" title="Next event (15)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1689">1689</td><td class="line">	number_width = decimal_width(max_change) &gt; number_width ?</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path15" class="msg msgControl" style="margin-left:24ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">15</div></td><td><div class="PathNav"><a href="#Path14" title="Previous event (14)">&#x2190;</a></div></td></td><td>'?' condition is false</td><td><div class="PathNav"><a href="#Path16" title="Next event (16)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1690">1690</td><td class="line">		decimal_width(max_change) : number_width;</td></tr>
<tr><td class="num" id="LN1691">1691</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1692">1692</td><td class="line">	<span class='keyword'>if</span> (options-&gt;stat_graph_width == -1)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path16" class="msg msgControl" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">16</div></td><td><div class="PathNav"><a href="#Path15" title="Previous event (15)">&#x2190;</a></div></td></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path17" title="Next event (17)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1693">1693</td><td class="line">		options-&gt;stat_graph_width = diff_stat_graph_width;</td></tr>
<tr><td class="num" id="LN1694">1694</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1695">1695</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1696">1696</td><td class="line">	 <span class='comment'>* Guarantee 3/8*16==6 for the graph part</span></td></tr>
<tr><td class="num" id="LN1697">1697</td><td class="line">	 <span class='comment'>* and 5/8*16==10 for the filename part</span></td></tr>
<tr><td class="num" id="LN1698">1698</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1699">1699</td><td class="line">	<span class='keyword'>if</span> (width &lt; 16 + 6 + number_width)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path17" class="msg msgControl" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">17</div></td><td><div class="PathNav"><a href="#Path16" title="Previous event (16)">&#x2190;</a></div></td></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path18" title="Next event (18)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1700">1700</td><td class="line">		width = 16 + 6 + number_width;</td></tr>
<tr><td class="num" id="LN1701">1701</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1702">1702</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1703">1703</td><td class="line">	 <span class='comment'>* First assign sizes that are wanted, ignoring available width.</span></td></tr>
<tr><td class="num" id="LN1704">1704</td><td class="line">	 <span class='comment'>* strlen("Bin XXX -&gt; YYY bytes") == bin_width, and the part</span></td></tr>
<tr><td class="num" id="LN1705">1705</td><td class="line">	 <span class='comment'>* starting from "XXX" should fit in graph_width.</span></td></tr>
<tr><td class="num" id="LN1706">1706</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1707">1707</td><td class="line">	graph_width = max_change + 4 &gt; bin_width ? max_change : bin_width - 4;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path18" class="msg msgControl" style="margin-left:23ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">18</div></td><td><div class="PathNav"><a href="#Path17" title="Previous event (17)">&#x2190;</a></div></td></td><td>'?' condition is true</td><td><div class="PathNav"><a href="#Path19" title="Next event (19)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1708">1708</td><td class="line">	<span class='keyword'>if</span> (options-&gt;stat_graph_width &amp;&amp;</td></tr>
<tr><td class="num" id="LN1709">1709</td><td class="line">	    options-&gt;stat_graph_width &lt; graph_width)</td></tr>
<tr><td class="num" id="LN1710">1710</td><td class="line">		graph_width = options-&gt;stat_graph_width;</td></tr>
<tr><td class="num" id="LN1711">1711</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1712">1712</td><td class="line">	name_width = (options-&gt;stat_name_width &gt; 0 &amp;&amp;</td></tr>
<tr><td class="num" id="LN1713">1713</td><td class="line">		      options-&gt;stat_name_width &lt; max_len) ?</td></tr>
<tr><td class="num" id="LN1714">1714</td><td class="line">		options-&gt;stat_name_width : max_len;</td></tr>
<tr><td class="num" id="LN1715">1715</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1716">1716</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1717">1717</td><td class="line">	 <span class='comment'>* Adjust adjustable widths not to exceed maximum width</span></td></tr>
<tr><td class="num" id="LN1718">1718</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1719">1719</td><td class="line">	<span class='keyword'>if</span> (name_width + number_width + 6 + graph_width &gt; width) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path19" class="msg msgControl" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">19</div></td><td><div class="PathNav"><a href="#Path18" title="Previous event (18)">&#x2190;</a></div></td></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path20" title="Next event (20)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1720">1720</td><td class="line">		<span class='keyword'>if</span> (graph_width &gt; width * 3/8 - number_width - 6) {</td></tr>
<tr><td class="num" id="LN1721">1721</td><td class="line">			graph_width = width * 3/8 - number_width - 6;</td></tr>
<tr><td class="num" id="LN1722">1722</td><td class="line">			<span class='keyword'>if</span> (graph_width &lt; 6)</td></tr>
<tr><td class="num" id="LN1723">1723</td><td class="line">				graph_width = 6;</td></tr>
<tr><td class="num" id="LN1724">1724</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1725">1725</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1726">1726</td><td class="line">		<span class='keyword'>if</span> (options-&gt;stat_graph_width &amp;&amp;</td></tr>
<tr><td class="num" id="LN1727">1727</td><td class="line">		    graph_width &gt; options-&gt;stat_graph_width)</td></tr>
<tr><td class="num" id="LN1728">1728</td><td class="line">			graph_width = options-&gt;stat_graph_width;</td></tr>
<tr><td class="num" id="LN1729">1729</td><td class="line">		<span class='keyword'>if</span> (name_width &gt; width - number_width - 6 - graph_width)</td></tr>
<tr><td class="num" id="LN1730">1730</td><td class="line">			name_width = width - number_width - 6 - graph_width;</td></tr>
<tr><td class="num" id="LN1731">1731</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN1732">1732</td><td class="line">			graph_width = width - number_width - 6 - name_width;</td></tr>
<tr><td class="num" id="LN1733">1733</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1734">1734</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1735">1735</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1736">1736</td><td class="line">	 <span class='comment'>* From here name_width is the width of the name area,</span></td></tr>
<tr><td class="num" id="LN1737">1737</td><td class="line">	 <span class='comment'>* and graph_width is the width of the graph area.</span></td></tr>
<tr><td class="num" id="LN1738">1738</td><td class="line">	 <span class='comment'>* max_change is used to scale graph properly.</span></td></tr>
<tr><td class="num" id="LN1739">1739</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1740">1740</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; count; i++) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path20" class="msg msgControl" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">20</div></td><td><div class="PathNav"><a href="#Path19" title="Previous event (19)">&#x2190;</a></div></td></td><td>Loop condition is true.  Entering loop body</td><td><div class="PathNav"><a href="#Path21" title="Next event (21)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1741">1741</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *prefix = <span class='string_literal'>""</span>;</td></tr>
<tr><td class="num" id="LN1742">1742</td><td class="line">		<span class='keyword'>struct</span> diffstat_file *file = data-&gt;files[i];</td></tr>
<tr><td class="num" id="LN1743">1743</td><td class="line">		<span class='keyword'>char</span> *name = file-&gt;print_name;</td></tr>
<tr><td class="num" id="LN1744">1744</td><td class="line">		uintmax_t added = file-&gt;added;</td></tr>
<tr><td class="num" id="LN1745">1745</td><td class="line">		uintmax_t deleted = file-&gt;deleted;</td></tr>
<tr><td class="num" id="LN1746">1746</td><td class="line">		<span class='keyword'>int</span> name_len;</td></tr>
<tr><td class="num" id="LN1747">1747</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1748">1748</td><td class="line">		<span class='keyword'>if</span> (!file-&gt;is_interesting &amp;&amp; (added + deleted == 0))</td></tr>
<tr><td class="num" id="LN1749">1749</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN1750">1750</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1751">1751</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1752">1752</td><td class="line">		 <span class='comment'>* "scale" the filename</span></td></tr>
<tr><td class="num" id="LN1753">1753</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1754">1754</td><td class="line">		len = name_width;</td></tr>
<tr><td class="num" id="LN1755">1755</td><td class="line">		name_len = strlen(name);</td></tr>
<tr><td class="num" id="LN1756">1756</td><td class="line">		<span class='keyword'>if</span> (name_width &lt; name_len) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path21" class="msg msgControl" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">21</div></td><td><div class="PathNav"><a href="#Path20" title="Previous event (20)">&#x2190;</a></div></td></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path22" title="Next event (22)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1757">1757</td><td class="line">			<span class='keyword'>char</span> *slash;</td></tr>
<tr><td class="num" id="LN1758">1758</td><td class="line">			prefix = <span class='string_literal'>"..."</span>;</td></tr>
<tr><td class="num" id="LN1759">1759</td><td class="line">			len -= 3;</td></tr>
<tr><td class="num" id="LN1760">1760</td><td class="line">			name += name_len - len;</td></tr>
<tr><td class="num" id="LN1761">1761</td><td class="line">			slash = strchr(name, '/');</td></tr>
<tr><td class="num" id="LN1762">1762</td><td class="line">			<span class='keyword'>if</span> (slash)</td></tr>
<tr><td class="num" id="LN1763">1763</td><td class="line">				name = slash;</td></tr>
<tr><td class="num" id="LN1764">1764</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1765">1765</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1766">1766</td><td class="line">		<span class='keyword'>if</span> (file-&gt;is_binary) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path22" class="msg msgControl" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">22</div></td><td><div class="PathNav"><a href="#Path21" title="Previous event (21)">&#x2190;</a></div></td></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path23" title="Next event (23)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1767">1767</td><td class="line">			fprintf(options-&gt;file, <span class='string_literal'>"%s"</span>, line_prefix);</td></tr>
<tr><td class="num" id="LN1768">1768</td><td class="line">			show_name(options-&gt;file, prefix, name, len);</td></tr>
<tr><td class="num" id="LN1769">1769</td><td class="line">			fprintf(options-&gt;file, <span class='string_literal'>" %*s"</span>, number_width, <span class='string_literal'>"Bin"</span>);</td></tr>
<tr><td class="num" id="LN1770">1770</td><td class="line">			<span class='keyword'>if</span> (!added &amp;&amp; !deleted) {</td></tr>
<tr><td class="num" id="LN1771">1771</td><td class="line">				putc('\n', options-&gt;file);</td></tr>
<tr><td class="num" id="LN1772">1772</td><td class="line">				<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN1773">1773</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN1774">1774</td><td class="line">			fprintf(options-&gt;file, <span class='string_literal'>" %s%"</span><span class='macro'>PRIuMAX<span class='expansion'>"j" "u"</span></span><span class='string_literal'>"%s"</span>,</td></tr>
<tr><td class="num" id="LN1775">1775</td><td class="line">				del_c, deleted, reset);</td></tr>
<tr><td class="num" id="LN1776">1776</td><td class="line">			fprintf(options-&gt;file, <span class='string_literal'>" -&gt; "</span>);</td></tr>
<tr><td class="num" id="LN1777">1777</td><td class="line">			fprintf(options-&gt;file, <span class='string_literal'>"%s%"</span><span class='macro'>PRIuMAX<span class='expansion'>"j" "u"</span></span><span class='string_literal'>"%s"</span>,</td></tr>
<tr><td class="num" id="LN1778">1778</td><td class="line">				add_c, added, reset);</td></tr>
<tr><td class="num" id="LN1779">1779</td><td class="line">			fprintf(options-&gt;file, <span class='string_literal'>" bytes"</span>);</td></tr>
<tr><td class="num" id="LN1780">1780</td><td class="line">			fprintf(options-&gt;file, <span class='string_literal'>"\n"</span>);</td></tr>
<tr><td class="num" id="LN1781">1781</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN1782">1782</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1783">1783</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (file-&gt;is_unmerged) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path23" class="msg msgControl" style="margin-left:22ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">23</div></td><td><div class="PathNav"><a href="#Path22" title="Previous event (22)">&#x2190;</a></div></td></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path24" title="Next event (24)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1784">1784</td><td class="line">			fprintf(options-&gt;file, <span class='string_literal'>"%s"</span>, line_prefix);</td></tr>
<tr><td class="num" id="LN1785">1785</td><td class="line">			show_name(options-&gt;file, prefix, name, len);</td></tr>
<tr><td class="num" id="LN1786">1786</td><td class="line">			fprintf(options-&gt;file, <span class='string_literal'>" Unmerged\n"</span>);</td></tr>
<tr><td class="num" id="LN1787">1787</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN1788">1788</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1789">1789</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1790">1790</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1791">1791</td><td class="line">		 <span class='comment'>* scale the add/delete</span></td></tr>
<tr><td class="num" id="LN1792">1792</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1793">1793</td><td class="line">		add = added;</td></tr>
<tr><td class="num" id="LN1794">1794</td><td class="line">		del = deleted;</td></tr>
<tr><td class="num" id="LN1795">1795</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1796">1796</td><td class="line">		<span class='keyword'>if</span> (graph_width &lt;= max_change) {</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path24" class="msg msgControl" style="margin-left:17ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">24</div></td><td><div class="PathNav"><a href="#Path23" title="Previous event (23)">&#x2190;</a></div></td></td><td>Taking true branch</td><td><div class="PathNav"><a href="#Path25" title="Next event (25)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1797">1797</td><td class="line">			<span class='keyword'>int</span> total = <span class="mrange">scale_linear(add + del, graph_width, <span class="mrange">max_change</span>)</span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path25" class="msg msgEvent" style="margin-left:74ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">25</div></td><td><div class="PathNav"><a href="#Path24" title="Previous event (24)">&#x2190;</a></div></td></td><td>Passing the value 0 via 3rd parameter 'max_change'</td><td><div class="PathNav"><a href="#Path26" title="Next event (26)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path26" class="msg msgEvent" style="margin-left:37ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">26</div></td><td><div class="PathNav"><a href="#Path25" title="Previous event (25)">&#x2190;</a></div></td></td><td>Calling 'scale_linear'</td><td><div class="PathNav"><a href="#Path27" title="Next event (27)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num" id="LN1798">1798</td><td class="line">			<span class='keyword'>if</span> (total &lt; 2 &amp;&amp; add &amp;&amp; del)</td></tr>
<tr><td class="num" id="LN1799">1799</td><td class="line">				<span class='comment'>/* width &gt;= 2 due to the sanity check */</span></td></tr>
<tr><td class="num" id="LN1800">1800</td><td class="line">				total = 2;</td></tr>
<tr><td class="num" id="LN1801">1801</td><td class="line">			<span class='keyword'>if</span> (add &lt; del) {</td></tr>
<tr><td class="num" id="LN1802">1802</td><td class="line">				add = scale_linear(add, graph_width, max_change);</td></tr>
<tr><td class="num" id="LN1803">1803</td><td class="line">				del = total - add;</td></tr>
<tr><td class="num" id="LN1804">1804</td><td class="line">			} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN1805">1805</td><td class="line">				del = scale_linear(del, graph_width, max_change);</td></tr>
<tr><td class="num" id="LN1806">1806</td><td class="line">				add = total - del;</td></tr>
<tr><td class="num" id="LN1807">1807</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN1808">1808</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1809">1809</td><td class="line">		fprintf(options-&gt;file, <span class='string_literal'>"%s"</span>, line_prefix);</td></tr>
<tr><td class="num" id="LN1810">1810</td><td class="line">		show_name(options-&gt;file, prefix, name, len);</td></tr>
<tr><td class="num" id="LN1811">1811</td><td class="line">		fprintf(options-&gt;file, <span class='string_literal'>" %*"</span><span class='macro'>PRIuMAX<span class='expansion'>"j" "u"</span></span><span class='string_literal'>"%s"</span>,</td></tr>
<tr><td class="num" id="LN1812">1812</td><td class="line">			number_width, added + deleted,</td></tr>
<tr><td class="num" id="LN1813">1813</td><td class="line">			added + deleted ? <span class='string_literal'>" "</span> : <span class='string_literal'>""</span>);</td></tr>
<tr><td class="num" id="LN1814">1814</td><td class="line">		show_graph(options-&gt;file, '+', add, add_c, reset);</td></tr>
<tr><td class="num" id="LN1815">1815</td><td class="line">		show_graph(options-&gt;file, '-', del, del_c, reset);</td></tr>
<tr><td class="num" id="LN1816">1816</td><td class="line">		fprintf(options-&gt;file, <span class='string_literal'>"\n"</span>);</td></tr>
<tr><td class="num" id="LN1817">1817</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1818">1818</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1819">1819</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; data-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN1820">1820</td><td class="line">		<span class='keyword'>struct</span> diffstat_file *file = data-&gt;files[i];</td></tr>
<tr><td class="num" id="LN1821">1821</td><td class="line">		uintmax_t added = file-&gt;added;</td></tr>
<tr><td class="num" id="LN1822">1822</td><td class="line">		uintmax_t deleted = file-&gt;deleted;</td></tr>
<tr><td class="num" id="LN1823">1823</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1824">1824</td><td class="line">		<span class='keyword'>if</span> (file-&gt;is_unmerged ||</td></tr>
<tr><td class="num" id="LN1825">1825</td><td class="line">		    (!file-&gt;is_interesting &amp;&amp; (added + deleted == 0))) {</td></tr>
<tr><td class="num" id="LN1826">1826</td><td class="line">			total_files--;</td></tr>
<tr><td class="num" id="LN1827">1827</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN1828">1828</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1829">1829</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1830">1830</td><td class="line">		<span class='keyword'>if</span> (!file-&gt;is_binary) {</td></tr>
<tr><td class="num" id="LN1831">1831</td><td class="line">			adds += added;</td></tr>
<tr><td class="num" id="LN1832">1832</td><td class="line">			dels += deleted;</td></tr>
<tr><td class="num" id="LN1833">1833</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1834">1834</td><td class="line">		<span class='keyword'>if</span> (i &lt; count)</td></tr>
<tr><td class="num" id="LN1835">1835</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN1836">1836</td><td class="line">		<span class='keyword'>if</span> (!extra_shown)</td></tr>
<tr><td class="num" id="LN1837">1837</td><td class="line">			fprintf(options-&gt;file, <span class='string_literal'>"%s ...\n"</span>, line_prefix);</td></tr>
<tr><td class="num" id="LN1838">1838</td><td class="line">		extra_shown = 1;</td></tr>
<tr><td class="num" id="LN1839">1839</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1840">1840</td><td class="line">	fprintf(options-&gt;file, <span class='string_literal'>"%s"</span>, line_prefix);</td></tr>
<tr><td class="num" id="LN1841">1841</td><td class="line">	print_stat_summary(options-&gt;file, total_files, adds, dels);</td></tr>
<tr><td class="num" id="LN1842">1842</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1843">1843</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1844">1844</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> show_shortstats(<span class='keyword'>struct</span> diffstat_t *data, <span class='keyword'>struct</span> diff_options *options)</td></tr>
<tr><td class="num" id="LN1845">1845</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1846">1846</td><td class="line">	<span class='keyword'>int</span> i, adds = 0, dels = 0, total_files = data-&gt;nr;</td></tr>
<tr><td class="num" id="LN1847">1847</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1848">1848</td><td class="line">	<span class='keyword'>if</span> (data-&gt;nr == 0)</td></tr>
<tr><td class="num" id="LN1849">1849</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN1850">1850</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1851">1851</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; data-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN1852">1852</td><td class="line">		<span class='keyword'>int</span> added = data-&gt;files[i]-&gt;added;</td></tr>
<tr><td class="num" id="LN1853">1853</td><td class="line">		<span class='keyword'>int</span> deleted= data-&gt;files[i]-&gt;deleted;</td></tr>
<tr><td class="num" id="LN1854">1854</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1855">1855</td><td class="line">		<span class='keyword'>if</span> (data-&gt;files[i]-&gt;is_unmerged ||</td></tr>
<tr><td class="num" id="LN1856">1856</td><td class="line">		    (!data-&gt;files[i]-&gt;is_interesting &amp;&amp; (added + deleted == 0))) {</td></tr>
<tr><td class="num" id="LN1857">1857</td><td class="line">			total_files--;</td></tr>
<tr><td class="num" id="LN1858">1858</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (!data-&gt;files[i]-&gt;is_binary) { <span class='comment'>/* don't count bytes */</span></td></tr>
<tr><td class="num" id="LN1859">1859</td><td class="line">			adds += added;</td></tr>
<tr><td class="num" id="LN1860">1860</td><td class="line">			dels += deleted;</td></tr>
<tr><td class="num" id="LN1861">1861</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1862">1862</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1863">1863</td><td class="line">	fprintf(options-&gt;file, <span class='string_literal'>"%s"</span>, diff_line_prefix(options));</td></tr>
<tr><td class="num" id="LN1864">1864</td><td class="line">	print_stat_summary(options-&gt;file, total_files, adds, dels);</td></tr>
<tr><td class="num" id="LN1865">1865</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1866">1866</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1867">1867</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> show_numstat(<span class='keyword'>struct</span> diffstat_t *data, <span class='keyword'>struct</span> diff_options *options)</td></tr>
<tr><td class="num" id="LN1868">1868</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1869">1869</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN1870">1870</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1871">1871</td><td class="line">	<span class='keyword'>if</span> (data-&gt;nr == 0)</td></tr>
<tr><td class="num" id="LN1872">1872</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN1873">1873</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1874">1874</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; data-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN1875">1875</td><td class="line">		<span class='keyword'>struct</span> diffstat_file *file = data-&gt;files[i];</td></tr>
<tr><td class="num" id="LN1876">1876</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1877">1877</td><td class="line">		fprintf(options-&gt;file, <span class='string_literal'>"%s"</span>, diff_line_prefix(options));</td></tr>
<tr><td class="num" id="LN1878">1878</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1879">1879</td><td class="line">		<span class='keyword'>if</span> (file-&gt;is_binary)</td></tr>
<tr><td class="num" id="LN1880">1880</td><td class="line">			fprintf(options-&gt;file, <span class='string_literal'>"-\t-\t"</span>);</td></tr>
<tr><td class="num" id="LN1881">1881</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN1882">1882</td><td class="line">			fprintf(options-&gt;file,</td></tr>
<tr><td class="num" id="LN1883">1883</td><td class="line">				<span class='string_literal'>"%"</span><span class='macro'>PRIuMAX<span class='expansion'>"j" "u"</span></span><span class='string_literal'>"\t%"</span><span class='macro'>PRIuMAX<span class='expansion'>"j" "u"</span></span><span class='string_literal'>"\t"</span>,</td></tr>
<tr><td class="num" id="LN1884">1884</td><td class="line">				file-&gt;added, file-&gt;deleted);</td></tr>
<tr><td class="num" id="LN1885">1885</td><td class="line">		<span class='keyword'>if</span> (options-&gt;line_termination) {</td></tr>
<tr><td class="num" id="LN1886">1886</td><td class="line">			fill_print_name(file);</td></tr>
<tr><td class="num" id="LN1887">1887</td><td class="line">			<span class='keyword'>if</span> (!file-&gt;is_renamed)</td></tr>
<tr><td class="num" id="LN1888">1888</td><td class="line">				write_name_quoted(file-&gt;name, options-&gt;file,</td></tr>
<tr><td class="num" id="LN1889">1889</td><td class="line">						  options-&gt;line_termination);</td></tr>
<tr><td class="num" id="LN1890">1890</td><td class="line">			<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN1891">1891</td><td class="line">				fputs(file-&gt;print_name, options-&gt;file);</td></tr>
<tr><td class="num" id="LN1892">1892</td><td class="line">				putc(options-&gt;line_termination, options-&gt;file);</td></tr>
<tr><td class="num" id="LN1893">1893</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN1894">1894</td><td class="line">		} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN1895">1895</td><td class="line">			<span class='keyword'>if</span> (file-&gt;is_renamed) {</td></tr>
<tr><td class="num" id="LN1896">1896</td><td class="line">				putc('\0', options-&gt;file);</td></tr>
<tr><td class="num" id="LN1897">1897</td><td class="line">				write_name_quoted(file-&gt;from_name, options-&gt;file, '\0');</td></tr>
<tr><td class="num" id="LN1898">1898</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN1899">1899</td><td class="line">			write_name_quoted(file-&gt;name, options-&gt;file, '\0');</td></tr>
<tr><td class="num" id="LN1900">1900</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1901">1901</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1902">1902</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1903">1903</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1904">1904</td><td class="line"><span class='keyword'>struct</span> dirstat_file {</td></tr>
<tr><td class="num" id="LN1905">1905</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *name;</td></tr>
<tr><td class="num" id="LN1906">1906</td><td class="line">	<span class='keyword'>unsigned</span> <span class='keyword'>long</span> changed;</td></tr>
<tr><td class="num" id="LN1907">1907</td><td class="line">};</td></tr>
<tr><td class="num" id="LN1908">1908</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1909">1909</td><td class="line"><span class='keyword'>struct</span> dirstat_dir {</td></tr>
<tr><td class="num" id="LN1910">1910</td><td class="line">	<span class='keyword'>struct</span> dirstat_file *files;</td></tr>
<tr><td class="num" id="LN1911">1911</td><td class="line">	<span class='keyword'>int</span> alloc, nr, permille, cumulative;</td></tr>
<tr><td class="num" id="LN1912">1912</td><td class="line">};</td></tr>
<tr><td class="num" id="LN1913">1913</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1914">1914</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>long</span> gather_dirstat(<span class='keyword'>struct</span> diff_options *opt, <span class='keyword'>struct</span> dirstat_dir *dir,</td></tr>
<tr><td class="num" id="LN1915">1915</td><td class="line">		<span class='keyword'>unsigned</span> <span class='keyword'>long</span> changed, <span class='keyword'>const</span> <span class='keyword'>char</span> *base, <span class='keyword'>int</span> baselen)</td></tr>
<tr><td class="num" id="LN1916">1916</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1917">1917</td><td class="line">	<span class='keyword'>unsigned</span> <span class='keyword'>long</span> this_dir = 0;</td></tr>
<tr><td class="num" id="LN1918">1918</td><td class="line">	<span class='keyword'>unsigned</span> <span class='keyword'>int</span> sources = 0;</td></tr>
<tr><td class="num" id="LN1919">1919</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *line_prefix = diff_line_prefix(opt);</td></tr>
<tr><td class="num" id="LN1920">1920</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1921">1921</td><td class="line">	<span class='keyword'>while</span> (dir-&gt;nr) {</td></tr>
<tr><td class="num" id="LN1922">1922</td><td class="line">		<span class='keyword'>struct</span> dirstat_file *f = dir-&gt;files;</td></tr>
<tr><td class="num" id="LN1923">1923</td><td class="line">		<span class='keyword'>int</span> namelen = strlen(f-&gt;name);</td></tr>
<tr><td class="num" id="LN1924">1924</td><td class="line">		<span class='keyword'>unsigned</span> <span class='keyword'>long</span> this;</td></tr>
<tr><td class="num" id="LN1925">1925</td><td class="line">		<span class='keyword'>char</span> *slash;</td></tr>
<tr><td class="num" id="LN1926">1926</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1927">1927</td><td class="line">		<span class='keyword'>if</span> (namelen &lt; baselen)</td></tr>
<tr><td class="num" id="LN1928">1928</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN1929">1929</td><td class="line">		<span class='keyword'>if</span> (memcmp(f-&gt;name, base, baselen))</td></tr>
<tr><td class="num" id="LN1930">1930</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN1931">1931</td><td class="line">		slash = strchr(f-&gt;name + baselen, '/');</td></tr>
<tr><td class="num" id="LN1932">1932</td><td class="line">		<span class='keyword'>if</span> (slash) {</td></tr>
<tr><td class="num" id="LN1933">1933</td><td class="line">			<span class='keyword'>int</span> newbaselen = slash + 1 - f-&gt;name;</td></tr>
<tr><td class="num" id="LN1934">1934</td><td class="line">			this = gather_dirstat(opt, dir, changed, f-&gt;name, newbaselen);</td></tr>
<tr><td class="num" id="LN1935">1935</td><td class="line">			sources++;</td></tr>
<tr><td class="num" id="LN1936">1936</td><td class="line">		} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN1937">1937</td><td class="line">			this = f-&gt;changed;</td></tr>
<tr><td class="num" id="LN1938">1938</td><td class="line">			dir-&gt;files++;</td></tr>
<tr><td class="num" id="LN1939">1939</td><td class="line">			dir-&gt;nr--;</td></tr>
<tr><td class="num" id="LN1940">1940</td><td class="line">			sources += 2;</td></tr>
<tr><td class="num" id="LN1941">1941</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1942">1942</td><td class="line">		this_dir += this;</td></tr>
<tr><td class="num" id="LN1943">1943</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1944">1944</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1945">1945</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN1946">1946</td><td class="line">	 <span class='comment'>* We don't report dirstat's for</span></td></tr>
<tr><td class="num" id="LN1947">1947</td><td class="line">	 <span class='comment'>*  - the top level</span></td></tr>
<tr><td class="num" id="LN1948">1948</td><td class="line">	 <span class='comment'>*  - or cases where everything came from a single directory</span></td></tr>
<tr><td class="num" id="LN1949">1949</td><td class="line">	 <span class='comment'>*    under this directory (sources == 1).</span></td></tr>
<tr><td class="num" id="LN1950">1950</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN1951">1951</td><td class="line">	<span class='keyword'>if</span> (baselen &amp;&amp; sources != 1) {</td></tr>
<tr><td class="num" id="LN1952">1952</td><td class="line">		<span class='keyword'>if</span> (this_dir) {</td></tr>
<tr><td class="num" id="LN1953">1953</td><td class="line">			<span class='keyword'>int</span> permille = this_dir * 1000 / changed;</td></tr>
<tr><td class="num" id="LN1954">1954</td><td class="line">			<span class='keyword'>if</span> (permille &gt;= dir-&gt;permille) {</td></tr>
<tr><td class="num" id="LN1955">1955</td><td class="line">				fprintf(opt-&gt;file, <span class='string_literal'>"%s%4d.%01d%% %.*s\n"</span>, line_prefix,</td></tr>
<tr><td class="num" id="LN1956">1956</td><td class="line">					permille / 10, permille % 10, baselen, base);</td></tr>
<tr><td class="num" id="LN1957">1957</td><td class="line">				<span class='keyword'>if</span> (!dir-&gt;cumulative)</td></tr>
<tr><td class="num" id="LN1958">1958</td><td class="line">					<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN1959">1959</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN1960">1960</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN1961">1961</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN1962">1962</td><td class="line">	<span class='keyword'>return</span> this_dir;</td></tr>
<tr><td class="num" id="LN1963">1963</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1964">1964</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1965">1965</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> dirstat_compare(<span class='keyword'>const</span> <span class='keyword'>void</span> *_a, <span class='keyword'>const</span> <span class='keyword'>void</span> *_b)</td></tr>
<tr><td class="num" id="LN1966">1966</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1967">1967</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>struct</span> dirstat_file *a = _a;</td></tr>
<tr><td class="num" id="LN1968">1968</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>struct</span> dirstat_file *b = _b;</td></tr>
<tr><td class="num" id="LN1969">1969</td><td class="line">	<span class='keyword'>return</span> strcmp(a-&gt;name, b-&gt;name);</td></tr>
<tr><td class="num" id="LN1970">1970</td><td class="line">}</td></tr>
<tr><td class="num" id="LN1971">1971</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1972">1972</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> show_dirstat(<span class='keyword'>struct</span> diff_options *options)</td></tr>
<tr><td class="num" id="LN1973">1973</td><td class="line">{</td></tr>
<tr><td class="num" id="LN1974">1974</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN1975">1975</td><td class="line">	<span class='keyword'>unsigned</span> <span class='keyword'>long</span> changed;</td></tr>
<tr><td class="num" id="LN1976">1976</td><td class="line">	<span class='keyword'>struct</span> dirstat_dir dir;</td></tr>
<tr><td class="num" id="LN1977">1977</td><td class="line">	<span class='keyword'>struct</span> diff_queue_struct *q = &amp;diff_queued_diff;</td></tr>
<tr><td class="num" id="LN1978">1978</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1979">1979</td><td class="line">	dir.files = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN1980">1980</td><td class="line">	dir.alloc = 0;</td></tr>
<tr><td class="num" id="LN1981">1981</td><td class="line">	dir.nr = 0;</td></tr>
<tr><td class="num" id="LN1982">1982</td><td class="line">	dir.permille = options-&gt;dirstat_permille;</td></tr>
<tr><td class="num" id="LN1983">1983</td><td class="line">	dir.cumulative = <span class='macro'>DIFF_OPT_TST(options, DIRSTAT_CUMULATIVE)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 19))</span></span>;</td></tr>
<tr><td class="num" id="LN1984">1984</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1985">1985</td><td class="line">	changed = 0;</td></tr>
<tr><td class="num" id="LN1986">1986</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN1987">1987</td><td class="line">		<span class='keyword'>struct</span> diff_filepair *p = q-&gt;queue[i];</td></tr>
<tr><td class="num" id="LN1988">1988</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *name;</td></tr>
<tr><td class="num" id="LN1989">1989</td><td class="line">		<span class='keyword'>unsigned</span> <span class='keyword'>long</span> copied, added, damage;</td></tr>
<tr><td class="num" id="LN1990">1990</td><td class="line">		<span class='keyword'>int</span> content_changed;</td></tr>
<tr><td class="num" id="LN1991">1991</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1992">1992</td><td class="line">		name = p-&gt;two-&gt;path ? p-&gt;two-&gt;path : p-&gt;one-&gt;path;</td></tr>
<tr><td class="num" id="LN1993">1993</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1994">1994</td><td class="line">		<span class='keyword'>if</span> (p-&gt;one-&gt;oid_valid &amp;&amp; p-&gt;two-&gt;oid_valid)</td></tr>
<tr><td class="num" id="LN1995">1995</td><td class="line">			content_changed = oidcmp(&amp;p-&gt;one-&gt;oid, &amp;p-&gt;two-&gt;oid);</td></tr>
<tr><td class="num" id="LN1996">1996</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN1997">1997</td><td class="line">			content_changed = 1;</td></tr>
<tr><td class="num" id="LN1998">1998</td><td class="line"> </td></tr>
<tr><td class="num" id="LN1999">1999</td><td class="line">		<span class='keyword'>if</span> (!content_changed) {</td></tr>
<tr><td class="num" id="LN2000">2000</td><td class="line">			<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2001">2001</td><td class="line">			 <span class='comment'>* The SHA1 has not changed, so pre-/post-content is</span></td></tr>
<tr><td class="num" id="LN2002">2002</td><td class="line">			 <span class='comment'>* identical. We can therefore skip looking at the</span></td></tr>
<tr><td class="num" id="LN2003">2003</td><td class="line">			 <span class='comment'>* file contents altogether.</span></td></tr>
<tr><td class="num" id="LN2004">2004</td><td class="line">			 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2005">2005</td><td class="line">			damage = 0;</td></tr>
<tr><td class="num" id="LN2006">2006</td><td class="line">			<span class='keyword'>goto</span> found_damage;</td></tr>
<tr><td class="num" id="LN2007">2007</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2008">2008</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2009">2009</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(options, DIRSTAT_BY_FILE)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 20))</span></span>) {</td></tr>
<tr><td class="num" id="LN2010">2010</td><td class="line">			<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2011">2011</td><td class="line">			 <span class='comment'>* In --dirstat-by-file mode, we don't really need to</span></td></tr>
<tr><td class="num" id="LN2012">2012</td><td class="line">			 <span class='comment'>* look at the actual file contents at all.</span></td></tr>
<tr><td class="num" id="LN2013">2013</td><td class="line">			 <span class='comment'>* The fact that the SHA1 changed is enough for us to</span></td></tr>
<tr><td class="num" id="LN2014">2014</td><td class="line">			 <span class='comment'>* add this file to the list of results</span></td></tr>
<tr><td class="num" id="LN2015">2015</td><td class="line">			 <span class='comment'>* (with each file contributing equal damage).</span></td></tr>
<tr><td class="num" id="LN2016">2016</td><td class="line">			 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2017">2017</td><td class="line">			damage = 1;</td></tr>
<tr><td class="num" id="LN2018">2018</td><td class="line">			<span class='keyword'>goto</span> found_damage;</td></tr>
<tr><td class="num" id="LN2019">2019</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2020">2020</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2021">2021</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>DIFF_FILE_VALID(p-&gt;one)<span class='expansion'>(((p-&gt;one)-&gt;mode) != 0)</span></span> &amp;&amp; <span class='macro'>DIFF_FILE_VALID(p-&gt;two)<span class='expansion'>(((p-&gt;two)-&gt;mode) != 0)</span></span>) {</td></tr>
<tr><td class="num" id="LN2022">2022</td><td class="line">			diff_populate_filespec(p-&gt;one, 0);</td></tr>
<tr><td class="num" id="LN2023">2023</td><td class="line">			diff_populate_filespec(p-&gt;two, 0);</td></tr>
<tr><td class="num" id="LN2024">2024</td><td class="line">			diffcore_count_changes(p-&gt;one, p-&gt;two, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>,</td></tr>
<tr><td class="num" id="LN2025">2025</td><td class="line">					       &amp;copied, &amp;added);</td></tr>
<tr><td class="num" id="LN2026">2026</td><td class="line">			diff_free_filespec_data(p-&gt;one);</td></tr>
<tr><td class="num" id="LN2027">2027</td><td class="line">			diff_free_filespec_data(p-&gt;two);</td></tr>
<tr><td class="num" id="LN2028">2028</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (<span class='macro'>DIFF_FILE_VALID(p-&gt;one)<span class='expansion'>(((p-&gt;one)-&gt;mode) != 0)</span></span>) {</td></tr>
<tr><td class="num" id="LN2029">2029</td><td class="line">			diff_populate_filespec(p-&gt;one, <span class='macro'>CHECK_SIZE_ONLY<span class='expansion'>1</span></span>);</td></tr>
<tr><td class="num" id="LN2030">2030</td><td class="line">			copied = added = 0;</td></tr>
<tr><td class="num" id="LN2031">2031</td><td class="line">			diff_free_filespec_data(p-&gt;one);</td></tr>
<tr><td class="num" id="LN2032">2032</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (<span class='macro'>DIFF_FILE_VALID(p-&gt;two)<span class='expansion'>(((p-&gt;two)-&gt;mode) != 0)</span></span>) {</td></tr>
<tr><td class="num" id="LN2033">2033</td><td class="line">			diff_populate_filespec(p-&gt;two, <span class='macro'>CHECK_SIZE_ONLY<span class='expansion'>1</span></span>);</td></tr>
<tr><td class="num" id="LN2034">2034</td><td class="line">			copied = 0;</td></tr>
<tr><td class="num" id="LN2035">2035</td><td class="line">			added = p-&gt;two-&gt;size;</td></tr>
<tr><td class="num" id="LN2036">2036</td><td class="line">			diff_free_filespec_data(p-&gt;two);</td></tr>
<tr><td class="num" id="LN2037">2037</td><td class="line">		} <span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN2038">2038</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN2039">2039</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2040">2040</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2041">2041</td><td class="line">		 <span class='comment'>* Original minus copied is the removed material,</span></td></tr>
<tr><td class="num" id="LN2042">2042</td><td class="line">		 <span class='comment'>* added is the new material.  They are both damages</span></td></tr>
<tr><td class="num" id="LN2043">2043</td><td class="line">		 <span class='comment'>* made to the preimage.</span></td></tr>
<tr><td class="num" id="LN2044">2044</td><td class="line">		 <span class='comment'>* If the resulting damage is zero, we know that</span></td></tr>
<tr><td class="num" id="LN2045">2045</td><td class="line">		 <span class='comment'>* diffcore_count_changes() considers the two entries to</span></td></tr>
<tr><td class="num" id="LN2046">2046</td><td class="line">		 <span class='comment'>* be identical, but since content_changed is true, we</span></td></tr>
<tr><td class="num" id="LN2047">2047</td><td class="line">		 <span class='comment'>* know that there must have been _some_ kind of change,</span></td></tr>
<tr><td class="num" id="LN2048">2048</td><td class="line">		 <span class='comment'>* so we force all entries to have damage &gt; 0.</span></td></tr>
<tr><td class="num" id="LN2049">2049</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2050">2050</td><td class="line">		damage = (p-&gt;one-&gt;size - copied) + added;</td></tr>
<tr><td class="num" id="LN2051">2051</td><td class="line">		<span class='keyword'>if</span> (!damage)</td></tr>
<tr><td class="num" id="LN2052">2052</td><td class="line">			damage = 1;</td></tr>
<tr><td class="num" id="LN2053">2053</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2054">2054</td><td class="line">found_damage:</td></tr>
<tr><td class="num" id="LN2055">2055</td><td class="line">		<span class='macro'>ALLOC_GROW(dir.files, dir.nr + 1, dir.alloc)<span class='expansion'>do { if ((dir.nr + 1) &gt; dir.alloc) { if ((((dir.alloc)+16)<br>*3/2) &lt; (dir.nr + 1)) dir.alloc = (dir.nr + 1); else dir.alloc<br> = (((dir.alloc)+16)*3/2); (dir.files) = xrealloc((dir.files)<br>, st_mult(sizeof(*(dir.files)), (dir.alloc))); } } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN2056">2056</td><td class="line">		dir.files[dir.nr].name = name;</td></tr>
<tr><td class="num" id="LN2057">2057</td><td class="line">		dir.files[dir.nr].changed = damage;</td></tr>
<tr><td class="num" id="LN2058">2058</td><td class="line">		changed += damage;</td></tr>
<tr><td class="num" id="LN2059">2059</td><td class="line">		dir.nr++;</td></tr>
<tr><td class="num" id="LN2060">2060</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2061">2061</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2062">2062</td><td class="line">	<span class='comment'>/* This can happen even with many files, if everything was renames */</span></td></tr>
<tr><td class="num" id="LN2063">2063</td><td class="line">	<span class='keyword'>if</span> (!changed)</td></tr>
<tr><td class="num" id="LN2064">2064</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN2065">2065</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2066">2066</td><td class="line">	<span class='comment'>/* Show all directories with more than x% of the changes */</span></td></tr>
<tr><td class="num" id="LN2067">2067</td><td class="line">	<span class='macro'>QSORT(dir.files, dir.nr, dirstat_compare)<span class='expansion'>sane_qsort((dir.files), (dir.nr), sizeof(*(dir.files)), dirstat_compare<br>)</span></span>;</td></tr>
<tr><td class="num" id="LN2068">2068</td><td class="line">	gather_dirstat(options, &amp;dir, changed, <span class='string_literal'>""</span>, 0);</td></tr>
<tr><td class="num" id="LN2069">2069</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2070">2070</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2071">2071</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> show_dirstat_by_line(<span class='keyword'>struct</span> diffstat_t *data, <span class='keyword'>struct</span> diff_options *options)</td></tr>
<tr><td class="num" id="LN2072">2072</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2073">2073</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN2074">2074</td><td class="line">	<span class='keyword'>unsigned</span> <span class='keyword'>long</span> changed;</td></tr>
<tr><td class="num" id="LN2075">2075</td><td class="line">	<span class='keyword'>struct</span> dirstat_dir dir;</td></tr>
<tr><td class="num" id="LN2076">2076</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2077">2077</td><td class="line">	<span class='keyword'>if</span> (data-&gt;nr == 0)</td></tr>
<tr><td class="num" id="LN2078">2078</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN2079">2079</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2080">2080</td><td class="line">	dir.files = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN2081">2081</td><td class="line">	dir.alloc = 0;</td></tr>
<tr><td class="num" id="LN2082">2082</td><td class="line">	dir.nr = 0;</td></tr>
<tr><td class="num" id="LN2083">2083</td><td class="line">	dir.permille = options-&gt;dirstat_permille;</td></tr>
<tr><td class="num" id="LN2084">2084</td><td class="line">	dir.cumulative = <span class='macro'>DIFF_OPT_TST(options, DIRSTAT_CUMULATIVE)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 19))</span></span>;</td></tr>
<tr><td class="num" id="LN2085">2085</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2086">2086</td><td class="line">	changed = 0;</td></tr>
<tr><td class="num" id="LN2087">2087</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; data-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN2088">2088</td><td class="line">		<span class='keyword'>struct</span> diffstat_file *file = data-&gt;files[i];</td></tr>
<tr><td class="num" id="LN2089">2089</td><td class="line">		<span class='keyword'>unsigned</span> <span class='keyword'>long</span> damage = file-&gt;added + file-&gt;deleted;</td></tr>
<tr><td class="num" id="LN2090">2090</td><td class="line">		<span class='keyword'>if</span> (file-&gt;is_binary)</td></tr>
<tr><td class="num" id="LN2091">2091</td><td class="line">			<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2092">2092</td><td class="line">			 <span class='comment'>* binary files counts bytes, not lines. Must find some</span></td></tr>
<tr><td class="num" id="LN2093">2093</td><td class="line">			 <span class='comment'>* way to normalize binary bytes vs. textual lines.</span></td></tr>
<tr><td class="num" id="LN2094">2094</td><td class="line">			 <span class='comment'>* The following heuristic assumes that there are 64</span></td></tr>
<tr><td class="num" id="LN2095">2095</td><td class="line">			 <span class='comment'>* bytes per "line".</span></td></tr>
<tr><td class="num" id="LN2096">2096</td><td class="line">			 <span class='comment'>* This is stupid and ugly, but very cheap...</span></td></tr>
<tr><td class="num" id="LN2097">2097</td><td class="line">			 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2098">2098</td><td class="line">			damage = (damage + 63) / 64;</td></tr>
<tr><td class="num" id="LN2099">2099</td><td class="line">		<span class='macro'>ALLOC_GROW(dir.files, dir.nr + 1, dir.alloc)<span class='expansion'>do { if ((dir.nr + 1) &gt; dir.alloc) { if ((((dir.alloc)+16)<br>*3/2) &lt; (dir.nr + 1)) dir.alloc = (dir.nr + 1); else dir.alloc<br> = (((dir.alloc)+16)*3/2); (dir.files) = xrealloc((dir.files)<br>, st_mult(sizeof(*(dir.files)), (dir.alloc))); } } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN2100">2100</td><td class="line">		dir.files[dir.nr].name = file-&gt;name;</td></tr>
<tr><td class="num" id="LN2101">2101</td><td class="line">		dir.files[dir.nr].changed = damage;</td></tr>
<tr><td class="num" id="LN2102">2102</td><td class="line">		changed += damage;</td></tr>
<tr><td class="num" id="LN2103">2103</td><td class="line">		dir.nr++;</td></tr>
<tr><td class="num" id="LN2104">2104</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2105">2105</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2106">2106</td><td class="line">	<span class='comment'>/* This can happen even with many files, if everything was renames */</span></td></tr>
<tr><td class="num" id="LN2107">2107</td><td class="line">	<span class='keyword'>if</span> (!changed)</td></tr>
<tr><td class="num" id="LN2108">2108</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN2109">2109</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2110">2110</td><td class="line">	<span class='comment'>/* Show all directories with more than x% of the changes */</span></td></tr>
<tr><td class="num" id="LN2111">2111</td><td class="line">	<span class='macro'>QSORT(dir.files, dir.nr, dirstat_compare)<span class='expansion'>sane_qsort((dir.files), (dir.nr), sizeof(*(dir.files)), dirstat_compare<br>)</span></span>;</td></tr>
<tr><td class="num" id="LN2112">2112</td><td class="line">	gather_dirstat(options, &amp;dir, changed, <span class='string_literal'>""</span>, 0);</td></tr>
<tr><td class="num" id="LN2113">2113</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2114">2114</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2115">2115</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> free_diffstat_info(<span class='keyword'>struct</span> diffstat_t *diffstat)</td></tr>
<tr><td class="num" id="LN2116">2116</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2117">2117</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN2118">2118</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; diffstat-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN2119">2119</td><td class="line">		<span class='keyword'>struct</span> diffstat_file *f = diffstat-&gt;files[i];</td></tr>
<tr><td class="num" id="LN2120">2120</td><td class="line">		<span class='keyword'>if</span> (f-&gt;name != f-&gt;print_name)</td></tr>
<tr><td class="num" id="LN2121">2121</td><td class="line">			free(f-&gt;print_name);</td></tr>
<tr><td class="num" id="LN2122">2122</td><td class="line">		free(f-&gt;name);</td></tr>
<tr><td class="num" id="LN2123">2123</td><td class="line">		free(f-&gt;from_name);</td></tr>
<tr><td class="num" id="LN2124">2124</td><td class="line">		free(f);</td></tr>
<tr><td class="num" id="LN2125">2125</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2126">2126</td><td class="line">	free(diffstat-&gt;files);</td></tr>
<tr><td class="num" id="LN2127">2127</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2128">2128</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2129">2129</td><td class="line"><span class='keyword'>struct</span> checkdiff_t {</td></tr>
<tr><td class="num" id="LN2130">2130</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *filename;</td></tr>
<tr><td class="num" id="LN2131">2131</td><td class="line">	<span class='keyword'>int</span> lineno;</td></tr>
<tr><td class="num" id="LN2132">2132</td><td class="line">	<span class='keyword'>int</span> conflict_marker_size;</td></tr>
<tr><td class="num" id="LN2133">2133</td><td class="line">	<span class='keyword'>struct</span> diff_options *o;</td></tr>
<tr><td class="num" id="LN2134">2134</td><td class="line">	<span class='keyword'>unsigned</span> ws_rule;</td></tr>
<tr><td class="num" id="LN2135">2135</td><td class="line">	<span class='keyword'>unsigned</span> status;</td></tr>
<tr><td class="num" id="LN2136">2136</td><td class="line">};</td></tr>
<tr><td class="num" id="LN2137">2137</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2138">2138</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> is_conflict_marker(<span class='keyword'>const</span> <span class='keyword'>char</span> *line, <span class='keyword'>int</span> marker_size, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> len)</td></tr>
<tr><td class="num" id="LN2139">2139</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2140">2140</td><td class="line">	<span class='keyword'>char</span> firstchar;</td></tr>
<tr><td class="num" id="LN2141">2141</td><td class="line">	<span class='keyword'>int</span> cnt;</td></tr>
<tr><td class="num" id="LN2142">2142</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2143">2143</td><td class="line">	<span class='keyword'>if</span> (len &lt; marker_size + 1)</td></tr>
<tr><td class="num" id="LN2144">2144</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2145">2145</td><td class="line">	firstchar = line[0];</td></tr>
<tr><td class="num" id="LN2146">2146</td><td class="line">	<span class='keyword'>switch</span> (firstchar) {</td></tr>
<tr><td class="num" id="LN2147">2147</td><td class="line">	<span class='keyword'>case</span> '=': <span class='keyword'>case</span> '&gt;': <span class='keyword'>case</span> '&lt;': <span class='keyword'>case</span> '|':</td></tr>
<tr><td class="num" id="LN2148">2148</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN2149">2149</td><td class="line">	<span class='keyword'>default</span>:</td></tr>
<tr><td class="num" id="LN2150">2150</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2151">2151</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2152">2152</td><td class="line">	<span class='keyword'>for</span> (cnt = 1; cnt &lt; marker_size; cnt++)</td></tr>
<tr><td class="num" id="LN2153">2153</td><td class="line">		<span class='keyword'>if</span> (line[cnt] != firstchar)</td></tr>
<tr><td class="num" id="LN2154">2154</td><td class="line">			<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2155">2155</td><td class="line">	<span class='comment'>/* line[1] thru line[marker_size-1] are same as firstchar */</span></td></tr>
<tr><td class="num" id="LN2156">2156</td><td class="line">	<span class='keyword'>if</span> (len &lt; marker_size + 1 || !<span class='macro'>isspace(line[marker_size])<span class='expansion'>((sane_ctype[(unsigned char)(line[marker_size])] &amp; (0x01)<br>) != 0)</span></span>)</td></tr>
<tr><td class="num" id="LN2157">2157</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2158">2158</td><td class="line">	<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN2159">2159</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2160">2160</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2161">2161</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> checkdiff_consume(<span class='keyword'>void</span> *priv, <span class='keyword'>char</span> *line, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> len)</td></tr>
<tr><td class="num" id="LN2162">2162</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2163">2163</td><td class="line">	<span class='keyword'>struct</span> checkdiff_t *data = priv;</td></tr>
<tr><td class="num" id="LN2164">2164</td><td class="line">	<span class='keyword'>int</span> marker_size = data-&gt;conflict_marker_size;</td></tr>
<tr><td class="num" id="LN2165">2165</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *ws = diff_get_color(data-&gt;o-&gt;use_color, DIFF_WHITESPACE);</td></tr>
<tr><td class="num" id="LN2166">2166</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *reset = diff_get_color(data-&gt;o-&gt;use_color, DIFF_RESET);</td></tr>
<tr><td class="num" id="LN2167">2167</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *set = diff_get_color(data-&gt;o-&gt;use_color, DIFF_FILE_NEW);</td></tr>
<tr><td class="num" id="LN2168">2168</td><td class="line">	<span class='keyword'>char</span> *err;</td></tr>
<tr><td class="num" id="LN2169">2169</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *line_prefix;</td></tr>
<tr><td class="num" id="LN2170">2170</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2171">2171</td><td class="line">	<span class='macro'>assert(data-&gt;o)<span class='expansion'>(__builtin_expect(!(data-&gt;o), 0) ? __assert_rtn(__func__, "diff.c"<br>, 2171, "data-&gt;o") : (void)0)</span></span>;</td></tr>
<tr><td class="num" id="LN2172">2172</td><td class="line">	line_prefix = diff_line_prefix(data-&gt;o);</td></tr>
<tr><td class="num" id="LN2173">2173</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2174">2174</td><td class="line">	<span class='keyword'>if</span> (line[0] == '+') {</td></tr>
<tr><td class="num" id="LN2175">2175</td><td class="line">		<span class='keyword'>unsigned</span> bad;</td></tr>
<tr><td class="num" id="LN2176">2176</td><td class="line">		data-&gt;lineno++;</td></tr>
<tr><td class="num" id="LN2177">2177</td><td class="line">		<span class='keyword'>if</span> (is_conflict_marker(line + 1, marker_size, len - 1)) {</td></tr>
<tr><td class="num" id="LN2178">2178</td><td class="line">			data-&gt;status |= 1;</td></tr>
<tr><td class="num" id="LN2179">2179</td><td class="line">			fprintf(data-&gt;o-&gt;file,</td></tr>
<tr><td class="num" id="LN2180">2180</td><td class="line">				<span class='string_literal'>"%s%s:%d: leftover conflict marker\n"</span>,</td></tr>
<tr><td class="num" id="LN2181">2181</td><td class="line">				line_prefix, data-&gt;filename, data-&gt;lineno);</td></tr>
<tr><td class="num" id="LN2182">2182</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2183">2183</td><td class="line">		bad = ws_check(line + 1, len - 1, data-&gt;ws_rule);</td></tr>
<tr><td class="num" id="LN2184">2184</td><td class="line">		<span class='keyword'>if</span> (!bad)</td></tr>
<tr><td class="num" id="LN2185">2185</td><td class="line">			<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN2186">2186</td><td class="line">		data-&gt;status |= bad;</td></tr>
<tr><td class="num" id="LN2187">2187</td><td class="line">		err = whitespace_error_string(bad);</td></tr>
<tr><td class="num" id="LN2188">2188</td><td class="line">		fprintf(data-&gt;o-&gt;file, <span class='string_literal'>"%s%s:%d: %s.\n"</span>,</td></tr>
<tr><td class="num" id="LN2189">2189</td><td class="line">			line_prefix, data-&gt;filename, data-&gt;lineno, err);</td></tr>
<tr><td class="num" id="LN2190">2190</td><td class="line">		free(err);</td></tr>
<tr><td class="num" id="LN2191">2191</td><td class="line">		emit_line(data-&gt;o, set, reset, line, 1);</td></tr>
<tr><td class="num" id="LN2192">2192</td><td class="line">		ws_check_emit(line + 1, len - 1, data-&gt;ws_rule,</td></tr>
<tr><td class="num" id="LN2193">2193</td><td class="line">			      data-&gt;o-&gt;file, set, reset, ws);</td></tr>
<tr><td class="num" id="LN2194">2194</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (line[0] == ' ') {</td></tr>
<tr><td class="num" id="LN2195">2195</td><td class="line">		data-&gt;lineno++;</td></tr>
<tr><td class="num" id="LN2196">2196</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (line[0] == '@') {</td></tr>
<tr><td class="num" id="LN2197">2197</td><td class="line">		<span class='keyword'>char</span> *plus = strchr(line, '+');</td></tr>
<tr><td class="num" id="LN2198">2198</td><td class="line">		<span class='keyword'>if</span> (plus)</td></tr>
<tr><td class="num" id="LN2199">2199</td><td class="line">			data-&gt;lineno = strtol(plus, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 10) - 1;</td></tr>
<tr><td class="num" id="LN2200">2200</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN2201">2201</td><td class="line">			die(<span class='string_literal'>"invalid diff"</span>);</td></tr>
<tr><td class="num" id="LN2202">2202</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2203">2203</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2204">2204</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2205">2205</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *deflate_it(<span class='keyword'>char</span> *data,</td></tr>
<tr><td class="num" id="LN2206">2206</td><td class="line">				 <span class='keyword'>unsigned</span> <span class='keyword'>long</span> size,</td></tr>
<tr><td class="num" id="LN2207">2207</td><td class="line">				 <span class='keyword'>unsigned</span> <span class='keyword'>long</span> *result_size)</td></tr>
<tr><td class="num" id="LN2208">2208</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2209">2209</td><td class="line">	<span class='keyword'>int</span> bound;</td></tr>
<tr><td class="num" id="LN2210">2210</td><td class="line">	<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *deflated;</td></tr>
<tr><td class="num" id="LN2211">2211</td><td class="line">	git_zstream stream;</td></tr>
<tr><td class="num" id="LN2212">2212</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2213">2213</td><td class="line">	git_deflate_init(&amp;stream, zlib_compression_level);</td></tr>
<tr><td class="num" id="LN2214">2214</td><td class="line">	bound = git_deflate_bound(&amp;stream, size);</td></tr>
<tr><td class="num" id="LN2215">2215</td><td class="line">	deflated = xmalloc(bound);</td></tr>
<tr><td class="num" id="LN2216">2216</td><td class="line">	stream.next_out = deflated;</td></tr>
<tr><td class="num" id="LN2217">2217</td><td class="line">	stream.avail_out = bound;</td></tr>
<tr><td class="num" id="LN2218">2218</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2219">2219</td><td class="line">	stream.next_in = (<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *)data;</td></tr>
<tr><td class="num" id="LN2220">2220</td><td class="line">	stream.avail_in = size;</td></tr>
<tr><td class="num" id="LN2221">2221</td><td class="line">	<span class='keyword'>while</span> (git_deflate(&amp;stream, <span class='macro'>Z_FINISH<span class='expansion'>4</span></span>) == <span class='macro'>Z_OK<span class='expansion'>0</span></span>)</td></tr>
<tr><td class="num" id="LN2222">2222</td><td class="line">		; <span class='comment'>/* nothing */</span></td></tr>
<tr><td class="num" id="LN2223">2223</td><td class="line">	git_deflate_end(&amp;stream);</td></tr>
<tr><td class="num" id="LN2224">2224</td><td class="line">	*result_size = stream.total_out;</td></tr>
<tr><td class="num" id="LN2225">2225</td><td class="line">	<span class='keyword'>return</span> deflated;</td></tr>
<tr><td class="num" id="LN2226">2226</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2227">2227</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2228">2228</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> emit_binary_diff_body(FILE *file, mmfile_t *one, mmfile_t *two,</td></tr>
<tr><td class="num" id="LN2229">2229</td><td class="line">				  <span class='keyword'>const</span> <span class='keyword'>char</span> *prefix)</td></tr>
<tr><td class="num" id="LN2230">2230</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2231">2231</td><td class="line">	<span class='keyword'>void</span> *cp;</td></tr>
<tr><td class="num" id="LN2232">2232</td><td class="line">	<span class='keyword'>void</span> *delta;</td></tr>
<tr><td class="num" id="LN2233">2233</td><td class="line">	<span class='keyword'>void</span> *deflated;</td></tr>
<tr><td class="num" id="LN2234">2234</td><td class="line">	<span class='keyword'>void</span> *data;</td></tr>
<tr><td class="num" id="LN2235">2235</td><td class="line">	<span class='keyword'>unsigned</span> <span class='keyword'>long</span> orig_size;</td></tr>
<tr><td class="num" id="LN2236">2236</td><td class="line">	<span class='keyword'>unsigned</span> <span class='keyword'>long</span> delta_size;</td></tr>
<tr><td class="num" id="LN2237">2237</td><td class="line">	<span class='keyword'>unsigned</span> <span class='keyword'>long</span> deflate_size;</td></tr>
<tr><td class="num" id="LN2238">2238</td><td class="line">	<span class='keyword'>unsigned</span> <span class='keyword'>long</span> data_size;</td></tr>
<tr><td class="num" id="LN2239">2239</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2240">2240</td><td class="line">	<span class='comment'>/* We could do deflated delta, or we could do just deflated two,</span></td></tr>
<tr><td class="num" id="LN2241">2241</td><td class="line">	 <span class='comment'>* whichever is smaller.</span></td></tr>
<tr><td class="num" id="LN2242">2242</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2243">2243</td><td class="line">	delta = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN2244">2244</td><td class="line">	deflated = deflate_it(two-&gt;ptr, two-&gt;size, &amp;deflate_size);</td></tr>
<tr><td class="num" id="LN2245">2245</td><td class="line">	<span class='keyword'>if</span> (one-&gt;size &amp;&amp; two-&gt;size) {</td></tr>
<tr><td class="num" id="LN2246">2246</td><td class="line">		delta = diff_delta(one-&gt;ptr, one-&gt;size,</td></tr>
<tr><td class="num" id="LN2247">2247</td><td class="line">				   two-&gt;ptr, two-&gt;size,</td></tr>
<tr><td class="num" id="LN2248">2248</td><td class="line">				   &amp;delta_size, deflate_size);</td></tr>
<tr><td class="num" id="LN2249">2249</td><td class="line">		<span class='keyword'>if</span> (delta) {</td></tr>
<tr><td class="num" id="LN2250">2250</td><td class="line">			<span class='keyword'>void</span> *to_free = delta;</td></tr>
<tr><td class="num" id="LN2251">2251</td><td class="line">			orig_size = delta_size;</td></tr>
<tr><td class="num" id="LN2252">2252</td><td class="line">			delta = deflate_it(delta, delta_size, &amp;delta_size);</td></tr>
<tr><td class="num" id="LN2253">2253</td><td class="line">			free(to_free);</td></tr>
<tr><td class="num" id="LN2254">2254</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2255">2255</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2256">2256</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2257">2257</td><td class="line">	<span class='keyword'>if</span> (delta &amp;&amp; delta_size &lt; deflate_size) {</td></tr>
<tr><td class="num" id="LN2258">2258</td><td class="line">		fprintf(file, <span class='string_literal'>"%sdelta %lu\n"</span>, prefix, orig_size);</td></tr>
<tr><td class="num" id="LN2259">2259</td><td class="line">		free(deflated);</td></tr>
<tr><td class="num" id="LN2260">2260</td><td class="line">		data = delta;</td></tr>
<tr><td class="num" id="LN2261">2261</td><td class="line">		data_size = delta_size;</td></tr>
<tr><td class="num" id="LN2262">2262</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2263">2263</td><td class="line">	<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN2264">2264</td><td class="line">		fprintf(file, <span class='string_literal'>"%sliteral %lu\n"</span>, prefix, two-&gt;size);</td></tr>
<tr><td class="num" id="LN2265">2265</td><td class="line">		free(delta);</td></tr>
<tr><td class="num" id="LN2266">2266</td><td class="line">		data = deflated;</td></tr>
<tr><td class="num" id="LN2267">2267</td><td class="line">		data_size = deflate_size;</td></tr>
<tr><td class="num" id="LN2268">2268</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2269">2269</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2270">2270</td><td class="line">	<span class='comment'>/* emit data encoded in base85 */</span></td></tr>
<tr><td class="num" id="LN2271">2271</td><td class="line">	cp = data;</td></tr>
<tr><td class="num" id="LN2272">2272</td><td class="line">	<span class='keyword'>while</span> (data_size) {</td></tr>
<tr><td class="num" id="LN2273">2273</td><td class="line">		<span class='keyword'>int</span> bytes = (52 &lt; data_size) ? 52 : data_size;</td></tr>
<tr><td class="num" id="LN2274">2274</td><td class="line">		<span class='keyword'>char</span> line[70];</td></tr>
<tr><td class="num" id="LN2275">2275</td><td class="line">		data_size -= bytes;</td></tr>
<tr><td class="num" id="LN2276">2276</td><td class="line">		<span class='keyword'>if</span> (bytes &lt;= 26)</td></tr>
<tr><td class="num" id="LN2277">2277</td><td class="line">			line[0] = bytes + 'A' - 1;</td></tr>
<tr><td class="num" id="LN2278">2278</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN2279">2279</td><td class="line">			line[0] = bytes - 26 + 'a' - 1;</td></tr>
<tr><td class="num" id="LN2280">2280</td><td class="line">		encode_85(line + 1, cp, bytes);</td></tr>
<tr><td class="num" id="LN2281">2281</td><td class="line">		cp = (<span class='keyword'>char</span> *) cp + bytes;</td></tr>
<tr><td class="num" id="LN2282">2282</td><td class="line">		fprintf(file, <span class='string_literal'>"%s"</span>, prefix);</td></tr>
<tr><td class="num" id="LN2283">2283</td><td class="line">		fputs(line, file);</td></tr>
<tr><td class="num" id="LN2284">2284</td><td class="line">		fputc('\n', file);</td></tr>
<tr><td class="num" id="LN2285">2285</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2286">2286</td><td class="line">	fprintf(file, <span class='string_literal'>"%s\n"</span>, prefix);</td></tr>
<tr><td class="num" id="LN2287">2287</td><td class="line">	free(data);</td></tr>
<tr><td class="num" id="LN2288">2288</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2289">2289</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2290">2290</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> emit_binary_diff(FILE *file, mmfile_t *one, mmfile_t *two,</td></tr>
<tr><td class="num" id="LN2291">2291</td><td class="line">			     <span class='keyword'>const</span> <span class='keyword'>char</span> *prefix)</td></tr>
<tr><td class="num" id="LN2292">2292</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2293">2293</td><td class="line">	fprintf(file, <span class='string_literal'>"%sGIT binary patch\n"</span>, prefix);</td></tr>
<tr><td class="num" id="LN2294">2294</td><td class="line">	emit_binary_diff_body(file, one, two, prefix);</td></tr>
<tr><td class="num" id="LN2295">2295</td><td class="line">	emit_binary_diff_body(file, two, one, prefix);</td></tr>
<tr><td class="num" id="LN2296">2296</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2297">2297</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2298">2298</td><td class="line"><span class='keyword'>int</span> diff_filespec_is_binary(<span class='keyword'>struct</span> diff_filespec *one)</td></tr>
<tr><td class="num" id="LN2299">2299</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2300">2300</td><td class="line">	<span class='keyword'>if</span> (one-&gt;is_binary == -1) {</td></tr>
<tr><td class="num" id="LN2301">2301</td><td class="line">		diff_filespec_load_driver(one);</td></tr>
<tr><td class="num" id="LN2302">2302</td><td class="line">		<span class='keyword'>if</span> (one-&gt;driver-&gt;binary != -1)</td></tr>
<tr><td class="num" id="LN2303">2303</td><td class="line">			one-&gt;is_binary = one-&gt;driver-&gt;binary;</td></tr>
<tr><td class="num" id="LN2304">2304</td><td class="line">		<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN2305">2305</td><td class="line">			<span class='keyword'>if</span> (!one-&gt;data &amp;&amp; <span class='macro'>DIFF_FILE_VALID(one)<span class='expansion'>(((one)-&gt;mode) != 0)</span></span>)</td></tr>
<tr><td class="num" id="LN2306">2306</td><td class="line">				diff_populate_filespec(one, <span class='macro'>CHECK_BINARY<span class='expansion'>2</span></span>);</td></tr>
<tr><td class="num" id="LN2307">2307</td><td class="line">			<span class='keyword'>if</span> (one-&gt;is_binary == -1 &amp;&amp; one-&gt;data)</td></tr>
<tr><td class="num" id="LN2308">2308</td><td class="line">				one-&gt;is_binary = buffer_is_binary(one-&gt;data,</td></tr>
<tr><td class="num" id="LN2309">2309</td><td class="line">						one-&gt;size);</td></tr>
<tr><td class="num" id="LN2310">2310</td><td class="line">			<span class='keyword'>if</span> (one-&gt;is_binary == -1)</td></tr>
<tr><td class="num" id="LN2311">2311</td><td class="line">				one-&gt;is_binary = 0;</td></tr>
<tr><td class="num" id="LN2312">2312</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2313">2313</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2314">2314</td><td class="line">	<span class='keyword'>return</span> one-&gt;is_binary;</td></tr>
<tr><td class="num" id="LN2315">2315</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2316">2316</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2317">2317</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>struct</span> userdiff_funcname *diff_funcname_pattern(<span class='keyword'>struct</span> diff_filespec *one)</td></tr>
<tr><td class="num" id="LN2318">2318</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2319">2319</td><td class="line">	diff_filespec_load_driver(one);</td></tr>
<tr><td class="num" id="LN2320">2320</td><td class="line">	<span class='keyword'>return</span> one-&gt;driver-&gt;funcname.pattern ? &amp;one-&gt;driver-&gt;funcname : <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN2321">2321</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2322">2322</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2323">2323</td><td class="line"><span class='keyword'>void</span> diff_set_mnemonic_prefix(<span class='keyword'>struct</span> diff_options *options, <span class='keyword'>const</span> <span class='keyword'>char</span> *a, <span class='keyword'>const</span> <span class='keyword'>char</span> *b)</td></tr>
<tr><td class="num" id="LN2324">2324</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2325">2325</td><td class="line">	<span class='keyword'>if</span> (!options-&gt;a_prefix)</td></tr>
<tr><td class="num" id="LN2326">2326</td><td class="line">		options-&gt;a_prefix = a;</td></tr>
<tr><td class="num" id="LN2327">2327</td><td class="line">	<span class='keyword'>if</span> (!options-&gt;b_prefix)</td></tr>
<tr><td class="num" id="LN2328">2328</td><td class="line">		options-&gt;b_prefix = b;</td></tr>
<tr><td class="num" id="LN2329">2329</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2330">2330</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2331">2331</td><td class="line"><span class='keyword'>struct</span> userdiff_driver *get_textconv(<span class='keyword'>struct</span> diff_filespec *one)</td></tr>
<tr><td class="num" id="LN2332">2332</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2333">2333</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>DIFF_FILE_VALID(one)<span class='expansion'>(((one)-&gt;mode) != 0)</span></span>)</td></tr>
<tr><td class="num" id="LN2334">2334</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN2335">2335</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2336">2336</td><td class="line">	diff_filespec_load_driver(one);</td></tr>
<tr><td class="num" id="LN2337">2337</td><td class="line">	<span class='keyword'>return</span> userdiff_get_textconv(one-&gt;driver);</td></tr>
<tr><td class="num" id="LN2338">2338</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2339">2339</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2340">2340</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> builtin_diff(<span class='keyword'>const</span> <span class='keyword'>char</span> *name_a,</td></tr>
<tr><td class="num" id="LN2341">2341</td><td class="line">			 <span class='keyword'>const</span> <span class='keyword'>char</span> *name_b,</td></tr>
<tr><td class="num" id="LN2342">2342</td><td class="line">			 <span class='keyword'>struct</span> diff_filespec *one,</td></tr>
<tr><td class="num" id="LN2343">2343</td><td class="line">			 <span class='keyword'>struct</span> diff_filespec *two,</td></tr>
<tr><td class="num" id="LN2344">2344</td><td class="line">			 <span class='keyword'>const</span> <span class='keyword'>char</span> *xfrm_msg,</td></tr>
<tr><td class="num" id="LN2345">2345</td><td class="line">			 <span class='keyword'>int</span> must_show_header,</td></tr>
<tr><td class="num" id="LN2346">2346</td><td class="line">			 <span class='keyword'>struct</span> diff_options *o,</td></tr>
<tr><td class="num" id="LN2347">2347</td><td class="line">			 <span class='keyword'>int</span> complete_rewrite)</td></tr>
<tr><td class="num" id="LN2348">2348</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2349">2349</td><td class="line">	mmfile_t mf1, mf2;</td></tr>
<tr><td class="num" id="LN2350">2350</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *lbl[2];</td></tr>
<tr><td class="num" id="LN2351">2351</td><td class="line">	<span class='keyword'>char</span> *a_one, *b_two;</td></tr>
<tr><td class="num" id="LN2352">2352</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *meta = <span class='macro'>diff_get_color_opt(o, DIFF_METAINFO)<span class='expansion'>diff_get_color((o)-&gt;use_color, DIFF_METAINFO)</span></span>;</td></tr>
<tr><td class="num" id="LN2353">2353</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *reset = <span class='macro'>diff_get_color_opt(o, DIFF_RESET)<span class='expansion'>diff_get_color((o)-&gt;use_color, DIFF_RESET)</span></span>;</td></tr>
<tr><td class="num" id="LN2354">2354</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *a_prefix, *b_prefix;</td></tr>
<tr><td class="num" id="LN2355">2355</td><td class="line">	<span class='keyword'>struct</span> userdiff_driver *textconv_one = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN2356">2356</td><td class="line">	<span class='keyword'>struct</span> userdiff_driver *textconv_two = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN2357">2357</td><td class="line">	<span class='keyword'>struct</span> strbuf header = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN2358">2358</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *line_prefix = diff_line_prefix(o);</td></tr>
<tr><td class="num" id="LN2359">2359</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2360">2360</td><td class="line">	diff_set_mnemonic_prefix(o, <span class='string_literal'>"a/"</span>, <span class='string_literal'>"b/"</span>);</td></tr>
<tr><td class="num" id="LN2361">2361</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(o, REVERSE_DIFF)<span class='expansion'>((o)-&gt;flags &amp; (1 &lt;&lt; 15))</span></span>) {</td></tr>
<tr><td class="num" id="LN2362">2362</td><td class="line">		a_prefix = o-&gt;b_prefix;</td></tr>
<tr><td class="num" id="LN2363">2363</td><td class="line">		b_prefix = o-&gt;a_prefix;</td></tr>
<tr><td class="num" id="LN2364">2364</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN2365">2365</td><td class="line">		a_prefix = o-&gt;a_prefix;</td></tr>
<tr><td class="num" id="LN2366">2366</td><td class="line">		b_prefix = o-&gt;b_prefix;</td></tr>
<tr><td class="num" id="LN2367">2367</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2368">2368</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2369">2369</td><td class="line">	<span class='keyword'>if</span> (o-&gt;submodule_format == DIFF_SUBMODULE_LOG &amp;&amp;</td></tr>
<tr><td class="num" id="LN2370">2370</td><td class="line">	    (!one-&gt;mode || <span class='macro'>S_ISGITLINK(one-&gt;mode)<span class='expansion'>(((one-&gt;mode) &amp; 0170000) == 0160000)</span></span>) &amp;&amp;</td></tr>
<tr><td class="num" id="LN2371">2371</td><td class="line">	    (!two-&gt;mode || <span class='macro'>S_ISGITLINK(two-&gt;mode)<span class='expansion'>(((two-&gt;mode) &amp; 0170000) == 0160000)</span></span>)) {</td></tr>
<tr><td class="num" id="LN2372">2372</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *del = <span class='macro'>diff_get_color_opt(o, DIFF_FILE_OLD)<span class='expansion'>diff_get_color((o)-&gt;use_color, DIFF_FILE_OLD)</span></span>;</td></tr>
<tr><td class="num" id="LN2373">2373</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *add = <span class='macro'>diff_get_color_opt(o, DIFF_FILE_NEW)<span class='expansion'>diff_get_color((o)-&gt;use_color, DIFF_FILE_NEW)</span></span>;</td></tr>
<tr><td class="num" id="LN2374">2374</td><td class="line">		show_submodule_summary(o-&gt;file, one-&gt;path ? one-&gt;path : two-&gt;path,</td></tr>
<tr><td class="num" id="LN2375">2375</td><td class="line">				line_prefix,</td></tr>
<tr><td class="num" id="LN2376">2376</td><td class="line">				&amp;one-&gt;oid, &amp;two-&gt;oid,</td></tr>
<tr><td class="num" id="LN2377">2377</td><td class="line">				two-&gt;dirty_submodule,</td></tr>
<tr><td class="num" id="LN2378">2378</td><td class="line">				meta, del, add, reset);</td></tr>
<tr><td class="num" id="LN2379">2379</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN2380">2380</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (o-&gt;submodule_format == DIFF_SUBMODULE_INLINE_DIFF &amp;&amp;</td></tr>
<tr><td class="num" id="LN2381">2381</td><td class="line">		   (!one-&gt;mode || <span class='macro'>S_ISGITLINK(one-&gt;mode)<span class='expansion'>(((one-&gt;mode) &amp; 0170000) == 0160000)</span></span>) &amp;&amp;</td></tr>
<tr><td class="num" id="LN2382">2382</td><td class="line">		   (!two-&gt;mode || <span class='macro'>S_ISGITLINK(two-&gt;mode)<span class='expansion'>(((two-&gt;mode) &amp; 0170000) == 0160000)</span></span>)) {</td></tr>
<tr><td class="num" id="LN2383">2383</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *del = <span class='macro'>diff_get_color_opt(o, DIFF_FILE_OLD)<span class='expansion'>diff_get_color((o)-&gt;use_color, DIFF_FILE_OLD)</span></span>;</td></tr>
<tr><td class="num" id="LN2384">2384</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *add = <span class='macro'>diff_get_color_opt(o, DIFF_FILE_NEW)<span class='expansion'>diff_get_color((o)-&gt;use_color, DIFF_FILE_NEW)</span></span>;</td></tr>
<tr><td class="num" id="LN2385">2385</td><td class="line">		show_submodule_inline_diff(o-&gt;file, one-&gt;path ? one-&gt;path : two-&gt;path,</td></tr>
<tr><td class="num" id="LN2386">2386</td><td class="line">				line_prefix,</td></tr>
<tr><td class="num" id="LN2387">2387</td><td class="line">				&amp;one-&gt;oid, &amp;two-&gt;oid,</td></tr>
<tr><td class="num" id="LN2388">2388</td><td class="line">				two-&gt;dirty_submodule,</td></tr>
<tr><td class="num" id="LN2389">2389</td><td class="line">				meta, del, add, reset, o);</td></tr>
<tr><td class="num" id="LN2390">2390</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN2391">2391</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2392">2392</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2393">2393</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(o, ALLOW_TEXTCONV)<span class='expansion'>((o)-&gt;flags &amp; (1 &lt;&lt; 21))</span></span>) {</td></tr>
<tr><td class="num" id="LN2394">2394</td><td class="line">		textconv_one = get_textconv(one);</td></tr>
<tr><td class="num" id="LN2395">2395</td><td class="line">		textconv_two = get_textconv(two);</td></tr>
<tr><td class="num" id="LN2396">2396</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2397">2397</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2398">2398</td><td class="line">	<span class='comment'>/* Never use a non-valid filename anywhere if at all possible */</span></td></tr>
<tr><td class="num" id="LN2399">2399</td><td class="line">	name_a = <span class='macro'>DIFF_FILE_VALID(one)<span class='expansion'>(((one)-&gt;mode) != 0)</span></span> ? name_a : name_b;</td></tr>
<tr><td class="num" id="LN2400">2400</td><td class="line">	name_b = <span class='macro'>DIFF_FILE_VALID(two)<span class='expansion'>(((two)-&gt;mode) != 0)</span></span> ? name_b : name_a;</td></tr>
<tr><td class="num" id="LN2401">2401</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2402">2402</td><td class="line">	a_one = quote_two(a_prefix, name_a + (*name_a == '/'));</td></tr>
<tr><td class="num" id="LN2403">2403</td><td class="line">	b_two = quote_two(b_prefix, name_b + (*name_b == '/'));</td></tr>
<tr><td class="num" id="LN2404">2404</td><td class="line">	lbl[0] = <span class='macro'>DIFF_FILE_VALID(one)<span class='expansion'>(((one)-&gt;mode) != 0)</span></span> ? a_one : <span class='string_literal'>"/dev/null"</span>;</td></tr>
<tr><td class="num" id="LN2405">2405</td><td class="line">	lbl[1] = <span class='macro'>DIFF_FILE_VALID(two)<span class='expansion'>(((two)-&gt;mode) != 0)</span></span> ? b_two : <span class='string_literal'>"/dev/null"</span>;</td></tr>
<tr><td class="num" id="LN2406">2406</td><td class="line">	strbuf_addf(&amp;header, <span class='string_literal'>"%s%sdiff --git %s %s%s\n"</span>, line_prefix, meta, a_one, b_two, reset);</td></tr>
<tr><td class="num" id="LN2407">2407</td><td class="line">	<span class='keyword'>if</span> (lbl[0][0] == '/') {</td></tr>
<tr><td class="num" id="LN2408">2408</td><td class="line">		<span class='comment'>/* /dev/null */</span></td></tr>
<tr><td class="num" id="LN2409">2409</td><td class="line">		strbuf_addf(&amp;header, <span class='string_literal'>"%s%snew file mode %06o%s\n"</span>, line_prefix, meta, two-&gt;mode, reset);</td></tr>
<tr><td class="num" id="LN2410">2410</td><td class="line">		<span class='keyword'>if</span> (xfrm_msg)</td></tr>
<tr><td class="num" id="LN2411">2411</td><td class="line">			strbuf_addstr(&amp;header, xfrm_msg);</td></tr>
<tr><td class="num" id="LN2412">2412</td><td class="line">		must_show_header = 1;</td></tr>
<tr><td class="num" id="LN2413">2413</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2414">2414</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (lbl[1][0] == '/') {</td></tr>
<tr><td class="num" id="LN2415">2415</td><td class="line">		strbuf_addf(&amp;header, <span class='string_literal'>"%s%sdeleted file mode %06o%s\n"</span>, line_prefix, meta, one-&gt;mode, reset);</td></tr>
<tr><td class="num" id="LN2416">2416</td><td class="line">		<span class='keyword'>if</span> (xfrm_msg)</td></tr>
<tr><td class="num" id="LN2417">2417</td><td class="line">			strbuf_addstr(&amp;header, xfrm_msg);</td></tr>
<tr><td class="num" id="LN2418">2418</td><td class="line">		must_show_header = 1;</td></tr>
<tr><td class="num" id="LN2419">2419</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2420">2420</td><td class="line">	<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN2421">2421</td><td class="line">		<span class='keyword'>if</span> (one-&gt;mode != two-&gt;mode) {</td></tr>
<tr><td class="num" id="LN2422">2422</td><td class="line">			strbuf_addf(&amp;header, <span class='string_literal'>"%s%sold mode %06o%s\n"</span>, line_prefix, meta, one-&gt;mode, reset);</td></tr>
<tr><td class="num" id="LN2423">2423</td><td class="line">			strbuf_addf(&amp;header, <span class='string_literal'>"%s%snew mode %06o%s\n"</span>, line_prefix, meta, two-&gt;mode, reset);</td></tr>
<tr><td class="num" id="LN2424">2424</td><td class="line">			must_show_header = 1;</td></tr>
<tr><td class="num" id="LN2425">2425</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2426">2426</td><td class="line">		<span class='keyword'>if</span> (xfrm_msg)</td></tr>
<tr><td class="num" id="LN2427">2427</td><td class="line">			strbuf_addstr(&amp;header, xfrm_msg);</td></tr>
<tr><td class="num" id="LN2428">2428</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2429">2429</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2430">2430</td><td class="line">		 <span class='comment'>* we do not run diff between different kind</span></td></tr>
<tr><td class="num" id="LN2431">2431</td><td class="line">		 <span class='comment'>* of objects.</span></td></tr>
<tr><td class="num" id="LN2432">2432</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2433">2433</td><td class="line">		<span class='keyword'>if</span> ((one-&gt;mode ^ two-&gt;mode) &amp; <span class='macro'>S_IFMT<span class='expansion'>0170000</span></span>)</td></tr>
<tr><td class="num" id="LN2434">2434</td><td class="line">			<span class='keyword'>goto</span> free_ab_and_return;</td></tr>
<tr><td class="num" id="LN2435">2435</td><td class="line">		<span class='keyword'>if</span> (complete_rewrite &amp;&amp;</td></tr>
<tr><td class="num" id="LN2436">2436</td><td class="line">		    (textconv_one || !diff_filespec_is_binary(one)) &amp;&amp;</td></tr>
<tr><td class="num" id="LN2437">2437</td><td class="line">		    (textconv_two || !diff_filespec_is_binary(two))) {</td></tr>
<tr><td class="num" id="LN2438">2438</td><td class="line">			fprintf(o-&gt;file, <span class='string_literal'>"%s"</span>, header.buf);</td></tr>
<tr><td class="num" id="LN2439">2439</td><td class="line">			<span class='macro'>strbuf_reset(&amp;header)<span class='expansion'>strbuf_setlen(&amp;header, 0)</span></span>;</td></tr>
<tr><td class="num" id="LN2440">2440</td><td class="line">			emit_rewrite_diff(name_a, name_b, one, two,</td></tr>
<tr><td class="num" id="LN2441">2441</td><td class="line">						textconv_one, textconv_two, o);</td></tr>
<tr><td class="num" id="LN2442">2442</td><td class="line">			o-&gt;found_changes = 1;</td></tr>
<tr><td class="num" id="LN2443">2443</td><td class="line">			<span class='keyword'>goto</span> free_ab_and_return;</td></tr>
<tr><td class="num" id="LN2444">2444</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2445">2445</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2446">2446</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2447">2447</td><td class="line">	<span class='keyword'>if</span> (o-&gt;irreversible_delete &amp;&amp; lbl[1][0] == '/') {</td></tr>
<tr><td class="num" id="LN2448">2448</td><td class="line">		fprintf(o-&gt;file, <span class='string_literal'>"%s"</span>, header.buf);</td></tr>
<tr><td class="num" id="LN2449">2449</td><td class="line">		<span class='macro'>strbuf_reset(&amp;header)<span class='expansion'>strbuf_setlen(&amp;header, 0)</span></span>;</td></tr>
<tr><td class="num" id="LN2450">2450</td><td class="line">		<span class='keyword'>goto</span> free_ab_and_return;</td></tr>
<tr><td class="num" id="LN2451">2451</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (!<span class='macro'>DIFF_OPT_TST(o, TEXT)<span class='expansion'>((o)-&gt;flags &amp; (1 &lt;&lt; 3))</span></span> &amp;&amp;</td></tr>
<tr><td class="num" id="LN2452">2452</td><td class="line">	    ( (!textconv_one &amp;&amp; diff_filespec_is_binary(one)) ||</td></tr>
<tr><td class="num" id="LN2453">2453</td><td class="line">	      (!textconv_two &amp;&amp; diff_filespec_is_binary(two)) )) {</td></tr>
<tr><td class="num" id="LN2454">2454</td><td class="line">		<span class='keyword'>if</span> (!one-&gt;data &amp;&amp; !two-&gt;data &amp;&amp;</td></tr>
<tr><td class="num" id="LN2455">2455</td><td class="line">		    <span class='macro'>S_ISREG(one-&gt;mode)<span class='expansion'>(((one-&gt;mode) &amp; 0170000) == 0100000)</span></span> &amp;&amp; <span class='macro'>S_ISREG(two-&gt;mode)<span class='expansion'>(((two-&gt;mode) &amp; 0170000) == 0100000)</span></span> &amp;&amp;</td></tr>
<tr><td class="num" id="LN2456">2456</td><td class="line">		    !<span class='macro'>DIFF_OPT_TST(o, BINARY)<span class='expansion'>((o)-&gt;flags &amp; (1 &lt;&lt; 2))</span></span>) {</td></tr>
<tr><td class="num" id="LN2457">2457</td><td class="line">			<span class='keyword'>if</span> (!oidcmp(&amp;one-&gt;oid, &amp;two-&gt;oid)) {</td></tr>
<tr><td class="num" id="LN2458">2458</td><td class="line">				<span class='keyword'>if</span> (must_show_header)</td></tr>
<tr><td class="num" id="LN2459">2459</td><td class="line">					fprintf(o-&gt;file, <span class='string_literal'>"%s"</span>, header.buf);</td></tr>
<tr><td class="num" id="LN2460">2460</td><td class="line">				<span class='keyword'>goto</span> free_ab_and_return;</td></tr>
<tr><td class="num" id="LN2461">2461</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN2462">2462</td><td class="line">			fprintf(o-&gt;file, <span class='string_literal'>"%s"</span>, header.buf);</td></tr>
<tr><td class="num" id="LN2463">2463</td><td class="line">			fprintf(o-&gt;file, <span class='string_literal'>"%sBinary files %s and %s differ\n"</span>,</td></tr>
<tr><td class="num" id="LN2464">2464</td><td class="line">				line_prefix, lbl[0], lbl[1]);</td></tr>
<tr><td class="num" id="LN2465">2465</td><td class="line">			<span class='keyword'>goto</span> free_ab_and_return;</td></tr>
<tr><td class="num" id="LN2466">2466</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2467">2467</td><td class="line">		<span class='keyword'>if</span> (fill_mmfile(&amp;mf1, one) &lt; 0 || fill_mmfile(&amp;mf2, two) &lt; 0)</td></tr>
<tr><td class="num" id="LN2468">2468</td><td class="line">			die(<span class='string_literal'>"unable to read files to diff"</span>);</td></tr>
<tr><td class="num" id="LN2469">2469</td><td class="line">		<span class='comment'>/* Quite common confusing case */</span></td></tr>
<tr><td class="num" id="LN2470">2470</td><td class="line">		<span class='keyword'>if</span> (mf1.size == mf2.size &amp;&amp;</td></tr>
<tr><td class="num" id="LN2471">2471</td><td class="line">		    !memcmp(mf1.ptr, mf2.ptr, mf1.size)) {</td></tr>
<tr><td class="num" id="LN2472">2472</td><td class="line">			<span class='keyword'>if</span> (must_show_header)</td></tr>
<tr><td class="num" id="LN2473">2473</td><td class="line">				fprintf(o-&gt;file, <span class='string_literal'>"%s"</span>, header.buf);</td></tr>
<tr><td class="num" id="LN2474">2474</td><td class="line">			<span class='keyword'>goto</span> free_ab_and_return;</td></tr>
<tr><td class="num" id="LN2475">2475</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2476">2476</td><td class="line">		fprintf(o-&gt;file, <span class='string_literal'>"%s"</span>, header.buf);</td></tr>
<tr><td class="num" id="LN2477">2477</td><td class="line">		<span class='macro'>strbuf_reset(&amp;header)<span class='expansion'>strbuf_setlen(&amp;header, 0)</span></span>;</td></tr>
<tr><td class="num" id="LN2478">2478</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(o, BINARY)<span class='expansion'>((o)-&gt;flags &amp; (1 &lt;&lt; 2))</span></span>)</td></tr>
<tr><td class="num" id="LN2479">2479</td><td class="line">			emit_binary_diff(o-&gt;file, &amp;mf1, &amp;mf2, line_prefix);</td></tr>
<tr><td class="num" id="LN2480">2480</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN2481">2481</td><td class="line">			fprintf(o-&gt;file, <span class='string_literal'>"%sBinary files %s and %s differ\n"</span>,</td></tr>
<tr><td class="num" id="LN2482">2482</td><td class="line">				line_prefix, lbl[0], lbl[1]);</td></tr>
<tr><td class="num" id="LN2483">2483</td><td class="line">		o-&gt;found_changes = 1;</td></tr>
<tr><td class="num" id="LN2484">2484</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN2485">2485</td><td class="line">		<span class='comment'>/* Crazy xdl interfaces.. */</span></td></tr>
<tr><td class="num" id="LN2486">2486</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *diffopts = getenv(<span class='string_literal'>"GIT_DIFF_OPTS"</span>);</td></tr>
<tr><td class="num" id="LN2487">2487</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *v;</td></tr>
<tr><td class="num" id="LN2488">2488</td><td class="line">		xpparam_t xpp;</td></tr>
<tr><td class="num" id="LN2489">2489</td><td class="line">		xdemitconf_t xecfg;</td></tr>
<tr><td class="num" id="LN2490">2490</td><td class="line">		<span class='keyword'>struct</span> emit_callback ecbdata;</td></tr>
<tr><td class="num" id="LN2491">2491</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>struct</span> userdiff_funcname *pe;</td></tr>
<tr><td class="num" id="LN2492">2492</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2493">2493</td><td class="line">		<span class='keyword'>if</span> (must_show_header) {</td></tr>
<tr><td class="num" id="LN2494">2494</td><td class="line">			fprintf(o-&gt;file, <span class='string_literal'>"%s"</span>, header.buf);</td></tr>
<tr><td class="num" id="LN2495">2495</td><td class="line">			<span class='macro'>strbuf_reset(&amp;header)<span class='expansion'>strbuf_setlen(&amp;header, 0)</span></span>;</td></tr>
<tr><td class="num" id="LN2496">2496</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2497">2497</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2498">2498</td><td class="line">		mf1.size = fill_textconv(textconv_one, one, &amp;mf1.ptr);</td></tr>
<tr><td class="num" id="LN2499">2499</td><td class="line">		mf2.size = fill_textconv(textconv_two, two, &amp;mf2.ptr);</td></tr>
<tr><td class="num" id="LN2500">2500</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2501">2501</td><td class="line">		pe = diff_funcname_pattern(one);</td></tr>
<tr><td class="num" id="LN2502">2502</td><td class="line">		<span class='keyword'>if</span> (!pe)</td></tr>
<tr><td class="num" id="LN2503">2503</td><td class="line">			pe = diff_funcname_pattern(two);</td></tr>
<tr><td class="num" id="LN2504">2504</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2505">2505</td><td class="line">		<span class='macro'>memset(&amp;xpp, 0, <span class='keyword'>sizeof</span>(xpp))<span class='expansion'>__builtin___memset_chk (&amp;xpp, 0, sizeof(xpp), __builtin_object_size<br> (&amp;xpp, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN2506">2506</td><td class="line">		<span class='macro'>memset(&amp;xecfg, 0, <span class='keyword'>sizeof</span>(xecfg))<span class='expansion'>__builtin___memset_chk (&amp;xecfg, 0, sizeof(xecfg), __builtin_object_size<br> (&amp;xecfg, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN2507">2507</td><td class="line">		<span class='macro'>memset(&amp;ecbdata, 0, <span class='keyword'>sizeof</span>(ecbdata))<span class='expansion'>__builtin___memset_chk (&amp;ecbdata, 0, sizeof(ecbdata), __builtin_object_size<br> (&amp;ecbdata, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN2508">2508</td><td class="line">		ecbdata.label_path = lbl;</td></tr>
<tr><td class="num" id="LN2509">2509</td><td class="line">		ecbdata.color_diff = want_color(o-&gt;use_color);</td></tr>
<tr><td class="num" id="LN2510">2510</td><td class="line">		ecbdata.ws_rule = whitespace_rule(name_b);</td></tr>
<tr><td class="num" id="LN2511">2511</td><td class="line">		<span class='keyword'>if</span> (ecbdata.ws_rule &amp; <span class='macro'>WS_BLANK_AT_EOF<span class='expansion'>02000</span></span>)</td></tr>
<tr><td class="num" id="LN2512">2512</td><td class="line">			check_blank_at_eof(&amp;mf1, &amp;mf2, &amp;ecbdata);</td></tr>
<tr><td class="num" id="LN2513">2513</td><td class="line">		ecbdata.opt = o;</td></tr>
<tr><td class="num" id="LN2514">2514</td><td class="line">		ecbdata.header = header.len ? &amp;header : <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN2515">2515</td><td class="line">		xpp.flags = o-&gt;xdl_opts;</td></tr>
<tr><td class="num" id="LN2516">2516</td><td class="line">		xecfg.ctxlen = o-&gt;context;</td></tr>
<tr><td class="num" id="LN2517">2517</td><td class="line">		xecfg.interhunkctxlen = o-&gt;interhunkcontext;</td></tr>
<tr><td class="num" id="LN2518">2518</td><td class="line">		xecfg.flags = <span class='macro'>XDL_EMIT_FUNCNAMES<span class='expansion'>(1 &lt;&lt; 0)</span></span>;</td></tr>
<tr><td class="num" id="LN2519">2519</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(o, FUNCCONTEXT)<span class='expansion'>((o)-&gt;flags &amp; (1 &lt;&lt; 29))</span></span>)</td></tr>
<tr><td class="num" id="LN2520">2520</td><td class="line">			xecfg.flags |= <span class='macro'>XDL_EMIT_FUNCCONTEXT<span class='expansion'>(1 &lt;&lt; 2)</span></span>;</td></tr>
<tr><td class="num" id="LN2521">2521</td><td class="line">		<span class='keyword'>if</span> (pe)</td></tr>
<tr><td class="num" id="LN2522">2522</td><td class="line">			xdiff_set_find_func(&amp;xecfg, pe-&gt;pattern, pe-&gt;cflags);</td></tr>
<tr><td class="num" id="LN2523">2523</td><td class="line">		<span class='keyword'>if</span> (!diffopts)</td></tr>
<tr><td class="num" id="LN2524">2524</td><td class="line">			;</td></tr>
<tr><td class="num" id="LN2525">2525</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(diffopts, <span class='string_literal'>"--unified="</span>, &amp;v))</td></tr>
<tr><td class="num" id="LN2526">2526</td><td class="line">			xecfg.ctxlen = strtoul(v, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 10);</td></tr>
<tr><td class="num" id="LN2527">2527</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(diffopts, <span class='string_literal'>"-u"</span>, &amp;v))</td></tr>
<tr><td class="num" id="LN2528">2528</td><td class="line">			xecfg.ctxlen = strtoul(v, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 10);</td></tr>
<tr><td class="num" id="LN2529">2529</td><td class="line">		<span class='keyword'>if</span> (o-&gt;word_diff)</td></tr>
<tr><td class="num" id="LN2530">2530</td><td class="line">			init_diff_words_data(&amp;ecbdata, o, one, two);</td></tr>
<tr><td class="num" id="LN2531">2531</td><td class="line">		<span class='keyword'>if</span> (xdi_diff_outf(&amp;mf1, &amp;mf2, fn_out_consume, &amp;ecbdata,</td></tr>
<tr><td class="num" id="LN2532">2532</td><td class="line">				  &amp;xpp, &amp;xecfg))</td></tr>
<tr><td class="num" id="LN2533">2533</td><td class="line">			die(<span class='string_literal'>"unable to generate diff for %s"</span>, one-&gt;path);</td></tr>
<tr><td class="num" id="LN2534">2534</td><td class="line">		<span class='keyword'>if</span> (o-&gt;word_diff)</td></tr>
<tr><td class="num" id="LN2535">2535</td><td class="line">			free_diff_words_data(&amp;ecbdata);</td></tr>
<tr><td class="num" id="LN2536">2536</td><td class="line">		<span class='keyword'>if</span> (textconv_one)</td></tr>
<tr><td class="num" id="LN2537">2537</td><td class="line">			free(mf1.ptr);</td></tr>
<tr><td class="num" id="LN2538">2538</td><td class="line">		<span class='keyword'>if</span> (textconv_two)</td></tr>
<tr><td class="num" id="LN2539">2539</td><td class="line">			free(mf2.ptr);</td></tr>
<tr><td class="num" id="LN2540">2540</td><td class="line">		xdiff_clear_find_func(&amp;xecfg);</td></tr>
<tr><td class="num" id="LN2541">2541</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2542">2542</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2543">2543</td><td class="line"> free_ab_and_return:</td></tr>
<tr><td class="num" id="LN2544">2544</td><td class="line">	strbuf_release(&amp;header);</td></tr>
<tr><td class="num" id="LN2545">2545</td><td class="line">	diff_free_filespec_data(one);</td></tr>
<tr><td class="num" id="LN2546">2546</td><td class="line">	diff_free_filespec_data(two);</td></tr>
<tr><td class="num" id="LN2547">2547</td><td class="line">	free(a_one);</td></tr>
<tr><td class="num" id="LN2548">2548</td><td class="line">	free(b_two);</td></tr>
<tr><td class="num" id="LN2549">2549</td><td class="line">	<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN2550">2550</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2551">2551</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2552">2552</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> builtin_diffstat(<span class='keyword'>const</span> <span class='keyword'>char</span> *name_a, <span class='keyword'>const</span> <span class='keyword'>char</span> *name_b,</td></tr>
<tr><td class="num" id="LN2553">2553</td><td class="line">			     <span class='keyword'>struct</span> diff_filespec *one,</td></tr>
<tr><td class="num" id="LN2554">2554</td><td class="line">			     <span class='keyword'>struct</span> diff_filespec *two,</td></tr>
<tr><td class="num" id="LN2555">2555</td><td class="line">			     <span class='keyword'>struct</span> diffstat_t *diffstat,</td></tr>
<tr><td class="num" id="LN2556">2556</td><td class="line">			     <span class='keyword'>struct</span> diff_options *o,</td></tr>
<tr><td class="num" id="LN2557">2557</td><td class="line">			     <span class='keyword'>struct</span> diff_filepair *p)</td></tr>
<tr><td class="num" id="LN2558">2558</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2559">2559</td><td class="line">	mmfile_t mf1, mf2;</td></tr>
<tr><td class="num" id="LN2560">2560</td><td class="line">	<span class='keyword'>struct</span> diffstat_file *data;</td></tr>
<tr><td class="num" id="LN2561">2561</td><td class="line">	<span class='keyword'>int</span> same_contents;</td></tr>
<tr><td class="num" id="LN2562">2562</td><td class="line">	<span class='keyword'>int</span> complete_rewrite = 0;</td></tr>
<tr><td class="num" id="LN2563">2563</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2564">2564</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>DIFF_PAIR_UNMERGED(p)<span class='expansion'>((p)-&gt;is_unmerged)</span></span>) {</td></tr>
<tr><td class="num" id="LN2565">2565</td><td class="line">		<span class='keyword'>if</span> (p-&gt;status == <span class='macro'>DIFF_STATUS_MODIFIED<span class='expansion'>'M'</span></span> &amp;&amp; p-&gt;score)</td></tr>
<tr><td class="num" id="LN2566">2566</td><td class="line">			complete_rewrite = 1;</td></tr>
<tr><td class="num" id="LN2567">2567</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2568">2568</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2569">2569</td><td class="line">	data = diffstat_add(diffstat, name_a, name_b);</td></tr>
<tr><td class="num" id="LN2570">2570</td><td class="line">	data-&gt;is_interesting = p-&gt;status != <span class='macro'>DIFF_STATUS_UNKNOWN<span class='expansion'>'X'</span></span>;</td></tr>
<tr><td class="num" id="LN2571">2571</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2572">2572</td><td class="line">	<span class='keyword'>if</span> (!one || !two) {</td></tr>
<tr><td class="num" id="LN2573">2573</td><td class="line">		data-&gt;is_unmerged = 1;</td></tr>
<tr><td class="num" id="LN2574">2574</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN2575">2575</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2576">2576</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2577">2577</td><td class="line">	same_contents = !oidcmp(&amp;one-&gt;oid, &amp;two-&gt;oid);</td></tr>
<tr><td class="num" id="LN2578">2578</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2579">2579</td><td class="line">	<span class='keyword'>if</span> (diff_filespec_is_binary(one) || diff_filespec_is_binary(two)) {</td></tr>
<tr><td class="num" id="LN2580">2580</td><td class="line">		data-&gt;is_binary = 1;</td></tr>
<tr><td class="num" id="LN2581">2581</td><td class="line">		<span class='keyword'>if</span> (same_contents) {</td></tr>
<tr><td class="num" id="LN2582">2582</td><td class="line">			data-&gt;added = 0;</td></tr>
<tr><td class="num" id="LN2583">2583</td><td class="line">			data-&gt;deleted = 0;</td></tr>
<tr><td class="num" id="LN2584">2584</td><td class="line">		} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN2585">2585</td><td class="line">			data-&gt;added = diff_filespec_size(two);</td></tr>
<tr><td class="num" id="LN2586">2586</td><td class="line">			data-&gt;deleted = diff_filespec_size(one);</td></tr>
<tr><td class="num" id="LN2587">2587</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2588">2588</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2589">2589</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2590">2590</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (complete_rewrite) {</td></tr>
<tr><td class="num" id="LN2591">2591</td><td class="line">		diff_populate_filespec(one, 0);</td></tr>
<tr><td class="num" id="LN2592">2592</td><td class="line">		diff_populate_filespec(two, 0);</td></tr>
<tr><td class="num" id="LN2593">2593</td><td class="line">		data-&gt;deleted = count_lines(one-&gt;data, one-&gt;size);</td></tr>
<tr><td class="num" id="LN2594">2594</td><td class="line">		data-&gt;added = count_lines(two-&gt;data, two-&gt;size);</td></tr>
<tr><td class="num" id="LN2595">2595</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2596">2596</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2597">2597</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!same_contents) {</td></tr>
<tr><td class="num" id="LN2598">2598</td><td class="line">		<span class='comment'>/* Crazy xdl interfaces.. */</span></td></tr>
<tr><td class="num" id="LN2599">2599</td><td class="line">		xpparam_t xpp;</td></tr>
<tr><td class="num" id="LN2600">2600</td><td class="line">		xdemitconf_t xecfg;</td></tr>
<tr><td class="num" id="LN2601">2601</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2602">2602</td><td class="line">		<span class='keyword'>if</span> (fill_mmfile(&amp;mf1, one) &lt; 0 || fill_mmfile(&amp;mf2, two) &lt; 0)</td></tr>
<tr><td class="num" id="LN2603">2603</td><td class="line">			die(<span class='string_literal'>"unable to read files to diff"</span>);</td></tr>
<tr><td class="num" id="LN2604">2604</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2605">2605</td><td class="line">		<span class='macro'>memset(&amp;xpp, 0, <span class='keyword'>sizeof</span>(xpp))<span class='expansion'>__builtin___memset_chk (&amp;xpp, 0, sizeof(xpp), __builtin_object_size<br> (&amp;xpp, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN2606">2606</td><td class="line">		<span class='macro'>memset(&amp;xecfg, 0, <span class='keyword'>sizeof</span>(xecfg))<span class='expansion'>__builtin___memset_chk (&amp;xecfg, 0, sizeof(xecfg), __builtin_object_size<br> (&amp;xecfg, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN2607">2607</td><td class="line">		xpp.flags = o-&gt;xdl_opts;</td></tr>
<tr><td class="num" id="LN2608">2608</td><td class="line">		xecfg.ctxlen = o-&gt;context;</td></tr>
<tr><td class="num" id="LN2609">2609</td><td class="line">		xecfg.interhunkctxlen = o-&gt;interhunkcontext;</td></tr>
<tr><td class="num" id="LN2610">2610</td><td class="line">		<span class='keyword'>if</span> (xdi_diff_outf(&amp;mf1, &amp;mf2, diffstat_consume, diffstat,</td></tr>
<tr><td class="num" id="LN2611">2611</td><td class="line">				  &amp;xpp, &amp;xecfg))</td></tr>
<tr><td class="num" id="LN2612">2612</td><td class="line">			die(<span class='string_literal'>"unable to generate diffstat for %s"</span>, one-&gt;path);</td></tr>
<tr><td class="num" id="LN2613">2613</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2614">2614</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2615">2615</td><td class="line">	diff_free_filespec_data(one);</td></tr>
<tr><td class="num" id="LN2616">2616</td><td class="line">	diff_free_filespec_data(two);</td></tr>
<tr><td class="num" id="LN2617">2617</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2618">2618</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2619">2619</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> builtin_checkdiff(<span class='keyword'>const</span> <span class='keyword'>char</span> *name_a, <span class='keyword'>const</span> <span class='keyword'>char</span> *name_b,</td></tr>
<tr><td class="num" id="LN2620">2620</td><td class="line">			      <span class='keyword'>const</span> <span class='keyword'>char</span> *attr_path,</td></tr>
<tr><td class="num" id="LN2621">2621</td><td class="line">			      <span class='keyword'>struct</span> diff_filespec *one,</td></tr>
<tr><td class="num" id="LN2622">2622</td><td class="line">			      <span class='keyword'>struct</span> diff_filespec *two,</td></tr>
<tr><td class="num" id="LN2623">2623</td><td class="line">			      <span class='keyword'>struct</span> diff_options *o)</td></tr>
<tr><td class="num" id="LN2624">2624</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2625">2625</td><td class="line">	mmfile_t mf1, mf2;</td></tr>
<tr><td class="num" id="LN2626">2626</td><td class="line">	<span class='keyword'>struct</span> checkdiff_t data;</td></tr>
<tr><td class="num" id="LN2627">2627</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2628">2628</td><td class="line">	<span class='keyword'>if</span> (!two)</td></tr>
<tr><td class="num" id="LN2629">2629</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN2630">2630</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2631">2631</td><td class="line">	<span class='macro'>memset(&amp;data, 0, <span class='keyword'>sizeof</span>(data))<span class='expansion'>__builtin___memset_chk (&amp;data, 0, sizeof(data), __builtin_object_size<br> (&amp;data, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN2632">2632</td><td class="line">	data.filename = name_b ? name_b : name_a;</td></tr>
<tr><td class="num" id="LN2633">2633</td><td class="line">	data.lineno = 0;</td></tr>
<tr><td class="num" id="LN2634">2634</td><td class="line">	data.o = o;</td></tr>
<tr><td class="num" id="LN2635">2635</td><td class="line">	data.ws_rule = whitespace_rule(attr_path);</td></tr>
<tr><td class="num" id="LN2636">2636</td><td class="line">	data.conflict_marker_size = ll_merge_marker_size(attr_path);</td></tr>
<tr><td class="num" id="LN2637">2637</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2638">2638</td><td class="line">	<span class='keyword'>if</span> (fill_mmfile(&amp;mf1, one) &lt; 0 || fill_mmfile(&amp;mf2, two) &lt; 0)</td></tr>
<tr><td class="num" id="LN2639">2639</td><td class="line">		die(<span class='string_literal'>"unable to read files to diff"</span>);</td></tr>
<tr><td class="num" id="LN2640">2640</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2641">2641</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2642">2642</td><td class="line">	 <span class='comment'>* All the other codepaths check both sides, but not checking</span></td></tr>
<tr><td class="num" id="LN2643">2643</td><td class="line">	 <span class='comment'>* the "old" side here is deliberate.  We are checking the newly</span></td></tr>
<tr><td class="num" id="LN2644">2644</td><td class="line">	 <span class='comment'>* introduced changes, and as long as the "new" side is text, we</span></td></tr>
<tr><td class="num" id="LN2645">2645</td><td class="line">	 <span class='comment'>* can and should check what it introduces.</span></td></tr>
<tr><td class="num" id="LN2646">2646</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2647">2647</td><td class="line">	<span class='keyword'>if</span> (diff_filespec_is_binary(two))</td></tr>
<tr><td class="num" id="LN2648">2648</td><td class="line">		<span class='keyword'>goto</span> free_and_return;</td></tr>
<tr><td class="num" id="LN2649">2649</td><td class="line">	<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN2650">2650</td><td class="line">		<span class='comment'>/* Crazy xdl interfaces.. */</span></td></tr>
<tr><td class="num" id="LN2651">2651</td><td class="line">		xpparam_t xpp;</td></tr>
<tr><td class="num" id="LN2652">2652</td><td class="line">		xdemitconf_t xecfg;</td></tr>
<tr><td class="num" id="LN2653">2653</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2654">2654</td><td class="line">		<span class='macro'>memset(&amp;xpp, 0, <span class='keyword'>sizeof</span>(xpp))<span class='expansion'>__builtin___memset_chk (&amp;xpp, 0, sizeof(xpp), __builtin_object_size<br> (&amp;xpp, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN2655">2655</td><td class="line">		<span class='macro'>memset(&amp;xecfg, 0, <span class='keyword'>sizeof</span>(xecfg))<span class='expansion'>__builtin___memset_chk (&amp;xecfg, 0, sizeof(xecfg), __builtin_object_size<br> (&amp;xecfg, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN2656">2656</td><td class="line">		xecfg.ctxlen = 1; <span class='comment'>/* at least one context line */</span></td></tr>
<tr><td class="num" id="LN2657">2657</td><td class="line">		xpp.flags = 0;</td></tr>
<tr><td class="num" id="LN2658">2658</td><td class="line">		<span class='keyword'>if</span> (xdi_diff_outf(&amp;mf1, &amp;mf2, checkdiff_consume, &amp;data,</td></tr>
<tr><td class="num" id="LN2659">2659</td><td class="line">				  &amp;xpp, &amp;xecfg))</td></tr>
<tr><td class="num" id="LN2660">2660</td><td class="line">			die(<span class='string_literal'>"unable to generate checkdiff for %s"</span>, one-&gt;path);</td></tr>
<tr><td class="num" id="LN2661">2661</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2662">2662</td><td class="line">		<span class='keyword'>if</span> (data.ws_rule &amp; <span class='macro'>WS_BLANK_AT_EOF<span class='expansion'>02000</span></span>) {</td></tr>
<tr><td class="num" id="LN2663">2663</td><td class="line">			<span class='keyword'>struct</span> emit_callback ecbdata;</td></tr>
<tr><td class="num" id="LN2664">2664</td><td class="line">			<span class='keyword'>int</span> blank_at_eof;</td></tr>
<tr><td class="num" id="LN2665">2665</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2666">2666</td><td class="line">			ecbdata.ws_rule = data.ws_rule;</td></tr>
<tr><td class="num" id="LN2667">2667</td><td class="line">			check_blank_at_eof(&amp;mf1, &amp;mf2, &amp;ecbdata);</td></tr>
<tr><td class="num" id="LN2668">2668</td><td class="line">			blank_at_eof = ecbdata.blank_at_eof_in_postimage;</td></tr>
<tr><td class="num" id="LN2669">2669</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2670">2670</td><td class="line">			<span class='keyword'>if</span> (blank_at_eof) {</td></tr>
<tr><td class="num" id="LN2671">2671</td><td class="line">				<span class='keyword'>static</span> <span class='keyword'>char</span> *err;</td></tr>
<tr><td class="num" id="LN2672">2672</td><td class="line">				<span class='keyword'>if</span> (!err)</td></tr>
<tr><td class="num" id="LN2673">2673</td><td class="line">					err = whitespace_error_string(<span class='macro'>WS_BLANK_AT_EOF<span class='expansion'>02000</span></span>);</td></tr>
<tr><td class="num" id="LN2674">2674</td><td class="line">				fprintf(o-&gt;file, <span class='string_literal'>"%s:%d: %s.\n"</span>,</td></tr>
<tr><td class="num" id="LN2675">2675</td><td class="line">					data.filename, blank_at_eof, err);</td></tr>
<tr><td class="num" id="LN2676">2676</td><td class="line">				data.status = 1; <span class='comment'>/* report errors */</span></td></tr>
<tr><td class="num" id="LN2677">2677</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN2678">2678</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2679">2679</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2680">2680</td><td class="line"> free_and_return:</td></tr>
<tr><td class="num" id="LN2681">2681</td><td class="line">	diff_free_filespec_data(one);</td></tr>
<tr><td class="num" id="LN2682">2682</td><td class="line">	diff_free_filespec_data(two);</td></tr>
<tr><td class="num" id="LN2683">2683</td><td class="line">	<span class='keyword'>if</span> (data.status)</td></tr>
<tr><td class="num" id="LN2684">2684</td><td class="line">		<span class='macro'>DIFF_OPT_SET(o, CHECK_FAILED)<span class='expansion'>(((o)-&gt;flags |= (1 &lt;&lt; 16)),((o)-&gt;touched_flags |=<br> (1 &lt;&lt; 16)))</span></span>;</td></tr>
<tr><td class="num" id="LN2685">2685</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2686">2686</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2687">2687</td><td class="line"><span class='keyword'>struct</span> diff_filespec *alloc_filespec(<span class='keyword'>const</span> <span class='keyword'>char</span> *path)</td></tr>
<tr><td class="num" id="LN2688">2688</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2689">2689</td><td class="line">	<span class='keyword'>struct</span> diff_filespec *spec;</td></tr>
<tr><td class="num" id="LN2690">2690</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2691">2691</td><td class="line">	<span class='macro'>FLEXPTR_ALLOC_STR(spec, path, path)<span class='expansion'>do { size_t flex_array_len_ = (strlen(path)); ((spec)) = xcalloc<br>(1, st_add(st_add((sizeof(*((spec)))),(flex_array_len_)),(1))<br>); __builtin___memcpy_chk (((spec)) + 1, ((path)), flex_array_len_<br>, __builtin_object_size (((spec)) + 1, 0)); ((spec))-&gt;path<br> = (void *)(((spec))+1); } while(0)</span></span>;</td></tr>
<tr><td class="num" id="LN2692">2692</td><td class="line">	spec-&gt;count = 1;</td></tr>
<tr><td class="num" id="LN2693">2693</td><td class="line">	spec-&gt;is_binary = -1;</td></tr>
<tr><td class="num" id="LN2694">2694</td><td class="line">	<span class='keyword'>return</span> spec;</td></tr>
<tr><td class="num" id="LN2695">2695</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2696">2696</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2697">2697</td><td class="line"><span class='keyword'>void</span> free_filespec(<span class='keyword'>struct</span> diff_filespec *spec)</td></tr>
<tr><td class="num" id="LN2698">2698</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2699">2699</td><td class="line">	<span class='keyword'>if</span> (!--spec-&gt;count) {</td></tr>
<tr><td class="num" id="LN2700">2700</td><td class="line">		diff_free_filespec_data(spec);</td></tr>
<tr><td class="num" id="LN2701">2701</td><td class="line">		free(spec);</td></tr>
<tr><td class="num" id="LN2702">2702</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2703">2703</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2704">2704</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2705">2705</td><td class="line"><span class='keyword'>void</span> fill_filespec(<span class='keyword'>struct</span> diff_filespec *spec, <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *sha1,</td></tr>
<tr><td class="num" id="LN2706">2706</td><td class="line">		   <span class='keyword'>int</span> sha1_valid, <span class='keyword'>unsigned</span> <span class='keyword'>short</span> mode)</td></tr>
<tr><td class="num" id="LN2707">2707</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2708">2708</td><td class="line">	<span class='keyword'>if</span> (mode) {</td></tr>
<tr><td class="num" id="LN2709">2709</td><td class="line">		spec-&gt;mode = canon_mode(mode);</td></tr>
<tr><td class="num" id="LN2710">2710</td><td class="line">		hashcpy(spec-&gt;oid.hash, sha1);</td></tr>
<tr><td class="num" id="LN2711">2711</td><td class="line">		spec-&gt;oid_valid = sha1_valid;</td></tr>
<tr><td class="num" id="LN2712">2712</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2713">2713</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2714">2714</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2715">2715</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2716">2716</td><td class="line"> <span class='comment'>* Given a name and sha1 pair, if the index tells us the file in</span></td></tr>
<tr><td class="num" id="LN2717">2717</td><td class="line"> <span class='comment'>* the work tree has that object contents, return true, so that</span></td></tr>
<tr><td class="num" id="LN2718">2718</td><td class="line"> <span class='comment'>* prepare_temp_file() does not have to inflate and extract.</span></td></tr>
<tr><td class="num" id="LN2719">2719</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2720">2720</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> reuse_worktree_file(<span class='keyword'>const</span> <span class='keyword'>char</span> *name, <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *sha1, <span class='keyword'>int</span> want_file)</td></tr>
<tr><td class="num" id="LN2721">2721</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2722">2722</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>struct</span> cache_entry *ce;</td></tr>
<tr><td class="num" id="LN2723">2723</td><td class="line">	<span class='keyword'>struct</span> stat st;</td></tr>
<tr><td class="num" id="LN2724">2724</td><td class="line">	<span class='keyword'>int</span> pos, len;</td></tr>
<tr><td class="num" id="LN2725">2725</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2726">2726</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2727">2727</td><td class="line">	 <span class='comment'>* We do not read the cache ourselves here, because the</span></td></tr>
<tr><td class="num" id="LN2728">2728</td><td class="line">	 <span class='comment'>* benchmark with my previous version that always reads cache</span></td></tr>
<tr><td class="num" id="LN2729">2729</td><td class="line">	 <span class='comment'>* shows that it makes things worse for diff-tree comparing</span></td></tr>
<tr><td class="num" id="LN2730">2730</td><td class="line">	 <span class='comment'>* two linux-2.6 kernel trees in an already checked out work</span></td></tr>
<tr><td class="num" id="LN2731">2731</td><td class="line">	 <span class='comment'>* tree.  This is because most diff-tree comparisons deal with</span></td></tr>
<tr><td class="num" id="LN2732">2732</td><td class="line">	 <span class='comment'>* only a small number of files, while reading the cache is</span></td></tr>
<tr><td class="num" id="LN2733">2733</td><td class="line">	 <span class='comment'>* expensive for a large project, and its cost outweighs the</span></td></tr>
<tr><td class="num" id="LN2734">2734</td><td class="line">	 <span class='comment'>* savings we get by not inflating the object to a temporary</span></td></tr>
<tr><td class="num" id="LN2735">2735</td><td class="line">	 <span class='comment'>* file.  Practically, this code only helps when we are used</span></td></tr>
<tr><td class="num" id="LN2736">2736</td><td class="line">	 <span class='comment'>* by diff-cache --cached, which does read the cache before</span></td></tr>
<tr><td class="num" id="LN2737">2737</td><td class="line">	 <span class='comment'>* calling us.</span></td></tr>
<tr><td class="num" id="LN2738">2738</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2739">2739</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>active_cache<span class='expansion'>(the_index.cache)</span></span>)</td></tr>
<tr><td class="num" id="LN2740">2740</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2741">2741</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2742">2742</td><td class="line">	<span class='comment'>/* We want to avoid the working directory if our caller</span></td></tr>
<tr><td class="num" id="LN2743">2743</td><td class="line">	 <span class='comment'>* doesn't need the data in a normal file, this system</span></td></tr>
<tr><td class="num" id="LN2744">2744</td><td class="line">	 <span class='comment'>* is rather slow with its stat/open/mmap/close syscalls,</span></td></tr>
<tr><td class="num" id="LN2745">2745</td><td class="line">	 <span class='comment'>* and the object is contained in a pack file.  The pack</span></td></tr>
<tr><td class="num" id="LN2746">2746</td><td class="line">	 <span class='comment'>* is probably already open and will be faster to obtain</span></td></tr>
<tr><td class="num" id="LN2747">2747</td><td class="line">	 <span class='comment'>* the data through than the working directory.  Loose</span></td></tr>
<tr><td class="num" id="LN2748">2748</td><td class="line">	 <span class='comment'>* objects however would tend to be slower as they need</span></td></tr>
<tr><td class="num" id="LN2749">2749</td><td class="line">	 <span class='comment'>* to be individually opened and inflated.</span></td></tr>
<tr><td class="num" id="LN2750">2750</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2751">2751</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>FAST_WORKING_DIRECTORY<span class='expansion'>1</span></span> &amp;&amp; !want_file &amp;&amp; has_sha1_pack(sha1))</td></tr>
<tr><td class="num" id="LN2752">2752</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2753">2753</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2754">2754</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2755">2755</td><td class="line">	 <span class='comment'>* Similarly, if we'd have to convert the file contents anyway, that</span></td></tr>
<tr><td class="num" id="LN2756">2756</td><td class="line">	 <span class='comment'>* makes the optimization not worthwhile.</span></td></tr>
<tr><td class="num" id="LN2757">2757</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2758">2758</td><td class="line">	<span class='keyword'>if</span> (!want_file &amp;&amp; would_convert_to_git(name))</td></tr>
<tr><td class="num" id="LN2759">2759</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2760">2760</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2761">2761</td><td class="line">	len = strlen(name);</td></tr>
<tr><td class="num" id="LN2762">2762</td><td class="line">	pos = <span class='macro'>cache_name_pos(name, len)<span class='expansion'>index_name_pos(&amp;the_index,(name),(len))</span></span>;</td></tr>
<tr><td class="num" id="LN2763">2763</td><td class="line">	<span class='keyword'>if</span> (pos &lt; 0)</td></tr>
<tr><td class="num" id="LN2764">2764</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2765">2765</td><td class="line">	ce = <span class='macro'>active_cache<span class='expansion'>(the_index.cache)</span></span>[pos];</td></tr>
<tr><td class="num" id="LN2766">2766</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2767">2767</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2768">2768</td><td class="line">	 <span class='comment'>* This is not the sha1 we are looking for, or</span></td></tr>
<tr><td class="num" id="LN2769">2769</td><td class="line">	 <span class='comment'>* unreusable because it is not a regular file.</span></td></tr>
<tr><td class="num" id="LN2770">2770</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2771">2771</td><td class="line">	<span class='keyword'>if</span> (hashcmp(sha1, ce-&gt;oid.hash) || !<span class='macro'>S_ISREG(ce-&gt;ce_mode)<span class='expansion'>(((ce-&gt;ce_mode) &amp; 0170000) == 0100000)</span></span>)</td></tr>
<tr><td class="num" id="LN2772">2772</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2773">2773</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2774">2774</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2775">2775</td><td class="line">	 <span class='comment'>* If ce is marked as "assume unchanged", there is no</span></td></tr>
<tr><td class="num" id="LN2776">2776</td><td class="line">	 <span class='comment'>* guarantee that work tree matches what we are looking for.</span></td></tr>
<tr><td class="num" id="LN2777">2777</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2778">2778</td><td class="line">	<span class='keyword'>if</span> ((ce-&gt;ce_flags &amp; <span class='macro'>CE_VALID<span class='expansion'>(0x8000)</span></span>) || <span class='macro'>ce_skip_worktree(ce)<span class='expansion'>((ce)-&gt;ce_flags &amp; (1 &lt;&lt; 30))</span></span>)</td></tr>
<tr><td class="num" id="LN2779">2779</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2780">2780</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2781">2781</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2782">2782</td><td class="line">	 <span class='comment'>* If ce matches the file in the work tree, we can reuse it.</span></td></tr>
<tr><td class="num" id="LN2783">2783</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2784">2784</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>ce_uptodate(ce)<span class='expansion'>((ce)-&gt;ce_flags &amp; (1 &lt;&lt; 18))</span></span> ||</td></tr>
<tr><td class="num" id="LN2785">2785</td><td class="line">	    (!lstat(name, &amp;st) &amp;&amp; !<span class='macro'>ce_match_stat(ce, &amp;st, 0)<span class='expansion'>ie_match_stat(&amp;the_index, (ce), (&amp;st), (0))</span></span>))</td></tr>
<tr><td class="num" id="LN2786">2786</td><td class="line">		<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN2787">2787</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2788">2788</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2789">2789</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2790">2790</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2791">2791</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_populate_gitlink(<span class='keyword'>struct</span> diff_filespec *s, <span class='keyword'>int</span> size_only)</td></tr>
<tr><td class="num" id="LN2792">2792</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2793">2793</td><td class="line">	<span class='keyword'>struct</span> strbuf buf = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN2794">2794</td><td class="line">	<span class='keyword'>char</span> *dirty = <span class='string_literal'>""</span>;</td></tr>
<tr><td class="num" id="LN2795">2795</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2796">2796</td><td class="line">	<span class='comment'>/* Are we looking at the work tree? */</span></td></tr>
<tr><td class="num" id="LN2797">2797</td><td class="line">	<span class='keyword'>if</span> (s-&gt;dirty_submodule)</td></tr>
<tr><td class="num" id="LN2798">2798</td><td class="line">		dirty = <span class='string_literal'>"-dirty"</span>;</td></tr>
<tr><td class="num" id="LN2799">2799</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2800">2800</td><td class="line">	strbuf_addf(&amp;buf, <span class='string_literal'>"Subproject commit %s%s\n"</span>,</td></tr>
<tr><td class="num" id="LN2801">2801</td><td class="line">		    oid_to_hex(&amp;s-&gt;oid), dirty);</td></tr>
<tr><td class="num" id="LN2802">2802</td><td class="line">	s-&gt;size = buf.len;</td></tr>
<tr><td class="num" id="LN2803">2803</td><td class="line">	<span class='keyword'>if</span> (size_only) {</td></tr>
<tr><td class="num" id="LN2804">2804</td><td class="line">		s-&gt;data = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN2805">2805</td><td class="line">		strbuf_release(&amp;buf);</td></tr>
<tr><td class="num" id="LN2806">2806</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN2807">2807</td><td class="line">		s-&gt;data = strbuf_detach(&amp;buf, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>);</td></tr>
<tr><td class="num" id="LN2808">2808</td><td class="line">		s-&gt;should_free = 1;</td></tr>
<tr><td class="num" id="LN2809">2809</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2810">2810</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2811">2811</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2812">2812</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2813">2813</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2814">2814</td><td class="line"> <span class='comment'>* While doing rename detection and pickaxe operation, we may need to</span></td></tr>
<tr><td class="num" id="LN2815">2815</td><td class="line"> <span class='comment'>* grab the data for the blob (or file) for our own in-core comparison.</span></td></tr>
<tr><td class="num" id="LN2816">2816</td><td class="line"> <span class='comment'>* diff_filespec has data and size fields for this purpose.</span></td></tr>
<tr><td class="num" id="LN2817">2817</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2818">2818</td><td class="line"><span class='keyword'>int</span> diff_populate_filespec(<span class='keyword'>struct</span> diff_filespec *s, <span class='keyword'>unsigned</span> <span class='keyword'>int</span> flags)</td></tr>
<tr><td class="num" id="LN2819">2819</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2820">2820</td><td class="line">	<span class='keyword'>int</span> size_only = flags &amp; <span class='macro'>CHECK_SIZE_ONLY<span class='expansion'>1</span></span>;</td></tr>
<tr><td class="num" id="LN2821">2821</td><td class="line">	<span class='keyword'>int</span> err = 0;</td></tr>
<tr><td class="num" id="LN2822">2822</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2823">2823</td><td class="line">	 <span class='comment'>* demote FAIL to WARN to allow inspecting the situation</span></td></tr>
<tr><td class="num" id="LN2824">2824</td><td class="line">	 <span class='comment'>* instead of refusing.</span></td></tr>
<tr><td class="num" id="LN2825">2825</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2826">2826</td><td class="line">	<span class='keyword'>enum</span> safe_crlf crlf_warn = (safe_crlf == SAFE_CRLF_FAIL</td></tr>
<tr><td class="num" id="LN2827">2827</td><td class="line">				    ? SAFE_CRLF_WARN</td></tr>
<tr><td class="num" id="LN2828">2828</td><td class="line">				    : safe_crlf);</td></tr>
<tr><td class="num" id="LN2829">2829</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2830">2830</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>DIFF_FILE_VALID(s)<span class='expansion'>(((s)-&gt;mode) != 0)</span></span>)</td></tr>
<tr><td class="num" id="LN2831">2831</td><td class="line">		die(<span class='string_literal'>"internal error: asking to populate invalid file."</span>);</td></tr>
<tr><td class="num" id="LN2832">2832</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>S_ISDIR(s-&gt;mode)<span class='expansion'>(((s-&gt;mode) &amp; 0170000) == 0040000)</span></span>)</td></tr>
<tr><td class="num" id="LN2833">2833</td><td class="line">		<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN2834">2834</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2835">2835</td><td class="line">	<span class='keyword'>if</span> (s-&gt;data)</td></tr>
<tr><td class="num" id="LN2836">2836</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2837">2837</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2838">2838</td><td class="line">	<span class='keyword'>if</span> (size_only &amp;&amp; 0 &lt; s-&gt;size)</td></tr>
<tr><td class="num" id="LN2839">2839</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2840">2840</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2841">2841</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>S_ISGITLINK(s-&gt;mode)<span class='expansion'>(((s-&gt;mode) &amp; 0170000) == 0160000)</span></span>)</td></tr>
<tr><td class="num" id="LN2842">2842</td><td class="line">		<span class='keyword'>return</span> diff_populate_gitlink(s, size_only);</td></tr>
<tr><td class="num" id="LN2843">2843</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2844">2844</td><td class="line">	<span class='keyword'>if</span> (!s-&gt;oid_valid ||</td></tr>
<tr><td class="num" id="LN2845">2845</td><td class="line">	    reuse_worktree_file(s-&gt;path, s-&gt;oid.hash, 0)) {</td></tr>
<tr><td class="num" id="LN2846">2846</td><td class="line">		<span class='keyword'>struct</span> strbuf buf = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN2847">2847</td><td class="line">		<span class='keyword'>struct</span> stat st;</td></tr>
<tr><td class="num" id="LN2848">2848</td><td class="line">		<span class='keyword'>int</span> fd;</td></tr>
<tr><td class="num" id="LN2849">2849</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2850">2850</td><td class="line">		<span class='keyword'>if</span> (lstat(s-&gt;path, &amp;st) &lt; 0) {</td></tr>
<tr><td class="num" id="LN2851">2851</td><td class="line">			<span class='keyword'>if</span> (<span class='macro'>errno<span class='expansion'>(*__error())</span></span> == <span class='macro'>ENOENT<span class='expansion'>2</span></span>) {</td></tr>
<tr><td class="num" id="LN2852">2852</td><td class="line">			err_empty:</td></tr>
<tr><td class="num" id="LN2853">2853</td><td class="line">				err = -1;</td></tr>
<tr><td class="num" id="LN2854">2854</td><td class="line">			empty:</td></tr>
<tr><td class="num" id="LN2855">2855</td><td class="line">				s-&gt;data = (<span class='keyword'>char</span> *)<span class='string_literal'>""</span>;</td></tr>
<tr><td class="num" id="LN2856">2856</td><td class="line">				s-&gt;size = 0;</td></tr>
<tr><td class="num" id="LN2857">2857</td><td class="line">				<span class='keyword'>return</span> err;</td></tr>
<tr><td class="num" id="LN2858">2858</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN2859">2859</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2860">2860</td><td class="line">		s-&gt;size = xsize_t(st.st_size);</td></tr>
<tr><td class="num" id="LN2861">2861</td><td class="line">		<span class='keyword'>if</span> (!s-&gt;size)</td></tr>
<tr><td class="num" id="LN2862">2862</td><td class="line">			<span class='keyword'>goto</span> empty;</td></tr>
<tr><td class="num" id="LN2863">2863</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>S_ISLNK(st.st_mode)<span class='expansion'>(((st.st_mode) &amp; 0170000) == 0120000)</span></span>) {</td></tr>
<tr><td class="num" id="LN2864">2864</td><td class="line">			<span class='keyword'>struct</span> strbuf sb = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN2865">2865</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2866">2866</td><td class="line">			<span class='keyword'>if</span> (strbuf_readlink(&amp;sb, s-&gt;path, s-&gt;size))</td></tr>
<tr><td class="num" id="LN2867">2867</td><td class="line">				<span class='keyword'>goto</span> err_empty;</td></tr>
<tr><td class="num" id="LN2868">2868</td><td class="line">			s-&gt;size = sb.len;</td></tr>
<tr><td class="num" id="LN2869">2869</td><td class="line">			s-&gt;data = strbuf_detach(&amp;sb, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>);</td></tr>
<tr><td class="num" id="LN2870">2870</td><td class="line">			s-&gt;should_free = 1;</td></tr>
<tr><td class="num" id="LN2871">2871</td><td class="line">			<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2872">2872</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2873">2873</td><td class="line">		<span class='keyword'>if</span> (size_only)</td></tr>
<tr><td class="num" id="LN2874">2874</td><td class="line">			<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2875">2875</td><td class="line">		<span class='keyword'>if</span> ((flags &amp; <span class='macro'>CHECK_BINARY<span class='expansion'>2</span></span>) &amp;&amp;</td></tr>
<tr><td class="num" id="LN2876">2876</td><td class="line">		    s-&gt;size &gt; big_file_threshold &amp;&amp; s-&gt;is_binary == -1) {</td></tr>
<tr><td class="num" id="LN2877">2877</td><td class="line">			s-&gt;is_binary = 1;</td></tr>
<tr><td class="num" id="LN2878">2878</td><td class="line">			<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2879">2879</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2880">2880</td><td class="line">		fd = open(s-&gt;path, <span class='macro'>O_RDONLY<span class='expansion'>0x0000</span></span>);</td></tr>
<tr><td class="num" id="LN2881">2881</td><td class="line">		<span class='keyword'>if</span> (fd &lt; 0)</td></tr>
<tr><td class="num" id="LN2882">2882</td><td class="line">			<span class='keyword'>goto</span> err_empty;</td></tr>
<tr><td class="num" id="LN2883">2883</td><td class="line">		s-&gt;data = xmmap(<span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, s-&gt;size, <span class='macro'>PROT_READ<span class='expansion'>0x01</span></span>, <span class='macro'>MAP_PRIVATE<span class='expansion'>0x0002</span></span>, fd, 0);</td></tr>
<tr><td class="num" id="LN2884">2884</td><td class="line">		close(fd);</td></tr>
<tr><td class="num" id="LN2885">2885</td><td class="line">		s-&gt;should_munmap = 1;</td></tr>
<tr><td class="num" id="LN2886">2886</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2887">2887</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN2888">2888</td><td class="line">		 <span class='comment'>* Convert from working tree format to canonical git format</span></td></tr>
<tr><td class="num" id="LN2889">2889</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2890">2890</td><td class="line">		<span class='keyword'>if</span> (convert_to_git(s-&gt;path, s-&gt;data, s-&gt;size, &amp;buf, crlf_warn)) {</td></tr>
<tr><td class="num" id="LN2891">2891</td><td class="line">			size_t size = 0;</td></tr>
<tr><td class="num" id="LN2892">2892</td><td class="line">			munmap(s-&gt;data, s-&gt;size);</td></tr>
<tr><td class="num" id="LN2893">2893</td><td class="line">			s-&gt;should_munmap = 0;</td></tr>
<tr><td class="num" id="LN2894">2894</td><td class="line">			s-&gt;data = strbuf_detach(&amp;buf, &amp;size);</td></tr>
<tr><td class="num" id="LN2895">2895</td><td class="line">			s-&gt;size = size;</td></tr>
<tr><td class="num" id="LN2896">2896</td><td class="line">			s-&gt;should_free = 1;</td></tr>
<tr><td class="num" id="LN2897">2897</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2898">2898</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2899">2899</td><td class="line">	<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN2900">2900</td><td class="line">		<span class='keyword'>enum</span> object_type type;</td></tr>
<tr><td class="num" id="LN2901">2901</td><td class="line">		<span class='keyword'>if</span> (size_only || (flags &amp; <span class='macro'>CHECK_BINARY<span class='expansion'>2</span></span>)) {</td></tr>
<tr><td class="num" id="LN2902">2902</td><td class="line">			type = sha1_object_info(s-&gt;oid.hash, &amp;s-&gt;size);</td></tr>
<tr><td class="num" id="LN2903">2903</td><td class="line">			<span class='keyword'>if</span> (type &lt; 0)</td></tr>
<tr><td class="num" id="LN2904">2904</td><td class="line">				die(<span class='string_literal'>"unable to read %s"</span>,</td></tr>
<tr><td class="num" id="LN2905">2905</td><td class="line">				    oid_to_hex(&amp;s-&gt;oid));</td></tr>
<tr><td class="num" id="LN2906">2906</td><td class="line">			<span class='keyword'>if</span> (size_only)</td></tr>
<tr><td class="num" id="LN2907">2907</td><td class="line">				<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2908">2908</td><td class="line">			<span class='keyword'>if</span> (s-&gt;size &gt; big_file_threshold &amp;&amp; s-&gt;is_binary == -1) {</td></tr>
<tr><td class="num" id="LN2909">2909</td><td class="line">				s-&gt;is_binary = 1;</td></tr>
<tr><td class="num" id="LN2910">2910</td><td class="line">				<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2911">2911</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN2912">2912</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN2913">2913</td><td class="line">		s-&gt;data = read_sha1_file(s-&gt;oid.hash, &amp;type, &amp;s-&gt;size);</td></tr>
<tr><td class="num" id="LN2914">2914</td><td class="line">		<span class='keyword'>if</span> (!s-&gt;data)</td></tr>
<tr><td class="num" id="LN2915">2915</td><td class="line">			die(<span class='string_literal'>"unable to read %s"</span>, oid_to_hex(&amp;s-&gt;oid));</td></tr>
<tr><td class="num" id="LN2916">2916</td><td class="line">		s-&gt;should_free = 1;</td></tr>
<tr><td class="num" id="LN2917">2917</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2918">2918</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN2919">2919</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2920">2920</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2921">2921</td><td class="line"><span class='keyword'>void</span> diff_free_filespec_blob(<span class='keyword'>struct</span> diff_filespec *s)</td></tr>
<tr><td class="num" id="LN2922">2922</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2923">2923</td><td class="line">	<span class='keyword'>if</span> (s-&gt;should_free)</td></tr>
<tr><td class="num" id="LN2924">2924</td><td class="line">		free(s-&gt;data);</td></tr>
<tr><td class="num" id="LN2925">2925</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (s-&gt;should_munmap)</td></tr>
<tr><td class="num" id="LN2926">2926</td><td class="line">		munmap(s-&gt;data, s-&gt;size);</td></tr>
<tr><td class="num" id="LN2927">2927</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2928">2928</td><td class="line">	<span class='keyword'>if</span> (s-&gt;should_free || s-&gt;should_munmap) {</td></tr>
<tr><td class="num" id="LN2929">2929</td><td class="line">		s-&gt;should_free = s-&gt;should_munmap = 0;</td></tr>
<tr><td class="num" id="LN2930">2930</td><td class="line">		s-&gt;data = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN2931">2931</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2932">2932</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2933">2933</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2934">2934</td><td class="line"><span class='keyword'>void</span> diff_free_filespec_data(<span class='keyword'>struct</span> diff_filespec *s)</td></tr>
<tr><td class="num" id="LN2935">2935</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2936">2936</td><td class="line">	diff_free_filespec_blob(s);</td></tr>
<tr><td class="num" id="LN2937">2937</td><td class="line">	free(s-&gt;cnt_data);</td></tr>
<tr><td class="num" id="LN2938">2938</td><td class="line">	s-&gt;cnt_data = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN2939">2939</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2940">2940</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2941">2941</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> prep_temp_blob(<span class='keyword'>const</span> <span class='keyword'>char</span> *path, <span class='keyword'>struct</span> diff_tempfile *temp,</td></tr>
<tr><td class="num" id="LN2942">2942</td><td class="line">			   <span class='keyword'>void</span> *blob,</td></tr>
<tr><td class="num" id="LN2943">2943</td><td class="line">			   <span class='keyword'>unsigned</span> <span class='keyword'>long</span> size,</td></tr>
<tr><td class="num" id="LN2944">2944</td><td class="line">			   <span class='keyword'>const</span> <span class='keyword'>struct</span> object_id *oid,</td></tr>
<tr><td class="num" id="LN2945">2945</td><td class="line">			   <span class='keyword'>int</span> mode)</td></tr>
<tr><td class="num" id="LN2946">2946</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2947">2947</td><td class="line">	<span class='keyword'>int</span> fd;</td></tr>
<tr><td class="num" id="LN2948">2948</td><td class="line">	<span class='keyword'>struct</span> strbuf buf = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN2949">2949</td><td class="line">	<span class='keyword'>struct</span> strbuf template = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN2950">2950</td><td class="line">	<span class='keyword'>char</span> *path_dup = xstrdup(path);</td></tr>
<tr><td class="num" id="LN2951">2951</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *base = basename(path_dup);</td></tr>
<tr><td class="num" id="LN2952">2952</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2953">2953</td><td class="line">	<span class='comment'>/* Generate "XXXXXX_basename.ext" */</span></td></tr>
<tr><td class="num" id="LN2954">2954</td><td class="line">	strbuf_addstr(&amp;template, <span class='string_literal'>"XXXXXX_"</span>);</td></tr>
<tr><td class="num" id="LN2955">2955</td><td class="line">	strbuf_addstr(&amp;template, base);</td></tr>
<tr><td class="num" id="LN2956">2956</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2957">2957</td><td class="line">	fd = mks_tempfile_ts(&amp;temp-&gt;tempfile, template.buf, strlen(base) + 1);</td></tr>
<tr><td class="num" id="LN2958">2958</td><td class="line">	<span class='keyword'>if</span> (fd &lt; 0)</td></tr>
<tr><td class="num" id="LN2959">2959</td><td class="line">		die_errno(<span class='string_literal'>"unable to create temp-file"</span>);</td></tr>
<tr><td class="num" id="LN2960">2960</td><td class="line">	<span class='keyword'>if</span> (convert_to_working_tree(path,</td></tr>
<tr><td class="num" id="LN2961">2961</td><td class="line">			(<span class='keyword'>const</span> <span class='keyword'>char</span> *)blob, (size_t)size, &amp;buf)) {</td></tr>
<tr><td class="num" id="LN2962">2962</td><td class="line">		blob = buf.buf;</td></tr>
<tr><td class="num" id="LN2963">2963</td><td class="line">		size = buf.len;</td></tr>
<tr><td class="num" id="LN2964">2964</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2965">2965</td><td class="line">	<span class='keyword'>if</span> (write_in_full(fd, blob, size) != size)</td></tr>
<tr><td class="num" id="LN2966">2966</td><td class="line">		die_errno(<span class='string_literal'>"unable to write temp-file"</span>);</td></tr>
<tr><td class="num" id="LN2967">2967</td><td class="line">	close_tempfile(&amp;temp-&gt;tempfile);</td></tr>
<tr><td class="num" id="LN2968">2968</td><td class="line">	temp-&gt;name = get_tempfile_path(&amp;temp-&gt;tempfile);</td></tr>
<tr><td class="num" id="LN2969">2969</td><td class="line">	oid_to_hex_r(temp-&gt;hex, oid);</td></tr>
<tr><td class="num" id="LN2970">2970</td><td class="line">	xsnprintf(temp-&gt;mode, <span class='keyword'>sizeof</span>(temp-&gt;mode), <span class='string_literal'>"%06o"</span>, mode);</td></tr>
<tr><td class="num" id="LN2971">2971</td><td class="line">	strbuf_release(&amp;buf);</td></tr>
<tr><td class="num" id="LN2972">2972</td><td class="line">	strbuf_release(&amp;template);</td></tr>
<tr><td class="num" id="LN2973">2973</td><td class="line">	free(path_dup);</td></tr>
<tr><td class="num" id="LN2974">2974</td><td class="line">}</td></tr>
<tr><td class="num" id="LN2975">2975</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2976">2976</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>struct</span> diff_tempfile *prepare_temp_file(<span class='keyword'>const</span> <span class='keyword'>char</span> *name,</td></tr>
<tr><td class="num" id="LN2977">2977</td><td class="line">		<span class='keyword'>struct</span> diff_filespec *one)</td></tr>
<tr><td class="num" id="LN2978">2978</td><td class="line">{</td></tr>
<tr><td class="num" id="LN2979">2979</td><td class="line">	<span class='keyword'>struct</span> diff_tempfile *temp = claim_diff_tempfile();</td></tr>
<tr><td class="num" id="LN2980">2980</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2981">2981</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>DIFF_FILE_VALID(one)<span class='expansion'>(((one)-&gt;mode) != 0)</span></span>) {</td></tr>
<tr><td class="num" id="LN2982">2982</td><td class="line">	not_a_valid_file:</td></tr>
<tr><td class="num" id="LN2983">2983</td><td class="line">		<span class='comment'>/* A '-' entry produces this for file-2, and</span></td></tr>
<tr><td class="num" id="LN2984">2984</td><td class="line">		 <span class='comment'>* a '+' entry produces this for file-1.</span></td></tr>
<tr><td class="num" id="LN2985">2985</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN2986">2986</td><td class="line">		temp-&gt;name = <span class='string_literal'>"/dev/null"</span>;</td></tr>
<tr><td class="num" id="LN2987">2987</td><td class="line">		xsnprintf(temp-&gt;hex, <span class='keyword'>sizeof</span>(temp-&gt;hex), <span class='string_literal'>"."</span>);</td></tr>
<tr><td class="num" id="LN2988">2988</td><td class="line">		xsnprintf(temp-&gt;mode, <span class='keyword'>sizeof</span>(temp-&gt;mode), <span class='string_literal'>"."</span>);</td></tr>
<tr><td class="num" id="LN2989">2989</td><td class="line">		<span class='keyword'>return</span> temp;</td></tr>
<tr><td class="num" id="LN2990">2990</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN2991">2991</td><td class="line"> </td></tr>
<tr><td class="num" id="LN2992">2992</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>S_ISGITLINK(one-&gt;mode)<span class='expansion'>(((one-&gt;mode) &amp; 0170000) == 0160000)</span></span> &amp;&amp;</td></tr>
<tr><td class="num" id="LN2993">2993</td><td class="line">	    (!one-&gt;oid_valid ||</td></tr>
<tr><td class="num" id="LN2994">2994</td><td class="line">	     reuse_worktree_file(name, one-&gt;oid.hash, 1))) {</td></tr>
<tr><td class="num" id="LN2995">2995</td><td class="line">		<span class='keyword'>struct</span> stat st;</td></tr>
<tr><td class="num" id="LN2996">2996</td><td class="line">		<span class='keyword'>if</span> (lstat(name, &amp;st) &lt; 0) {</td></tr>
<tr><td class="num" id="LN2997">2997</td><td class="line">			<span class='keyword'>if</span> (<span class='macro'>errno<span class='expansion'>(*__error())</span></span> == <span class='macro'>ENOENT<span class='expansion'>2</span></span>)</td></tr>
<tr><td class="num" id="LN2998">2998</td><td class="line">				<span class='keyword'>goto</span> not_a_valid_file;</td></tr>
<tr><td class="num" id="LN2999">2999</td><td class="line">			die_errno(<span class='string_literal'>"stat(%s)"</span>, name);</td></tr>
<tr><td class="num" id="LN3000">3000</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN3001">3001</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>S_ISLNK(st.st_mode)<span class='expansion'>(((st.st_mode) &amp; 0170000) == 0120000)</span></span>) {</td></tr>
<tr><td class="num" id="LN3002">3002</td><td class="line">			<span class='keyword'>struct</span> strbuf sb = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN3003">3003</td><td class="line">			<span class='keyword'>if</span> (strbuf_readlink(&amp;sb, name, st.st_size) &lt; 0)</td></tr>
<tr><td class="num" id="LN3004">3004</td><td class="line">				die_errno(<span class='string_literal'>"readlink(%s)"</span>, name);</td></tr>
<tr><td class="num" id="LN3005">3005</td><td class="line">			prep_temp_blob(name, temp, sb.buf, sb.len,</td></tr>
<tr><td class="num" id="LN3006">3006</td><td class="line">				       (one-&gt;oid_valid ?</td></tr>
<tr><td class="num" id="LN3007">3007</td><td class="line">					&amp;one-&gt;oid : &amp;null_oid),</td></tr>
<tr><td class="num" id="LN3008">3008</td><td class="line">				       (one-&gt;oid_valid ?</td></tr>
<tr><td class="num" id="LN3009">3009</td><td class="line">					one-&gt;mode : <span class='macro'>S_IFLNK<span class='expansion'>0120000</span></span>));</td></tr>
<tr><td class="num" id="LN3010">3010</td><td class="line">			strbuf_release(&amp;sb);</td></tr>
<tr><td class="num" id="LN3011">3011</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN3012">3012</td><td class="line">		<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN3013">3013</td><td class="line">			<span class='comment'>/* we can borrow from the file in the work tree */</span></td></tr>
<tr><td class="num" id="LN3014">3014</td><td class="line">			temp-&gt;name = name;</td></tr>
<tr><td class="num" id="LN3015">3015</td><td class="line">			<span class='keyword'>if</span> (!one-&gt;oid_valid)</td></tr>
<tr><td class="num" id="LN3016">3016</td><td class="line">				sha1_to_hex_r(temp-&gt;hex, null_sha1);</td></tr>
<tr><td class="num" id="LN3017">3017</td><td class="line">			<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN3018">3018</td><td class="line">				oid_to_hex_r(temp-&gt;hex, &amp;one-&gt;oid);</td></tr>
<tr><td class="num" id="LN3019">3019</td><td class="line">			<span class='comment'>/* Even though we may sometimes borrow the</span></td></tr>
<tr><td class="num" id="LN3020">3020</td><td class="line">			 <span class='comment'>* contents from the work tree, we always want</span></td></tr>
<tr><td class="num" id="LN3021">3021</td><td class="line">			 <span class='comment'>* one-&gt;mode.  mode is trustworthy even when</span></td></tr>
<tr><td class="num" id="LN3022">3022</td><td class="line">			 <span class='comment'>* !(one-&gt;sha1_valid), as long as</span></td></tr>
<tr><td class="num" id="LN3023">3023</td><td class="line">			 <span class='comment'>* DIFF_FILE_VALID(one).</span></td></tr>
<tr><td class="num" id="LN3024">3024</td><td class="line">			 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN3025">3025</td><td class="line">			xsnprintf(temp-&gt;mode, <span class='keyword'>sizeof</span>(temp-&gt;mode), <span class='string_literal'>"%06o"</span>, one-&gt;mode);</td></tr>
<tr><td class="num" id="LN3026">3026</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN3027">3027</td><td class="line">		<span class='keyword'>return</span> temp;</td></tr>
<tr><td class="num" id="LN3028">3028</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3029">3029</td><td class="line">	<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN3030">3030</td><td class="line">		<span class='keyword'>if</span> (diff_populate_filespec(one, 0))</td></tr>
<tr><td class="num" id="LN3031">3031</td><td class="line">			die(<span class='string_literal'>"cannot read data blob for %s"</span>, one-&gt;path);</td></tr>
<tr><td class="num" id="LN3032">3032</td><td class="line">		prep_temp_blob(name, temp, one-&gt;data, one-&gt;size,</td></tr>
<tr><td class="num" id="LN3033">3033</td><td class="line">			       &amp;one-&gt;oid, one-&gt;mode);</td></tr>
<tr><td class="num" id="LN3034">3034</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3035">3035</td><td class="line">	<span class='keyword'>return</span> temp;</td></tr>
<tr><td class="num" id="LN3036">3036</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3037">3037</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3038">3038</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> add_external_diff_name(<span class='keyword'>struct</span> argv_array *argv,</td></tr>
<tr><td class="num" id="LN3039">3039</td><td class="line">				   <span class='keyword'>const</span> <span class='keyword'>char</span> *name,</td></tr>
<tr><td class="num" id="LN3040">3040</td><td class="line">				   <span class='keyword'>struct</span> diff_filespec *df)</td></tr>
<tr><td class="num" id="LN3041">3041</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3042">3042</td><td class="line">	<span class='keyword'>struct</span> diff_tempfile *temp = prepare_temp_file(name, df);</td></tr>
<tr><td class="num" id="LN3043">3043</td><td class="line">	argv_array_push(argv, temp-&gt;name);</td></tr>
<tr><td class="num" id="LN3044">3044</td><td class="line">	argv_array_push(argv, temp-&gt;hex);</td></tr>
<tr><td class="num" id="LN3045">3045</td><td class="line">	argv_array_push(argv, temp-&gt;mode);</td></tr>
<tr><td class="num" id="LN3046">3046</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3047">3047</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3048">3048</td><td class="line"><span class='comment'>/* An external diff command takes:</span></td></tr>
<tr><td class="num" id="LN3049">3049</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN3050">3050</td><td class="line"> <span class='comment'>* diff-cmd name infile1 infile1-sha1 infile1-mode \</span></td></tr>
<tr><td class="num" id="LN3051">3051</td><td class="line"> <span class='comment'>*               infile2 infile2-sha1 infile2-mode [ rename-to ]</span></td></tr>
<tr><td class="num" id="LN3052">3052</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN3053">3053</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN3054">3054</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> run_external_diff(<span class='keyword'>const</span> <span class='keyword'>char</span> *pgm,</td></tr>
<tr><td class="num" id="LN3055">3055</td><td class="line">			      <span class='keyword'>const</span> <span class='keyword'>char</span> *name,</td></tr>
<tr><td class="num" id="LN3056">3056</td><td class="line">			      <span class='keyword'>const</span> <span class='keyword'>char</span> *other,</td></tr>
<tr><td class="num" id="LN3057">3057</td><td class="line">			      <span class='keyword'>struct</span> diff_filespec *one,</td></tr>
<tr><td class="num" id="LN3058">3058</td><td class="line">			      <span class='keyword'>struct</span> diff_filespec *two,</td></tr>
<tr><td class="num" id="LN3059">3059</td><td class="line">			      <span class='keyword'>const</span> <span class='keyword'>char</span> *xfrm_msg,</td></tr>
<tr><td class="num" id="LN3060">3060</td><td class="line">			      <span class='keyword'>int</span> complete_rewrite,</td></tr>
<tr><td class="num" id="LN3061">3061</td><td class="line">			      <span class='keyword'>struct</span> diff_options *o)</td></tr>
<tr><td class="num" id="LN3062">3062</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3063">3063</td><td class="line">	<span class='keyword'>struct</span> argv_array argv = <span class='macro'>ARGV_ARRAY_INIT<span class='expansion'>{ empty_argv, 0, 0 }</span></span>;</td></tr>
<tr><td class="num" id="LN3064">3064</td><td class="line">	<span class='keyword'>struct</span> argv_array env = <span class='macro'>ARGV_ARRAY_INIT<span class='expansion'>{ empty_argv, 0, 0 }</span></span>;</td></tr>
<tr><td class="num" id="LN3065">3065</td><td class="line">	<span class='keyword'>struct</span> diff_queue_struct *q = &amp;diff_queued_diff;</td></tr>
<tr><td class="num" id="LN3066">3066</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3067">3067</td><td class="line">	argv_array_push(&amp;argv, pgm);</td></tr>
<tr><td class="num" id="LN3068">3068</td><td class="line">	argv_array_push(&amp;argv, name);</td></tr>
<tr><td class="num" id="LN3069">3069</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3070">3070</td><td class="line">	<span class='keyword'>if</span> (one &amp;&amp; two) {</td></tr>
<tr><td class="num" id="LN3071">3071</td><td class="line">		add_external_diff_name(&amp;argv, name, one);</td></tr>
<tr><td class="num" id="LN3072">3072</td><td class="line">		<span class='keyword'>if</span> (!other)</td></tr>
<tr><td class="num" id="LN3073">3073</td><td class="line">			add_external_diff_name(&amp;argv, name, two);</td></tr>
<tr><td class="num" id="LN3074">3074</td><td class="line">		<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN3075">3075</td><td class="line">			add_external_diff_name(&amp;argv, other, two);</td></tr>
<tr><td class="num" id="LN3076">3076</td><td class="line">			argv_array_push(&amp;argv, other);</td></tr>
<tr><td class="num" id="LN3077">3077</td><td class="line">			argv_array_push(&amp;argv, xfrm_msg);</td></tr>
<tr><td class="num" id="LN3078">3078</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN3079">3079</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3080">3080</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3081">3081</td><td class="line">	argv_array_pushf(&amp;env, <span class='string_literal'>"GIT_DIFF_PATH_COUNTER=%d"</span>, ++o-&gt;diff_path_counter);</td></tr>
<tr><td class="num" id="LN3082">3082</td><td class="line">	argv_array_pushf(&amp;env, <span class='string_literal'>"GIT_DIFF_PATH_TOTAL=%d"</span>, q-&gt;nr);</td></tr>
<tr><td class="num" id="LN3083">3083</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3084">3084</td><td class="line">	<span class='keyword'>if</span> (run_command_v_opt_cd_env(argv.argv, <span class='macro'>RUN_USING_SHELL<span class='expansion'>16</span></span>, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, env.argv))</td></tr>
<tr><td class="num" id="LN3085">3085</td><td class="line">		die(_(<span class='string_literal'>"external diff died, stopping at %s"</span>), name);</td></tr>
<tr><td class="num" id="LN3086">3086</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3087">3087</td><td class="line">	remove_tempfile();</td></tr>
<tr><td class="num" id="LN3088">3088</td><td class="line">	argv_array_clear(&amp;argv);</td></tr>
<tr><td class="num" id="LN3089">3089</td><td class="line">	argv_array_clear(&amp;env);</td></tr>
<tr><td class="num" id="LN3090">3090</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3091">3091</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3092">3092</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> similarity_index(<span class='keyword'>struct</span> diff_filepair *p)</td></tr>
<tr><td class="num" id="LN3093">3093</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3094">3094</td><td class="line">	<span class='keyword'>return</span> p-&gt;score * 100 / <span class='macro'>MAX_SCORE<span class='expansion'>60000.0</span></span>;</td></tr>
<tr><td class="num" id="LN3095">3095</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3096">3096</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3097">3097</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> *diff_abbrev_oid(<span class='keyword'>const</span> <span class='keyword'>struct</span> object_id *oid, <span class='keyword'>int</span> abbrev)</td></tr>
<tr><td class="num" id="LN3098">3098</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3099">3099</td><td class="line">	<span class='keyword'>if</span> (startup_info-&gt;have_repository)</td></tr>
<tr><td class="num" id="LN3100">3100</td><td class="line">		<span class='keyword'>return</span> find_unique_abbrev(oid-&gt;hash, abbrev);</td></tr>
<tr><td class="num" id="LN3101">3101</td><td class="line">	<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN3102">3102</td><td class="line">		<span class='keyword'>char</span> *hex = oid_to_hex(oid);</td></tr>
<tr><td class="num" id="LN3103">3103</td><td class="line">		<span class='keyword'>if</span> (abbrev &lt; 0)</td></tr>
<tr><td class="num" id="LN3104">3104</td><td class="line">			abbrev = <span class='macro'>FALLBACK_DEFAULT_ABBREV<span class='expansion'>7</span></span>;</td></tr>
<tr><td class="num" id="LN3105">3105</td><td class="line">		<span class='keyword'>if</span> (abbrev &gt; <span class='macro'>GIT_SHA1_HEXSZ<span class='expansion'>(2 * 20)</span></span>)</td></tr>
<tr><td class="num" id="LN3106">3106</td><td class="line">			die(<span class='string_literal'>"BUG: oid abbreviation out of range: %d"</span>, abbrev);</td></tr>
<tr><td class="num" id="LN3107">3107</td><td class="line">		<span class='keyword'>if</span> (abbrev)</td></tr>
<tr><td class="num" id="LN3108">3108</td><td class="line">			hex[abbrev] = '\0';</td></tr>
<tr><td class="num" id="LN3109">3109</td><td class="line">		<span class='keyword'>return</span> hex;</td></tr>
<tr><td class="num" id="LN3110">3110</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3111">3111</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3112">3112</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3113">3113</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> fill_metainfo(<span class='keyword'>struct</span> strbuf *msg,</td></tr>
<tr><td class="num" id="LN3114">3114</td><td class="line">			  <span class='keyword'>const</span> <span class='keyword'>char</span> *name,</td></tr>
<tr><td class="num" id="LN3115">3115</td><td class="line">			  <span class='keyword'>const</span> <span class='keyword'>char</span> *other,</td></tr>
<tr><td class="num" id="LN3116">3116</td><td class="line">			  <span class='keyword'>struct</span> diff_filespec *one,</td></tr>
<tr><td class="num" id="LN3117">3117</td><td class="line">			  <span class='keyword'>struct</span> diff_filespec *two,</td></tr>
<tr><td class="num" id="LN3118">3118</td><td class="line">			  <span class='keyword'>struct</span> diff_options *o,</td></tr>
<tr><td class="num" id="LN3119">3119</td><td class="line">			  <span class='keyword'>struct</span> diff_filepair *p,</td></tr>
<tr><td class="num" id="LN3120">3120</td><td class="line">			  <span class='keyword'>int</span> *must_show_header,</td></tr>
<tr><td class="num" id="LN3121">3121</td><td class="line">			  <span class='keyword'>int</span> use_color)</td></tr>
<tr><td class="num" id="LN3122">3122</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3123">3123</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *set = diff_get_color(use_color, DIFF_METAINFO);</td></tr>
<tr><td class="num" id="LN3124">3124</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *reset = diff_get_color(use_color, DIFF_RESET);</td></tr>
<tr><td class="num" id="LN3125">3125</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *line_prefix = diff_line_prefix(o);</td></tr>
<tr><td class="num" id="LN3126">3126</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3127">3127</td><td class="line">	*must_show_header = 1;</td></tr>
<tr><td class="num" id="LN3128">3128</td><td class="line">	strbuf_init(msg, <span class='macro'>PATH_MAX<span class='expansion'>1024</span></span> * 2 + 300);</td></tr>
<tr><td class="num" id="LN3129">3129</td><td class="line">	<span class='keyword'>switch</span> (p-&gt;status) {</td></tr>
<tr><td class="num" id="LN3130">3130</td><td class="line">	<span class='keyword'>case</span> <span class='macro'>DIFF_STATUS_COPIED<span class='expansion'>'C'</span></span>:</td></tr>
<tr><td class="num" id="LN3131">3131</td><td class="line">		strbuf_addf(msg, <span class='string_literal'>"%s%ssimilarity index %d%%"</span>,</td></tr>
<tr><td class="num" id="LN3132">3132</td><td class="line">			    line_prefix, set, similarity_index(p));</td></tr>
<tr><td class="num" id="LN3133">3133</td><td class="line">		strbuf_addf(msg, <span class='string_literal'>"%s\n%s%scopy from "</span>,</td></tr>
<tr><td class="num" id="LN3134">3134</td><td class="line">			    reset,  line_prefix, set);</td></tr>
<tr><td class="num" id="LN3135">3135</td><td class="line">		quote_c_style(name, msg, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 0);</td></tr>
<tr><td class="num" id="LN3136">3136</td><td class="line">		strbuf_addf(msg, <span class='string_literal'>"%s\n%s%scopy to "</span>, reset, line_prefix, set);</td></tr>
<tr><td class="num" id="LN3137">3137</td><td class="line">		quote_c_style(other, msg, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 0);</td></tr>
<tr><td class="num" id="LN3138">3138</td><td class="line">		strbuf_addf(msg, <span class='string_literal'>"%s\n"</span>, reset);</td></tr>
<tr><td class="num" id="LN3139">3139</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN3140">3140</td><td class="line">	<span class='keyword'>case</span> <span class='macro'>DIFF_STATUS_RENAMED<span class='expansion'>'R'</span></span>:</td></tr>
<tr><td class="num" id="LN3141">3141</td><td class="line">		strbuf_addf(msg, <span class='string_literal'>"%s%ssimilarity index %d%%"</span>,</td></tr>
<tr><td class="num" id="LN3142">3142</td><td class="line">			    line_prefix, set, similarity_index(p));</td></tr>
<tr><td class="num" id="LN3143">3143</td><td class="line">		strbuf_addf(msg, <span class='string_literal'>"%s\n%s%srename from "</span>,</td></tr>
<tr><td class="num" id="LN3144">3144</td><td class="line">			    reset, line_prefix, set);</td></tr>
<tr><td class="num" id="LN3145">3145</td><td class="line">		quote_c_style(name, msg, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 0);</td></tr>
<tr><td class="num" id="LN3146">3146</td><td class="line">		strbuf_addf(msg, <span class='string_literal'>"%s\n%s%srename to "</span>,</td></tr>
<tr><td class="num" id="LN3147">3147</td><td class="line">			    reset, line_prefix, set);</td></tr>
<tr><td class="num" id="LN3148">3148</td><td class="line">		quote_c_style(other, msg, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 0);</td></tr>
<tr><td class="num" id="LN3149">3149</td><td class="line">		strbuf_addf(msg, <span class='string_literal'>"%s\n"</span>, reset);</td></tr>
<tr><td class="num" id="LN3150">3150</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN3151">3151</td><td class="line">	<span class='keyword'>case</span> <span class='macro'>DIFF_STATUS_MODIFIED<span class='expansion'>'M'</span></span>:</td></tr>
<tr><td class="num" id="LN3152">3152</td><td class="line">		<span class='keyword'>if</span> (p-&gt;score) {</td></tr>
<tr><td class="num" id="LN3153">3153</td><td class="line">			strbuf_addf(msg, <span class='string_literal'>"%s%sdissimilarity index %d%%%s\n"</span>,</td></tr>
<tr><td class="num" id="LN3154">3154</td><td class="line">				    line_prefix,</td></tr>
<tr><td class="num" id="LN3155">3155</td><td class="line">				    set, similarity_index(p), reset);</td></tr>
<tr><td class="num" id="LN3156">3156</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN3157">3157</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN3158">3158</td><td class="line">		<span class='comment'>/* fallthru */</span></td></tr>
<tr><td class="num" id="LN3159">3159</td><td class="line">	<span class='keyword'>default</span>:</td></tr>
<tr><td class="num" id="LN3160">3160</td><td class="line">		*must_show_header = 0;</td></tr>
<tr><td class="num" id="LN3161">3161</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3162">3162</td><td class="line">	<span class='keyword'>if</span> (one &amp;&amp; two &amp;&amp; oidcmp(&amp;one-&gt;oid, &amp;two-&gt;oid)) {</td></tr>
<tr><td class="num" id="LN3163">3163</td><td class="line">		<span class='keyword'>int</span> abbrev = <span class='macro'>DIFF_OPT_TST(o, FULL_INDEX)<span class='expansion'>((o)-&gt;flags &amp; (1 &lt;&lt; 4))</span></span> ? 40 : <span class='macro'>DEFAULT_ABBREV<span class='expansion'>default_abbrev</span></span>;</td></tr>
<tr><td class="num" id="LN3164">3164</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3165">3165</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(o, BINARY)<span class='expansion'>((o)-&gt;flags &amp; (1 &lt;&lt; 2))</span></span>) {</td></tr>
<tr><td class="num" id="LN3166">3166</td><td class="line">			mmfile_t mf;</td></tr>
<tr><td class="num" id="LN3167">3167</td><td class="line">			<span class='keyword'>if</span> ((!fill_mmfile(&amp;mf, one) &amp;&amp; diff_filespec_is_binary(one)) ||</td></tr>
<tr><td class="num" id="LN3168">3168</td><td class="line">			    (!fill_mmfile(&amp;mf, two) &amp;&amp; diff_filespec_is_binary(two)))</td></tr>
<tr><td class="num" id="LN3169">3169</td><td class="line">				abbrev = 40;</td></tr>
<tr><td class="num" id="LN3170">3170</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN3171">3171</td><td class="line">		strbuf_addf(msg, <span class='string_literal'>"%s%sindex %s..%s"</span>, line_prefix, set,</td></tr>
<tr><td class="num" id="LN3172">3172</td><td class="line">			    diff_abbrev_oid(&amp;one-&gt;oid, abbrev),</td></tr>
<tr><td class="num" id="LN3173">3173</td><td class="line">			    diff_abbrev_oid(&amp;two-&gt;oid, abbrev));</td></tr>
<tr><td class="num" id="LN3174">3174</td><td class="line">		<span class='keyword'>if</span> (one-&gt;mode == two-&gt;mode)</td></tr>
<tr><td class="num" id="LN3175">3175</td><td class="line">			strbuf_addf(msg, <span class='string_literal'>" %06o"</span>, one-&gt;mode);</td></tr>
<tr><td class="num" id="LN3176">3176</td><td class="line">		strbuf_addf(msg, <span class='string_literal'>"%s\n"</span>, reset);</td></tr>
<tr><td class="num" id="LN3177">3177</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3178">3178</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3179">3179</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3180">3180</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> run_diff_cmd(<span class='keyword'>const</span> <span class='keyword'>char</span> *pgm,</td></tr>
<tr><td class="num" id="LN3181">3181</td><td class="line">			 <span class='keyword'>const</span> <span class='keyword'>char</span> *name,</td></tr>
<tr><td class="num" id="LN3182">3182</td><td class="line">			 <span class='keyword'>const</span> <span class='keyword'>char</span> *other,</td></tr>
<tr><td class="num" id="LN3183">3183</td><td class="line">			 <span class='keyword'>const</span> <span class='keyword'>char</span> *attr_path,</td></tr>
<tr><td class="num" id="LN3184">3184</td><td class="line">			 <span class='keyword'>struct</span> diff_filespec *one,</td></tr>
<tr><td class="num" id="LN3185">3185</td><td class="line">			 <span class='keyword'>struct</span> diff_filespec *two,</td></tr>
<tr><td class="num" id="LN3186">3186</td><td class="line">			 <span class='keyword'>struct</span> strbuf *msg,</td></tr>
<tr><td class="num" id="LN3187">3187</td><td class="line">			 <span class='keyword'>struct</span> diff_options *o,</td></tr>
<tr><td class="num" id="LN3188">3188</td><td class="line">			 <span class='keyword'>struct</span> diff_filepair *p)</td></tr>
<tr><td class="num" id="LN3189">3189</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3190">3190</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *xfrm_msg = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN3191">3191</td><td class="line">	<span class='keyword'>int</span> complete_rewrite = (p-&gt;status == <span class='macro'>DIFF_STATUS_MODIFIED<span class='expansion'>'M'</span></span>) &amp;&amp; p-&gt;score;</td></tr>
<tr><td class="num" id="LN3192">3192</td><td class="line">	<span class='keyword'>int</span> must_show_header = 0;</td></tr>
<tr><td class="num" id="LN3193">3193</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3194">3194</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3195">3195</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(o, ALLOW_EXTERNAL)<span class='expansion'>((o)-&gt;flags &amp; (1 &lt;&lt; 13))</span></span>) {</td></tr>
<tr><td class="num" id="LN3196">3196</td><td class="line">		<span class='keyword'>struct</span> userdiff_driver *drv = userdiff_find_by_path(attr_path);</td></tr>
<tr><td class="num" id="LN3197">3197</td><td class="line">		<span class='keyword'>if</span> (drv &amp;&amp; drv-&gt;external)</td></tr>
<tr><td class="num" id="LN3198">3198</td><td class="line">			pgm = drv-&gt;external;</td></tr>
<tr><td class="num" id="LN3199">3199</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3200">3200</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3201">3201</td><td class="line">	<span class='keyword'>if</span> (msg) {</td></tr>
<tr><td class="num" id="LN3202">3202</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN3203">3203</td><td class="line">		 <span class='comment'>* don't use colors when the header is intended for an</span></td></tr>
<tr><td class="num" id="LN3204">3204</td><td class="line">		 <span class='comment'>* external diff driver</span></td></tr>
<tr><td class="num" id="LN3205">3205</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN3206">3206</td><td class="line">		fill_metainfo(msg, name, other, one, two, o, p,</td></tr>
<tr><td class="num" id="LN3207">3207</td><td class="line">			      &amp;must_show_header,</td></tr>
<tr><td class="num" id="LN3208">3208</td><td class="line">			      want_color(o-&gt;use_color) &amp;&amp; !pgm);</td></tr>
<tr><td class="num" id="LN3209">3209</td><td class="line">		xfrm_msg = msg-&gt;len ? msg-&gt;buf : <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN3210">3210</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3211">3211</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3212">3212</td><td class="line">	<span class='keyword'>if</span> (pgm) {</td></tr>
<tr><td class="num" id="LN3213">3213</td><td class="line">		run_external_diff(pgm, name, other, one, two, xfrm_msg,</td></tr>
<tr><td class="num" id="LN3214">3214</td><td class="line">				  complete_rewrite, o);</td></tr>
<tr><td class="num" id="LN3215">3215</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN3216">3216</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3217">3217</td><td class="line">	<span class='keyword'>if</span> (one &amp;&amp; two)</td></tr>
<tr><td class="num" id="LN3218">3218</td><td class="line">		builtin_diff(name, other ? other : name,</td></tr>
<tr><td class="num" id="LN3219">3219</td><td class="line">			     one, two, xfrm_msg, must_show_header,</td></tr>
<tr><td class="num" id="LN3220">3220</td><td class="line">			     o, complete_rewrite);</td></tr>
<tr><td class="num" id="LN3221">3221</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN3222">3222</td><td class="line">		fprintf(o-&gt;file, <span class='string_literal'>"* Unmerged path %s\n"</span>, name);</td></tr>
<tr><td class="num" id="LN3223">3223</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3224">3224</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3225">3225</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> diff_fill_sha1_info(<span class='keyword'>struct</span> diff_filespec *one)</td></tr>
<tr><td class="num" id="LN3226">3226</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3227">3227</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_FILE_VALID(one)<span class='expansion'>(((one)-&gt;mode) != 0)</span></span>) {</td></tr>
<tr><td class="num" id="LN3228">3228</td><td class="line">		<span class='keyword'>if</span> (!one-&gt;oid_valid) {</td></tr>
<tr><td class="num" id="LN3229">3229</td><td class="line">			<span class='keyword'>struct</span> stat st;</td></tr>
<tr><td class="num" id="LN3230">3230</td><td class="line">			<span class='keyword'>if</span> (one-&gt;is_stdin) {</td></tr>
<tr><td class="num" id="LN3231">3231</td><td class="line">				oidclr(&amp;one-&gt;oid);</td></tr>
<tr><td class="num" id="LN3232">3232</td><td class="line">				<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN3233">3233</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN3234">3234</td><td class="line">			<span class='keyword'>if</span> (lstat(one-&gt;path, &amp;st) &lt; 0)</td></tr>
<tr><td class="num" id="LN3235">3235</td><td class="line">				die_errno(<span class='string_literal'>"stat '%s'"</span>, one-&gt;path);</td></tr>
<tr><td class="num" id="LN3236">3236</td><td class="line">			<span class='keyword'>if</span> (index_path(one-&gt;oid.hash, one-&gt;path, &amp;st, 0))</td></tr>
<tr><td class="num" id="LN3237">3237</td><td class="line">				die(<span class='string_literal'>"cannot hash %s"</span>, one-&gt;path);</td></tr>
<tr><td class="num" id="LN3238">3238</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN3239">3239</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3240">3240</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN3241">3241</td><td class="line">		oidclr(&amp;one-&gt;oid);</td></tr>
<tr><td class="num" id="LN3242">3242</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3243">3243</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3244">3244</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> strip_prefix(<span class='keyword'>int</span> prefix_length, <span class='keyword'>const</span> <span class='keyword'>char</span> **namep, <span class='keyword'>const</span> <span class='keyword'>char</span> **otherp)</td></tr>
<tr><td class="num" id="LN3245">3245</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3246">3246</td><td class="line">	<span class='comment'>/* Strip the prefix but do not molest /dev/null and absolute paths */</span></td></tr>
<tr><td class="num" id="LN3247">3247</td><td class="line">	<span class='keyword'>if</span> (*namep &amp;&amp; **namep != '/') {</td></tr>
<tr><td class="num" id="LN3248">3248</td><td class="line">		*namep += prefix_length;</td></tr>
<tr><td class="num" id="LN3249">3249</td><td class="line">		<span class='keyword'>if</span> (**namep == '/')</td></tr>
<tr><td class="num" id="LN3250">3250</td><td class="line">			++*namep;</td></tr>
<tr><td class="num" id="LN3251">3251</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3252">3252</td><td class="line">	<span class='keyword'>if</span> (*otherp &amp;&amp; **otherp != '/') {</td></tr>
<tr><td class="num" id="LN3253">3253</td><td class="line">		*otherp += prefix_length;</td></tr>
<tr><td class="num" id="LN3254">3254</td><td class="line">		<span class='keyword'>if</span> (**otherp == '/')</td></tr>
<tr><td class="num" id="LN3255">3255</td><td class="line">			++*otherp;</td></tr>
<tr><td class="num" id="LN3256">3256</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3257">3257</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3258">3258</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3259">3259</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> run_diff(<span class='keyword'>struct</span> diff_filepair *p, <span class='keyword'>struct</span> diff_options *o)</td></tr>
<tr><td class="num" id="LN3260">3260</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3261">3261</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *pgm = external_diff();</td></tr>
<tr><td class="num" id="LN3262">3262</td><td class="line">	<span class='keyword'>struct</span> strbuf msg;</td></tr>
<tr><td class="num" id="LN3263">3263</td><td class="line">	<span class='keyword'>struct</span> diff_filespec *one = p-&gt;one;</td></tr>
<tr><td class="num" id="LN3264">3264</td><td class="line">	<span class='keyword'>struct</span> diff_filespec *two = p-&gt;two;</td></tr>
<tr><td class="num" id="LN3265">3265</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *name;</td></tr>
<tr><td class="num" id="LN3266">3266</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *other;</td></tr>
<tr><td class="num" id="LN3267">3267</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *attr_path;</td></tr>
<tr><td class="num" id="LN3268">3268</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3269">3269</td><td class="line">	name  = p-&gt;one-&gt;path;</td></tr>
<tr><td class="num" id="LN3270">3270</td><td class="line">	other = (strcmp(name, p-&gt;two-&gt;path) ? p-&gt;two-&gt;path : <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>);</td></tr>
<tr><td class="num" id="LN3271">3271</td><td class="line">	attr_path = name;</td></tr>
<tr><td class="num" id="LN3272">3272</td><td class="line">	<span class='keyword'>if</span> (o-&gt;prefix_length)</td></tr>
<tr><td class="num" id="LN3273">3273</td><td class="line">		strip_prefix(o-&gt;prefix_length, &amp;name, &amp;other);</td></tr>
<tr><td class="num" id="LN3274">3274</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3275">3275</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>DIFF_OPT_TST(o, ALLOW_EXTERNAL)<span class='expansion'>((o)-&gt;flags &amp; (1 &lt;&lt; 13))</span></span>)</td></tr>
<tr><td class="num" id="LN3276">3276</td><td class="line">		pgm = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN3277">3277</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3278">3278</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_PAIR_UNMERGED(p)<span class='expansion'>((p)-&gt;is_unmerged)</span></span>) {</td></tr>
<tr><td class="num" id="LN3279">3279</td><td class="line">		run_diff_cmd(pgm, name, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, attr_path,</td></tr>
<tr><td class="num" id="LN3280">3280</td><td class="line">			     <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, o, p);</td></tr>
<tr><td class="num" id="LN3281">3281</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN3282">3282</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3283">3283</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3284">3284</td><td class="line">	diff_fill_sha1_info(one);</td></tr>
<tr><td class="num" id="LN3285">3285</td><td class="line">	diff_fill_sha1_info(two);</td></tr>
<tr><td class="num" id="LN3286">3286</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3287">3287</td><td class="line">	<span class='keyword'>if</span> (!pgm &amp;&amp;</td></tr>
<tr><td class="num" id="LN3288">3288</td><td class="line">	    <span class='macro'>DIFF_FILE_VALID(one)<span class='expansion'>(((one)-&gt;mode) != 0)</span></span> &amp;&amp; <span class='macro'>DIFF_FILE_VALID(two)<span class='expansion'>(((two)-&gt;mode) != 0)</span></span> &amp;&amp;</td></tr>
<tr><td class="num" id="LN3289">3289</td><td class="line">	    (<span class='macro'>S_IFMT<span class='expansion'>0170000</span></span> &amp; one-&gt;mode) != (<span class='macro'>S_IFMT<span class='expansion'>0170000</span></span> &amp; two-&gt;mode)) {</td></tr>
<tr><td class="num" id="LN3290">3290</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN3291">3291</td><td class="line">		 <span class='comment'>* a filepair that changes between file and symlink</span></td></tr>
<tr><td class="num" id="LN3292">3292</td><td class="line">		 <span class='comment'>* needs to be split into deletion and creation.</span></td></tr>
<tr><td class="num" id="LN3293">3293</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN3294">3294</td><td class="line">		<span class='keyword'>struct</span> diff_filespec *null = alloc_filespec(two-&gt;path);</td></tr>
<tr><td class="num" id="LN3295">3295</td><td class="line">		run_diff_cmd(<span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, name, other, attr_path,</td></tr>
<tr><td class="num" id="LN3296">3296</td><td class="line">			     one, null, &amp;msg, o, p);</td></tr>
<tr><td class="num" id="LN3297">3297</td><td class="line">		free(null);</td></tr>
<tr><td class="num" id="LN3298">3298</td><td class="line">		strbuf_release(&amp;msg);</td></tr>
<tr><td class="num" id="LN3299">3299</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3300">3300</td><td class="line">		null = alloc_filespec(one-&gt;path);</td></tr>
<tr><td class="num" id="LN3301">3301</td><td class="line">		run_diff_cmd(<span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, name, other, attr_path,</td></tr>
<tr><td class="num" id="LN3302">3302</td><td class="line">			     null, two, &amp;msg, o, p);</td></tr>
<tr><td class="num" id="LN3303">3303</td><td class="line">		free(null);</td></tr>
<tr><td class="num" id="LN3304">3304</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3305">3305</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN3306">3306</td><td class="line">		run_diff_cmd(pgm, name, other, attr_path,</td></tr>
<tr><td class="num" id="LN3307">3307</td><td class="line">			     one, two, &amp;msg, o, p);</td></tr>
<tr><td class="num" id="LN3308">3308</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3309">3309</td><td class="line">	strbuf_release(&amp;msg);</td></tr>
<tr><td class="num" id="LN3310">3310</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3311">3311</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3312">3312</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> run_diffstat(<span class='keyword'>struct</span> diff_filepair *p, <span class='keyword'>struct</span> diff_options *o,</td></tr>
<tr><td class="num" id="LN3313">3313</td><td class="line">			 <span class='keyword'>struct</span> diffstat_t *diffstat)</td></tr>
<tr><td class="num" id="LN3314">3314</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3315">3315</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *name;</td></tr>
<tr><td class="num" id="LN3316">3316</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *other;</td></tr>
<tr><td class="num" id="LN3317">3317</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3318">3318</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_PAIR_UNMERGED(p)<span class='expansion'>((p)-&gt;is_unmerged)</span></span>) {</td></tr>
<tr><td class="num" id="LN3319">3319</td><td class="line">		<span class='comment'>/* unmerged */</span></td></tr>
<tr><td class="num" id="LN3320">3320</td><td class="line">		builtin_diffstat(p-&gt;one-&gt;path, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, diffstat, o, p);</td></tr>
<tr><td class="num" id="LN3321">3321</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN3322">3322</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3323">3323</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3324">3324</td><td class="line">	name = p-&gt;one-&gt;path;</td></tr>
<tr><td class="num" id="LN3325">3325</td><td class="line">	other = (strcmp(name, p-&gt;two-&gt;path) ? p-&gt;two-&gt;path : <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>);</td></tr>
<tr><td class="num" id="LN3326">3326</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3327">3327</td><td class="line">	<span class='keyword'>if</span> (o-&gt;prefix_length)</td></tr>
<tr><td class="num" id="LN3328">3328</td><td class="line">		strip_prefix(o-&gt;prefix_length, &amp;name, &amp;other);</td></tr>
<tr><td class="num" id="LN3329">3329</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3330">3330</td><td class="line">	diff_fill_sha1_info(p-&gt;one);</td></tr>
<tr><td class="num" id="LN3331">3331</td><td class="line">	diff_fill_sha1_info(p-&gt;two);</td></tr>
<tr><td class="num" id="LN3332">3332</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3333">3333</td><td class="line">	builtin_diffstat(name, other, p-&gt;one, p-&gt;two, diffstat, o, p);</td></tr>
<tr><td class="num" id="LN3334">3334</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3335">3335</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3336">3336</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> run_checkdiff(<span class='keyword'>struct</span> diff_filepair *p, <span class='keyword'>struct</span> diff_options *o)</td></tr>
<tr><td class="num" id="LN3337">3337</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3338">3338</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *name;</td></tr>
<tr><td class="num" id="LN3339">3339</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *other;</td></tr>
<tr><td class="num" id="LN3340">3340</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *attr_path;</td></tr>
<tr><td class="num" id="LN3341">3341</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3342">3342</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_PAIR_UNMERGED(p)<span class='expansion'>((p)-&gt;is_unmerged)</span></span>) {</td></tr>
<tr><td class="num" id="LN3343">3343</td><td class="line">		<span class='comment'>/* unmerged */</span></td></tr>
<tr><td class="num" id="LN3344">3344</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN3345">3345</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3346">3346</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3347">3347</td><td class="line">	name = p-&gt;one-&gt;path;</td></tr>
<tr><td class="num" id="LN3348">3348</td><td class="line">	other = (strcmp(name, p-&gt;two-&gt;path) ? p-&gt;two-&gt;path : <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>);</td></tr>
<tr><td class="num" id="LN3349">3349</td><td class="line">	attr_path = other ? other : name;</td></tr>
<tr><td class="num" id="LN3350">3350</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3351">3351</td><td class="line">	<span class='keyword'>if</span> (o-&gt;prefix_length)</td></tr>
<tr><td class="num" id="LN3352">3352</td><td class="line">		strip_prefix(o-&gt;prefix_length, &amp;name, &amp;other);</td></tr>
<tr><td class="num" id="LN3353">3353</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3354">3354</td><td class="line">	diff_fill_sha1_info(p-&gt;one);</td></tr>
<tr><td class="num" id="LN3355">3355</td><td class="line">	diff_fill_sha1_info(p-&gt;two);</td></tr>
<tr><td class="num" id="LN3356">3356</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3357">3357</td><td class="line">	builtin_checkdiff(name, other, attr_path, p-&gt;one, p-&gt;two, o);</td></tr>
<tr><td class="num" id="LN3358">3358</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3359">3359</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3360">3360</td><td class="line"><span class='keyword'>void</span> diff_setup(<span class='keyword'>struct</span> diff_options *options)</td></tr>
<tr><td class="num" id="LN3361">3361</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3362">3362</td><td class="line">	<span class='macro'>memcpy(options, &amp;default_diff_options, <span class='keyword'>sizeof</span>(*options))<span class='expansion'>__builtin___memcpy_chk (options, &amp;default_diff_options, sizeof<br>(*options), __builtin_object_size (options, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN3363">3363</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3364">3364</td><td class="line">	options-&gt;file = <span class='macro'>stdout<span class='expansion'>__stdoutp</span></span>;</td></tr>
<tr><td class="num" id="LN3365">3365</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3366">3366</td><td class="line">	options-&gt;abbrev = <span class='macro'>DEFAULT_ABBREV<span class='expansion'>default_abbrev</span></span>;</td></tr>
<tr><td class="num" id="LN3367">3367</td><td class="line">	options-&gt;line_termination = '\n';</td></tr>
<tr><td class="num" id="LN3368">3368</td><td class="line">	options-&gt;break_opt = -1;</td></tr>
<tr><td class="num" id="LN3369">3369</td><td class="line">	options-&gt;rename_limit = -1;</td></tr>
<tr><td class="num" id="LN3370">3370</td><td class="line">	options-&gt;dirstat_permille = diff_dirstat_permille_default;</td></tr>
<tr><td class="num" id="LN3371">3371</td><td class="line">	options-&gt;context = diff_context_default;</td></tr>
<tr><td class="num" id="LN3372">3372</td><td class="line">	options-&gt;interhunkcontext = diff_interhunk_context_default;</td></tr>
<tr><td class="num" id="LN3373">3373</td><td class="line">	options-&gt;ws_error_highlight = ws_error_highlight_default;</td></tr>
<tr><td class="num" id="LN3374">3374</td><td class="line">	<span class='macro'>DIFF_OPT_SET(options, RENAME_EMPTY)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 8)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 8)))</span></span>;</td></tr>
<tr><td class="num" id="LN3375">3375</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3376">3376</td><td class="line">	<span class='comment'>/* pathchange left =NULL by default */</span></td></tr>
<tr><td class="num" id="LN3377">3377</td><td class="line">	options-&gt;change = diff_change;</td></tr>
<tr><td class="num" id="LN3378">3378</td><td class="line">	options-&gt;add_remove = diff_addremove;</td></tr>
<tr><td class="num" id="LN3379">3379</td><td class="line">	options-&gt;use_color = diff_use_color_default;</td></tr>
<tr><td class="num" id="LN3380">3380</td><td class="line">	options-&gt;detect_rename = diff_detect_rename_default;</td></tr>
<tr><td class="num" id="LN3381">3381</td><td class="line">	options-&gt;xdl_opts |= diff_algorithm;</td></tr>
<tr><td class="num" id="LN3382">3382</td><td class="line">	<span class='keyword'>if</span> (diff_indent_heuristic)</td></tr>
<tr><td class="num" id="LN3383">3383</td><td class="line">		<span class='macro'>DIFF_XDL_SET(options, INDENT_HEURISTIC)<span class='expansion'>((options)-&gt;xdl_opts |= (1 &lt;&lt; 8))</span></span>;</td></tr>
<tr><td class="num" id="LN3384">3384</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3385">3385</td><td class="line">	options-&gt;orderfile = diff_order_file_cfg;</td></tr>
<tr><td class="num" id="LN3386">3386</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3387">3387</td><td class="line">	<span class='keyword'>if</span> (diff_no_prefix) {</td></tr>
<tr><td class="num" id="LN3388">3388</td><td class="line">		options-&gt;a_prefix = options-&gt;b_prefix = <span class='string_literal'>""</span>;</td></tr>
<tr><td class="num" id="LN3389">3389</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (!diff_mnemonic_prefix) {</td></tr>
<tr><td class="num" id="LN3390">3390</td><td class="line">		options-&gt;a_prefix = <span class='string_literal'>"a/"</span>;</td></tr>
<tr><td class="num" id="LN3391">3391</td><td class="line">		options-&gt;b_prefix = <span class='string_literal'>"b/"</span>;</td></tr>
<tr><td class="num" id="LN3392">3392</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3393">3393</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3394">3394</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3395">3395</td><td class="line"><span class='keyword'>void</span> diff_setup_done(<span class='keyword'>struct</span> diff_options *options)</td></tr>
<tr><td class="num" id="LN3396">3396</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3397">3397</td><td class="line">	<span class='keyword'>int</span> count = 0;</td></tr>
<tr><td class="num" id="LN3398">3398</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3399">3399</td><td class="line">	<span class='keyword'>if</span> (options-&gt;set_default)</td></tr>
<tr><td class="num" id="LN3400">3400</td><td class="line">		options-&gt;set_default(options);</td></tr>
<tr><td class="num" id="LN3401">3401</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3402">3402</td><td class="line">	<span class='keyword'>if</span> (options-&gt;output_format &amp; <span class='macro'>DIFF_FORMAT_NAME<span class='expansion'>0x0100</span></span>)</td></tr>
<tr><td class="num" id="LN3403">3403</td><td class="line">		count++;</td></tr>
<tr><td class="num" id="LN3404">3404</td><td class="line">	<span class='keyword'>if</span> (options-&gt;output_format &amp; <span class='macro'>DIFF_FORMAT_NAME_STATUS<span class='expansion'>0x0200</span></span>)</td></tr>
<tr><td class="num" id="LN3405">3405</td><td class="line">		count++;</td></tr>
<tr><td class="num" id="LN3406">3406</td><td class="line">	<span class='keyword'>if</span> (options-&gt;output_format &amp; <span class='macro'>DIFF_FORMAT_CHECKDIFF<span class='expansion'>0x0400</span></span>)</td></tr>
<tr><td class="num" id="LN3407">3407</td><td class="line">		count++;</td></tr>
<tr><td class="num" id="LN3408">3408</td><td class="line">	<span class='keyword'>if</span> (options-&gt;output_format &amp; <span class='macro'>DIFF_FORMAT_NO_OUTPUT<span class='expansion'>0x0800</span></span>)</td></tr>
<tr><td class="num" id="LN3409">3409</td><td class="line">		count++;</td></tr>
<tr><td class="num" id="LN3410">3410</td><td class="line">	<span class='keyword'>if</span> (count &gt; 1)</td></tr>
<tr><td class="num" id="LN3411">3411</td><td class="line">		die(_(<span class='string_literal'>"--name-only, --name-status, --check and -s are mutually exclusive"</span>));</td></tr>
<tr><td class="num" id="LN3412">3412</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3413">3413</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN3414">3414</td><td class="line">	 <span class='comment'>* Most of the time we can say "there are changes"</span></td></tr>
<tr><td class="num" id="LN3415">3415</td><td class="line">	 <span class='comment'>* only by checking if there are changed paths, but</span></td></tr>
<tr><td class="num" id="LN3416">3416</td><td class="line">	 <span class='comment'>* --ignore-whitespace* options force us to look</span></td></tr>
<tr><td class="num" id="LN3417">3417</td><td class="line">	 <span class='comment'>* inside contents.</span></td></tr>
<tr><td class="num" id="LN3418">3418</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN3419">3419</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3420">3420</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_XDL_TST(options, IGNORE_WHITESPACE)<span class='expansion'>((options)-&gt;xdl_opts &amp; (1 &lt;&lt; 2))</span></span> ||</td></tr>
<tr><td class="num" id="LN3421">3421</td><td class="line">	    <span class='macro'>DIFF_XDL_TST(options, IGNORE_WHITESPACE_CHANGE)<span class='expansion'>((options)-&gt;xdl_opts &amp; (1 &lt;&lt; 3))</span></span> ||</td></tr>
<tr><td class="num" id="LN3422">3422</td><td class="line">	    <span class='macro'>DIFF_XDL_TST(options, IGNORE_WHITESPACE_AT_EOL)<span class='expansion'>((options)-&gt;xdl_opts &amp; (1 &lt;&lt; 4))</span></span>)</td></tr>
<tr><td class="num" id="LN3423">3423</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, DIFF_FROM_CONTENTS)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 22)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 22)))</span></span>;</td></tr>
<tr><td class="num" id="LN3424">3424</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN3425">3425</td><td class="line">		<span class='macro'>DIFF_OPT_CLR(options, DIFF_FROM_CONTENTS)<span class='expansion'>(((options)-&gt;flags &amp;= ~(1 &lt;&lt; 22)),((options)-&gt;<br>touched_flags |= (1 &lt;&lt; 22)))</span></span>;</td></tr>
<tr><td class="num" id="LN3426">3426</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3427">3427</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(options, FIND_COPIES_HARDER)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 6))</span></span>)</td></tr>
<tr><td class="num" id="LN3428">3428</td><td class="line">		options-&gt;detect_rename = <span class='macro'>DIFF_DETECT_COPY<span class='expansion'>2</span></span>;</td></tr>
<tr><td class="num" id="LN3429">3429</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3430">3430</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>DIFF_OPT_TST(options, RELATIVE_NAME)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 17))</span></span>)</td></tr>
<tr><td class="num" id="LN3431">3431</td><td class="line">		options-&gt;prefix = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN3432">3432</td><td class="line">	<span class='keyword'>if</span> (options-&gt;prefix)</td></tr>
<tr><td class="num" id="LN3433">3433</td><td class="line">		options-&gt;prefix_length = strlen(options-&gt;prefix);</td></tr>
<tr><td class="num" id="LN3434">3434</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN3435">3435</td><td class="line">		options-&gt;prefix_length = 0;</td></tr>
<tr><td class="num" id="LN3436">3436</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3437">3437</td><td class="line">	<span class='keyword'>if</span> (options-&gt;output_format &amp; (<span class='macro'>DIFF_FORMAT_NAME<span class='expansion'>0x0100</span></span> |</td></tr>
<tr><td class="num" id="LN3438">3438</td><td class="line">				      <span class='macro'>DIFF_FORMAT_NAME_STATUS<span class='expansion'>0x0200</span></span> |</td></tr>
<tr><td class="num" id="LN3439">3439</td><td class="line">				      <span class='macro'>DIFF_FORMAT_CHECKDIFF<span class='expansion'>0x0400</span></span> |</td></tr>
<tr><td class="num" id="LN3440">3440</td><td class="line">				      <span class='macro'>DIFF_FORMAT_NO_OUTPUT<span class='expansion'>0x0800</span></span>))</td></tr>
<tr><td class="num" id="LN3441">3441</td><td class="line">		options-&gt;output_format &amp;= ~(<span class='macro'>DIFF_FORMAT_RAW<span class='expansion'>0x0001</span></span> |</td></tr>
<tr><td class="num" id="LN3442">3442</td><td class="line">					    <span class='macro'>DIFF_FORMAT_NUMSTAT<span class='expansion'>0x0004</span></span> |</td></tr>
<tr><td class="num" id="LN3443">3443</td><td class="line">					    <span class='macro'>DIFF_FORMAT_DIFFSTAT<span class='expansion'>0x0002</span></span> |</td></tr>
<tr><td class="num" id="LN3444">3444</td><td class="line">					    <span class='macro'>DIFF_FORMAT_SHORTSTAT<span class='expansion'>0x0020</span></span> |</td></tr>
<tr><td class="num" id="LN3445">3445</td><td class="line">					    <span class='macro'>DIFF_FORMAT_DIRSTAT<span class='expansion'>0x0040</span></span> |</td></tr>
<tr><td class="num" id="LN3446">3446</td><td class="line">					    <span class='macro'>DIFF_FORMAT_SUMMARY<span class='expansion'>0x0008</span></span> |</td></tr>
<tr><td class="num" id="LN3447">3447</td><td class="line">					    <span class='macro'>DIFF_FORMAT_PATCH<span class='expansion'>0x0010</span></span>);</td></tr>
<tr><td class="num" id="LN3448">3448</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3449">3449</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN3450">3450</td><td class="line">	 <span class='comment'>* These cases always need recursive; we do not drop caller-supplied</span></td></tr>
<tr><td class="num" id="LN3451">3451</td><td class="line">	 <span class='comment'>* recursive bits for other formats here.</span></td></tr>
<tr><td class="num" id="LN3452">3452</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN3453">3453</td><td class="line">	<span class='keyword'>if</span> (options-&gt;output_format &amp; (<span class='macro'>DIFF_FORMAT_PATCH<span class='expansion'>0x0010</span></span> |</td></tr>
<tr><td class="num" id="LN3454">3454</td><td class="line">				      <span class='macro'>DIFF_FORMAT_NUMSTAT<span class='expansion'>0x0004</span></span> |</td></tr>
<tr><td class="num" id="LN3455">3455</td><td class="line">				      <span class='macro'>DIFF_FORMAT_DIFFSTAT<span class='expansion'>0x0002</span></span> |</td></tr>
<tr><td class="num" id="LN3456">3456</td><td class="line">				      <span class='macro'>DIFF_FORMAT_SHORTSTAT<span class='expansion'>0x0020</span></span> |</td></tr>
<tr><td class="num" id="LN3457">3457</td><td class="line">				      <span class='macro'>DIFF_FORMAT_DIRSTAT<span class='expansion'>0x0040</span></span> |</td></tr>
<tr><td class="num" id="LN3458">3458</td><td class="line">				      <span class='macro'>DIFF_FORMAT_SUMMARY<span class='expansion'>0x0008</span></span> |</td></tr>
<tr><td class="num" id="LN3459">3459</td><td class="line">				      <span class='macro'>DIFF_FORMAT_CHECKDIFF<span class='expansion'>0x0400</span></span>))</td></tr>
<tr><td class="num" id="LN3460">3460</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, RECURSIVE)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 0)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 0)))</span></span>;</td></tr>
<tr><td class="num" id="LN3461">3461</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN3462">3462</td><td class="line">	 <span class='comment'>* Also pickaxe would not work very well if you do not say recursive</span></td></tr>
<tr><td class="num" id="LN3463">3463</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN3464">3464</td><td class="line">	<span class='keyword'>if</span> (options-&gt;pickaxe)</td></tr>
<tr><td class="num" id="LN3465">3465</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, RECURSIVE)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 0)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 0)))</span></span>;</td></tr>
<tr><td class="num" id="LN3466">3466</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN3467">3467</td><td class="line">	 <span class='comment'>* When patches are generated, submodules diffed against the work tree</span></td></tr>
<tr><td class="num" id="LN3468">3468</td><td class="line">	 <span class='comment'>* must be checked for dirtiness too so it can be shown in the output</span></td></tr>
<tr><td class="num" id="LN3469">3469</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN3470">3470</td><td class="line">	<span class='keyword'>if</span> (options-&gt;output_format &amp; <span class='macro'>DIFF_FORMAT_PATCH<span class='expansion'>0x0010</span></span>)</td></tr>
<tr><td class="num" id="LN3471">3471</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, DIRTY_SUBMODULES)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 24)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 24)))</span></span>;</td></tr>
<tr><td class="num" id="LN3472">3472</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3473">3473</td><td class="line">	<span class='keyword'>if</span> (options-&gt;detect_rename &amp;&amp; options-&gt;rename_limit &lt; 0)</td></tr>
<tr><td class="num" id="LN3474">3474</td><td class="line">		options-&gt;rename_limit = diff_rename_limit_default;</td></tr>
<tr><td class="num" id="LN3475">3475</td><td class="line">	<span class='keyword'>if</span> (options-&gt;setup &amp; <span class='macro'>DIFF_SETUP_USE_CACHE<span class='expansion'>2</span></span>) {</td></tr>
<tr><td class="num" id="LN3476">3476</td><td class="line">		<span class='keyword'>if</span> (!<span class='macro'>active_cache<span class='expansion'>(the_index.cache)</span></span>)</td></tr>
<tr><td class="num" id="LN3477">3477</td><td class="line">			<span class='comment'>/* read-cache does not die even when it fails</span></td></tr>
<tr><td class="num" id="LN3478">3478</td><td class="line">			 <span class='comment'>* so it is safe for us to do this here.  Also</span></td></tr>
<tr><td class="num" id="LN3479">3479</td><td class="line">			 <span class='comment'>* it does not smudge active_cache or active_nr</span></td></tr>
<tr><td class="num" id="LN3480">3480</td><td class="line">			 <span class='comment'>* when it fails, so we do not have to worry about</span></td></tr>
<tr><td class="num" id="LN3481">3481</td><td class="line">			 <span class='comment'>* cleaning it up ourselves either.</span></td></tr>
<tr><td class="num" id="LN3482">3482</td><td class="line">			 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN3483">3483</td><td class="line">			<span class='macro'>read_cache()<span class='expansion'>read_index(&amp;the_index)</span></span>;</td></tr>
<tr><td class="num" id="LN3484">3484</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3485">3485</td><td class="line">	<span class='keyword'>if</span> (40 &lt; options-&gt;abbrev)</td></tr>
<tr><td class="num" id="LN3486">3486</td><td class="line">		options-&gt;abbrev = 40; <span class='comment'>/* full */</span></td></tr>
<tr><td class="num" id="LN3487">3487</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3488">3488</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN3489">3489</td><td class="line">	 <span class='comment'>* It does not make sense to show the first hit we happened</span></td></tr>
<tr><td class="num" id="LN3490">3490</td><td class="line">	 <span class='comment'>* to have found.  It does not make sense not to return with</span></td></tr>
<tr><td class="num" id="LN3491">3491</td><td class="line">	 <span class='comment'>* exit code in such a case either.</span></td></tr>
<tr><td class="num" id="LN3492">3492</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN3493">3493</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(options, QUICK)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 11))</span></span>) {</td></tr>
<tr><td class="num" id="LN3494">3494</td><td class="line">		options-&gt;output_format = <span class='macro'>DIFF_FORMAT_NO_OUTPUT<span class='expansion'>0x0800</span></span>;</td></tr>
<tr><td class="num" id="LN3495">3495</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, EXIT_WITH_STATUS)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 14)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 14)))</span></span>;</td></tr>
<tr><td class="num" id="LN3496">3496</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3497">3497</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3498">3498</td><td class="line">	options-&gt;diff_path_counter = 0;</td></tr>
<tr><td class="num" id="LN3499">3499</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3500">3500</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(options, FOLLOW_RENAMES)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 7))</span></span> &amp;&amp; options-&gt;pathspec.nr != 1)</td></tr>
<tr><td class="num" id="LN3501">3501</td><td class="line">		die(_(<span class='string_literal'>"--follow requires exactly one pathspec"</span>));</td></tr>
<tr><td class="num" id="LN3502">3502</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3503">3503</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3504">3504</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> opt_arg(<span class='keyword'>const</span> <span class='keyword'>char</span> *arg, <span class='keyword'>int</span> arg_short, <span class='keyword'>const</span> <span class='keyword'>char</span> *arg_long, <span class='keyword'>int</span> *val)</td></tr>
<tr><td class="num" id="LN3505">3505</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3506">3506</td><td class="line">	<span class='keyword'>char</span> c, *eq;</td></tr>
<tr><td class="num" id="LN3507">3507</td><td class="line">	<span class='keyword'>int</span> len;</td></tr>
<tr><td class="num" id="LN3508">3508</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3509">3509</td><td class="line">	<span class='keyword'>if</span> (*arg != '-')</td></tr>
<tr><td class="num" id="LN3510">3510</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN3511">3511</td><td class="line">	c = *++arg;</td></tr>
<tr><td class="num" id="LN3512">3512</td><td class="line">	<span class='keyword'>if</span> (!c)</td></tr>
<tr><td class="num" id="LN3513">3513</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN3514">3514</td><td class="line">	<span class='keyword'>if</span> (c == arg_short) {</td></tr>
<tr><td class="num" id="LN3515">3515</td><td class="line">		c = *++arg;</td></tr>
<tr><td class="num" id="LN3516">3516</td><td class="line">		<span class='keyword'>if</span> (!c)</td></tr>
<tr><td class="num" id="LN3517">3517</td><td class="line">			<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN3518">3518</td><td class="line">		<span class='keyword'>if</span> (val &amp;&amp; <span class='macro'>isdigit(c)<span class='expansion'>((sane_ctype[(unsigned char)(c)] &amp; (0x02)) != 0)</span></span>) {</td></tr>
<tr><td class="num" id="LN3519">3519</td><td class="line">			<span class='keyword'>char</span> *end;</td></tr>
<tr><td class="num" id="LN3520">3520</td><td class="line">			<span class='keyword'>int</span> n = strtoul(arg, &amp;end, 10);</td></tr>
<tr><td class="num" id="LN3521">3521</td><td class="line">			<span class='keyword'>if</span> (*end)</td></tr>
<tr><td class="num" id="LN3522">3522</td><td class="line">				<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN3523">3523</td><td class="line">			*val = n;</td></tr>
<tr><td class="num" id="LN3524">3524</td><td class="line">			<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN3525">3525</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN3526">3526</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN3527">3527</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3528">3528</td><td class="line">	<span class='keyword'>if</span> (c != '-')</td></tr>
<tr><td class="num" id="LN3529">3529</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN3530">3530</td><td class="line">	arg++;</td></tr>
<tr><td class="num" id="LN3531">3531</td><td class="line">	eq = <span class='macro'>strchrnul<span class='expansion'>gitstrchrnul</span></span>(arg, '=');</td></tr>
<tr><td class="num" id="LN3532">3532</td><td class="line">	len = eq - arg;</td></tr>
<tr><td class="num" id="LN3533">3533</td><td class="line">	<span class='keyword'>if</span> (!len || strncmp(arg, arg_long, len))</td></tr>
<tr><td class="num" id="LN3534">3534</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN3535">3535</td><td class="line">	<span class='keyword'>if</span> (*eq) {</td></tr>
<tr><td class="num" id="LN3536">3536</td><td class="line">		<span class='keyword'>int</span> n;</td></tr>
<tr><td class="num" id="LN3537">3537</td><td class="line">		<span class='keyword'>char</span> *end;</td></tr>
<tr><td class="num" id="LN3538">3538</td><td class="line">		<span class='keyword'>if</span> (!<span class='macro'>isdigit(*++eq)<span class='expansion'>((sane_ctype[(unsigned char)(*++eq)] &amp; (0x02)) != 0)</span></span>)</td></tr>
<tr><td class="num" id="LN3539">3539</td><td class="line">			<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN3540">3540</td><td class="line">		n = strtoul(eq, &amp;end, 10);</td></tr>
<tr><td class="num" id="LN3541">3541</td><td class="line">		<span class='keyword'>if</span> (*end)</td></tr>
<tr><td class="num" id="LN3542">3542</td><td class="line">			<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN3543">3543</td><td class="line">		*val = n;</td></tr>
<tr><td class="num" id="LN3544">3544</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3545">3545</td><td class="line">	<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN3546">3546</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3547">3547</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3548">3548</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_scoreopt_parse(<span class='keyword'>const</span> <span class='keyword'>char</span> *opt);</td></tr>
<tr><td class="num" id="LN3549">3549</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3550">3550</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>inline</span> <span class='keyword'>int</span> short_opt(<span class='keyword'>char</span> opt, <span class='keyword'>const</span> <span class='keyword'>char</span> **argv,</td></tr>
<tr><td class="num" id="LN3551">3551</td><td class="line">			    <span class='keyword'>const</span> <span class='keyword'>char</span> **optarg)</td></tr>
<tr><td class="num" id="LN3552">3552</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3553">3553</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *arg = argv[0];</td></tr>
<tr><td class="num" id="LN3554">3554</td><td class="line">	<span class='keyword'>if</span> (arg[0] != '-' || arg[1] != opt)</td></tr>
<tr><td class="num" id="LN3555">3555</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN3556">3556</td><td class="line">	<span class='keyword'>if</span> (arg[2] != '\0') {</td></tr>
<tr><td class="num" id="LN3557">3557</td><td class="line">		*optarg = arg + 2;</td></tr>
<tr><td class="num" id="LN3558">3558</td><td class="line">		<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN3559">3559</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3560">3560</td><td class="line">	<span class='keyword'>if</span> (!argv[1])</td></tr>
<tr><td class="num" id="LN3561">3561</td><td class="line">		die(<span class='string_literal'>"Option '%c' requires a value"</span>, opt);</td></tr>
<tr><td class="num" id="LN3562">3562</td><td class="line">	*optarg = argv[1];</td></tr>
<tr><td class="num" id="LN3563">3563</td><td class="line">	<span class='keyword'>return</span> 2;</td></tr>
<tr><td class="num" id="LN3564">3564</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3565">3565</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3566">3566</td><td class="line"><span class='keyword'>int</span> parse_long_opt(<span class='keyword'>const</span> <span class='keyword'>char</span> *opt, <span class='keyword'>const</span> <span class='keyword'>char</span> **argv,</td></tr>
<tr><td class="num" id="LN3567">3567</td><td class="line">		   <span class='keyword'>const</span> <span class='keyword'>char</span> **optarg)</td></tr>
<tr><td class="num" id="LN3568">3568</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3569">3569</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *arg = argv[0];</td></tr>
<tr><td class="num" id="LN3570">3570</td><td class="line">	<span class='keyword'>if</span> (!skip_prefix(arg, <span class='string_literal'>"--"</span>, &amp;arg))</td></tr>
<tr><td class="num" id="LN3571">3571</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN3572">3572</td><td class="line">	<span class='keyword'>if</span> (!skip_prefix(arg, opt, &amp;arg))</td></tr>
<tr><td class="num" id="LN3573">3573</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN3574">3574</td><td class="line">	<span class='keyword'>if</span> (*arg == '=') { <span class='comment'>/* stuck form: --option=value */</span></td></tr>
<tr><td class="num" id="LN3575">3575</td><td class="line">		*optarg = arg + 1;</td></tr>
<tr><td class="num" id="LN3576">3576</td><td class="line">		<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN3577">3577</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3578">3578</td><td class="line">	<span class='keyword'>if</span> (*arg != '\0')</td></tr>
<tr><td class="num" id="LN3579">3579</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN3580">3580</td><td class="line">	<span class='comment'>/* separate form: --option value */</span></td></tr>
<tr><td class="num" id="LN3581">3581</td><td class="line">	<span class='keyword'>if</span> (!argv[1])</td></tr>
<tr><td class="num" id="LN3582">3582</td><td class="line">		die(<span class='string_literal'>"Option '--%s' requires a value"</span>, opt);</td></tr>
<tr><td class="num" id="LN3583">3583</td><td class="line">	*optarg = argv[1];</td></tr>
<tr><td class="num" id="LN3584">3584</td><td class="line">	<span class='keyword'>return</span> 2;</td></tr>
<tr><td class="num" id="LN3585">3585</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3586">3586</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3587">3587</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> stat_opt(<span class='keyword'>struct</span> diff_options *options, <span class='keyword'>const</span> <span class='keyword'>char</span> **av)</td></tr>
<tr><td class="num" id="LN3588">3588</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3589">3589</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *arg = av[0];</td></tr>
<tr><td class="num" id="LN3590">3590</td><td class="line">	<span class='keyword'>char</span> *end;</td></tr>
<tr><td class="num" id="LN3591">3591</td><td class="line">	<span class='keyword'>int</span> width = options-&gt;stat_width;</td></tr>
<tr><td class="num" id="LN3592">3592</td><td class="line">	<span class='keyword'>int</span> name_width = options-&gt;stat_name_width;</td></tr>
<tr><td class="num" id="LN3593">3593</td><td class="line">	<span class='keyword'>int</span> graph_width = options-&gt;stat_graph_width;</td></tr>
<tr><td class="num" id="LN3594">3594</td><td class="line">	<span class='keyword'>int</span> count = options-&gt;stat_count;</td></tr>
<tr><td class="num" id="LN3595">3595</td><td class="line">	<span class='keyword'>int</span> argcount = 1;</td></tr>
<tr><td class="num" id="LN3596">3596</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3597">3597</td><td class="line">	<span class='keyword'>if</span> (!skip_prefix(arg, <span class='string_literal'>"--stat"</span>, &amp;arg))</td></tr>
<tr><td class="num" id="LN3598">3598</td><td class="line">		die(<span class='string_literal'>"BUG: stat option does not begin with --stat: %s"</span>, arg);</td></tr>
<tr><td class="num" id="LN3599">3599</td><td class="line">	end = (<span class='keyword'>char</span> *)arg;</td></tr>
<tr><td class="num" id="LN3600">3600</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3601">3601</td><td class="line">	<span class='keyword'>switch</span> (*arg) {</td></tr>
<tr><td class="num" id="LN3602">3602</td><td class="line">	<span class='keyword'>case</span> '-':</td></tr>
<tr><td class="num" id="LN3603">3603</td><td class="line">		<span class='keyword'>if</span> (skip_prefix(arg, <span class='string_literal'>"-width"</span>, &amp;arg)) {</td></tr>
<tr><td class="num" id="LN3604">3604</td><td class="line">			<span class='keyword'>if</span> (*arg == '=')</td></tr>
<tr><td class="num" id="LN3605">3605</td><td class="line">				width = strtoul(arg + 1, &amp;end, 10);</td></tr>
<tr><td class="num" id="LN3606">3606</td><td class="line">			<span class='keyword'>else</span> <span class='keyword'>if</span> (!*arg &amp;&amp; !av[1])</td></tr>
<tr><td class="num" id="LN3607">3607</td><td class="line">				die_want_option(<span class='string_literal'>"--stat-width"</span>);</td></tr>
<tr><td class="num" id="LN3608">3608</td><td class="line">			<span class='keyword'>else</span> <span class='keyword'>if</span> (!*arg) {</td></tr>
<tr><td class="num" id="LN3609">3609</td><td class="line">				width = strtoul(av[1], &amp;end, 10);</td></tr>
<tr><td class="num" id="LN3610">3610</td><td class="line">				argcount = 2;</td></tr>
<tr><td class="num" id="LN3611">3611</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN3612">3612</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(arg, <span class='string_literal'>"-name-width"</span>, &amp;arg)) {</td></tr>
<tr><td class="num" id="LN3613">3613</td><td class="line">			<span class='keyword'>if</span> (*arg == '=')</td></tr>
<tr><td class="num" id="LN3614">3614</td><td class="line">				name_width = strtoul(arg + 1, &amp;end, 10);</td></tr>
<tr><td class="num" id="LN3615">3615</td><td class="line">			<span class='keyword'>else</span> <span class='keyword'>if</span> (!*arg &amp;&amp; !av[1])</td></tr>
<tr><td class="num" id="LN3616">3616</td><td class="line">				die_want_option(<span class='string_literal'>"--stat-name-width"</span>);</td></tr>
<tr><td class="num" id="LN3617">3617</td><td class="line">			<span class='keyword'>else</span> <span class='keyword'>if</span> (!*arg) {</td></tr>
<tr><td class="num" id="LN3618">3618</td><td class="line">				name_width = strtoul(av[1], &amp;end, 10);</td></tr>
<tr><td class="num" id="LN3619">3619</td><td class="line">				argcount = 2;</td></tr>
<tr><td class="num" id="LN3620">3620</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN3621">3621</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(arg, <span class='string_literal'>"-graph-width"</span>, &amp;arg)) {</td></tr>
<tr><td class="num" id="LN3622">3622</td><td class="line">			<span class='keyword'>if</span> (*arg == '=')</td></tr>
<tr><td class="num" id="LN3623">3623</td><td class="line">				graph_width = strtoul(arg + 1, &amp;end, 10);</td></tr>
<tr><td class="num" id="LN3624">3624</td><td class="line">			<span class='keyword'>else</span> <span class='keyword'>if</span> (!*arg &amp;&amp; !av[1])</td></tr>
<tr><td class="num" id="LN3625">3625</td><td class="line">				die_want_option(<span class='string_literal'>"--stat-graph-width"</span>);</td></tr>
<tr><td class="num" id="LN3626">3626</td><td class="line">			<span class='keyword'>else</span> <span class='keyword'>if</span> (!*arg) {</td></tr>
<tr><td class="num" id="LN3627">3627</td><td class="line">				graph_width = strtoul(av[1], &amp;end, 10);</td></tr>
<tr><td class="num" id="LN3628">3628</td><td class="line">				argcount = 2;</td></tr>
<tr><td class="num" id="LN3629">3629</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN3630">3630</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(arg, <span class='string_literal'>"-count"</span>, &amp;arg)) {</td></tr>
<tr><td class="num" id="LN3631">3631</td><td class="line">			<span class='keyword'>if</span> (*arg == '=')</td></tr>
<tr><td class="num" id="LN3632">3632</td><td class="line">				count = strtoul(arg + 1, &amp;end, 10);</td></tr>
<tr><td class="num" id="LN3633">3633</td><td class="line">			<span class='keyword'>else</span> <span class='keyword'>if</span> (!*arg &amp;&amp; !av[1])</td></tr>
<tr><td class="num" id="LN3634">3634</td><td class="line">				die_want_option(<span class='string_literal'>"--stat-count"</span>);</td></tr>
<tr><td class="num" id="LN3635">3635</td><td class="line">			<span class='keyword'>else</span> <span class='keyword'>if</span> (!*arg) {</td></tr>
<tr><td class="num" id="LN3636">3636</td><td class="line">				count = strtoul(av[1], &amp;end, 10);</td></tr>
<tr><td class="num" id="LN3637">3637</td><td class="line">				argcount = 2;</td></tr>
<tr><td class="num" id="LN3638">3638</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN3639">3639</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN3640">3640</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN3641">3641</td><td class="line">	<span class='keyword'>case</span> '=':</td></tr>
<tr><td class="num" id="LN3642">3642</td><td class="line">		width = strtoul(arg+1, &amp;end, 10);</td></tr>
<tr><td class="num" id="LN3643">3643</td><td class="line">		<span class='keyword'>if</span> (*end == ',')</td></tr>
<tr><td class="num" id="LN3644">3644</td><td class="line">			name_width = strtoul(end+1, &amp;end, 10);</td></tr>
<tr><td class="num" id="LN3645">3645</td><td class="line">		<span class='keyword'>if</span> (*end == ',')</td></tr>
<tr><td class="num" id="LN3646">3646</td><td class="line">			count = strtoul(end+1, &amp;end, 10);</td></tr>
<tr><td class="num" id="LN3647">3647</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3648">3648</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3649">3649</td><td class="line">	<span class='comment'>/* Important! This checks all the error cases! */</span></td></tr>
<tr><td class="num" id="LN3650">3650</td><td class="line">	<span class='keyword'>if</span> (*end)</td></tr>
<tr><td class="num" id="LN3651">3651</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN3652">3652</td><td class="line">	options-&gt;output_format |= <span class='macro'>DIFF_FORMAT_DIFFSTAT<span class='expansion'>0x0002</span></span>;</td></tr>
<tr><td class="num" id="LN3653">3653</td><td class="line">	options-&gt;stat_name_width = name_width;</td></tr>
<tr><td class="num" id="LN3654">3654</td><td class="line">	options-&gt;stat_graph_width = graph_width;</td></tr>
<tr><td class="num" id="LN3655">3655</td><td class="line">	options-&gt;stat_width = width;</td></tr>
<tr><td class="num" id="LN3656">3656</td><td class="line">	options-&gt;stat_count = count;</td></tr>
<tr><td class="num" id="LN3657">3657</td><td class="line">	<span class='keyword'>return</span> argcount;</td></tr>
<tr><td class="num" id="LN3658">3658</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3659">3659</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3660">3660</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> parse_dirstat_opt(<span class='keyword'>struct</span> diff_options *options, <span class='keyword'>const</span> <span class='keyword'>char</span> *params)</td></tr>
<tr><td class="num" id="LN3661">3661</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3662">3662</td><td class="line">	<span class='keyword'>struct</span> strbuf errmsg = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN3663">3663</td><td class="line">	<span class='keyword'>if</span> (parse_dirstat_params(options, params, &amp;errmsg))</td></tr>
<tr><td class="num" id="LN3664">3664</td><td class="line">		die(_(<span class='string_literal'>"Failed to parse --dirstat/-X option parameter:\n%s"</span>),</td></tr>
<tr><td class="num" id="LN3665">3665</td><td class="line">		    errmsg.buf);</td></tr>
<tr><td class="num" id="LN3666">3666</td><td class="line">	strbuf_release(&amp;errmsg);</td></tr>
<tr><td class="num" id="LN3667">3667</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN3668">3668</td><td class="line">	 <span class='comment'>* The caller knows a dirstat-related option is given from the command</span></td></tr>
<tr><td class="num" id="LN3669">3669</td><td class="line">	 <span class='comment'>* line; allow it to say "return this_function();"</span></td></tr>
<tr><td class="num" id="LN3670">3670</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN3671">3671</td><td class="line">	options-&gt;output_format |= <span class='macro'>DIFF_FORMAT_DIRSTAT<span class='expansion'>0x0040</span></span>;</td></tr>
<tr><td class="num" id="LN3672">3672</td><td class="line">	<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN3673">3673</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3674">3674</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3675">3675</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> parse_submodule_opt(<span class='keyword'>struct</span> diff_options *options, <span class='keyword'>const</span> <span class='keyword'>char</span> *value)</td></tr>
<tr><td class="num" id="LN3676">3676</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3677">3677</td><td class="line">	<span class='keyword'>if</span> (parse_submodule_params(options, value))</td></tr>
<tr><td class="num" id="LN3678">3678</td><td class="line">		die(_(<span class='string_literal'>"Failed to parse --submodule option parameter: '%s'"</span>),</td></tr>
<tr><td class="num" id="LN3679">3679</td><td class="line">			value);</td></tr>
<tr><td class="num" id="LN3680">3680</td><td class="line">	<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN3681">3681</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3682">3682</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3683">3683</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> diff_status_letters[] = {</td></tr>
<tr><td class="num" id="LN3684">3684</td><td class="line">	<span class='macro'>DIFF_STATUS_ADDED<span class='expansion'>'A'</span></span>,</td></tr>
<tr><td class="num" id="LN3685">3685</td><td class="line">	<span class='macro'>DIFF_STATUS_COPIED<span class='expansion'>'C'</span></span>,</td></tr>
<tr><td class="num" id="LN3686">3686</td><td class="line">	<span class='macro'>DIFF_STATUS_DELETED<span class='expansion'>'D'</span></span>,</td></tr>
<tr><td class="num" id="LN3687">3687</td><td class="line">	<span class='macro'>DIFF_STATUS_MODIFIED<span class='expansion'>'M'</span></span>,</td></tr>
<tr><td class="num" id="LN3688">3688</td><td class="line">	<span class='macro'>DIFF_STATUS_RENAMED<span class='expansion'>'R'</span></span>,</td></tr>
<tr><td class="num" id="LN3689">3689</td><td class="line">	<span class='macro'>DIFF_STATUS_TYPE_CHANGED<span class='expansion'>'T'</span></span>,</td></tr>
<tr><td class="num" id="LN3690">3690</td><td class="line">	<span class='macro'>DIFF_STATUS_UNKNOWN<span class='expansion'>'X'</span></span>,</td></tr>
<tr><td class="num" id="LN3691">3691</td><td class="line">	<span class='macro'>DIFF_STATUS_UNMERGED<span class='expansion'>'U'</span></span>,</td></tr>
<tr><td class="num" id="LN3692">3692</td><td class="line">	<span class='macro'>DIFF_STATUS_FILTER_AON<span class='expansion'>'*'</span></span>,</td></tr>
<tr><td class="num" id="LN3693">3693</td><td class="line">	<span class='macro'>DIFF_STATUS_FILTER_BROKEN<span class='expansion'>'B'</span></span>,</td></tr>
<tr><td class="num" id="LN3694">3694</td><td class="line">	'\0',</td></tr>
<tr><td class="num" id="LN3695">3695</td><td class="line">};</td></tr>
<tr><td class="num" id="LN3696">3696</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3697">3697</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>unsigned</span> <span class='keyword'>int</span> filter_bit['Z' + 1];</td></tr>
<tr><td class="num" id="LN3698">3698</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3699">3699</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> prepare_filter_bits(<span class='keyword'>void</span>)</td></tr>
<tr><td class="num" id="LN3700">3700</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3701">3701</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN3702">3702</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3703">3703</td><td class="line">	<span class='keyword'>if</span> (!filter_bit[<span class='macro'>DIFF_STATUS_ADDED<span class='expansion'>'A'</span></span>]) {</td></tr>
<tr><td class="num" id="LN3704">3704</td><td class="line">		<span class='keyword'>for</span> (i = 0; diff_status_letters[i]; i++)</td></tr>
<tr><td class="num" id="LN3705">3705</td><td class="line">			filter_bit[(<span class='keyword'>int</span>) diff_status_letters[i]] = (1 &lt;&lt; i);</td></tr>
<tr><td class="num" id="LN3706">3706</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3707">3707</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3708">3708</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3709">3709</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>unsigned</span> filter_bit_tst(<span class='keyword'>char</span> status, <span class='keyword'>const</span> <span class='keyword'>struct</span> diff_options *opt)</td></tr>
<tr><td class="num" id="LN3710">3710</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3711">3711</td><td class="line">	<span class='keyword'>return</span> opt-&gt;filter &amp; filter_bit[(<span class='keyword'>int</span>) status];</td></tr>
<tr><td class="num" id="LN3712">3712</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3713">3713</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3714">3714</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> parse_diff_filter_opt(<span class='keyword'>const</span> <span class='keyword'>char</span> *optarg, <span class='keyword'>struct</span> diff_options *opt)</td></tr>
<tr><td class="num" id="LN3715">3715</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3716">3716</td><td class="line">	<span class='keyword'>int</span> i, optch;</td></tr>
<tr><td class="num" id="LN3717">3717</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3718">3718</td><td class="line">	prepare_filter_bits();</td></tr>
<tr><td class="num" id="LN3719">3719</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3720">3720</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN3721">3721</td><td class="line">	 <span class='comment'>* If there is a negation e.g. 'd' in the input, and we haven't</span></td></tr>
<tr><td class="num" id="LN3722">3722</td><td class="line">	 <span class='comment'>* initialized the filter field with another --diff-filter, start</span></td></tr>
<tr><td class="num" id="LN3723">3723</td><td class="line">	 <span class='comment'>* from full set of bits, except for AON.</span></td></tr>
<tr><td class="num" id="LN3724">3724</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN3725">3725</td><td class="line">	<span class='keyword'>if</span> (!opt-&gt;filter) {</td></tr>
<tr><td class="num" id="LN3726">3726</td><td class="line">		<span class='keyword'>for</span> (i = 0; (optch = optarg[i]) != '\0'; i++) {</td></tr>
<tr><td class="num" id="LN3727">3727</td><td class="line">			<span class='keyword'>if</span> (optch &lt; 'a' || 'z' &lt; optch)</td></tr>
<tr><td class="num" id="LN3728">3728</td><td class="line">				<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN3729">3729</td><td class="line">			opt-&gt;filter = (1 &lt;&lt; (<span class='macro'>ARRAY_SIZE(diff_status_letters)<span class='expansion'>(sizeof(diff_status_letters) / sizeof((diff_status_letters)[0<br>]) + (sizeof(char [1 - 2*!(!__builtin_types_compatible_p(__typeof__<br>(diff_status_letters), __typeof__(&amp;(diff_status_letters)[<br>0])))]) - 1))</span></span> - 1)) - 1;</td></tr>
<tr><td class="num" id="LN3730">3730</td><td class="line">			opt-&gt;filter &amp;= ~filter_bit[<span class='macro'>DIFF_STATUS_FILTER_AON<span class='expansion'>'*'</span></span>];</td></tr>
<tr><td class="num" id="LN3731">3731</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN3732">3732</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN3733">3733</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3734">3734</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3735">3735</td><td class="line">	<span class='keyword'>for</span> (i = 0; (optch = optarg[i]) != '\0'; i++) {</td></tr>
<tr><td class="num" id="LN3736">3736</td><td class="line">		<span class='keyword'>unsigned</span> <span class='keyword'>int</span> bit;</td></tr>
<tr><td class="num" id="LN3737">3737</td><td class="line">		<span class='keyword'>int</span> negate;</td></tr>
<tr><td class="num" id="LN3738">3738</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3739">3739</td><td class="line">		<span class='keyword'>if</span> ('a' &lt;= optch &amp;&amp; optch &lt;= 'z') {</td></tr>
<tr><td class="num" id="LN3740">3740</td><td class="line">			negate = 1;</td></tr>
<tr><td class="num" id="LN3741">3741</td><td class="line">			optch = <span class='macro'>toupper(optch)<span class='expansion'>sane_case((unsigned char)(optch), 0)</span></span>;</td></tr>
<tr><td class="num" id="LN3742">3742</td><td class="line">		} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN3743">3743</td><td class="line">			negate = 0;</td></tr>
<tr><td class="num" id="LN3744">3744</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN3745">3745</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3746">3746</td><td class="line">		bit = (0 &lt;= optch &amp;&amp; optch &lt;= 'Z') ? filter_bit[optch] : 0;</td></tr>
<tr><td class="num" id="LN3747">3747</td><td class="line">		<span class='keyword'>if</span> (!bit)</td></tr>
<tr><td class="num" id="LN3748">3748</td><td class="line">			<span class='keyword'>return</span> optarg[i];</td></tr>
<tr><td class="num" id="LN3749">3749</td><td class="line">		<span class='keyword'>if</span> (negate)</td></tr>
<tr><td class="num" id="LN3750">3750</td><td class="line">			opt-&gt;filter &amp;= ~bit;</td></tr>
<tr><td class="num" id="LN3751">3751</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN3752">3752</td><td class="line">			opt-&gt;filter |= bit;</td></tr>
<tr><td class="num" id="LN3753">3753</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3754">3754</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN3755">3755</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3756">3756</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3757">3757</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> enable_patch_output(<span class='keyword'>int</span> *fmt) {</td></tr>
<tr><td class="num" id="LN3758">3758</td><td class="line">	*fmt &amp;= ~<span class='macro'>DIFF_FORMAT_NO_OUTPUT<span class='expansion'>0x0800</span></span>;</td></tr>
<tr><td class="num" id="LN3759">3759</td><td class="line">	*fmt |= <span class='macro'>DIFF_FORMAT_PATCH<span class='expansion'>0x0010</span></span>;</td></tr>
<tr><td class="num" id="LN3760">3760</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3761">3761</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3762">3762</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> parse_ws_error_highlight_opt(<span class='keyword'>struct</span> diff_options *opt, <span class='keyword'>const</span> <span class='keyword'>char</span> *arg)</td></tr>
<tr><td class="num" id="LN3763">3763</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3764">3764</td><td class="line">	<span class='keyword'>int</span> val = parse_ws_error_highlight(arg);</td></tr>
<tr><td class="num" id="LN3765">3765</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3766">3766</td><td class="line">	<span class='keyword'>if</span> (val &lt; 0) {</td></tr>
<tr><td class="num" id="LN3767">3767</td><td class="line">		<span class='macro'>error(<span class='string_literal'>"unknown value after ws-error-highlight=%.*s"</span>,<span class='expansion'>(error("unknown value after ws-error-highlight=%.*s", -1 - val<br>, arg), const_error())</span></span></td></tr>
<tr><td class="num" id="LN3768">3768</td><td class="line">		      <span class='macro'>-1 - val, arg)<span class='expansion'>(error("unknown value after ws-error-highlight=%.*s", -1 - val<br>, arg), const_error())</span></span>;</td></tr>
<tr><td class="num" id="LN3769">3769</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN3770">3770</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3771">3771</td><td class="line">	opt-&gt;ws_error_highlight = val;</td></tr>
<tr><td class="num" id="LN3772">3772</td><td class="line">	<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN3773">3773</td><td class="line">}</td></tr>
<tr><td class="num" id="LN3774">3774</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3775">3775</td><td class="line"><span class='keyword'>int</span> diff_opt_parse(<span class='keyword'>struct</span> diff_options *options,</td></tr>
<tr><td class="num" id="LN3776">3776</td><td class="line">		   <span class='keyword'>const</span> <span class='keyword'>char</span> **av, <span class='keyword'>int</span> ac, <span class='keyword'>const</span> <span class='keyword'>char</span> *prefix)</td></tr>
<tr><td class="num" id="LN3777">3777</td><td class="line">{</td></tr>
<tr><td class="num" id="LN3778">3778</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *arg = av[0];</td></tr>
<tr><td class="num" id="LN3779">3779</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *optarg;</td></tr>
<tr><td class="num" id="LN3780">3780</td><td class="line">	<span class='keyword'>int</span> argcount;</td></tr>
<tr><td class="num" id="LN3781">3781</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3782">3782</td><td class="line">	<span class='keyword'>if</span> (!prefix)</td></tr>
<tr><td class="num" id="LN3783">3783</td><td class="line">		prefix = <span class='string_literal'>""</span>;</td></tr>
<tr><td class="num" id="LN3784">3784</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3785">3785</td><td class="line">	<span class='comment'>/* Output format options */</span></td></tr>
<tr><td class="num" id="LN3786">3786</td><td class="line">	<span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"-p"</span>) || !strcmp(arg, <span class='string_literal'>"-u"</span>) || !strcmp(arg, <span class='string_literal'>"--patch"</span>)</td></tr>
<tr><td class="num" id="LN3787">3787</td><td class="line">	    || opt_arg(arg, 'U', <span class='string_literal'>"unified"</span>, &amp;options-&gt;context))</td></tr>
<tr><td class="num" id="LN3788">3788</td><td class="line">		enable_patch_output(&amp;options-&gt;output_format);</td></tr>
<tr><td class="num" id="LN3789">3789</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--raw"</span>))</td></tr>
<tr><td class="num" id="LN3790">3790</td><td class="line">		options-&gt;output_format |= <span class='macro'>DIFF_FORMAT_RAW<span class='expansion'>0x0001</span></span>;</td></tr>
<tr><td class="num" id="LN3791">3791</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--patch-with-raw"</span>)) {</td></tr>
<tr><td class="num" id="LN3792">3792</td><td class="line">		enable_patch_output(&amp;options-&gt;output_format);</td></tr>
<tr><td class="num" id="LN3793">3793</td><td class="line">		options-&gt;output_format |= <span class='macro'>DIFF_FORMAT_RAW<span class='expansion'>0x0001</span></span>;</td></tr>
<tr><td class="num" id="LN3794">3794</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--numstat"</span>))</td></tr>
<tr><td class="num" id="LN3795">3795</td><td class="line">		options-&gt;output_format |= <span class='macro'>DIFF_FORMAT_NUMSTAT<span class='expansion'>0x0004</span></span>;</td></tr>
<tr><td class="num" id="LN3796">3796</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--shortstat"</span>))</td></tr>
<tr><td class="num" id="LN3797">3797</td><td class="line">		options-&gt;output_format |= <span class='macro'>DIFF_FORMAT_SHORTSTAT<span class='expansion'>0x0020</span></span>;</td></tr>
<tr><td class="num" id="LN3798">3798</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"-X"</span>) || !strcmp(arg, <span class='string_literal'>"--dirstat"</span>))</td></tr>
<tr><td class="num" id="LN3799">3799</td><td class="line">		<span class='keyword'>return</span> parse_dirstat_opt(options, <span class='string_literal'>""</span>);</td></tr>
<tr><td class="num" id="LN3800">3800</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(arg, <span class='string_literal'>"-X"</span>, &amp;arg))</td></tr>
<tr><td class="num" id="LN3801">3801</td><td class="line">		<span class='keyword'>return</span> parse_dirstat_opt(options, arg);</td></tr>
<tr><td class="num" id="LN3802">3802</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(arg, <span class='string_literal'>"--dirstat="</span>, &amp;arg))</td></tr>
<tr><td class="num" id="LN3803">3803</td><td class="line">		<span class='keyword'>return</span> parse_dirstat_opt(options, arg);</td></tr>
<tr><td class="num" id="LN3804">3804</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--cumulative"</span>))</td></tr>
<tr><td class="num" id="LN3805">3805</td><td class="line">		<span class='keyword'>return</span> parse_dirstat_opt(options, <span class='string_literal'>"cumulative"</span>);</td></tr>
<tr><td class="num" id="LN3806">3806</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--dirstat-by-file"</span>))</td></tr>
<tr><td class="num" id="LN3807">3807</td><td class="line">		<span class='keyword'>return</span> parse_dirstat_opt(options, <span class='string_literal'>"files"</span>);</td></tr>
<tr><td class="num" id="LN3808">3808</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(arg, <span class='string_literal'>"--dirstat-by-file="</span>, &amp;arg)) {</td></tr>
<tr><td class="num" id="LN3809">3809</td><td class="line">		parse_dirstat_opt(options, <span class='string_literal'>"files"</span>);</td></tr>
<tr><td class="num" id="LN3810">3810</td><td class="line">		<span class='keyword'>return</span> parse_dirstat_opt(options, arg);</td></tr>
<tr><td class="num" id="LN3811">3811</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3812">3812</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--check"</span>))</td></tr>
<tr><td class="num" id="LN3813">3813</td><td class="line">		options-&gt;output_format |= <span class='macro'>DIFF_FORMAT_CHECKDIFF<span class='expansion'>0x0400</span></span>;</td></tr>
<tr><td class="num" id="LN3814">3814</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--summary"</span>))</td></tr>
<tr><td class="num" id="LN3815">3815</td><td class="line">		options-&gt;output_format |= <span class='macro'>DIFF_FORMAT_SUMMARY<span class='expansion'>0x0008</span></span>;</td></tr>
<tr><td class="num" id="LN3816">3816</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--patch-with-stat"</span>)) {</td></tr>
<tr><td class="num" id="LN3817">3817</td><td class="line">		enable_patch_output(&amp;options-&gt;output_format);</td></tr>
<tr><td class="num" id="LN3818">3818</td><td class="line">		options-&gt;output_format |= <span class='macro'>DIFF_FORMAT_DIFFSTAT<span class='expansion'>0x0002</span></span>;</td></tr>
<tr><td class="num" id="LN3819">3819</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--name-only"</span>))</td></tr>
<tr><td class="num" id="LN3820">3820</td><td class="line">		options-&gt;output_format |= <span class='macro'>DIFF_FORMAT_NAME<span class='expansion'>0x0100</span></span>;</td></tr>
<tr><td class="num" id="LN3821">3821</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--name-status"</span>))</td></tr>
<tr><td class="num" id="LN3822">3822</td><td class="line">		options-&gt;output_format |= <span class='macro'>DIFF_FORMAT_NAME_STATUS<span class='expansion'>0x0200</span></span>;</td></tr>
<tr><td class="num" id="LN3823">3823</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"-s"</span>) || !strcmp(arg, <span class='string_literal'>"--no-patch"</span>))</td></tr>
<tr><td class="num" id="LN3824">3824</td><td class="line">		options-&gt;output_format |= <span class='macro'>DIFF_FORMAT_NO_OUTPUT<span class='expansion'>0x0800</span></span>;</td></tr>
<tr><td class="num" id="LN3825">3825</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (starts_with(arg, <span class='string_literal'>"--stat"</span>))</td></tr>
<tr><td class="num" id="LN3826">3826</td><td class="line">		<span class='comment'>/* --stat, --stat-width, --stat-name-width, or --stat-count */</span></td></tr>
<tr><td class="num" id="LN3827">3827</td><td class="line">		<span class='keyword'>return</span> stat_opt(options, av);</td></tr>
<tr><td class="num" id="LN3828">3828</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3829">3829</td><td class="line">	<span class='comment'>/* renames options */</span></td></tr>
<tr><td class="num" id="LN3830">3830</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (starts_with(arg, <span class='string_literal'>"-B"</span>) || starts_with(arg, <span class='string_literal'>"--break-rewrites="</span>) ||</td></tr>
<tr><td class="num" id="LN3831">3831</td><td class="line">		 !strcmp(arg, <span class='string_literal'>"--break-rewrites"</span>)) {</td></tr>
<tr><td class="num" id="LN3832">3832</td><td class="line">		<span class='keyword'>if</span> ((options-&gt;break_opt = diff_scoreopt_parse(arg)) == -1)</td></tr>
<tr><td class="num" id="LN3833">3833</td><td class="line">			<span class='keyword'>return</span> <span class='macro'>error(<span class='string_literal'>"invalid argument to -B: %s"</span>, arg+2)<span class='expansion'>(error("invalid argument to -B: %s", arg+2), const_error())</span></span>;</td></tr>
<tr><td class="num" id="LN3834">3834</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3835">3835</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (starts_with(arg, <span class='string_literal'>"-M"</span>) || starts_with(arg, <span class='string_literal'>"--find-renames="</span>) ||</td></tr>
<tr><td class="num" id="LN3836">3836</td><td class="line">		 !strcmp(arg, <span class='string_literal'>"--find-renames"</span>)) {</td></tr>
<tr><td class="num" id="LN3837">3837</td><td class="line">		<span class='keyword'>if</span> ((options-&gt;rename_score = diff_scoreopt_parse(arg)) == -1)</td></tr>
<tr><td class="num" id="LN3838">3838</td><td class="line">			<span class='keyword'>return</span> <span class='macro'>error(<span class='string_literal'>"invalid argument to -M: %s"</span>, arg+2)<span class='expansion'>(error("invalid argument to -M: %s", arg+2), const_error())</span></span>;</td></tr>
<tr><td class="num" id="LN3839">3839</td><td class="line">		options-&gt;detect_rename = <span class='macro'>DIFF_DETECT_RENAME<span class='expansion'>1</span></span>;</td></tr>
<tr><td class="num" id="LN3840">3840</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3841">3841</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"-D"</span>) || !strcmp(arg, <span class='string_literal'>"--irreversible-delete"</span>)) {</td></tr>
<tr><td class="num" id="LN3842">3842</td><td class="line">		options-&gt;irreversible_delete = 1;</td></tr>
<tr><td class="num" id="LN3843">3843</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3844">3844</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (starts_with(arg, <span class='string_literal'>"-C"</span>) || starts_with(arg, <span class='string_literal'>"--find-copies="</span>) ||</td></tr>
<tr><td class="num" id="LN3845">3845</td><td class="line">		 !strcmp(arg, <span class='string_literal'>"--find-copies"</span>)) {</td></tr>
<tr><td class="num" id="LN3846">3846</td><td class="line">		<span class='keyword'>if</span> (options-&gt;detect_rename == <span class='macro'>DIFF_DETECT_COPY<span class='expansion'>2</span></span>)</td></tr>
<tr><td class="num" id="LN3847">3847</td><td class="line">			<span class='macro'>DIFF_OPT_SET(options, FIND_COPIES_HARDER)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 6)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 6)))</span></span>;</td></tr>
<tr><td class="num" id="LN3848">3848</td><td class="line">		<span class='keyword'>if</span> ((options-&gt;rename_score = diff_scoreopt_parse(arg)) == -1)</td></tr>
<tr><td class="num" id="LN3849">3849</td><td class="line">			<span class='keyword'>return</span> <span class='macro'>error(<span class='string_literal'>"invalid argument to -C: %s"</span>, arg+2)<span class='expansion'>(error("invalid argument to -C: %s", arg+2), const_error())</span></span>;</td></tr>
<tr><td class="num" id="LN3850">3850</td><td class="line">		options-&gt;detect_rename = <span class='macro'>DIFF_DETECT_COPY<span class='expansion'>2</span></span>;</td></tr>
<tr><td class="num" id="LN3851">3851</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3852">3852</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--no-renames"</span>))</td></tr>
<tr><td class="num" id="LN3853">3853</td><td class="line">		options-&gt;detect_rename = 0;</td></tr>
<tr><td class="num" id="LN3854">3854</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--rename-empty"</span>))</td></tr>
<tr><td class="num" id="LN3855">3855</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, RENAME_EMPTY)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 8)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 8)))</span></span>;</td></tr>
<tr><td class="num" id="LN3856">3856</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--no-rename-empty"</span>))</td></tr>
<tr><td class="num" id="LN3857">3857</td><td class="line">		<span class='macro'>DIFF_OPT_CLR(options, RENAME_EMPTY)<span class='expansion'>(((options)-&gt;flags &amp;= ~(1 &lt;&lt; 8)),((options)-&gt;<br>touched_flags |= (1 &lt;&lt; 8)))</span></span>;</td></tr>
<tr><td class="num" id="LN3858">3858</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--relative"</span>))</td></tr>
<tr><td class="num" id="LN3859">3859</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, RELATIVE_NAME)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 17)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 17)))</span></span>;</td></tr>
<tr><td class="num" id="LN3860">3860</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(arg, <span class='string_literal'>"--relative="</span>, &amp;arg)) {</td></tr>
<tr><td class="num" id="LN3861">3861</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, RELATIVE_NAME)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 17)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 17)))</span></span>;</td></tr>
<tr><td class="num" id="LN3862">3862</td><td class="line">		options-&gt;prefix = arg;</td></tr>
<tr><td class="num" id="LN3863">3863</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3864">3864</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3865">3865</td><td class="line">	<span class='comment'>/* xdiff options */</span></td></tr>
<tr><td class="num" id="LN3866">3866</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--minimal"</span>))</td></tr>
<tr><td class="num" id="LN3867">3867</td><td class="line">		<span class='macro'>DIFF_XDL_SET(options, NEED_MINIMAL)<span class='expansion'>((options)-&gt;xdl_opts |= (1 &lt;&lt; 1))</span></span>;</td></tr>
<tr><td class="num" id="LN3868">3868</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--no-minimal"</span>))</td></tr>
<tr><td class="num" id="LN3869">3869</td><td class="line">		<span class='macro'>DIFF_XDL_CLR(options, NEED_MINIMAL)<span class='expansion'>((options)-&gt;xdl_opts &amp;= ~(1 &lt;&lt; 1))</span></span>;</td></tr>
<tr><td class="num" id="LN3870">3870</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"-w"</span>) || !strcmp(arg, <span class='string_literal'>"--ignore-all-space"</span>))</td></tr>
<tr><td class="num" id="LN3871">3871</td><td class="line">		<span class='macro'>DIFF_XDL_SET(options, IGNORE_WHITESPACE)<span class='expansion'>((options)-&gt;xdl_opts |= (1 &lt;&lt; 2))</span></span>;</td></tr>
<tr><td class="num" id="LN3872">3872</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"-b"</span>) || !strcmp(arg, <span class='string_literal'>"--ignore-space-change"</span>))</td></tr>
<tr><td class="num" id="LN3873">3873</td><td class="line">		<span class='macro'>DIFF_XDL_SET(options, IGNORE_WHITESPACE_CHANGE)<span class='expansion'>((options)-&gt;xdl_opts |= (1 &lt;&lt; 3))</span></span>;</td></tr>
<tr><td class="num" id="LN3874">3874</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--ignore-space-at-eol"</span>))</td></tr>
<tr><td class="num" id="LN3875">3875</td><td class="line">		<span class='macro'>DIFF_XDL_SET(options, IGNORE_WHITESPACE_AT_EOL)<span class='expansion'>((options)-&gt;xdl_opts |= (1 &lt;&lt; 4))</span></span>;</td></tr>
<tr><td class="num" id="LN3876">3876</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--ignore-blank-lines"</span>))</td></tr>
<tr><td class="num" id="LN3877">3877</td><td class="line">		<span class='macro'>DIFF_XDL_SET(options, IGNORE_BLANK_LINES)<span class='expansion'>((options)-&gt;xdl_opts |= (1 &lt;&lt; 7))</span></span>;</td></tr>
<tr><td class="num" id="LN3878">3878</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--indent-heuristic"</span>))</td></tr>
<tr><td class="num" id="LN3879">3879</td><td class="line">		<span class='macro'>DIFF_XDL_SET(options, INDENT_HEURISTIC)<span class='expansion'>((options)-&gt;xdl_opts |= (1 &lt;&lt; 8))</span></span>;</td></tr>
<tr><td class="num" id="LN3880">3880</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--no-indent-heuristic"</span>))</td></tr>
<tr><td class="num" id="LN3881">3881</td><td class="line">		<span class='macro'>DIFF_XDL_CLR(options, INDENT_HEURISTIC)<span class='expansion'>((options)-&gt;xdl_opts &amp;= ~(1 &lt;&lt; 8))</span></span>;</td></tr>
<tr><td class="num" id="LN3882">3882</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--patience"</span>))</td></tr>
<tr><td class="num" id="LN3883">3883</td><td class="line">		options-&gt;xdl_opts = <span class='macro'>DIFF_WITH_ALG(options, PATIENCE_DIFF)<span class='expansion'>(((options)-&gt;xdl_opts &amp; ~((1 &lt;&lt; 5) | (1 &lt;&lt;<br> 6))) | (1 &lt;&lt; 5))</span></span>;</td></tr>
<tr><td class="num" id="LN3884">3884</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--histogram"</span>))</td></tr>
<tr><td class="num" id="LN3885">3885</td><td class="line">		options-&gt;xdl_opts = <span class='macro'>DIFF_WITH_ALG(options, HISTOGRAM_DIFF)<span class='expansion'>(((options)-&gt;xdl_opts &amp; ~((1 &lt;&lt; 5) | (1 &lt;&lt;<br> 6))) | (1 &lt;&lt; 6))</span></span>;</td></tr>
<tr><td class="num" id="LN3886">3886</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> ((argcount = parse_long_opt(<span class='string_literal'>"diff-algorithm"</span>, av, &amp;optarg))) {</td></tr>
<tr><td class="num" id="LN3887">3887</td><td class="line">		<span class='keyword'>long</span> value = parse_algorithm_value(optarg);</td></tr>
<tr><td class="num" id="LN3888">3888</td><td class="line">		<span class='keyword'>if</span> (value &lt; 0)</td></tr>
<tr><td class="num" id="LN3889">3889</td><td class="line">			<span class='keyword'>return</span> <span class='macro'>error(<span class='string_literal'>"option diff-algorithm accepts \"myers\", "<span class='expansion'>(error("option diff-algorithm accepts \"myers\", " "\"minimal\", \"patience\" and \"histogram\""<br>), const_error())</span></span></span></td></tr>
<tr><td class="num" id="LN3890">3890</td><td class="line">				     <span class='string_literal'><span class='macro'>"\"minimal\", \"patience\" and \"histogram\""</span>)<span class='expansion'>(error("option diff-algorithm accepts \"myers\", " "\"minimal\", \"patience\" and \"histogram\""<br>), const_error())</span></span>;</td></tr>
<tr><td class="num" id="LN3891">3891</td><td class="line">		<span class='comment'>/* clear out previous settings */</span></td></tr>
<tr><td class="num" id="LN3892">3892</td><td class="line">		<span class='macro'>DIFF_XDL_CLR(options, NEED_MINIMAL)<span class='expansion'>((options)-&gt;xdl_opts &amp;= ~(1 &lt;&lt; 1))</span></span>;</td></tr>
<tr><td class="num" id="LN3893">3893</td><td class="line">		options-&gt;xdl_opts &amp;= ~<span class='macro'>XDF_DIFF_ALGORITHM_MASK<span class='expansion'>((1 &lt;&lt; 5) | (1 &lt;&lt; 6))</span></span>;</td></tr>
<tr><td class="num" id="LN3894">3894</td><td class="line">		options-&gt;xdl_opts |= value;</td></tr>
<tr><td class="num" id="LN3895">3895</td><td class="line">		<span class='keyword'>return</span> argcount;</td></tr>
<tr><td class="num" id="LN3896">3896</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3897">3897</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3898">3898</td><td class="line">	<span class='comment'>/* flags options */</span></td></tr>
<tr><td class="num" id="LN3899">3899</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--binary"</span>)) {</td></tr>
<tr><td class="num" id="LN3900">3900</td><td class="line">		enable_patch_output(&amp;options-&gt;output_format);</td></tr>
<tr><td class="num" id="LN3901">3901</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, BINARY)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 2)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 2)))</span></span>;</td></tr>
<tr><td class="num" id="LN3902">3902</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3903">3903</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--full-index"</span>))</td></tr>
<tr><td class="num" id="LN3904">3904</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, FULL_INDEX)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 4)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 4)))</span></span>;</td></tr>
<tr><td class="num" id="LN3905">3905</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"-a"</span>) || !strcmp(arg, <span class='string_literal'>"--text"</span>))</td></tr>
<tr><td class="num" id="LN3906">3906</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, TEXT)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 3)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 3)))</span></span>;</td></tr>
<tr><td class="num" id="LN3907">3907</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"-R"</span>))</td></tr>
<tr><td class="num" id="LN3908">3908</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, REVERSE_DIFF)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 15)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 15)))</span></span>;</td></tr>
<tr><td class="num" id="LN3909">3909</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--find-copies-harder"</span>))</td></tr>
<tr><td class="num" id="LN3910">3910</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, FIND_COPIES_HARDER)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 6)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 6)))</span></span>;</td></tr>
<tr><td class="num" id="LN3911">3911</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--follow"</span>))</td></tr>
<tr><td class="num" id="LN3912">3912</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, FOLLOW_RENAMES)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 7)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 7)))</span></span>;</td></tr>
<tr><td class="num" id="LN3913">3913</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--no-follow"</span>)) {</td></tr>
<tr><td class="num" id="LN3914">3914</td><td class="line">		<span class='macro'>DIFF_OPT_CLR(options, FOLLOW_RENAMES)<span class='expansion'>(((options)-&gt;flags &amp;= ~(1 &lt;&lt; 7)),((options)-&gt;<br>touched_flags |= (1 &lt;&lt; 7)))</span></span>;</td></tr>
<tr><td class="num" id="LN3915">3915</td><td class="line">		<span class='macro'>DIFF_OPT_CLR(options, DEFAULT_FOLLOW_RENAMES)<span class='expansion'>(((options)-&gt;flags &amp;= ~(1U &lt;&lt; 31)),((options)-&gt;<br>touched_flags |= (1U &lt;&lt; 31)))</span></span>;</td></tr>
<tr><td class="num" id="LN3916">3916</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--color"</span>))</td></tr>
<tr><td class="num" id="LN3917">3917</td><td class="line">		options-&gt;use_color = 1;</td></tr>
<tr><td class="num" id="LN3918">3918</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(arg, <span class='string_literal'>"--color="</span>, &amp;arg)) {</td></tr>
<tr><td class="num" id="LN3919">3919</td><td class="line">		<span class='keyword'>int</span> value = git_config_colorbool(<span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, arg);</td></tr>
<tr><td class="num" id="LN3920">3920</td><td class="line">		<span class='keyword'>if</span> (value &lt; 0)</td></tr>
<tr><td class="num" id="LN3921">3921</td><td class="line">			<span class='keyword'>return</span> <span class='macro'>error(<span class='string_literal'>"option `color' expects \"always\", \"auto\", or \"never\""</span>)<span class='expansion'>(error("option `color' expects \"always\", \"auto\", or \"never\""<br>), const_error())</span></span>;</td></tr>
<tr><td class="num" id="LN3922">3922</td><td class="line">		options-&gt;use_color = value;</td></tr>
<tr><td class="num" id="LN3923">3923</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3924">3924</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--no-color"</span>))</td></tr>
<tr><td class="num" id="LN3925">3925</td><td class="line">		options-&gt;use_color = 0;</td></tr>
<tr><td class="num" id="LN3926">3926</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--color-words"</span>)) {</td></tr>
<tr><td class="num" id="LN3927">3927</td><td class="line">		options-&gt;use_color = 1;</td></tr>
<tr><td class="num" id="LN3928">3928</td><td class="line">		options-&gt;word_diff = DIFF_WORDS_COLOR;</td></tr>
<tr><td class="num" id="LN3929">3929</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3930">3930</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(arg, <span class='string_literal'>"--color-words="</span>, &amp;arg)) {</td></tr>
<tr><td class="num" id="LN3931">3931</td><td class="line">		options-&gt;use_color = 1;</td></tr>
<tr><td class="num" id="LN3932">3932</td><td class="line">		options-&gt;word_diff = DIFF_WORDS_COLOR;</td></tr>
<tr><td class="num" id="LN3933">3933</td><td class="line">		options-&gt;word_regex = arg;</td></tr>
<tr><td class="num" id="LN3934">3934</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3935">3935</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--word-diff"</span>)) {</td></tr>
<tr><td class="num" id="LN3936">3936</td><td class="line">		<span class='keyword'>if</span> (options-&gt;word_diff == DIFF_WORDS_NONE)</td></tr>
<tr><td class="num" id="LN3937">3937</td><td class="line">			options-&gt;word_diff = DIFF_WORDS_PLAIN;</td></tr>
<tr><td class="num" id="LN3938">3938</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3939">3939</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(arg, <span class='string_literal'>"--word-diff="</span>, &amp;arg)) {</td></tr>
<tr><td class="num" id="LN3940">3940</td><td class="line">		<span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"plain"</span>))</td></tr>
<tr><td class="num" id="LN3941">3941</td><td class="line">			options-&gt;word_diff = DIFF_WORDS_PLAIN;</td></tr>
<tr><td class="num" id="LN3942">3942</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"color"</span>)) {</td></tr>
<tr><td class="num" id="LN3943">3943</td><td class="line">			options-&gt;use_color = 1;</td></tr>
<tr><td class="num" id="LN3944">3944</td><td class="line">			options-&gt;word_diff = DIFF_WORDS_COLOR;</td></tr>
<tr><td class="num" id="LN3945">3945</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN3946">3946</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"porcelain"</span>))</td></tr>
<tr><td class="num" id="LN3947">3947</td><td class="line">			options-&gt;word_diff = DIFF_WORDS_PORCELAIN;</td></tr>
<tr><td class="num" id="LN3948">3948</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"none"</span>))</td></tr>
<tr><td class="num" id="LN3949">3949</td><td class="line">			options-&gt;word_diff = DIFF_WORDS_NONE;</td></tr>
<tr><td class="num" id="LN3950">3950</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN3951">3951</td><td class="line">			die(<span class='string_literal'>"bad --word-diff argument: %s"</span>, arg);</td></tr>
<tr><td class="num" id="LN3952">3952</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3953">3953</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> ((argcount = parse_long_opt(<span class='string_literal'>"word-diff-regex"</span>, av, &amp;optarg))) {</td></tr>
<tr><td class="num" id="LN3954">3954</td><td class="line">		<span class='keyword'>if</span> (options-&gt;word_diff == DIFF_WORDS_NONE)</td></tr>
<tr><td class="num" id="LN3955">3955</td><td class="line">			options-&gt;word_diff = DIFF_WORDS_PLAIN;</td></tr>
<tr><td class="num" id="LN3956">3956</td><td class="line">		options-&gt;word_regex = optarg;</td></tr>
<tr><td class="num" id="LN3957">3957</td><td class="line">		<span class='keyword'>return</span> argcount;</td></tr>
<tr><td class="num" id="LN3958">3958</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3959">3959</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--exit-code"</span>))</td></tr>
<tr><td class="num" id="LN3960">3960</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, EXIT_WITH_STATUS)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 14)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 14)))</span></span>;</td></tr>
<tr><td class="num" id="LN3961">3961</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--quiet"</span>))</td></tr>
<tr><td class="num" id="LN3962">3962</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, QUICK)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 11)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 11)))</span></span>;</td></tr>
<tr><td class="num" id="LN3963">3963</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--ext-diff"</span>))</td></tr>
<tr><td class="num" id="LN3964">3964</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, ALLOW_EXTERNAL)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 13)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 13)))</span></span>;</td></tr>
<tr><td class="num" id="LN3965">3965</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--no-ext-diff"</span>))</td></tr>
<tr><td class="num" id="LN3966">3966</td><td class="line">		<span class='macro'>DIFF_OPT_CLR(options, ALLOW_EXTERNAL)<span class='expansion'>(((options)-&gt;flags &amp;= ~(1 &lt;&lt; 13)),((options)-&gt;<br>touched_flags |= (1 &lt;&lt; 13)))</span></span>;</td></tr>
<tr><td class="num" id="LN3967">3967</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--textconv"</span>))</td></tr>
<tr><td class="num" id="LN3968">3968</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, ALLOW_TEXTCONV)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 21)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 21)))</span></span>;</td></tr>
<tr><td class="num" id="LN3969">3969</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--no-textconv"</span>))</td></tr>
<tr><td class="num" id="LN3970">3970</td><td class="line">		<span class='macro'>DIFF_OPT_CLR(options, ALLOW_TEXTCONV)<span class='expansion'>(((options)-&gt;flags &amp;= ~(1 &lt;&lt; 21)),((options)-&gt;<br>touched_flags |= (1 &lt;&lt; 21)))</span></span>;</td></tr>
<tr><td class="num" id="LN3971">3971</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--ignore-submodules"</span>)) {</td></tr>
<tr><td class="num" id="LN3972">3972</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, OVERRIDE_SUBMODULE_CONFIG)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 27)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 27)))</span></span>;</td></tr>
<tr><td class="num" id="LN3973">3973</td><td class="line">		handle_ignore_submodules_arg(options, <span class='string_literal'>"all"</span>);</td></tr>
<tr><td class="num" id="LN3974">3974</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(arg, <span class='string_literal'>"--ignore-submodules="</span>, &amp;arg)) {</td></tr>
<tr><td class="num" id="LN3975">3975</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, OVERRIDE_SUBMODULE_CONFIG)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 27)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 27)))</span></span>;</td></tr>
<tr><td class="num" id="LN3976">3976</td><td class="line">		handle_ignore_submodules_arg(options, arg);</td></tr>
<tr><td class="num" id="LN3977">3977</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--submodule"</span>))</td></tr>
<tr><td class="num" id="LN3978">3978</td><td class="line">		options-&gt;submodule_format = DIFF_SUBMODULE_LOG;</td></tr>
<tr><td class="num" id="LN3979">3979</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(arg, <span class='string_literal'>"--submodule="</span>, &amp;arg))</td></tr>
<tr><td class="num" id="LN3980">3980</td><td class="line">		<span class='keyword'>return</span> parse_submodule_opt(options, arg);</td></tr>
<tr><td class="num" id="LN3981">3981</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(arg, <span class='string_literal'>"--ws-error-highlight="</span>, &amp;arg))</td></tr>
<tr><td class="num" id="LN3982">3982</td><td class="line">		<span class='keyword'>return</span> parse_ws_error_highlight_opt(options, arg);</td></tr>
<tr><td class="num" id="LN3983">3983</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--ita-invisible-in-index"</span>))</td></tr>
<tr><td class="num" id="LN3984">3984</td><td class="line">		options-&gt;ita_invisible_in_index = 1;</td></tr>
<tr><td class="num" id="LN3985">3985</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--ita-visible-in-index"</span>))</td></tr>
<tr><td class="num" id="LN3986">3986</td><td class="line">		options-&gt;ita_invisible_in_index = 0;</td></tr>
<tr><td class="num" id="LN3987">3987</td><td class="line"> </td></tr>
<tr><td class="num" id="LN3988">3988</td><td class="line">	<span class='comment'>/* misc options */</span></td></tr>
<tr><td class="num" id="LN3989">3989</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"-z"</span>))</td></tr>
<tr><td class="num" id="LN3990">3990</td><td class="line">		options-&gt;line_termination = 0;</td></tr>
<tr><td class="num" id="LN3991">3991</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> ((argcount = short_opt('l', av, &amp;optarg))) {</td></tr>
<tr><td class="num" id="LN3992">3992</td><td class="line">		options-&gt;rename_limit = strtoul(optarg, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 10);</td></tr>
<tr><td class="num" id="LN3993">3993</td><td class="line">		<span class='keyword'>return</span> argcount;</td></tr>
<tr><td class="num" id="LN3994">3994</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN3995">3995</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> ((argcount = short_opt('S', av, &amp;optarg))) {</td></tr>
<tr><td class="num" id="LN3996">3996</td><td class="line">		options-&gt;pickaxe = optarg;</td></tr>
<tr><td class="num" id="LN3997">3997</td><td class="line">		options-&gt;pickaxe_opts |= <span class='macro'>DIFF_PICKAXE_KIND_S<span class='expansion'>4</span></span>;</td></tr>
<tr><td class="num" id="LN3998">3998</td><td class="line">		<span class='keyword'>return</span> argcount;</td></tr>
<tr><td class="num" id="LN3999">3999</td><td class="line">	} <span class='keyword'>else</span> <span class='keyword'>if</span> ((argcount = short_opt('G', av, &amp;optarg))) {</td></tr>
<tr><td class="num" id="LN4000">4000</td><td class="line">		options-&gt;pickaxe = optarg;</td></tr>
<tr><td class="num" id="LN4001">4001</td><td class="line">		options-&gt;pickaxe_opts |= <span class='macro'>DIFF_PICKAXE_KIND_G<span class='expansion'>8</span></span>;</td></tr>
<tr><td class="num" id="LN4002">4002</td><td class="line">		<span class='keyword'>return</span> argcount;</td></tr>
<tr><td class="num" id="LN4003">4003</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4004">4004</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--pickaxe-all"</span>))</td></tr>
<tr><td class="num" id="LN4005">4005</td><td class="line">		options-&gt;pickaxe_opts |= <span class='macro'>DIFF_PICKAXE_ALL<span class='expansion'>1</span></span>;</td></tr>
<tr><td class="num" id="LN4006">4006</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--pickaxe-regex"</span>))</td></tr>
<tr><td class="num" id="LN4007">4007</td><td class="line">		options-&gt;pickaxe_opts |= <span class='macro'>DIFF_PICKAXE_REGEX<span class='expansion'>2</span></span>;</td></tr>
<tr><td class="num" id="LN4008">4008</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> ((argcount = short_opt('O', av, &amp;optarg))) {</td></tr>
<tr><td class="num" id="LN4009">4009</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *path = prefix_filename(prefix, strlen(prefix), optarg);</td></tr>
<tr><td class="num" id="LN4010">4010</td><td class="line">		options-&gt;orderfile = xstrdup(path);</td></tr>
<tr><td class="num" id="LN4011">4011</td><td class="line">		<span class='keyword'>return</span> argcount;</td></tr>
<tr><td class="num" id="LN4012">4012</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4013">4013</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> ((argcount = parse_long_opt(<span class='string_literal'>"diff-filter"</span>, av, &amp;optarg))) {</td></tr>
<tr><td class="num" id="LN4014">4014</td><td class="line">		<span class='keyword'>int</span> offending = parse_diff_filter_opt(optarg, options);</td></tr>
<tr><td class="num" id="LN4015">4015</td><td class="line">		<span class='keyword'>if</span> (offending)</td></tr>
<tr><td class="num" id="LN4016">4016</td><td class="line">			die(<span class='string_literal'>"unknown change class '%c' in --diff-filter=%s"</span>,</td></tr>
<tr><td class="num" id="LN4017">4017</td><td class="line">			    offending, optarg);</td></tr>
<tr><td class="num" id="LN4018">4018</td><td class="line">		<span class='keyword'>return</span> argcount;</td></tr>
<tr><td class="num" id="LN4019">4019</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4020">4020</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--no-abbrev"</span>))</td></tr>
<tr><td class="num" id="LN4021">4021</td><td class="line">		options-&gt;abbrev = 0;</td></tr>
<tr><td class="num" id="LN4022">4022</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--abbrev"</span>))</td></tr>
<tr><td class="num" id="LN4023">4023</td><td class="line">		options-&gt;abbrev = <span class='macro'>DEFAULT_ABBREV<span class='expansion'>default_abbrev</span></span>;</td></tr>
<tr><td class="num" id="LN4024">4024</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(arg, <span class='string_literal'>"--abbrev="</span>, &amp;arg)) {</td></tr>
<tr><td class="num" id="LN4025">4025</td><td class="line">		options-&gt;abbrev = strtoul(arg, <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>, 10);</td></tr>
<tr><td class="num" id="LN4026">4026</td><td class="line">		<span class='keyword'>if</span> (options-&gt;abbrev &lt; <span class='macro'>MINIMUM_ABBREV<span class='expansion'>minimum_abbrev</span></span>)</td></tr>
<tr><td class="num" id="LN4027">4027</td><td class="line">			options-&gt;abbrev = <span class='macro'>MINIMUM_ABBREV<span class='expansion'>minimum_abbrev</span></span>;</td></tr>
<tr><td class="num" id="LN4028">4028</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (40 &lt; options-&gt;abbrev)</td></tr>
<tr><td class="num" id="LN4029">4029</td><td class="line">			options-&gt;abbrev = 40;</td></tr>
<tr><td class="num" id="LN4030">4030</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4031">4031</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> ((argcount = parse_long_opt(<span class='string_literal'>"src-prefix"</span>, av, &amp;optarg))) {</td></tr>
<tr><td class="num" id="LN4032">4032</td><td class="line">		options-&gt;a_prefix = optarg;</td></tr>
<tr><td class="num" id="LN4033">4033</td><td class="line">		<span class='keyword'>return</span> argcount;</td></tr>
<tr><td class="num" id="LN4034">4034</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4035">4035</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> ((argcount = parse_long_opt(<span class='string_literal'>"line-prefix"</span>, av, &amp;optarg))) {</td></tr>
<tr><td class="num" id="LN4036">4036</td><td class="line">		options-&gt;line_prefix = optarg;</td></tr>
<tr><td class="num" id="LN4037">4037</td><td class="line">		options-&gt;line_prefix_length = strlen(options-&gt;line_prefix);</td></tr>
<tr><td class="num" id="LN4038">4038</td><td class="line">		graph_setup_line_prefix(options);</td></tr>
<tr><td class="num" id="LN4039">4039</td><td class="line">		<span class='keyword'>return</span> argcount;</td></tr>
<tr><td class="num" id="LN4040">4040</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4041">4041</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> ((argcount = parse_long_opt(<span class='string_literal'>"dst-prefix"</span>, av, &amp;optarg))) {</td></tr>
<tr><td class="num" id="LN4042">4042</td><td class="line">		options-&gt;b_prefix = optarg;</td></tr>
<tr><td class="num" id="LN4043">4043</td><td class="line">		<span class='keyword'>return</span> argcount;</td></tr>
<tr><td class="num" id="LN4044">4044</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4045">4045</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--no-prefix"</span>))</td></tr>
<tr><td class="num" id="LN4046">4046</td><td class="line">		options-&gt;a_prefix = options-&gt;b_prefix = <span class='string_literal'>""</span>;</td></tr>
<tr><td class="num" id="LN4047">4047</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (opt_arg(arg, '\0', <span class='string_literal'>"inter-hunk-context"</span>,</td></tr>
<tr><td class="num" id="LN4048">4048</td><td class="line">			 &amp;options-&gt;interhunkcontext))</td></tr>
<tr><td class="num" id="LN4049">4049</td><td class="line">		;</td></tr>
<tr><td class="num" id="LN4050">4050</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"-W"</span>))</td></tr>
<tr><td class="num" id="LN4051">4051</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, FUNCCONTEXT)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 29)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 29)))</span></span>;</td></tr>
<tr><td class="num" id="LN4052">4052</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--function-context"</span>))</td></tr>
<tr><td class="num" id="LN4053">4053</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, FUNCCONTEXT)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 29)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 29)))</span></span>;</td></tr>
<tr><td class="num" id="LN4054">4054</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (!strcmp(arg, <span class='string_literal'>"--no-function-context"</span>))</td></tr>
<tr><td class="num" id="LN4055">4055</td><td class="line">		<span class='macro'>DIFF_OPT_CLR(options, FUNCCONTEXT)<span class='expansion'>(((options)-&gt;flags &amp;= ~(1 &lt;&lt; 29)),((options)-&gt;<br>touched_flags |= (1 &lt;&lt; 29)))</span></span>;</td></tr>
<tr><td class="num" id="LN4056">4056</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> ((argcount = parse_long_opt(<span class='string_literal'>"output"</span>, av, &amp;optarg))) {</td></tr>
<tr><td class="num" id="LN4057">4057</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *path = prefix_filename(prefix, strlen(prefix), optarg);</td></tr>
<tr><td class="num" id="LN4058">4058</td><td class="line">		options-&gt;file = fopen(path, <span class='string_literal'>"w"</span>);</td></tr>
<tr><td class="num" id="LN4059">4059</td><td class="line">		<span class='keyword'>if</span> (!options-&gt;file)</td></tr>
<tr><td class="num" id="LN4060">4060</td><td class="line">			die_errno(<span class='string_literal'>"Could not open '%s'"</span>, path);</td></tr>
<tr><td class="num" id="LN4061">4061</td><td class="line">		options-&gt;close_file = 1;</td></tr>
<tr><td class="num" id="LN4062">4062</td><td class="line">		<span class='keyword'>if</span> (options-&gt;use_color != <span class='macro'>GIT_COLOR_ALWAYS<span class='expansion'>1</span></span>)</td></tr>
<tr><td class="num" id="LN4063">4063</td><td class="line">			options-&gt;use_color = <span class='macro'>GIT_COLOR_NEVER<span class='expansion'>0</span></span>;</td></tr>
<tr><td class="num" id="LN4064">4064</td><td class="line">		<span class='keyword'>return</span> argcount;</td></tr>
<tr><td class="num" id="LN4065">4065</td><td class="line">	} <span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN4066">4066</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN4067">4067</td><td class="line">	<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN4068">4068</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4069">4069</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4070">4070</td><td class="line"><span class='keyword'>int</span> parse_rename_score(<span class='keyword'>const</span> <span class='keyword'>char</span> **cp_p)</td></tr>
<tr><td class="num" id="LN4071">4071</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4072">4072</td><td class="line">	<span class='keyword'>unsigned</span> <span class='keyword'>long</span> num, scale;</td></tr>
<tr><td class="num" id="LN4073">4073</td><td class="line">	<span class='keyword'>int</span> ch, dot;</td></tr>
<tr><td class="num" id="LN4074">4074</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *cp = *cp_p;</td></tr>
<tr><td class="num" id="LN4075">4075</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4076">4076</td><td class="line">	num = 0;</td></tr>
<tr><td class="num" id="LN4077">4077</td><td class="line">	scale = 1;</td></tr>
<tr><td class="num" id="LN4078">4078</td><td class="line">	dot = 0;</td></tr>
<tr><td class="num" id="LN4079">4079</td><td class="line">	<span class='keyword'>for</span> (;;) {</td></tr>
<tr><td class="num" id="LN4080">4080</td><td class="line">		ch = *cp;</td></tr>
<tr><td class="num" id="LN4081">4081</td><td class="line">		<span class='keyword'>if</span> ( !dot &amp;&amp; ch == '.' ) {</td></tr>
<tr><td class="num" id="LN4082">4082</td><td class="line">			scale = 1;</td></tr>
<tr><td class="num" id="LN4083">4083</td><td class="line">			dot = 1;</td></tr>
<tr><td class="num" id="LN4084">4084</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> ( ch == '%' ) {</td></tr>
<tr><td class="num" id="LN4085">4085</td><td class="line">			scale = dot ? scale*100 : 100;</td></tr>
<tr><td class="num" id="LN4086">4086</td><td class="line">			cp++;	<span class='comment'>/* % is always at the end */</span></td></tr>
<tr><td class="num" id="LN4087">4087</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN4088">4088</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> ( ch &gt;= '0' &amp;&amp; ch &lt;= '9' ) {</td></tr>
<tr><td class="num" id="LN4089">4089</td><td class="line">			<span class='keyword'>if</span> ( scale &lt; 100000 ) {</td></tr>
<tr><td class="num" id="LN4090">4090</td><td class="line">				scale *= 10;</td></tr>
<tr><td class="num" id="LN4091">4091</td><td class="line">				num = (num*10) + (ch-'0');</td></tr>
<tr><td class="num" id="LN4092">4092</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN4093">4093</td><td class="line">		} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN4094">4094</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN4095">4095</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4096">4096</td><td class="line">		cp++;</td></tr>
<tr><td class="num" id="LN4097">4097</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4098">4098</td><td class="line">	*cp_p = cp;</td></tr>
<tr><td class="num" id="LN4099">4099</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4100">4100</td><td class="line">	<span class='comment'>/* user says num divided by scale and we say internally that</span></td></tr>
<tr><td class="num" id="LN4101">4101</td><td class="line">	 <span class='comment'>* is MAX_SCORE * num / scale.</span></td></tr>
<tr><td class="num" id="LN4102">4102</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN4103">4103</td><td class="line">	<span class='keyword'>return</span> (<span class='keyword'>int</span>)((num &gt;= scale) ? <span class='macro'>MAX_SCORE<span class='expansion'>60000.0</span></span> : (<span class='macro'>MAX_SCORE<span class='expansion'>60000.0</span></span> * num / scale));</td></tr>
<tr><td class="num" id="LN4104">4104</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4105">4105</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4106">4106</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_scoreopt_parse(<span class='keyword'>const</span> <span class='keyword'>char</span> *opt)</td></tr>
<tr><td class="num" id="LN4107">4107</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4108">4108</td><td class="line">	<span class='keyword'>int</span> opt1, opt2, cmd;</td></tr>
<tr><td class="num" id="LN4109">4109</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4110">4110</td><td class="line">	<span class='keyword'>if</span> (*opt++ != '-')</td></tr>
<tr><td class="num" id="LN4111">4111</td><td class="line">		<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN4112">4112</td><td class="line">	cmd = *opt++;</td></tr>
<tr><td class="num" id="LN4113">4113</td><td class="line">	<span class='keyword'>if</span> (cmd == '-') {</td></tr>
<tr><td class="num" id="LN4114">4114</td><td class="line">		<span class='comment'>/* convert the long-form arguments into short-form versions */</span></td></tr>
<tr><td class="num" id="LN4115">4115</td><td class="line">		<span class='keyword'>if</span> (skip_prefix(opt, <span class='string_literal'>"break-rewrites"</span>, &amp;opt)) {</td></tr>
<tr><td class="num" id="LN4116">4116</td><td class="line">			<span class='keyword'>if</span> (*opt == 0 || *opt++ == '=')</td></tr>
<tr><td class="num" id="LN4117">4117</td><td class="line">				cmd = 'B';</td></tr>
<tr><td class="num" id="LN4118">4118</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(opt, <span class='string_literal'>"find-copies"</span>, &amp;opt)) {</td></tr>
<tr><td class="num" id="LN4119">4119</td><td class="line">			<span class='keyword'>if</span> (*opt == 0 || *opt++ == '=')</td></tr>
<tr><td class="num" id="LN4120">4120</td><td class="line">				cmd = 'C';</td></tr>
<tr><td class="num" id="LN4121">4121</td><td class="line">		} <span class='keyword'>else</span> <span class='keyword'>if</span> (skip_prefix(opt, <span class='string_literal'>"find-renames"</span>, &amp;opt)) {</td></tr>
<tr><td class="num" id="LN4122">4122</td><td class="line">			<span class='keyword'>if</span> (*opt == 0 || *opt++ == '=')</td></tr>
<tr><td class="num" id="LN4123">4123</td><td class="line">				cmd = 'M';</td></tr>
<tr><td class="num" id="LN4124">4124</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4125">4125</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4126">4126</td><td class="line">	<span class='keyword'>if</span> (cmd != 'M' &amp;&amp; cmd != 'C' &amp;&amp; cmd != 'B')</td></tr>
<tr><td class="num" id="LN4127">4127</td><td class="line">		<span class='keyword'>return</span> -1; <span class='comment'>/* that is not a -M, -C, or -B option */</span></td></tr>
<tr><td class="num" id="LN4128">4128</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4129">4129</td><td class="line">	opt1 = parse_rename_score(&amp;opt);</td></tr>
<tr><td class="num" id="LN4130">4130</td><td class="line">	<span class='keyword'>if</span> (cmd != 'B')</td></tr>
<tr><td class="num" id="LN4131">4131</td><td class="line">		opt2 = 0;</td></tr>
<tr><td class="num" id="LN4132">4132</td><td class="line">	<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN4133">4133</td><td class="line">		<span class='keyword'>if</span> (*opt == 0)</td></tr>
<tr><td class="num" id="LN4134">4134</td><td class="line">			opt2 = 0;</td></tr>
<tr><td class="num" id="LN4135">4135</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (*opt != '/')</td></tr>
<tr><td class="num" id="LN4136">4136</td><td class="line">			<span class='keyword'>return</span> -1; <span class='comment'>/* we expect -B80/99 or -B80 */</span></td></tr>
<tr><td class="num" id="LN4137">4137</td><td class="line">		<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN4138">4138</td><td class="line">			opt++;</td></tr>
<tr><td class="num" id="LN4139">4139</td><td class="line">			opt2 = parse_rename_score(&amp;opt);</td></tr>
<tr><td class="num" id="LN4140">4140</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4141">4141</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4142">4142</td><td class="line">	<span class='keyword'>if</span> (*opt != 0)</td></tr>
<tr><td class="num" id="LN4143">4143</td><td class="line">		<span class='keyword'>return</span> -1;</td></tr>
<tr><td class="num" id="LN4144">4144</td><td class="line">	<span class='keyword'>return</span> opt1 | (opt2 &lt;&lt; 16);</td></tr>
<tr><td class="num" id="LN4145">4145</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4146">4146</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4147">4147</td><td class="line"><span class='keyword'>struct</span> diff_queue_struct diff_queued_diff;</td></tr>
<tr><td class="num" id="LN4148">4148</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4149">4149</td><td class="line"><span class='keyword'>void</span> diff_q(<span class='keyword'>struct</span> diff_queue_struct *queue, <span class='keyword'>struct</span> diff_filepair *dp)</td></tr>
<tr><td class="num" id="LN4150">4150</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4151">4151</td><td class="line">	<span class='macro'>ALLOC_GROW(queue-&gt;queue, queue-&gt;nr + 1, queue-&gt;alloc)<span class='expansion'>do { if ((queue-&gt;nr + 1) &gt; queue-&gt;alloc) { if ((((queue<br>-&gt;alloc)+16)*3/2) &lt; (queue-&gt;nr + 1)) queue-&gt;alloc<br> = (queue-&gt;nr + 1); else queue-&gt;alloc = (((queue-&gt;alloc<br>)+16)*3/2); (queue-&gt;queue) = xrealloc((queue-&gt;queue), st_mult<br>(sizeof(*(queue-&gt;queue)), (queue-&gt;alloc))); } } while (<br>0)</span></span>;</td></tr>
<tr><td class="num" id="LN4152">4152</td><td class="line">	queue-&gt;queue[queue-&gt;nr++] = dp;</td></tr>
<tr><td class="num" id="LN4153">4153</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4154">4154</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4155">4155</td><td class="line"><span class='keyword'>struct</span> diff_filepair *diff_queue(<span class='keyword'>struct</span> diff_queue_struct *queue,</td></tr>
<tr><td class="num" id="LN4156">4156</td><td class="line">				 <span class='keyword'>struct</span> diff_filespec *one,</td></tr>
<tr><td class="num" id="LN4157">4157</td><td class="line">				 <span class='keyword'>struct</span> diff_filespec *two)</td></tr>
<tr><td class="num" id="LN4158">4158</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4159">4159</td><td class="line">	<span class='keyword'>struct</span> diff_filepair *dp = xcalloc(1, <span class='keyword'>sizeof</span>(*dp));</td></tr>
<tr><td class="num" id="LN4160">4160</td><td class="line">	dp-&gt;one = one;</td></tr>
<tr><td class="num" id="LN4161">4161</td><td class="line">	dp-&gt;two = two;</td></tr>
<tr><td class="num" id="LN4162">4162</td><td class="line">	<span class='keyword'>if</span> (queue)</td></tr>
<tr><td class="num" id="LN4163">4163</td><td class="line">		diff_q(queue, dp);</td></tr>
<tr><td class="num" id="LN4164">4164</td><td class="line">	<span class='keyword'>return</span> dp;</td></tr>
<tr><td class="num" id="LN4165">4165</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4166">4166</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4167">4167</td><td class="line"><span class='keyword'>void</span> diff_free_filepair(<span class='keyword'>struct</span> diff_filepair *p)</td></tr>
<tr><td class="num" id="LN4168">4168</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4169">4169</td><td class="line">	free_filespec(p-&gt;one);</td></tr>
<tr><td class="num" id="LN4170">4170</td><td class="line">	free_filespec(p-&gt;two);</td></tr>
<tr><td class="num" id="LN4171">4171</td><td class="line">	free(p);</td></tr>
<tr><td class="num" id="LN4172">4172</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4173">4173</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4174">4174</td><td class="line"><span class='keyword'>const</span> <span class='keyword'>char</span> *diff_aligned_abbrev(<span class='keyword'>const</span> <span class='keyword'>struct</span> object_id *oid, <span class='keyword'>int</span> len)</td></tr>
<tr><td class="num" id="LN4175">4175</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4176">4176</td><td class="line">	<span class='keyword'>int</span> abblen;</td></tr>
<tr><td class="num" id="LN4177">4177</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *abbrev;</td></tr>
<tr><td class="num" id="LN4178">4178</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4179">4179</td><td class="line">	<span class='keyword'>if</span> (len == <span class='macro'>GIT_SHA1_HEXSZ<span class='expansion'>(2 * 20)</span></span>)</td></tr>
<tr><td class="num" id="LN4180">4180</td><td class="line">		<span class='keyword'>return</span> oid_to_hex(oid);</td></tr>
<tr><td class="num" id="LN4181">4181</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4182">4182</td><td class="line">	abbrev = diff_abbrev_oid(oid, len);</td></tr>
<tr><td class="num" id="LN4183">4183</td><td class="line">	abblen = strlen(abbrev);</td></tr>
<tr><td class="num" id="LN4184">4184</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4185">4185</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN4186">4186</td><td class="line">	 <span class='comment'>* In well-behaved cases, where the abbbreviated result is the</span></td></tr>
<tr><td class="num" id="LN4187">4187</td><td class="line">	 <span class='comment'>* same as the requested length, append three dots after the</span></td></tr>
<tr><td class="num" id="LN4188">4188</td><td class="line">	 <span class='comment'>* abbreviation (hence the whole logic is limited to the case</span></td></tr>
<tr><td class="num" id="LN4189">4189</td><td class="line">	 <span class='comment'>* where abblen &lt; 37); when the actual abbreviated result is a</span></td></tr>
<tr><td class="num" id="LN4190">4190</td><td class="line">	 <span class='comment'>* bit longer than the requested length, we reduce the number</span></td></tr>
<tr><td class="num" id="LN4191">4191</td><td class="line">	 <span class='comment'>* of dots so that they match the well-behaved ones.  However,</span></td></tr>
<tr><td class="num" id="LN4192">4192</td><td class="line">	 <span class='comment'>* if the actual abbreviation is longer than the requested</span></td></tr>
<tr><td class="num" id="LN4193">4193</td><td class="line">	 <span class='comment'>* length by more than three, we give up on aligning, and add</span></td></tr>
<tr><td class="num" id="LN4194">4194</td><td class="line">	 <span class='comment'>* three dots anyway, to indicate that the output is not the</span></td></tr>
<tr><td class="num" id="LN4195">4195</td><td class="line">	 <span class='comment'>* full object name.  Yes, this may be suboptimal, but this</span></td></tr>
<tr><td class="num" id="LN4196">4196</td><td class="line">	 <span class='comment'>* appears only in "diff --raw --abbrev" output and it is not</span></td></tr>
<tr><td class="num" id="LN4197">4197</td><td class="line">	 <span class='comment'>* worth the effort to change it now.  Note that this would</span></td></tr>
<tr><td class="num" id="LN4198">4198</td><td class="line">	 <span class='comment'>* likely to work fine when the automatic sizing of default</span></td></tr>
<tr><td class="num" id="LN4199">4199</td><td class="line">	 <span class='comment'>* abbreviation length is used--we would be fed -1 in "len" in</span></td></tr>
<tr><td class="num" id="LN4200">4200</td><td class="line">	 <span class='comment'>* that case, and will end up always appending three-dots, but</span></td></tr>
<tr><td class="num" id="LN4201">4201</td><td class="line">	 <span class='comment'>* the automatic sizing is supposed to give abblen that ensures</span></td></tr>
<tr><td class="num" id="LN4202">4202</td><td class="line">	 <span class='comment'>* uniqueness across all objects (statistically speaking).</span></td></tr>
<tr><td class="num" id="LN4203">4203</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN4204">4204</td><td class="line">	<span class='keyword'>if</span> (abblen &lt; <span class='macro'>GIT_SHA1_HEXSZ<span class='expansion'>(2 * 20)</span></span> - 3) {</td></tr>
<tr><td class="num" id="LN4205">4205</td><td class="line">		<span class='keyword'>static</span> <span class='keyword'>char</span> hex[<span class='macro'>GIT_SHA1_HEXSZ<span class='expansion'>(2 * 20)</span></span> + 1];</td></tr>
<tr><td class="num" id="LN4206">4206</td><td class="line">		<span class='keyword'>if</span> (len &lt; abblen &amp;&amp; abblen &lt;= len + 2)</td></tr>
<tr><td class="num" id="LN4207">4207</td><td class="line">			xsnprintf(hex, <span class='keyword'>sizeof</span>(hex), <span class='string_literal'>"%s%.*s"</span>, abbrev, len+3-abblen, <span class='string_literal'>".."</span>);</td></tr>
<tr><td class="num" id="LN4208">4208</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN4209">4209</td><td class="line">			xsnprintf(hex, <span class='keyword'>sizeof</span>(hex), <span class='string_literal'>"%s..."</span>, abbrev);</td></tr>
<tr><td class="num" id="LN4210">4210</td><td class="line">		<span class='keyword'>return</span> hex;</td></tr>
<tr><td class="num" id="LN4211">4211</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4212">4212</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4213">4213</td><td class="line">	<span class='keyword'>return</span> oid_to_hex(oid);</td></tr>
<tr><td class="num" id="LN4214">4214</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4215">4215</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4216">4216</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> diff_flush_raw(<span class='keyword'>struct</span> diff_filepair *p, <span class='keyword'>struct</span> diff_options *opt)</td></tr>
<tr><td class="num" id="LN4217">4217</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4218">4218</td><td class="line">	<span class='keyword'>int</span> line_termination = opt-&gt;line_termination;</td></tr>
<tr><td class="num" id="LN4219">4219</td><td class="line">	<span class='keyword'>int</span> inter_name_termination = line_termination ? '\t' : '\0';</td></tr>
<tr><td class="num" id="LN4220">4220</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4221">4221</td><td class="line">	fprintf(opt-&gt;file, <span class='string_literal'>"%s"</span>, diff_line_prefix(opt));</td></tr>
<tr><td class="num" id="LN4222">4222</td><td class="line">	<span class='keyword'>if</span> (!(opt-&gt;output_format &amp; <span class='macro'>DIFF_FORMAT_NAME_STATUS<span class='expansion'>0x0200</span></span>)) {</td></tr>
<tr><td class="num" id="LN4223">4223</td><td class="line">		fprintf(opt-&gt;file, <span class='string_literal'>":%06o %06o %s "</span>, p-&gt;one-&gt;mode, p-&gt;two-&gt;mode,</td></tr>
<tr><td class="num" id="LN4224">4224</td><td class="line">			diff_aligned_abbrev(&amp;p-&gt;one-&gt;oid, opt-&gt;abbrev));</td></tr>
<tr><td class="num" id="LN4225">4225</td><td class="line">		fprintf(opt-&gt;file, <span class='string_literal'>"%s "</span>,</td></tr>
<tr><td class="num" id="LN4226">4226</td><td class="line">			diff_aligned_abbrev(&amp;p-&gt;two-&gt;oid, opt-&gt;abbrev));</td></tr>
<tr><td class="num" id="LN4227">4227</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4228">4228</td><td class="line">	<span class='keyword'>if</span> (p-&gt;score) {</td></tr>
<tr><td class="num" id="LN4229">4229</td><td class="line">		fprintf(opt-&gt;file, <span class='string_literal'>"%c%03d%c"</span>, p-&gt;status, similarity_index(p),</td></tr>
<tr><td class="num" id="LN4230">4230</td><td class="line">			inter_name_termination);</td></tr>
<tr><td class="num" id="LN4231">4231</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN4232">4232</td><td class="line">		fprintf(opt-&gt;file, <span class='string_literal'>"%c%c"</span>, p-&gt;status, inter_name_termination);</td></tr>
<tr><td class="num" id="LN4233">4233</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4234">4234</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4235">4235</td><td class="line">	<span class='keyword'>if</span> (p-&gt;status == <span class='macro'>DIFF_STATUS_COPIED<span class='expansion'>'C'</span></span> ||</td></tr>
<tr><td class="num" id="LN4236">4236</td><td class="line">	    p-&gt;status == <span class='macro'>DIFF_STATUS_RENAMED<span class='expansion'>'R'</span></span>) {</td></tr>
<tr><td class="num" id="LN4237">4237</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *name_a, *name_b;</td></tr>
<tr><td class="num" id="LN4238">4238</td><td class="line">		name_a = p-&gt;one-&gt;path;</td></tr>
<tr><td class="num" id="LN4239">4239</td><td class="line">		name_b = p-&gt;two-&gt;path;</td></tr>
<tr><td class="num" id="LN4240">4240</td><td class="line">		strip_prefix(opt-&gt;prefix_length, &amp;name_a, &amp;name_b);</td></tr>
<tr><td class="num" id="LN4241">4241</td><td class="line">		write_name_quoted(name_a, opt-&gt;file, inter_name_termination);</td></tr>
<tr><td class="num" id="LN4242">4242</td><td class="line">		write_name_quoted(name_b, opt-&gt;file, line_termination);</td></tr>
<tr><td class="num" id="LN4243">4243</td><td class="line">	} <span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN4244">4244</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *name_a, *name_b;</td></tr>
<tr><td class="num" id="LN4245">4245</td><td class="line">		name_a = p-&gt;one-&gt;mode ? p-&gt;one-&gt;path : p-&gt;two-&gt;path;</td></tr>
<tr><td class="num" id="LN4246">4246</td><td class="line">		name_b = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN4247">4247</td><td class="line">		strip_prefix(opt-&gt;prefix_length, &amp;name_a, &amp;name_b);</td></tr>
<tr><td class="num" id="LN4248">4248</td><td class="line">		write_name_quoted(name_a, opt-&gt;file, line_termination);</td></tr>
<tr><td class="num" id="LN4249">4249</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4250">4250</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4251">4251</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4252">4252</td><td class="line"><span class='keyword'>int</span> diff_unmodified_pair(<span class='keyword'>struct</span> diff_filepair *p)</td></tr>
<tr><td class="num" id="LN4253">4253</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4254">4254</td><td class="line">	<span class='comment'>/* This function is written stricter than necessary to support</span></td></tr>
<tr><td class="num" id="LN4255">4255</td><td class="line">	 <span class='comment'>* the currently implemented transformers, but the idea is to</span></td></tr>
<tr><td class="num" id="LN4256">4256</td><td class="line">	 <span class='comment'>* let transformers to produce diff_filepairs any way they want,</span></td></tr>
<tr><td class="num" id="LN4257">4257</td><td class="line">	 <span class='comment'>* and filter and clean them up here before producing the output.</span></td></tr>
<tr><td class="num" id="LN4258">4258</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN4259">4259</td><td class="line">	<span class='keyword'>struct</span> diff_filespec *one = p-&gt;one, *two = p-&gt;two;</td></tr>
<tr><td class="num" id="LN4260">4260</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4261">4261</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_PAIR_UNMERGED(p)<span class='expansion'>((p)-&gt;is_unmerged)</span></span>)</td></tr>
<tr><td class="num" id="LN4262">4262</td><td class="line">		<span class='keyword'>return</span> 0; <span class='comment'>/* unmerged is interesting */</span></td></tr>
<tr><td class="num" id="LN4263">4263</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4264">4264</td><td class="line">	<span class='comment'>/* deletion, addition, mode or type change</span></td></tr>
<tr><td class="num" id="LN4265">4265</td><td class="line">	 <span class='comment'>* and rename are all interesting.</span></td></tr>
<tr><td class="num" id="LN4266">4266</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN4267">4267</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_FILE_VALID(one)<span class='expansion'>(((one)-&gt;mode) != 0)</span></span> != <span class='macro'>DIFF_FILE_VALID(two)<span class='expansion'>(((two)-&gt;mode) != 0)</span></span> ||</td></tr>
<tr><td class="num" id="LN4268">4268</td><td class="line">	    <span class='macro'>DIFF_PAIR_MODE_CHANGED(p)<span class='expansion'>((p)-&gt;one-&gt;mode != (p)-&gt;two-&gt;mode)</span></span> ||</td></tr>
<tr><td class="num" id="LN4269">4269</td><td class="line">	    strcmp(one-&gt;path, two-&gt;path))</td></tr>
<tr><td class="num" id="LN4270">4270</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN4271">4271</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4272">4272</td><td class="line">	<span class='comment'>/* both are valid and point at the same path.  that is, we are</span></td></tr>
<tr><td class="num" id="LN4273">4273</td><td class="line">	 <span class='comment'>* dealing with a change.</span></td></tr>
<tr><td class="num" id="LN4274">4274</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN4275">4275</td><td class="line">	<span class='keyword'>if</span> (one-&gt;oid_valid &amp;&amp; two-&gt;oid_valid &amp;&amp;</td></tr>
<tr><td class="num" id="LN4276">4276</td><td class="line">	    !oidcmp(&amp;one-&gt;oid, &amp;two-&gt;oid) &amp;&amp;</td></tr>
<tr><td class="num" id="LN4277">4277</td><td class="line">	    !one-&gt;dirty_submodule &amp;&amp; !two-&gt;dirty_submodule)</td></tr>
<tr><td class="num" id="LN4278">4278</td><td class="line">		<span class='keyword'>return</span> 1; <span class='comment'>/* no change */</span></td></tr>
<tr><td class="num" id="LN4279">4279</td><td class="line">	<span class='keyword'>if</span> (!one-&gt;oid_valid &amp;&amp; !two-&gt;oid_valid)</td></tr>
<tr><td class="num" id="LN4280">4280</td><td class="line">		<span class='keyword'>return</span> 1; <span class='comment'>/* both look at the same file on the filesystem. */</span></td></tr>
<tr><td class="num" id="LN4281">4281</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN4282">4282</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4283">4283</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4284">4284</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> diff_flush_patch(<span class='keyword'>struct</span> diff_filepair *p, <span class='keyword'>struct</span> diff_options *o)</td></tr>
<tr><td class="num" id="LN4285">4285</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4286">4286</td><td class="line">	<span class='keyword'>if</span> (diff_unmodified_pair(p))</td></tr>
<tr><td class="num" id="LN4287">4287</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN4288">4288</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4289">4289</td><td class="line">	<span class='keyword'>if</span> ((<span class='macro'>DIFF_FILE_VALID(p-&gt;one)<span class='expansion'>(((p-&gt;one)-&gt;mode) != 0)</span></span> &amp;&amp; <span class='macro'>S_ISDIR(p-&gt;one-&gt;mode)<span class='expansion'>(((p-&gt;one-&gt;mode) &amp; 0170000) == 0040000)</span></span>) ||</td></tr>
<tr><td class="num" id="LN4290">4290</td><td class="line">	    (<span class='macro'>DIFF_FILE_VALID(p-&gt;two)<span class='expansion'>(((p-&gt;two)-&gt;mode) != 0)</span></span> &amp;&amp; <span class='macro'>S_ISDIR(p-&gt;two-&gt;mode)<span class='expansion'>(((p-&gt;two-&gt;mode) &amp; 0170000) == 0040000)</span></span>))</td></tr>
<tr><td class="num" id="LN4291">4291</td><td class="line">		<span class='keyword'>return</span>; <span class='comment'>/* no tree diffs in patch format */</span></td></tr>
<tr><td class="num" id="LN4292">4292</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4293">4293</td><td class="line">	run_diff(p, o);</td></tr>
<tr><td class="num" id="LN4294">4294</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4295">4295</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4296">4296</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> diff_flush_stat(<span class='keyword'>struct</span> diff_filepair *p, <span class='keyword'>struct</span> diff_options *o,</td></tr>
<tr><td class="num" id="LN4297">4297</td><td class="line">			    <span class='keyword'>struct</span> diffstat_t *diffstat)</td></tr>
<tr><td class="num" id="LN4298">4298</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4299">4299</td><td class="line">	<span class='keyword'>if</span> (diff_unmodified_pair(p))</td></tr>
<tr><td class="num" id="LN4300">4300</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN4301">4301</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4302">4302</td><td class="line">	<span class='keyword'>if</span> ((<span class='macro'>DIFF_FILE_VALID(p-&gt;one)<span class='expansion'>(((p-&gt;one)-&gt;mode) != 0)</span></span> &amp;&amp; <span class='macro'>S_ISDIR(p-&gt;one-&gt;mode)<span class='expansion'>(((p-&gt;one-&gt;mode) &amp; 0170000) == 0040000)</span></span>) ||</td></tr>
<tr><td class="num" id="LN4303">4303</td><td class="line">	    (<span class='macro'>DIFF_FILE_VALID(p-&gt;two)<span class='expansion'>(((p-&gt;two)-&gt;mode) != 0)</span></span> &amp;&amp; <span class='macro'>S_ISDIR(p-&gt;two-&gt;mode)<span class='expansion'>(((p-&gt;two-&gt;mode) &amp; 0170000) == 0040000)</span></span>))</td></tr>
<tr><td class="num" id="LN4304">4304</td><td class="line">		<span class='keyword'>return</span>; <span class='comment'>/* no useful stat for tree diffs */</span></td></tr>
<tr><td class="num" id="LN4305">4305</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4306">4306</td><td class="line">	run_diffstat(p, o, diffstat);</td></tr>
<tr><td class="num" id="LN4307">4307</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4308">4308</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4309">4309</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> diff_flush_checkdiff(<span class='keyword'>struct</span> diff_filepair *p,</td></tr>
<tr><td class="num" id="LN4310">4310</td><td class="line">		<span class='keyword'>struct</span> diff_options *o)</td></tr>
<tr><td class="num" id="LN4311">4311</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4312">4312</td><td class="line">	<span class='keyword'>if</span> (diff_unmodified_pair(p))</td></tr>
<tr><td class="num" id="LN4313">4313</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN4314">4314</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4315">4315</td><td class="line">	<span class='keyword'>if</span> ((<span class='macro'>DIFF_FILE_VALID(p-&gt;one)<span class='expansion'>(((p-&gt;one)-&gt;mode) != 0)</span></span> &amp;&amp; <span class='macro'>S_ISDIR(p-&gt;one-&gt;mode)<span class='expansion'>(((p-&gt;one-&gt;mode) &amp; 0170000) == 0040000)</span></span>) ||</td></tr>
<tr><td class="num" id="LN4316">4316</td><td class="line">	    (<span class='macro'>DIFF_FILE_VALID(p-&gt;two)<span class='expansion'>(((p-&gt;two)-&gt;mode) != 0)</span></span> &amp;&amp; <span class='macro'>S_ISDIR(p-&gt;two-&gt;mode)<span class='expansion'>(((p-&gt;two-&gt;mode) &amp; 0170000) == 0040000)</span></span>))</td></tr>
<tr><td class="num" id="LN4317">4317</td><td class="line">		<span class='keyword'>return</span>; <span class='comment'>/* nothing to check in tree diffs */</span></td></tr>
<tr><td class="num" id="LN4318">4318</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4319">4319</td><td class="line">	run_checkdiff(p, o);</td></tr>
<tr><td class="num" id="LN4320">4320</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4321">4321</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4322">4322</td><td class="line"><span class='keyword'>int</span> diff_queue_is_empty(<span class='keyword'>void</span>)</td></tr>
<tr><td class="num" id="LN4323">4323</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4324">4324</td><td class="line">	<span class='keyword'>struct</span> diff_queue_struct *q = &amp;diff_queued_diff;</td></tr>
<tr><td class="num" id="LN4325">4325</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN4326">4326</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++)</td></tr>
<tr><td class="num" id="LN4327">4327</td><td class="line">		<span class='keyword'>if</span> (!diff_unmodified_pair(q-&gt;queue[i]))</td></tr>
<tr><td class="num" id="LN4328">4328</td><td class="line">			<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN4329">4329</td><td class="line">	<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN4330">4330</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4331">4331</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4332">4332</td><td class="line"><span class='directive'>#if <span class='macro'>DIFF_DEBUG<span class='expansion'>0</span></span></span></td></tr>
<tr><td class="num" id="LN4333">4333</td><td class="line"><span class='keyword'>void</span> <span class='macro'>diff_debug_filespec(<span class='keyword'>struct</span> diff_filespec *s, <span class='keyword'>int</span> x, <span class='keyword'>const</span> <span class='keyword'>char</span> *one)<span class='expansion'>do { } while (0)</span></span></td></tr>
<tr><td class="num" id="LN4334">4334</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4335">4335</td><td class="line">	fprintf(<span class='macro'>stderr<span class='expansion'>__stderrp</span></span>, <span class='string_literal'>"queue[%d] %s (%s) %s %06o %s\n"</span>,</td></tr>
<tr><td class="num" id="LN4336">4336</td><td class="line">		x, one ? one : <span class='string_literal'>""</span>,</td></tr>
<tr><td class="num" id="LN4337">4337</td><td class="line">		s-&gt;path,</td></tr>
<tr><td class="num" id="LN4338">4338</td><td class="line">		<span class='macro'>DIFF_FILE_VALID(s)<span class='expansion'>(((s)-&gt;mode) != 0)</span></span> ? <span class='string_literal'>"valid"</span> : <span class='string_literal'>"invalid"</span>,</td></tr>
<tr><td class="num" id="LN4339">4339</td><td class="line">		s-&gt;mode,</td></tr>
<tr><td class="num" id="LN4340">4340</td><td class="line">		s-&gt;oid_valid ? oid_to_hex(&amp;s-&gt;oid) : <span class='string_literal'>""</span>);</td></tr>
<tr><td class="num" id="LN4341">4341</td><td class="line">	fprintf(<span class='macro'>stderr<span class='expansion'>__stderrp</span></span>, <span class='string_literal'>"queue[%d] %s size %lu\n"</span>,</td></tr>
<tr><td class="num" id="LN4342">4342</td><td class="line">		x, one ? one : <span class='string_literal'>""</span>,</td></tr>
<tr><td class="num" id="LN4343">4343</td><td class="line">		s-&gt;size);</td></tr>
<tr><td class="num" id="LN4344">4344</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4345">4345</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4346">4346</td><td class="line"><span class='keyword'>void</span> <span class='macro'>diff_debug_filepair(<span class='keyword'>const</span> <span class='keyword'>struct</span> diff_filepair *p, <span class='keyword'>int</span> i)<span class='expansion'>do { } while (0)</span></span></td></tr>
<tr><td class="num" id="LN4347">4347</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4348">4348</td><td class="line">	<span class='macro'>diff_debug_filespec(p-&gt;one, i, <span class='string_literal'>"one"</span>)<span class='expansion'>do { } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN4349">4349</td><td class="line">	<span class='macro'>diff_debug_filespec(p-&gt;two, i, <span class='string_literal'>"two"</span>)<span class='expansion'>do { } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN4350">4350</td><td class="line">	fprintf(<span class='macro'>stderr<span class='expansion'>__stderrp</span></span>, <span class='string_literal'>"score %d, status %c rename_used %d broken %d\n"</span>,</td></tr>
<tr><td class="num" id="LN4351">4351</td><td class="line">		p-&gt;score, p-&gt;status ? p-&gt;status : '?',</td></tr>
<tr><td class="num" id="LN4352">4352</td><td class="line">		p-&gt;one-&gt;rename_used, p-&gt;broken_pair);</td></tr>
<tr><td class="num" id="LN4353">4353</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4354">4354</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4355">4355</td><td class="line"><span class='keyword'>void</span> <span class='macro'>diff_debug_queue(<span class='keyword'>const</span> <span class='keyword'>char</span> *msg, <span class='keyword'>struct</span> diff_queue_struct *q)<span class='expansion'>do { } while (0)</span></span></td></tr>
<tr><td class="num" id="LN4356">4356</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4357">4357</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN4358">4358</td><td class="line">	<span class='keyword'>if</span> (msg)</td></tr>
<tr><td class="num" id="LN4359">4359</td><td class="line">		fprintf(<span class='macro'>stderr<span class='expansion'>__stderrp</span></span>, <span class='string_literal'>"%s\n"</span>, msg);</td></tr>
<tr><td class="num" id="LN4360">4360</td><td class="line">	fprintf(<span class='macro'>stderr<span class='expansion'>__stderrp</span></span>, <span class='string_literal'>"q-&gt;nr = %d\n"</span>, q-&gt;nr);</td></tr>
<tr><td class="num" id="LN4361">4361</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN4362">4362</td><td class="line">		<span class='keyword'>struct</span> diff_filepair *p = q-&gt;queue[i];</td></tr>
<tr><td class="num" id="LN4363">4363</td><td class="line">		<span class='macro'>diff_debug_filepair(p, i)<span class='expansion'>do { } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN4364">4364</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4365">4365</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4366">4366</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr><td class="num" id="LN4367">4367</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4368">4368</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> diff_resolve_rename_copy(<span class='keyword'>void</span>)</td></tr>
<tr><td class="num" id="LN4369">4369</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4370">4370</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN4371">4371</td><td class="line">	<span class='keyword'>struct</span> diff_filepair *p;</td></tr>
<tr><td class="num" id="LN4372">4372</td><td class="line">	<span class='keyword'>struct</span> diff_queue_struct *q = &amp;diff_queued_diff;</td></tr>
<tr><td class="num" id="LN4373">4373</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4374">4374</td><td class="line">	<span class='macro'>diff_debug_queue(<span class='string_literal'>"resolve-rename-copy"</span>, q)<span class='expansion'>do { } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN4375">4375</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4376">4376</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN4377">4377</td><td class="line">		p = q-&gt;queue[i];</td></tr>
<tr><td class="num" id="LN4378">4378</td><td class="line">		p-&gt;status = 0; <span class='comment'>/* undecided */</span></td></tr>
<tr><td class="num" id="LN4379">4379</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>DIFF_PAIR_UNMERGED(p)<span class='expansion'>((p)-&gt;is_unmerged)</span></span>)</td></tr>
<tr><td class="num" id="LN4380">4380</td><td class="line">			p-&gt;status = <span class='macro'>DIFF_STATUS_UNMERGED<span class='expansion'>'U'</span></span>;</td></tr>
<tr><td class="num" id="LN4381">4381</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (!<span class='macro'>DIFF_FILE_VALID(p-&gt;one)<span class='expansion'>(((p-&gt;one)-&gt;mode) != 0)</span></span>)</td></tr>
<tr><td class="num" id="LN4382">4382</td><td class="line">			p-&gt;status = <span class='macro'>DIFF_STATUS_ADDED<span class='expansion'>'A'</span></span>;</td></tr>
<tr><td class="num" id="LN4383">4383</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (!<span class='macro'>DIFF_FILE_VALID(p-&gt;two)<span class='expansion'>(((p-&gt;two)-&gt;mode) != 0)</span></span>)</td></tr>
<tr><td class="num" id="LN4384">4384</td><td class="line">			p-&gt;status = <span class='macro'>DIFF_STATUS_DELETED<span class='expansion'>'D'</span></span>;</td></tr>
<tr><td class="num" id="LN4385">4385</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (<span class='macro'>DIFF_PAIR_TYPE_CHANGED(p)<span class='expansion'>((0170000 &amp; (p)-&gt;one-&gt;mode) != (0170000 &amp; (p)-&gt;<br>two-&gt;mode))</span></span>)</td></tr>
<tr><td class="num" id="LN4386">4386</td><td class="line">			p-&gt;status = <span class='macro'>DIFF_STATUS_TYPE_CHANGED<span class='expansion'>'T'</span></span>;</td></tr>
<tr><td class="num" id="LN4387">4387</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4388">4388</td><td class="line">		<span class='comment'>/* from this point on, we are dealing with a pair</span></td></tr>
<tr><td class="num" id="LN4389">4389</td><td class="line">		 <span class='comment'>* whose both sides are valid and of the same type, i.e.</span></td></tr>
<tr><td class="num" id="LN4390">4390</td><td class="line">		 <span class='comment'>* either in-place edit or rename/copy edit.</span></td></tr>
<tr><td class="num" id="LN4391">4391</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN4392">4392</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (<span class='macro'>DIFF_PAIR_RENAME(p)<span class='expansion'>((p)-&gt;renamed_pair)</span></span>) {</td></tr>
<tr><td class="num" id="LN4393">4393</td><td class="line">			<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN4394">4394</td><td class="line">			 <span class='comment'>* A rename might have re-connected a broken</span></td></tr>
<tr><td class="num" id="LN4395">4395</td><td class="line">			 <span class='comment'>* pair up, causing the pathnames to be the</span></td></tr>
<tr><td class="num" id="LN4396">4396</td><td class="line">			 <span class='comment'>* same again. If so, that's not a rename at</span></td></tr>
<tr><td class="num" id="LN4397">4397</td><td class="line">			 <span class='comment'>* all, just a modification..</span></td></tr>
<tr><td class="num" id="LN4398">4398</td><td class="line">			 <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN4399">4399</td><td class="line">			 <span class='comment'>* Otherwise, see if this source was used for</span></td></tr>
<tr><td class="num" id="LN4400">4400</td><td class="line">			 <span class='comment'>* multiple renames, in which case we decrement</span></td></tr>
<tr><td class="num" id="LN4401">4401</td><td class="line">			 <span class='comment'>* the count, and call it a copy.</span></td></tr>
<tr><td class="num" id="LN4402">4402</td><td class="line">			 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN4403">4403</td><td class="line">			<span class='keyword'>if</span> (!strcmp(p-&gt;one-&gt;path, p-&gt;two-&gt;path))</td></tr>
<tr><td class="num" id="LN4404">4404</td><td class="line">				p-&gt;status = <span class='macro'>DIFF_STATUS_MODIFIED<span class='expansion'>'M'</span></span>;</td></tr>
<tr><td class="num" id="LN4405">4405</td><td class="line">			<span class='keyword'>else</span> <span class='keyword'>if</span> (--p-&gt;one-&gt;rename_used &gt; 0)</td></tr>
<tr><td class="num" id="LN4406">4406</td><td class="line">				p-&gt;status = <span class='macro'>DIFF_STATUS_COPIED<span class='expansion'>'C'</span></span>;</td></tr>
<tr><td class="num" id="LN4407">4407</td><td class="line">			<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN4408">4408</td><td class="line">				p-&gt;status = <span class='macro'>DIFF_STATUS_RENAMED<span class='expansion'>'R'</span></span>;</td></tr>
<tr><td class="num" id="LN4409">4409</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4410">4410</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (oidcmp(&amp;p-&gt;one-&gt;oid, &amp;p-&gt;two-&gt;oid) ||</td></tr>
<tr><td class="num" id="LN4411">4411</td><td class="line">			 p-&gt;one-&gt;mode != p-&gt;two-&gt;mode ||</td></tr>
<tr><td class="num" id="LN4412">4412</td><td class="line">			 p-&gt;one-&gt;dirty_submodule ||</td></tr>
<tr><td class="num" id="LN4413">4413</td><td class="line">			 p-&gt;two-&gt;dirty_submodule ||</td></tr>
<tr><td class="num" id="LN4414">4414</td><td class="line">			 is_null_oid(&amp;p-&gt;one-&gt;oid))</td></tr>
<tr><td class="num" id="LN4415">4415</td><td class="line">			p-&gt;status = <span class='macro'>DIFF_STATUS_MODIFIED<span class='expansion'>'M'</span></span>;</td></tr>
<tr><td class="num" id="LN4416">4416</td><td class="line">		<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN4417">4417</td><td class="line">			<span class='comment'>/* This is a "no-change" entry and should not</span></td></tr>
<tr><td class="num" id="LN4418">4418</td><td class="line">			 <span class='comment'>* happen anymore, but prepare for broken callers.</span></td></tr>
<tr><td class="num" id="LN4419">4419</td><td class="line">			 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN4420">4420</td><td class="line">			<span class='macro'>error(<span class='string_literal'>"feeding unmodified %s to diffcore"</span>,<span class='expansion'>(error("feeding unmodified %s to diffcore", p-&gt;one-&gt;path<br>), const_error())</span></span></td></tr>
<tr><td class="num" id="LN4421">4421</td><td class="line">			      <span class='macro'>p-&gt;one-&gt;path)<span class='expansion'>(error("feeding unmodified %s to diffcore", p-&gt;one-&gt;path<br>), const_error())</span></span>;</td></tr>
<tr><td class="num" id="LN4422">4422</td><td class="line">			p-&gt;status = <span class='macro'>DIFF_STATUS_UNKNOWN<span class='expansion'>'X'</span></span>;</td></tr>
<tr><td class="num" id="LN4423">4423</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4424">4424</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4425">4425</td><td class="line">	<span class='macro'>diff_debug_queue(<span class='string_literal'>"resolve-rename-copy done"</span>, q)<span class='expansion'>do { } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN4426">4426</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4427">4427</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4428">4428</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> check_pair_status(<span class='keyword'>struct</span> diff_filepair *p)</td></tr>
<tr><td class="num" id="LN4429">4429</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4430">4430</td><td class="line">	<span class='keyword'>switch</span> (p-&gt;status) {</td></tr>
<tr><td class="num" id="LN4431">4431</td><td class="line">	<span class='keyword'>case</span> <span class='macro'>DIFF_STATUS_UNKNOWN<span class='expansion'>'X'</span></span>:</td></tr>
<tr><td class="num" id="LN4432">4432</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN4433">4433</td><td class="line">	<span class='keyword'>case</span> 0:</td></tr>
<tr><td class="num" id="LN4434">4434</td><td class="line">		die(<span class='string_literal'>"internal error in diff-resolve-rename-copy"</span>);</td></tr>
<tr><td class="num" id="LN4435">4435</td><td class="line">	<span class='keyword'>default</span>:</td></tr>
<tr><td class="num" id="LN4436">4436</td><td class="line">		<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN4437">4437</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4438">4438</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4439">4439</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4440">4440</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> flush_one_pair(<span class='keyword'>struct</span> diff_filepair *p, <span class='keyword'>struct</span> diff_options *opt)</td></tr>
<tr><td class="num" id="LN4441">4441</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4442">4442</td><td class="line">	<span class='keyword'>int</span> fmt = opt-&gt;output_format;</td></tr>
<tr><td class="num" id="LN4443">4443</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4444">4444</td><td class="line">	<span class='keyword'>if</span> (fmt &amp; <span class='macro'>DIFF_FORMAT_CHECKDIFF<span class='expansion'>0x0400</span></span>)</td></tr>
<tr><td class="num" id="LN4445">4445</td><td class="line">		diff_flush_checkdiff(p, opt);</td></tr>
<tr><td class="num" id="LN4446">4446</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (fmt &amp; (<span class='macro'>DIFF_FORMAT_RAW<span class='expansion'>0x0001</span></span> | <span class='macro'>DIFF_FORMAT_NAME_STATUS<span class='expansion'>0x0200</span></span>))</td></tr>
<tr><td class="num" id="LN4447">4447</td><td class="line">		diff_flush_raw(p, opt);</td></tr>
<tr><td class="num" id="LN4448">4448</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (fmt &amp; <span class='macro'>DIFF_FORMAT_NAME<span class='expansion'>0x0100</span></span>) {</td></tr>
<tr><td class="num" id="LN4449">4449</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *name_a, *name_b;</td></tr>
<tr><td class="num" id="LN4450">4450</td><td class="line">		name_a = p-&gt;two-&gt;path;</td></tr>
<tr><td class="num" id="LN4451">4451</td><td class="line">		name_b = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN4452">4452</td><td class="line">		strip_prefix(opt-&gt;prefix_length, &amp;name_a, &amp;name_b);</td></tr>
<tr><td class="num" id="LN4453">4453</td><td class="line">		fprintf(opt-&gt;file, <span class='string_literal'>"%s"</span>, diff_line_prefix(opt));</td></tr>
<tr><td class="num" id="LN4454">4454</td><td class="line">		write_name_quoted(name_a, opt-&gt;file, opt-&gt;line_termination);</td></tr>
<tr><td class="num" id="LN4455">4455</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4456">4456</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4457">4457</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4458">4458</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> show_file_mode_name(FILE *file, <span class='keyword'>const</span> <span class='keyword'>char</span> *newdelete, <span class='keyword'>struct</span> diff_filespec *fs)</td></tr>
<tr><td class="num" id="LN4459">4459</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4460">4460</td><td class="line">	<span class='keyword'>if</span> (fs-&gt;mode)</td></tr>
<tr><td class="num" id="LN4461">4461</td><td class="line">		fprintf(file, <span class='string_literal'>" %s mode %06o "</span>, newdelete, fs-&gt;mode);</td></tr>
<tr><td class="num" id="LN4462">4462</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN4463">4463</td><td class="line">		fprintf(file, <span class='string_literal'>" %s "</span>, newdelete);</td></tr>
<tr><td class="num" id="LN4464">4464</td><td class="line">	write_name_quoted(fs-&gt;path, file, '\n');</td></tr>
<tr><td class="num" id="LN4465">4465</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4466">4466</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4467">4467</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4468">4468</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> show_mode_change(FILE *file, <span class='keyword'>struct</span> diff_filepair *p, <span class='keyword'>int</span> show_name,</td></tr>
<tr><td class="num" id="LN4469">4469</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>char</span> *line_prefix)</td></tr>
<tr><td class="num" id="LN4470">4470</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4471">4471</td><td class="line">	<span class='keyword'>if</span> (p-&gt;one-&gt;mode &amp;&amp; p-&gt;two-&gt;mode &amp;&amp; p-&gt;one-&gt;mode != p-&gt;two-&gt;mode) {</td></tr>
<tr><td class="num" id="LN4472">4472</td><td class="line">		fprintf(file, <span class='string_literal'>"%s mode change %06o =&gt; %06o%c"</span>, line_prefix, p-&gt;one-&gt;mode,</td></tr>
<tr><td class="num" id="LN4473">4473</td><td class="line">			p-&gt;two-&gt;mode, show_name ? ' ' : '\n');</td></tr>
<tr><td class="num" id="LN4474">4474</td><td class="line">		<span class='keyword'>if</span> (show_name) {</td></tr>
<tr><td class="num" id="LN4475">4475</td><td class="line">			write_name_quoted(p-&gt;two-&gt;path, file, '\n');</td></tr>
<tr><td class="num" id="LN4476">4476</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4477">4477</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4478">4478</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4479">4479</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4480">4480</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> show_rename_copy(FILE *file, <span class='keyword'>const</span> <span class='keyword'>char</span> *renamecopy, <span class='keyword'>struct</span> diff_filepair *p,</td></tr>
<tr><td class="num" id="LN4481">4481</td><td class="line">			<span class='keyword'>const</span> <span class='keyword'>char</span> *line_prefix)</td></tr>
<tr><td class="num" id="LN4482">4482</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4483">4483</td><td class="line">	<span class='keyword'>char</span> *names = pprint_rename(p-&gt;one-&gt;path, p-&gt;two-&gt;path);</td></tr>
<tr><td class="num" id="LN4484">4484</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4485">4485</td><td class="line">	fprintf(file, <span class='string_literal'>" %s %s (%d%%)\n"</span>, renamecopy, names, similarity_index(p));</td></tr>
<tr><td class="num" id="LN4486">4486</td><td class="line">	free(names);</td></tr>
<tr><td class="num" id="LN4487">4487</td><td class="line">	show_mode_change(file, p, 0, line_prefix);</td></tr>
<tr><td class="num" id="LN4488">4488</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4489">4489</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4490">4490</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> diff_summary(<span class='keyword'>struct</span> diff_options *opt, <span class='keyword'>struct</span> diff_filepair *p)</td></tr>
<tr><td class="num" id="LN4491">4491</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4492">4492</td><td class="line">	FILE *file = opt-&gt;file;</td></tr>
<tr><td class="num" id="LN4493">4493</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *line_prefix = diff_line_prefix(opt);</td></tr>
<tr><td class="num" id="LN4494">4494</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4495">4495</td><td class="line">	<span class='keyword'>switch</span>(p-&gt;status) {</td></tr>
<tr><td class="num" id="LN4496">4496</td><td class="line">	<span class='keyword'>case</span> <span class='macro'>DIFF_STATUS_DELETED<span class='expansion'>'D'</span></span>:</td></tr>
<tr><td class="num" id="LN4497">4497</td><td class="line">		fputs(line_prefix, file);</td></tr>
<tr><td class="num" id="LN4498">4498</td><td class="line">		show_file_mode_name(file, <span class='string_literal'>"delete"</span>, p-&gt;one);</td></tr>
<tr><td class="num" id="LN4499">4499</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN4500">4500</td><td class="line">	<span class='keyword'>case</span> <span class='macro'>DIFF_STATUS_ADDED<span class='expansion'>'A'</span></span>:</td></tr>
<tr><td class="num" id="LN4501">4501</td><td class="line">		fputs(line_prefix, file);</td></tr>
<tr><td class="num" id="LN4502">4502</td><td class="line">		show_file_mode_name(file, <span class='string_literal'>"create"</span>, p-&gt;two);</td></tr>
<tr><td class="num" id="LN4503">4503</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN4504">4504</td><td class="line">	<span class='keyword'>case</span> <span class='macro'>DIFF_STATUS_COPIED<span class='expansion'>'C'</span></span>:</td></tr>
<tr><td class="num" id="LN4505">4505</td><td class="line">		fputs(line_prefix, file);</td></tr>
<tr><td class="num" id="LN4506">4506</td><td class="line">		show_rename_copy(file, <span class='string_literal'>"copy"</span>, p, line_prefix);</td></tr>
<tr><td class="num" id="LN4507">4507</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN4508">4508</td><td class="line">	<span class='keyword'>case</span> <span class='macro'>DIFF_STATUS_RENAMED<span class='expansion'>'R'</span></span>:</td></tr>
<tr><td class="num" id="LN4509">4509</td><td class="line">		fputs(line_prefix, file);</td></tr>
<tr><td class="num" id="LN4510">4510</td><td class="line">		show_rename_copy(file, <span class='string_literal'>"rename"</span>, p, line_prefix);</td></tr>
<tr><td class="num" id="LN4511">4511</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN4512">4512</td><td class="line">	<span class='keyword'>default</span>:</td></tr>
<tr><td class="num" id="LN4513">4513</td><td class="line">		<span class='keyword'>if</span> (p-&gt;score) {</td></tr>
<tr><td class="num" id="LN4514">4514</td><td class="line">			fprintf(file, <span class='string_literal'>"%s rewrite "</span>, line_prefix);</td></tr>
<tr><td class="num" id="LN4515">4515</td><td class="line">			write_name_quoted(p-&gt;two-&gt;path, file, ' ');</td></tr>
<tr><td class="num" id="LN4516">4516</td><td class="line">			fprintf(file, <span class='string_literal'>"(%d%%)\n"</span>, similarity_index(p));</td></tr>
<tr><td class="num" id="LN4517">4517</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4518">4518</td><td class="line">		show_mode_change(file, p, !p-&gt;score, line_prefix);</td></tr>
<tr><td class="num" id="LN4519">4519</td><td class="line">		<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN4520">4520</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4521">4521</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4522">4522</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4523">4523</td><td class="line"><span class='keyword'>struct</span> patch_id_t {</td></tr>
<tr><td class="num" id="LN4524">4524</td><td class="line">	<span class='macro'>git_SHA_CTX<span class='expansion'>blk_SHA_CTX</span></span> *ctx;</td></tr>
<tr><td class="num" id="LN4525">4525</td><td class="line">	<span class='keyword'>int</span> patchlen;</td></tr>
<tr><td class="num" id="LN4526">4526</td><td class="line">};</td></tr>
<tr><td class="num" id="LN4527">4527</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4528">4528</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> remove_space(<span class='keyword'>char</span> *line, <span class='keyword'>int</span> len)</td></tr>
<tr><td class="num" id="LN4529">4529</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4530">4530</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN4531">4531</td><td class="line">	<span class='keyword'>char</span> *dst = line;</td></tr>
<tr><td class="num" id="LN4532">4532</td><td class="line">	<span class='keyword'>unsigned</span> <span class='keyword'>char</span> c;</td></tr>
<tr><td class="num" id="LN4533">4533</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4534">4534</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; len; i++)</td></tr>
<tr><td class="num" id="LN4535">4535</td><td class="line">		<span class='keyword'>if</span> (!<span class='macro'>isspace((c = line[i]))<span class='expansion'>((sane_ctype[(unsigned char)((c = line[i]))] &amp; (0x01)) !=<br> 0)</span></span>)</td></tr>
<tr><td class="num" id="LN4536">4536</td><td class="line">			*dst++ = c;</td></tr>
<tr><td class="num" id="LN4537">4537</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4538">4538</td><td class="line">	<span class='keyword'>return</span> dst - line;</td></tr>
<tr><td class="num" id="LN4539">4539</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4540">4540</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4541">4541</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> patch_id_consume(<span class='keyword'>void</span> *priv, <span class='keyword'>char</span> *line, <span class='keyword'>unsigned</span> <span class='keyword'>long</span> len)</td></tr>
<tr><td class="num" id="LN4542">4542</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4543">4543</td><td class="line">	<span class='keyword'>struct</span> patch_id_t *data = priv;</td></tr>
<tr><td class="num" id="LN4544">4544</td><td class="line">	<span class='keyword'>int</span> new_len;</td></tr>
<tr><td class="num" id="LN4545">4545</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4546">4546</td><td class="line">	<span class='comment'>/* Ignore line numbers when computing the SHA1 of the patch */</span></td></tr>
<tr><td class="num" id="LN4547">4547</td><td class="line">	<span class='keyword'>if</span> (starts_with(line, <span class='string_literal'>"@@ -"</span>))</td></tr>
<tr><td class="num" id="LN4548">4548</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN4549">4549</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4550">4550</td><td class="line">	new_len = remove_space(line, len);</td></tr>
<tr><td class="num" id="LN4551">4551</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4552">4552</td><td class="line">	<span class='macro'>git_SHA1_Update<span class='expansion'>git_SHA1_Update_Chunked</span></span>(data-&gt;ctx, line, new_len);</td></tr>
<tr><td class="num" id="LN4553">4553</td><td class="line">	data-&gt;patchlen += new_len;</td></tr>
<tr><td class="num" id="LN4554">4554</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4555">4555</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4556">4556</td><td class="line"><span class='comment'>/* returns 0 upon success, and writes result into sha1 */</span></td></tr>
<tr><td class="num" id="LN4557">4557</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_get_patch_id(<span class='keyword'>struct</span> diff_options *options, <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *sha1, <span class='keyword'>int</span> diff_header_only)</td></tr>
<tr><td class="num" id="LN4558">4558</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4559">4559</td><td class="line">	<span class='keyword'>struct</span> diff_queue_struct *q = &amp;diff_queued_diff;</td></tr>
<tr><td class="num" id="LN4560">4560</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN4561">4561</td><td class="line">	<span class='macro'>git_SHA_CTX<span class='expansion'>blk_SHA_CTX</span></span> ctx;</td></tr>
<tr><td class="num" id="LN4562">4562</td><td class="line">	<span class='keyword'>struct</span> patch_id_t data;</td></tr>
<tr><td class="num" id="LN4563">4563</td><td class="line">	<span class='keyword'>char</span> buffer[<span class='macro'>PATH_MAX<span class='expansion'>1024</span></span> * 4 + 20];</td></tr>
<tr><td class="num" id="LN4564">4564</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4565">4565</td><td class="line">	<span class='macro'>git_SHA1_Init<span class='expansion'>blk_SHA1_Init</span></span>(&amp;ctx);</td></tr>
<tr><td class="num" id="LN4566">4566</td><td class="line">	<span class='macro'>memset(&amp;data, 0, <span class='keyword'>sizeof</span>(<span class='keyword'>struct</span> patch_id_t))<span class='expansion'>__builtin___memset_chk (&amp;data, 0, sizeof(struct patch_id_t<br>), __builtin_object_size (&amp;data, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN4567">4567</td><td class="line">	data.ctx = &amp;ctx;</td></tr>
<tr><td class="num" id="LN4568">4568</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4569">4569</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN4570">4570</td><td class="line">		xpparam_t xpp;</td></tr>
<tr><td class="num" id="LN4571">4571</td><td class="line">		xdemitconf_t xecfg;</td></tr>
<tr><td class="num" id="LN4572">4572</td><td class="line">		mmfile_t mf1, mf2;</td></tr>
<tr><td class="num" id="LN4573">4573</td><td class="line">		<span class='keyword'>struct</span> diff_filepair *p = q-&gt;queue[i];</td></tr>
<tr><td class="num" id="LN4574">4574</td><td class="line">		<span class='keyword'>int</span> len1, len2;</td></tr>
<tr><td class="num" id="LN4575">4575</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4576">4576</td><td class="line">		<span class='macro'>memset(&amp;xpp, 0, <span class='keyword'>sizeof</span>(xpp))<span class='expansion'>__builtin___memset_chk (&amp;xpp, 0, sizeof(xpp), __builtin_object_size<br> (&amp;xpp, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN4577">4577</td><td class="line">		<span class='macro'>memset(&amp;xecfg, 0, <span class='keyword'>sizeof</span>(xecfg))<span class='expansion'>__builtin___memset_chk (&amp;xecfg, 0, sizeof(xecfg), __builtin_object_size<br> (&amp;xecfg, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN4578">4578</td><td class="line">		<span class='keyword'>if</span> (p-&gt;status == 0)</td></tr>
<tr><td class="num" id="LN4579">4579</td><td class="line">			<span class='keyword'>return</span> <span class='macro'>error(<span class='string_literal'>"internal diff status error"</span>)<span class='expansion'>(error("internal diff status error"), const_error())</span></span>;</td></tr>
<tr><td class="num" id="LN4580">4580</td><td class="line">		<span class='keyword'>if</span> (p-&gt;status == <span class='macro'>DIFF_STATUS_UNKNOWN<span class='expansion'>'X'</span></span>)</td></tr>
<tr><td class="num" id="LN4581">4581</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN4582">4582</td><td class="line">		<span class='keyword'>if</span> (diff_unmodified_pair(p))</td></tr>
<tr><td class="num" id="LN4583">4583</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN4584">4584</td><td class="line">		<span class='keyword'>if</span> ((<span class='macro'>DIFF_FILE_VALID(p-&gt;one)<span class='expansion'>(((p-&gt;one)-&gt;mode) != 0)</span></span> &amp;&amp; <span class='macro'>S_ISDIR(p-&gt;one-&gt;mode)<span class='expansion'>(((p-&gt;one-&gt;mode) &amp; 0170000) == 0040000)</span></span>) ||</td></tr>
<tr><td class="num" id="LN4585">4585</td><td class="line">		    (<span class='macro'>DIFF_FILE_VALID(p-&gt;two)<span class='expansion'>(((p-&gt;two)-&gt;mode) != 0)</span></span> &amp;&amp; <span class='macro'>S_ISDIR(p-&gt;two-&gt;mode)<span class='expansion'>(((p-&gt;two-&gt;mode) &amp; 0170000) == 0040000)</span></span>))</td></tr>
<tr><td class="num" id="LN4586">4586</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN4587">4587</td><td class="line">		<span class='keyword'>if</span> (<span class='macro'>DIFF_PAIR_UNMERGED(p)<span class='expansion'>((p)-&gt;is_unmerged)</span></span>)</td></tr>
<tr><td class="num" id="LN4588">4588</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN4589">4589</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4590">4590</td><td class="line">		diff_fill_sha1_info(p-&gt;one);</td></tr>
<tr><td class="num" id="LN4591">4591</td><td class="line">		diff_fill_sha1_info(p-&gt;two);</td></tr>
<tr><td class="num" id="LN4592">4592</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4593">4593</td><td class="line">		len1 = remove_space(p-&gt;one-&gt;path, strlen(p-&gt;one-&gt;path));</td></tr>
<tr><td class="num" id="LN4594">4594</td><td class="line">		len2 = remove_space(p-&gt;two-&gt;path, strlen(p-&gt;two-&gt;path));</td></tr>
<tr><td class="num" id="LN4595">4595</td><td class="line">		<span class='keyword'>if</span> (p-&gt;one-&gt;mode == 0)</td></tr>
<tr><td class="num" id="LN4596">4596</td><td class="line">			len1 = <span class='macro'>snprintf(buffer, <span class='keyword'>sizeof</span>(buffer),<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "newfilemode%06o"<br> "---/dev/null" "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;two-&gt;mode, len2, p-&gt;two-&gt;path<br>)</span></span></td></tr>
<tr><td class="num" id="LN4597">4597</td><td class="line">					<span class='string_literal'><span class='macro'>"diff--gita/%.*sb/%.*s"<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "newfilemode%06o"<br> "---/dev/null" "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;two-&gt;mode, len2, p-&gt;two-&gt;path<br>)</span></span></span></td></tr>
<tr><td class="num" id="LN4598">4598</td><td class="line">					<span class='string_literal'><span class='macro'>"newfilemode%06o"<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "newfilemode%06o"<br> "---/dev/null" "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;two-&gt;mode, len2, p-&gt;two-&gt;path<br>)</span></span></span></td></tr>
<tr><td class="num" id="LN4599">4599</td><td class="line">					<span class='string_literal'><span class='macro'>"---/dev/null"<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "newfilemode%06o"<br> "---/dev/null" "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;two-&gt;mode, len2, p-&gt;two-&gt;path<br>)</span></span></span></td></tr>
<tr><td class="num" id="LN4600">4600</td><td class="line">					<span class='string_literal'><span class='macro'>"+++b/%.*s"</span>,<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "newfilemode%06o"<br> "---/dev/null" "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;two-&gt;mode, len2, p-&gt;two-&gt;path<br>)</span></span></td></tr>
<tr><td class="num" id="LN4601">4601</td><td class="line">					<span class='macro'>len1, p-&gt;one-&gt;path,<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "newfilemode%06o"<br> "---/dev/null" "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;two-&gt;mode, len2, p-&gt;two-&gt;path<br>)</span></span></td></tr>
<tr><td class="num" id="LN4602">4602</td><td class="line">					<span class='macro'>len2, p-&gt;two-&gt;path,<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "newfilemode%06o"<br> "---/dev/null" "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;two-&gt;mode, len2, p-&gt;two-&gt;path<br>)</span></span></td></tr>
<tr><td class="num" id="LN4603">4603</td><td class="line">					<span class='macro'>p-&gt;two-&gt;mode,<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "newfilemode%06o"<br> "---/dev/null" "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;two-&gt;mode, len2, p-&gt;two-&gt;path<br>)</span></span></td></tr>
<tr><td class="num" id="LN4604">4604</td><td class="line">					<span class='macro'>len2, p-&gt;two-&gt;path)<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "newfilemode%06o"<br> "---/dev/null" "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;two-&gt;mode, len2, p-&gt;two-&gt;path<br>)</span></span>;</td></tr>
<tr><td class="num" id="LN4605">4605</td><td class="line">		<span class='keyword'>else</span> <span class='keyword'>if</span> (p-&gt;two-&gt;mode == 0)</td></tr>
<tr><td class="num" id="LN4606">4606</td><td class="line">			len1 = <span class='macro'>snprintf(buffer, <span class='keyword'>sizeof</span>(buffer),<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "deletedfilemode%06o"<br> "---a/%.*s" "+++/dev/null", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;one-&gt;mode, len1, p-&gt;one-&gt;path<br>)</span></span></td></tr>
<tr><td class="num" id="LN4607">4607</td><td class="line">					<span class='string_literal'><span class='macro'>"diff--gita/%.*sb/%.*s"<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "deletedfilemode%06o"<br> "---a/%.*s" "+++/dev/null", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;one-&gt;mode, len1, p-&gt;one-&gt;path<br>)</span></span></span></td></tr>
<tr><td class="num" id="LN4608">4608</td><td class="line">					<span class='string_literal'><span class='macro'>"deletedfilemode%06o"<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "deletedfilemode%06o"<br> "---a/%.*s" "+++/dev/null", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;one-&gt;mode, len1, p-&gt;one-&gt;path<br>)</span></span></span></td></tr>
<tr><td class="num" id="LN4609">4609</td><td class="line">					<span class='string_literal'><span class='macro'>"---a/%.*s"<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "deletedfilemode%06o"<br> "---a/%.*s" "+++/dev/null", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;one-&gt;mode, len1, p-&gt;one-&gt;path<br>)</span></span></span></td></tr>
<tr><td class="num" id="LN4610">4610</td><td class="line">					<span class='string_literal'><span class='macro'>"+++/dev/null"</span>,<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "deletedfilemode%06o"<br> "---a/%.*s" "+++/dev/null", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;one-&gt;mode, len1, p-&gt;one-&gt;path<br>)</span></span></td></tr>
<tr><td class="num" id="LN4611">4611</td><td class="line">					<span class='macro'>len1, p-&gt;one-&gt;path,<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "deletedfilemode%06o"<br> "---a/%.*s" "+++/dev/null", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;one-&gt;mode, len1, p-&gt;one-&gt;path<br>)</span></span></td></tr>
<tr><td class="num" id="LN4612">4612</td><td class="line">					<span class='macro'>len2, p-&gt;two-&gt;path,<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "deletedfilemode%06o"<br> "---a/%.*s" "+++/dev/null", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;one-&gt;mode, len1, p-&gt;one-&gt;path<br>)</span></span></td></tr>
<tr><td class="num" id="LN4613">4613</td><td class="line">					<span class='macro'>p-&gt;one-&gt;mode,<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "deletedfilemode%06o"<br> "---a/%.*s" "+++/dev/null", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;one-&gt;mode, len1, p-&gt;one-&gt;path<br>)</span></span></td></tr>
<tr><td class="num" id="LN4614">4614</td><td class="line">					<span class='macro'>len1, p-&gt;one-&gt;path)<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "deletedfilemode%06o"<br> "---a/%.*s" "+++/dev/null", len1, p-&gt;one-&gt;path, len2, p<br>-&gt;two-&gt;path, p-&gt;one-&gt;mode, len1, p-&gt;one-&gt;path<br>)</span></span>;</td></tr>
<tr><td class="num" id="LN4615">4615</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN4616">4616</td><td class="line">			len1 = <span class='macro'>snprintf(buffer, <span class='keyword'>sizeof</span>(buffer),<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "---a/%.*s"<br> "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path<br>, len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path)</span></span></td></tr>
<tr><td class="num" id="LN4617">4617</td><td class="line">					<span class='string_literal'><span class='macro'>"diff--gita/%.*sb/%.*s"<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "---a/%.*s"<br> "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path<br>, len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path)</span></span></span></td></tr>
<tr><td class="num" id="LN4618">4618</td><td class="line">					<span class='string_literal'><span class='macro'>"---a/%.*s"<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "---a/%.*s"<br> "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path<br>, len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path)</span></span></span></td></tr>
<tr><td class="num" id="LN4619">4619</td><td class="line">					<span class='string_literal'><span class='macro'>"+++b/%.*s"</span>,<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "---a/%.*s"<br> "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path<br>, len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path)</span></span></td></tr>
<tr><td class="num" id="LN4620">4620</td><td class="line">					<span class='macro'>len1, p-&gt;one-&gt;path,<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "---a/%.*s"<br> "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path<br>, len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path)</span></span></td></tr>
<tr><td class="num" id="LN4621">4621</td><td class="line">					<span class='macro'>len2, p-&gt;two-&gt;path,<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "---a/%.*s"<br> "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path<br>, len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path)</span></span></td></tr>
<tr><td class="num" id="LN4622">4622</td><td class="line">					<span class='macro'>len1, p-&gt;one-&gt;path,<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "---a/%.*s"<br> "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path<br>, len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path)</span></span></td></tr>
<tr><td class="num" id="LN4623">4623</td><td class="line">					<span class='macro'>len2, p-&gt;two-&gt;path)<span class='expansion'>__builtin___snprintf_chk (buffer, sizeof(buffer), 0, __builtin_object_size<br> (buffer, 2 &gt; 1 ? 1 : 0), "diff--gita/%.*sb/%.*s" "---a/%.*s"<br> "+++b/%.*s", len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path<br>, len1, p-&gt;one-&gt;path, len2, p-&gt;two-&gt;path)</span></span>;</td></tr>
<tr><td class="num" id="LN4624">4624</td><td class="line">		<span class='macro'>git_SHA1_Update<span class='expansion'>git_SHA1_Update_Chunked</span></span>(&amp;ctx, buffer, len1);</td></tr>
<tr><td class="num" id="LN4625">4625</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4626">4626</td><td class="line">		<span class='keyword'>if</span> (diff_header_only)</td></tr>
<tr><td class="num" id="LN4627">4627</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN4628">4628</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4629">4629</td><td class="line">		<span class='keyword'>if</span> (fill_mmfile(&amp;mf1, p-&gt;one) &lt; 0 ||</td></tr>
<tr><td class="num" id="LN4630">4630</td><td class="line">		    fill_mmfile(&amp;mf2, p-&gt;two) &lt; 0)</td></tr>
<tr><td class="num" id="LN4631">4631</td><td class="line">			<span class='keyword'>return</span> <span class='macro'>error(<span class='string_literal'>"unable to read files to diff"</span>)<span class='expansion'>(error("unable to read files to diff"), const_error())</span></span>;</td></tr>
<tr><td class="num" id="LN4632">4632</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4633">4633</td><td class="line">		<span class='keyword'>if</span> (diff_filespec_is_binary(p-&gt;one) ||</td></tr>
<tr><td class="num" id="LN4634">4634</td><td class="line">		    diff_filespec_is_binary(p-&gt;two)) {</td></tr>
<tr><td class="num" id="LN4635">4635</td><td class="line">			<span class='macro'>git_SHA1_Update<span class='expansion'>git_SHA1_Update_Chunked</span></span>(&amp;ctx, oid_to_hex(&amp;p-&gt;one-&gt;oid),</td></tr>
<tr><td class="num" id="LN4636">4636</td><td class="line">					40);</td></tr>
<tr><td class="num" id="LN4637">4637</td><td class="line">			<span class='macro'>git_SHA1_Update<span class='expansion'>git_SHA1_Update_Chunked</span></span>(&amp;ctx, oid_to_hex(&amp;p-&gt;two-&gt;oid),</td></tr>
<tr><td class="num" id="LN4638">4638</td><td class="line">					40);</td></tr>
<tr><td class="num" id="LN4639">4639</td><td class="line">			<span class='keyword'>continue</span>;</td></tr>
<tr><td class="num" id="LN4640">4640</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4641">4641</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4642">4642</td><td class="line">		xpp.flags = 0;</td></tr>
<tr><td class="num" id="LN4643">4643</td><td class="line">		xecfg.ctxlen = 3;</td></tr>
<tr><td class="num" id="LN4644">4644</td><td class="line">		xecfg.flags = 0;</td></tr>
<tr><td class="num" id="LN4645">4645</td><td class="line">		<span class='keyword'>if</span> (xdi_diff_outf(&amp;mf1, &amp;mf2, patch_id_consume, &amp;data,</td></tr>
<tr><td class="num" id="LN4646">4646</td><td class="line">				  &amp;xpp, &amp;xecfg))</td></tr>
<tr><td class="num" id="LN4647">4647</td><td class="line">			<span class='keyword'>return</span> <span class='macro'>error(<span class='string_literal'>"unable to generate patch-id diff for %s"</span>,<span class='expansion'>(error("unable to generate patch-id diff for %s", p-&gt;one-&gt;<br>path), const_error())</span></span></td></tr>
<tr><td class="num" id="LN4648">4648</td><td class="line">				     <span class='macro'>p-&gt;one-&gt;path)<span class='expansion'>(error("unable to generate patch-id diff for %s", p-&gt;one-&gt;<br>path), const_error())</span></span>;</td></tr>
<tr><td class="num" id="LN4649">4649</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4650">4650</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4651">4651</td><td class="line">	<span class='macro'>git_SHA1_Final<span class='expansion'>blk_SHA1_Final</span></span>(sha1, &amp;ctx);</td></tr>
<tr><td class="num" id="LN4652">4652</td><td class="line">	<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN4653">4653</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4654">4654</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4655">4655</td><td class="line"><span class='keyword'>int</span> diff_flush_patch_id(<span class='keyword'>struct</span> diff_options *options, <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *sha1, <span class='keyword'>int</span> diff_header_only)</td></tr>
<tr><td class="num" id="LN4656">4656</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4657">4657</td><td class="line">	<span class='keyword'>struct</span> diff_queue_struct *q = &amp;diff_queued_diff;</td></tr>
<tr><td class="num" id="LN4658">4658</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN4659">4659</td><td class="line">	<span class='keyword'>int</span> result = diff_get_patch_id(options, sha1, diff_header_only);</td></tr>
<tr><td class="num" id="LN4660">4660</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4661">4661</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++)</td></tr>
<tr><td class="num" id="LN4662">4662</td><td class="line">		diff_free_filepair(q-&gt;queue[i]);</td></tr>
<tr><td class="num" id="LN4663">4663</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4664">4664</td><td class="line">	free(q-&gt;queue);</td></tr>
<tr><td class="num" id="LN4665">4665</td><td class="line">	<span class='macro'>DIFF_QUEUE_CLEAR(q)<span class='expansion'>do { (q)-&gt;queue = ((void*)0); (q)-&gt;nr = (q)-&gt;alloc =<br> 0; } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN4666">4666</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4667">4667</td><td class="line">	<span class='keyword'>return</span> result;</td></tr>
<tr><td class="num" id="LN4668">4668</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4669">4669</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4670">4670</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> is_summary_empty(<span class='keyword'>const</span> <span class='keyword'>struct</span> diff_queue_struct *q)</td></tr>
<tr><td class="num" id="LN4671">4671</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4672">4672</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN4673">4673</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4674">4674</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN4675">4675</td><td class="line">		<span class='keyword'>const</span> <span class='keyword'>struct</span> diff_filepair *p = q-&gt;queue[i];</td></tr>
<tr><td class="num" id="LN4676">4676</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4677">4677</td><td class="line">		<span class='keyword'>switch</span> (p-&gt;status) {</td></tr>
<tr><td class="num" id="LN4678">4678</td><td class="line">		<span class='keyword'>case</span> <span class='macro'>DIFF_STATUS_DELETED<span class='expansion'>'D'</span></span>:</td></tr>
<tr><td class="num" id="LN4679">4679</td><td class="line">		<span class='keyword'>case</span> <span class='macro'>DIFF_STATUS_ADDED<span class='expansion'>'A'</span></span>:</td></tr>
<tr><td class="num" id="LN4680">4680</td><td class="line">		<span class='keyword'>case</span> <span class='macro'>DIFF_STATUS_COPIED<span class='expansion'>'C'</span></span>:</td></tr>
<tr><td class="num" id="LN4681">4681</td><td class="line">		<span class='keyword'>case</span> <span class='macro'>DIFF_STATUS_RENAMED<span class='expansion'>'R'</span></span>:</td></tr>
<tr><td class="num" id="LN4682">4682</td><td class="line">			<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN4683">4683</td><td class="line">		<span class='keyword'>default</span>:</td></tr>
<tr><td class="num" id="LN4684">4684</td><td class="line">			<span class='keyword'>if</span> (p-&gt;score)</td></tr>
<tr><td class="num" id="LN4685">4685</td><td class="line">				<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN4686">4686</td><td class="line">			<span class='keyword'>if</span> (p-&gt;one-&gt;mode &amp;&amp; p-&gt;two-&gt;mode &amp;&amp;</td></tr>
<tr><td class="num" id="LN4687">4687</td><td class="line">			    p-&gt;one-&gt;mode != p-&gt;two-&gt;mode)</td></tr>
<tr><td class="num" id="LN4688">4688</td><td class="line">				<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN4689">4689</td><td class="line">			<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN4690">4690</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4691">4691</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4692">4692</td><td class="line">	<span class='keyword'>return</span> 1;</td></tr>
<tr><td class="num" id="LN4693">4693</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4694">4694</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4695">4695</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> rename_limit_warning[] =</td></tr>
<tr><td class="num" id="LN4696">4696</td><td class="line"><span class='macro'>N_(<span class='string_literal'>"inexact rename detection was skipped due to too many files."</span>)<span class='expansion'>("inexact rename detection was skipped due to too many files."<br>)</span></span>;</td></tr>
<tr><td class="num" id="LN4697">4697</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4698">4698</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> degrade_cc_to_c_warning[] =</td></tr>
<tr><td class="num" id="LN4699">4699</td><td class="line"><span class='macro'>N_(<span class='string_literal'>"only found copies from modified paths due to too many files."</span>)<span class='expansion'>("only found copies from modified paths due to too many files."<br>)</span></span>;</td></tr>
<tr><td class="num" id="LN4700">4700</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4701">4701</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>char</span> rename_limit_advice[] =</td></tr>
<tr><td class="num" id="LN4702">4702</td><td class="line"><span class='macro'>N_(<span class='string_literal'>"you may want to set your %s variable to at least "<span class='expansion'>("you may want to set your %s variable to at least " "%d and retry the command."<br>)</span></span></span></td></tr>
<tr><td class="num" id="LN4703">4703</td><td class="line">   <span class='string_literal'><span class='macro'>"%d and retry the command."</span>)<span class='expansion'>("you may want to set your %s variable to at least " "%d and retry the command."<br>)</span></span>;</td></tr>
<tr><td class="num" id="LN4704">4704</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4705">4705</td><td class="line"><span class='keyword'>void</span> diff_warn_rename_limit(<span class='keyword'>const</span> <span class='keyword'>char</span> *varname, <span class='keyword'>int</span> needed, <span class='keyword'>int</span> degraded_cc)</td></tr>
<tr><td class="num" id="LN4706">4706</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4707">4707</td><td class="line">	<span class='keyword'>if</span> (degraded_cc)</td></tr>
<tr><td class="num" id="LN4708">4708</td><td class="line">		warning(_(degrade_cc_to_c_warning));</td></tr>
<tr><td class="num" id="LN4709">4709</td><td class="line">	<span class='keyword'>else</span> <span class='keyword'>if</span> (needed)</td></tr>
<tr><td class="num" id="LN4710">4710</td><td class="line">		warning(_(rename_limit_warning));</td></tr>
<tr><td class="num" id="LN4711">4711</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN4712">4712</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN4713">4713</td><td class="line">	<span class='keyword'>if</span> (0 &lt; needed &amp;&amp; needed &lt; 32767)</td></tr>
<tr><td class="num" id="LN4714">4714</td><td class="line">		warning(_(rename_limit_advice), varname, needed);</td></tr>
<tr><td class="num" id="LN4715">4715</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4716">4716</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4717">4717</td><td class="line"><span class='keyword'>void</span> diff_flush(<span class='keyword'>struct</span> diff_options *options)</td></tr>
<tr><td class="num" id="LN4718">4718</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4719">4719</td><td class="line">	<span class='keyword'>struct</span> diff_queue_struct *q = &amp;diff_queued_diff;</td></tr>
<tr><td class="num" id="LN4720">4720</td><td class="line">	<span class='keyword'>int</span> i, output_format = options-&gt;output_format;</td></tr>
<tr><td class="num" id="LN4721">4721</td><td class="line">	<span class='keyword'>int</span> separator = 0;</td></tr>
<tr><td class="num" id="LN4722">4722</td><td class="line">	<span class='keyword'>int</span> dirstat_by_line = 0;</td></tr>
<tr><td class="num" id="LN4723">4723</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4724">4724</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN4725">4725</td><td class="line">	 <span class='comment'>* Order: raw, stat, summary, patch</span></td></tr>
<tr><td class="num" id="LN4726">4726</td><td class="line">	 <span class='comment'>* or:    name/name-status/checkdiff (other bits clear)</span></td></tr>
<tr><td class="num" id="LN4727">4727</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN4728">4728</td><td class="line">	<span class='keyword'>if</span> (!q-&gt;nr)</td></tr>
<tr><td class="num" id="LN4729">4729</td><td class="line">		<span class='keyword'>goto</span> free_queue;</td></tr>
<tr><td class="num" id="LN4730">4730</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4731">4731</td><td class="line">	<span class='keyword'>if</span> (output_format &amp; (<span class='macro'>DIFF_FORMAT_RAW<span class='expansion'>0x0001</span></span> |</td></tr>
<tr><td class="num" id="LN4732">4732</td><td class="line">			     <span class='macro'>DIFF_FORMAT_NAME<span class='expansion'>0x0100</span></span> |</td></tr>
<tr><td class="num" id="LN4733">4733</td><td class="line">			     <span class='macro'>DIFF_FORMAT_NAME_STATUS<span class='expansion'>0x0200</span></span> |</td></tr>
<tr><td class="num" id="LN4734">4734</td><td class="line">			     <span class='macro'>DIFF_FORMAT_CHECKDIFF<span class='expansion'>0x0400</span></span>)) {</td></tr>
<tr><td class="num" id="LN4735">4735</td><td class="line">		<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN4736">4736</td><td class="line">			<span class='keyword'>struct</span> diff_filepair *p = q-&gt;queue[i];</td></tr>
<tr><td class="num" id="LN4737">4737</td><td class="line">			<span class='keyword'>if</span> (check_pair_status(p))</td></tr>
<tr><td class="num" id="LN4738">4738</td><td class="line">				flush_one_pair(p, options);</td></tr>
<tr><td class="num" id="LN4739">4739</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4740">4740</td><td class="line">		separator++;</td></tr>
<tr><td class="num" id="LN4741">4741</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4742">4742</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4743">4743</td><td class="line">	<span class='keyword'>if</span> (output_format &amp; <span class='macro'>DIFF_FORMAT_DIRSTAT<span class='expansion'>0x0040</span></span> &amp;&amp; <span class='macro'>DIFF_OPT_TST(options, DIRSTAT_BY_LINE)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 28))</span></span>)</td></tr>
<tr><td class="num" id="LN4744">4744</td><td class="line">		dirstat_by_line = 1;</td></tr>
<tr><td class="num" id="LN4745">4745</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4746">4746</td><td class="line">	<span class='keyword'>if</span> (output_format &amp; (<span class='macro'>DIFF_FORMAT_DIFFSTAT<span class='expansion'>0x0002</span></span>|<span class='macro'>DIFF_FORMAT_SHORTSTAT<span class='expansion'>0x0020</span></span>|<span class='macro'>DIFF_FORMAT_NUMSTAT<span class='expansion'>0x0004</span></span>) ||</td></tr>
<tr><td class="num" id="LN4747">4747</td><td class="line">	    dirstat_by_line) {</td></tr>
<tr><td class="num" id="LN4748">4748</td><td class="line">		<span class='keyword'>struct</span> diffstat_t diffstat;</td></tr>
<tr><td class="num" id="LN4749">4749</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4750">4750</td><td class="line">		<span class='macro'>memset(&amp;diffstat, 0, <span class='keyword'>sizeof</span>(<span class='keyword'>struct</span> diffstat_t))<span class='expansion'>__builtin___memset_chk (&amp;diffstat, 0, sizeof(struct diffstat_t<br>), __builtin_object_size (&amp;diffstat, 0))</span></span>;</td></tr>
<tr><td class="num" id="LN4751">4751</td><td class="line">		<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN4752">4752</td><td class="line">			<span class='keyword'>struct</span> diff_filepair *p = q-&gt;queue[i];</td></tr>
<tr><td class="num" id="LN4753">4753</td><td class="line">			<span class='keyword'>if</span> (check_pair_status(p))</td></tr>
<tr><td class="num" id="LN4754">4754</td><td class="line">				diff_flush_stat(p, options, &amp;diffstat);</td></tr>
<tr><td class="num" id="LN4755">4755</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4756">4756</td><td class="line">		<span class='keyword'>if</span> (output_format &amp; <span class='macro'>DIFF_FORMAT_NUMSTAT<span class='expansion'>0x0004</span></span>)</td></tr>
<tr><td class="num" id="LN4757">4757</td><td class="line">			show_numstat(&amp;diffstat, options);</td></tr>
<tr><td class="num" id="LN4758">4758</td><td class="line">		<span class='keyword'>if</span> (output_format &amp; <span class='macro'>DIFF_FORMAT_DIFFSTAT<span class='expansion'>0x0002</span></span>)</td></tr>
<tr><td class="num" id="LN4759">4759</td><td class="line">			show_stats(&amp;diffstat, options);</td></tr>
<tr><td class="num" id="LN4760">4760</td><td class="line">		<span class='keyword'>if</span> (output_format &amp; <span class='macro'>DIFF_FORMAT_SHORTSTAT<span class='expansion'>0x0020</span></span>)</td></tr>
<tr><td class="num" id="LN4761">4761</td><td class="line">			show_shortstats(&amp;diffstat, options);</td></tr>
<tr><td class="num" id="LN4762">4762</td><td class="line">		<span class='keyword'>if</span> (output_format &amp; <span class='macro'>DIFF_FORMAT_DIRSTAT<span class='expansion'>0x0040</span></span> &amp;&amp; dirstat_by_line)</td></tr>
<tr><td class="num" id="LN4763">4763</td><td class="line">			show_dirstat_by_line(&amp;diffstat, options);</td></tr>
<tr><td class="num" id="LN4764">4764</td><td class="line">		free_diffstat_info(&amp;diffstat);</td></tr>
<tr><td class="num" id="LN4765">4765</td><td class="line">		separator++;</td></tr>
<tr><td class="num" id="LN4766">4766</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4767">4767</td><td class="line">	<span class='keyword'>if</span> ((output_format &amp; <span class='macro'>DIFF_FORMAT_DIRSTAT<span class='expansion'>0x0040</span></span>) &amp;&amp; !dirstat_by_line)</td></tr>
<tr><td class="num" id="LN4768">4768</td><td class="line">		show_dirstat(options);</td></tr>
<tr><td class="num" id="LN4769">4769</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4770">4770</td><td class="line">	<span class='keyword'>if</span> (output_format &amp; <span class='macro'>DIFF_FORMAT_SUMMARY<span class='expansion'>0x0008</span></span> &amp;&amp; !is_summary_empty(q)) {</td></tr>
<tr><td class="num" id="LN4771">4771</td><td class="line">		<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN4772">4772</td><td class="line">			diff_summary(options, q-&gt;queue[i]);</td></tr>
<tr><td class="num" id="LN4773">4773</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4774">4774</td><td class="line">		separator++;</td></tr>
<tr><td class="num" id="LN4775">4775</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4776">4776</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4777">4777</td><td class="line">	<span class='keyword'>if</span> (output_format &amp; <span class='macro'>DIFF_FORMAT_NO_OUTPUT<span class='expansion'>0x0800</span></span> &amp;&amp;</td></tr>
<tr><td class="num" id="LN4778">4778</td><td class="line">	    <span class='macro'>DIFF_OPT_TST(options, EXIT_WITH_STATUS)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 14))</span></span> &amp;&amp;</td></tr>
<tr><td class="num" id="LN4779">4779</td><td class="line">	    <span class='macro'>DIFF_OPT_TST(options, DIFF_FROM_CONTENTS)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 22))</span></span>) {</td></tr>
<tr><td class="num" id="LN4780">4780</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN4781">4781</td><td class="line">		 <span class='comment'>* run diff_flush_patch for the exit status. setting</span></td></tr>
<tr><td class="num" id="LN4782">4782</td><td class="line">		 <span class='comment'>* options-&gt;file to /dev/null should be safe, because we</span></td></tr>
<tr><td class="num" id="LN4783">4783</td><td class="line">		 <span class='comment'>* aren't supposed to produce any output anyway.</span></td></tr>
<tr><td class="num" id="LN4784">4784</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN4785">4785</td><td class="line">		<span class='keyword'>if</span> (options-&gt;close_file)</td></tr>
<tr><td class="num" id="LN4786">4786</td><td class="line">			fclose(options-&gt;file);</td></tr>
<tr><td class="num" id="LN4787">4787</td><td class="line">		options-&gt;file = fopen(<span class='string_literal'>"/dev/null"</span>, <span class='string_literal'>"w"</span>);</td></tr>
<tr><td class="num" id="LN4788">4788</td><td class="line">		<span class='keyword'>if</span> (!options-&gt;file)</td></tr>
<tr><td class="num" id="LN4789">4789</td><td class="line">			die_errno(<span class='string_literal'>"Could not open /dev/null"</span>);</td></tr>
<tr><td class="num" id="LN4790">4790</td><td class="line">		options-&gt;close_file = 1;</td></tr>
<tr><td class="num" id="LN4791">4791</td><td class="line">		<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN4792">4792</td><td class="line">			<span class='keyword'>struct</span> diff_filepair *p = q-&gt;queue[i];</td></tr>
<tr><td class="num" id="LN4793">4793</td><td class="line">			<span class='keyword'>if</span> (check_pair_status(p))</td></tr>
<tr><td class="num" id="LN4794">4794</td><td class="line">				diff_flush_patch(p, options);</td></tr>
<tr><td class="num" id="LN4795">4795</td><td class="line">			<span class='keyword'>if</span> (options-&gt;found_changes)</td></tr>
<tr><td class="num" id="LN4796">4796</td><td class="line">				<span class='keyword'>break</span>;</td></tr>
<tr><td class="num" id="LN4797">4797</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4798">4798</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4799">4799</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4800">4800</td><td class="line">	<span class='keyword'>if</span> (output_format &amp; <span class='macro'>DIFF_FORMAT_PATCH<span class='expansion'>0x0010</span></span>) {</td></tr>
<tr><td class="num" id="LN4801">4801</td><td class="line">		<span class='keyword'>if</span> (separator) {</td></tr>
<tr><td class="num" id="LN4802">4802</td><td class="line">			fprintf(options-&gt;file, <span class='string_literal'>"%s%c"</span>,</td></tr>
<tr><td class="num" id="LN4803">4803</td><td class="line">				diff_line_prefix(options),</td></tr>
<tr><td class="num" id="LN4804">4804</td><td class="line">				options-&gt;line_termination);</td></tr>
<tr><td class="num" id="LN4805">4805</td><td class="line">			<span class='keyword'>if</span> (options-&gt;stat_sep) {</td></tr>
<tr><td class="num" id="LN4806">4806</td><td class="line">				<span class='comment'>/* attach patch instead of inline */</span></td></tr>
<tr><td class="num" id="LN4807">4807</td><td class="line">				fputs(options-&gt;stat_sep, options-&gt;file);</td></tr>
<tr><td class="num" id="LN4808">4808</td><td class="line">			}</td></tr>
<tr><td class="num" id="LN4809">4809</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4810">4810</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4811">4811</td><td class="line">		<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN4812">4812</td><td class="line">			<span class='keyword'>struct</span> diff_filepair *p = q-&gt;queue[i];</td></tr>
<tr><td class="num" id="LN4813">4813</td><td class="line">			<span class='keyword'>if</span> (check_pair_status(p))</td></tr>
<tr><td class="num" id="LN4814">4814</td><td class="line">				diff_flush_patch(p, options);</td></tr>
<tr><td class="num" id="LN4815">4815</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4816">4816</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4817">4817</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4818">4818</td><td class="line">	<span class='keyword'>if</span> (output_format &amp; <span class='macro'>DIFF_FORMAT_CALLBACK<span class='expansion'>0x1000</span></span>)</td></tr>
<tr><td class="num" id="LN4819">4819</td><td class="line">		options-&gt;format_callback(q, options, options-&gt;format_callback_data);</td></tr>
<tr><td class="num" id="LN4820">4820</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4821">4821</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++)</td></tr>
<tr><td class="num" id="LN4822">4822</td><td class="line">		diff_free_filepair(q-&gt;queue[i]);</td></tr>
<tr><td class="num" id="LN4823">4823</td><td class="line">free_queue:</td></tr>
<tr><td class="num" id="LN4824">4824</td><td class="line">	free(q-&gt;queue);</td></tr>
<tr><td class="num" id="LN4825">4825</td><td class="line">	<span class='macro'>DIFF_QUEUE_CLEAR(q)<span class='expansion'>do { (q)-&gt;queue = ((void*)0); (q)-&gt;nr = (q)-&gt;alloc =<br> 0; } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN4826">4826</td><td class="line">	<span class='keyword'>if</span> (options-&gt;close_file)</td></tr>
<tr><td class="num" id="LN4827">4827</td><td class="line">		fclose(options-&gt;file);</td></tr>
<tr><td class="num" id="LN4828">4828</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4829">4829</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN4830">4830</td><td class="line">	 <span class='comment'>* Report the content-level differences with HAS_CHANGES;</span></td></tr>
<tr><td class="num" id="LN4831">4831</td><td class="line">	 <span class='comment'>* diff_addremove/diff_change does not set the bit when</span></td></tr>
<tr><td class="num" id="LN4832">4832</td><td class="line">	 <span class='comment'>* DIFF_FROM_CONTENTS is in effect (e.g. with -w).</span></td></tr>
<tr><td class="num" id="LN4833">4833</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN4834">4834</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(options, DIFF_FROM_CONTENTS)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 22))</span></span>) {</td></tr>
<tr><td class="num" id="LN4835">4835</td><td class="line">		<span class='keyword'>if</span> (options-&gt;found_changes)</td></tr>
<tr><td class="num" id="LN4836">4836</td><td class="line">			<span class='macro'>DIFF_OPT_SET(options, HAS_CHANGES)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 10)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 10)))</span></span>;</td></tr>
<tr><td class="num" id="LN4837">4837</td><td class="line">		<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN4838">4838</td><td class="line">			<span class='macro'>DIFF_OPT_CLR(options, HAS_CHANGES)<span class='expansion'>(((options)-&gt;flags &amp;= ~(1 &lt;&lt; 10)),((options)-&gt;<br>touched_flags |= (1 &lt;&lt; 10)))</span></span>;</td></tr>
<tr><td class="num" id="LN4839">4839</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4840">4840</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4841">4841</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4842">4842</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> match_filter(<span class='keyword'>const</span> <span class='keyword'>struct</span> diff_options *options, <span class='keyword'>const</span> <span class='keyword'>struct</span> diff_filepair *p)</td></tr>
<tr><td class="num" id="LN4843">4843</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4844">4844</td><td class="line">	<span class='keyword'>return</span> (((p-&gt;status == <span class='macro'>DIFF_STATUS_MODIFIED<span class='expansion'>'M'</span></span>) &amp;&amp;</td></tr>
<tr><td class="num" id="LN4845">4845</td><td class="line">		 ((p-&gt;score &amp;&amp;</td></tr>
<tr><td class="num" id="LN4846">4846</td><td class="line">		   filter_bit_tst(<span class='macro'>DIFF_STATUS_FILTER_BROKEN<span class='expansion'>'B'</span></span>, options)) ||</td></tr>
<tr><td class="num" id="LN4847">4847</td><td class="line">		  (!p-&gt;score &amp;&amp;</td></tr>
<tr><td class="num" id="LN4848">4848</td><td class="line">		   filter_bit_tst(<span class='macro'>DIFF_STATUS_MODIFIED<span class='expansion'>'M'</span></span>, options)))) ||</td></tr>
<tr><td class="num" id="LN4849">4849</td><td class="line">		((p-&gt;status != <span class='macro'>DIFF_STATUS_MODIFIED<span class='expansion'>'M'</span></span>) &amp;&amp;</td></tr>
<tr><td class="num" id="LN4850">4850</td><td class="line">		 filter_bit_tst(p-&gt;status, options)));</td></tr>
<tr><td class="num" id="LN4851">4851</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4852">4852</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4853">4853</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> diffcore_apply_filter(<span class='keyword'>struct</span> diff_options *options)</td></tr>
<tr><td class="num" id="LN4854">4854</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4855">4855</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN4856">4856</td><td class="line">	<span class='keyword'>struct</span> diff_queue_struct *q = &amp;diff_queued_diff;</td></tr>
<tr><td class="num" id="LN4857">4857</td><td class="line">	<span class='keyword'>struct</span> diff_queue_struct outq;</td></tr>
<tr><td class="num" id="LN4858">4858</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4859">4859</td><td class="line">	<span class='macro'>DIFF_QUEUE_CLEAR(&amp;outq)<span class='expansion'>do { (&amp;outq)-&gt;queue = ((void*)0); (&amp;outq)-&gt;nr =<br> (&amp;outq)-&gt;alloc = 0; } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN4860">4860</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4861">4861</td><td class="line">	<span class='keyword'>if</span> (!options-&gt;filter)</td></tr>
<tr><td class="num" id="LN4862">4862</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN4863">4863</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4864">4864</td><td class="line">	<span class='keyword'>if</span> (filter_bit_tst(<span class='macro'>DIFF_STATUS_FILTER_AON<span class='expansion'>'*'</span></span>, options)) {</td></tr>
<tr><td class="num" id="LN4865">4865</td><td class="line">		<span class='keyword'>int</span> found;</td></tr>
<tr><td class="num" id="LN4866">4866</td><td class="line">		<span class='keyword'>for</span> (i = found = 0; !found &amp;&amp; i &lt; q-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN4867">4867</td><td class="line">			<span class='keyword'>if</span> (match_filter(options, q-&gt;queue[i]))</td></tr>
<tr><td class="num" id="LN4868">4868</td><td class="line">				found++;</td></tr>
<tr><td class="num" id="LN4869">4869</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4870">4870</td><td class="line">		<span class='keyword'>if</span> (found)</td></tr>
<tr><td class="num" id="LN4871">4871</td><td class="line">			<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN4872">4872</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4873">4873</td><td class="line">		<span class='comment'>/* otherwise we will clear the whole queue</span></td></tr>
<tr><td class="num" id="LN4874">4874</td><td class="line">		 <span class='comment'>* by copying the empty outq at the end of this</span></td></tr>
<tr><td class="num" id="LN4875">4875</td><td class="line">		 <span class='comment'>* function, but first clear the current entries</span></td></tr>
<tr><td class="num" id="LN4876">4876</td><td class="line">		 <span class='comment'>* in the queue.</span></td></tr>
<tr><td class="num" id="LN4877">4877</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN4878">4878</td><td class="line">		<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++)</td></tr>
<tr><td class="num" id="LN4879">4879</td><td class="line">			diff_free_filepair(q-&gt;queue[i]);</td></tr>
<tr><td class="num" id="LN4880">4880</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4881">4881</td><td class="line">	<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN4882">4882</td><td class="line">		<span class='comment'>/* Only the matching ones */</span></td></tr>
<tr><td class="num" id="LN4883">4883</td><td class="line">		<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN4884">4884</td><td class="line">			<span class='keyword'>struct</span> diff_filepair *p = q-&gt;queue[i];</td></tr>
<tr><td class="num" id="LN4885">4885</td><td class="line">			<span class='keyword'>if</span> (match_filter(options, p))</td></tr>
<tr><td class="num" id="LN4886">4886</td><td class="line">				diff_q(&amp;outq, p);</td></tr>
<tr><td class="num" id="LN4887">4887</td><td class="line">			<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN4888">4888</td><td class="line">				diff_free_filepair(p);</td></tr>
<tr><td class="num" id="LN4889">4889</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4890">4890</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4891">4891</td><td class="line">	free(q-&gt;queue);</td></tr>
<tr><td class="num" id="LN4892">4892</td><td class="line">	*q = outq;</td></tr>
<tr><td class="num" id="LN4893">4893</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4894">4894</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4895">4895</td><td class="line"><span class='comment'>/* Check whether two filespecs with the same mode and size are identical */</span></td></tr>
<tr><td class="num" id="LN4896">4896</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_filespec_is_identical(<span class='keyword'>struct</span> diff_filespec *one,</td></tr>
<tr><td class="num" id="LN4897">4897</td><td class="line">				      <span class='keyword'>struct</span> diff_filespec *two)</td></tr>
<tr><td class="num" id="LN4898">4898</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4899">4899</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>S_ISGITLINK(one-&gt;mode)<span class='expansion'>(((one-&gt;mode) &amp; 0170000) == 0160000)</span></span>)</td></tr>
<tr><td class="num" id="LN4900">4900</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN4901">4901</td><td class="line">	<span class='keyword'>if</span> (diff_populate_filespec(one, 0))</td></tr>
<tr><td class="num" id="LN4902">4902</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN4903">4903</td><td class="line">	<span class='keyword'>if</span> (diff_populate_filespec(two, 0))</td></tr>
<tr><td class="num" id="LN4904">4904</td><td class="line">		<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN4905">4905</td><td class="line">	<span class='keyword'>return</span> !memcmp(one-&gt;data, two-&gt;data, one-&gt;size);</td></tr>
<tr><td class="num" id="LN4906">4906</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4907">4907</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4908">4908</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diff_filespec_check_stat_unmatch(<span class='keyword'>struct</span> diff_filepair *p)</td></tr>
<tr><td class="num" id="LN4909">4909</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4910">4910</td><td class="line">	<span class='keyword'>if</span> (p-&gt;done_skip_stat_unmatch)</td></tr>
<tr><td class="num" id="LN4911">4911</td><td class="line">		<span class='keyword'>return</span> p-&gt;skip_stat_unmatch_result;</td></tr>
<tr><td class="num" id="LN4912">4912</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4913">4913</td><td class="line">	p-&gt;done_skip_stat_unmatch = 1;</td></tr>
<tr><td class="num" id="LN4914">4914</td><td class="line">	p-&gt;skip_stat_unmatch_result = 0;</td></tr>
<tr><td class="num" id="LN4915">4915</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN4916">4916</td><td class="line">	 <span class='comment'>* 1. Entries that come from stat info dirtiness</span></td></tr>
<tr><td class="num" id="LN4917">4917</td><td class="line">	 <span class='comment'>*    always have both sides (iow, not create/delete),</span></td></tr>
<tr><td class="num" id="LN4918">4918</td><td class="line">	 <span class='comment'>*    one side of the object name is unknown, with</span></td></tr>
<tr><td class="num" id="LN4919">4919</td><td class="line">	 <span class='comment'>*    the same mode and size.  Keep the ones that</span></td></tr>
<tr><td class="num" id="LN4920">4920</td><td class="line">	 <span class='comment'>*    do not match these criteria.  They have real</span></td></tr>
<tr><td class="num" id="LN4921">4921</td><td class="line">	 <span class='comment'>*    differences.</span></td></tr>
<tr><td class="num" id="LN4922">4922</td><td class="line">	 <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN4923">4923</td><td class="line">	 <span class='comment'>* 2. At this point, the file is known to be modified,</span></td></tr>
<tr><td class="num" id="LN4924">4924</td><td class="line">	 <span class='comment'>*    with the same mode and size, and the object</span></td></tr>
<tr><td class="num" id="LN4925">4925</td><td class="line">	 <span class='comment'>*    name of one side is unknown.  Need to inspect</span></td></tr>
<tr><td class="num" id="LN4926">4926</td><td class="line">	 <span class='comment'>*    the identical contents.</span></td></tr>
<tr><td class="num" id="LN4927">4927</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN4928">4928</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>DIFF_FILE_VALID(p-&gt;one)<span class='expansion'>(((p-&gt;one)-&gt;mode) != 0)</span></span> || <span class='comment'>/* (1) */</span></td></tr>
<tr><td class="num" id="LN4929">4929</td><td class="line">	    !<span class='macro'>DIFF_FILE_VALID(p-&gt;two)<span class='expansion'>(((p-&gt;two)-&gt;mode) != 0)</span></span> ||</td></tr>
<tr><td class="num" id="LN4930">4930</td><td class="line">	    (p-&gt;one-&gt;oid_valid &amp;&amp; p-&gt;two-&gt;oid_valid) ||</td></tr>
<tr><td class="num" id="LN4931">4931</td><td class="line">	    (p-&gt;one-&gt;mode != p-&gt;two-&gt;mode) ||</td></tr>
<tr><td class="num" id="LN4932">4932</td><td class="line">	    diff_populate_filespec(p-&gt;one, <span class='macro'>CHECK_SIZE_ONLY<span class='expansion'>1</span></span>) ||</td></tr>
<tr><td class="num" id="LN4933">4933</td><td class="line">	    diff_populate_filespec(p-&gt;two, <span class='macro'>CHECK_SIZE_ONLY<span class='expansion'>1</span></span>) ||</td></tr>
<tr><td class="num" id="LN4934">4934</td><td class="line">	    (p-&gt;one-&gt;size != p-&gt;two-&gt;size) ||</td></tr>
<tr><td class="num" id="LN4935">4935</td><td class="line">	    !diff_filespec_is_identical(p-&gt;one, p-&gt;two)) <span class='comment'>/* (2) */</span></td></tr>
<tr><td class="num" id="LN4936">4936</td><td class="line">		p-&gt;skip_stat_unmatch_result = 1;</td></tr>
<tr><td class="num" id="LN4937">4937</td><td class="line">	<span class='keyword'>return</span> p-&gt;skip_stat_unmatch_result;</td></tr>
<tr><td class="num" id="LN4938">4938</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4939">4939</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4940">4940</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> diffcore_skip_stat_unmatch(<span class='keyword'>struct</span> diff_options *diffopt)</td></tr>
<tr><td class="num" id="LN4941">4941</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4942">4942</td><td class="line">	<span class='keyword'>int</span> i;</td></tr>
<tr><td class="num" id="LN4943">4943</td><td class="line">	<span class='keyword'>struct</span> diff_queue_struct *q = &amp;diff_queued_diff;</td></tr>
<tr><td class="num" id="LN4944">4944</td><td class="line">	<span class='keyword'>struct</span> diff_queue_struct outq;</td></tr>
<tr><td class="num" id="LN4945">4945</td><td class="line">	<span class='macro'>DIFF_QUEUE_CLEAR(&amp;outq)<span class='expansion'>do { (&amp;outq)-&gt;queue = ((void*)0); (&amp;outq)-&gt;nr =<br> (&amp;outq)-&gt;alloc = 0; } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN4946">4946</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4947">4947</td><td class="line">	<span class='keyword'>for</span> (i = 0; i &lt; q-&gt;nr; i++) {</td></tr>
<tr><td class="num" id="LN4948">4948</td><td class="line">		<span class='keyword'>struct</span> diff_filepair *p = q-&gt;queue[i];</td></tr>
<tr><td class="num" id="LN4949">4949</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4950">4950</td><td class="line">		<span class='keyword'>if</span> (diff_filespec_check_stat_unmatch(p))</td></tr>
<tr><td class="num" id="LN4951">4951</td><td class="line">			diff_q(&amp;outq, p);</td></tr>
<tr><td class="num" id="LN4952">4952</td><td class="line">		<span class='keyword'>else</span> {</td></tr>
<tr><td class="num" id="LN4953">4953</td><td class="line">			<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN4954">4954</td><td class="line">			 <span class='comment'>* The caller can subtract 1 from skip_stat_unmatch</span></td></tr>
<tr><td class="num" id="LN4955">4955</td><td class="line">			 <span class='comment'>* to determine how many paths were dirty only</span></td></tr>
<tr><td class="num" id="LN4956">4956</td><td class="line">			 <span class='comment'>* due to stat info mismatch.</span></td></tr>
<tr><td class="num" id="LN4957">4957</td><td class="line">			 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN4958">4958</td><td class="line">			<span class='keyword'>if</span> (!<span class='macro'>DIFF_OPT_TST(diffopt, NO_INDEX)<span class='expansion'>((diffopt)-&gt;flags &amp; (1 &lt;&lt; 12))</span></span>)</td></tr>
<tr><td class="num" id="LN4959">4959</td><td class="line">				diffopt-&gt;skip_stat_unmatch++;</td></tr>
<tr><td class="num" id="LN4960">4960</td><td class="line">			diff_free_filepair(p);</td></tr>
<tr><td class="num" id="LN4961">4961</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN4962">4962</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4963">4963</td><td class="line">	free(q-&gt;queue);</td></tr>
<tr><td class="num" id="LN4964">4964</td><td class="line">	*q = outq;</td></tr>
<tr><td class="num" id="LN4965">4965</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4966">4966</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4967">4967</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> diffnamecmp(<span class='keyword'>const</span> <span class='keyword'>void</span> *a_, <span class='keyword'>const</span> <span class='keyword'>void</span> *b_)</td></tr>
<tr><td class="num" id="LN4968">4968</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4969">4969</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>struct</span> diff_filepair *a = *((<span class='keyword'>const</span> <span class='keyword'>struct</span> diff_filepair **)a_);</td></tr>
<tr><td class="num" id="LN4970">4970</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>struct</span> diff_filepair *b = *((<span class='keyword'>const</span> <span class='keyword'>struct</span> diff_filepair **)b_);</td></tr>
<tr><td class="num" id="LN4971">4971</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *name_a, *name_b;</td></tr>
<tr><td class="num" id="LN4972">4972</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4973">4973</td><td class="line">	name_a = a-&gt;one ? a-&gt;one-&gt;path : a-&gt;two-&gt;path;</td></tr>
<tr><td class="num" id="LN4974">4974</td><td class="line">	name_b = b-&gt;one ? b-&gt;one-&gt;path : b-&gt;two-&gt;path;</td></tr>
<tr><td class="num" id="LN4975">4975</td><td class="line">	<span class='keyword'>return</span> strcmp(name_a, name_b);</td></tr>
<tr><td class="num" id="LN4976">4976</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4977">4977</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4978">4978</td><td class="line"><span class='keyword'>void</span> diffcore_fix_diff_index(<span class='keyword'>struct</span> diff_options *options)</td></tr>
<tr><td class="num" id="LN4979">4979</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4980">4980</td><td class="line">	<span class='keyword'>struct</span> diff_queue_struct *q = &amp;diff_queued_diff;</td></tr>
<tr><td class="num" id="LN4981">4981</td><td class="line">	<span class='macro'>QSORT(q-&gt;queue, q-&gt;nr, diffnamecmp)<span class='expansion'>sane_qsort((q-&gt;queue), (q-&gt;nr), sizeof(*(q-&gt;queue)),<br> diffnamecmp)</span></span>;</td></tr>
<tr><td class="num" id="LN4982">4982</td><td class="line">}</td></tr>
<tr><td class="num" id="LN4983">4983</td><td class="line"> </td></tr>
<tr><td class="num" id="LN4984">4984</td><td class="line"><span class='keyword'>void</span> diffcore_std(<span class='keyword'>struct</span> diff_options *options)</td></tr>
<tr><td class="num" id="LN4985">4985</td><td class="line">{</td></tr>
<tr><td class="num" id="LN4986">4986</td><td class="line">	<span class='comment'>/* NOTE please keep the following in sync with diff_tree_combined() */</span></td></tr>
<tr><td class="num" id="LN4987">4987</td><td class="line">	<span class='keyword'>if</span> (options-&gt;skip_stat_unmatch)</td></tr>
<tr><td class="num" id="LN4988">4988</td><td class="line">		diffcore_skip_stat_unmatch(options);</td></tr>
<tr><td class="num" id="LN4989">4989</td><td class="line">	<span class='keyword'>if</span> (!options-&gt;found_follow) {</td></tr>
<tr><td class="num" id="LN4990">4990</td><td class="line">		<span class='comment'>/* See try_to_follow_renames() in tree-diff.c */</span></td></tr>
<tr><td class="num" id="LN4991">4991</td><td class="line">		<span class='keyword'>if</span> (options-&gt;break_opt != -1)</td></tr>
<tr><td class="num" id="LN4992">4992</td><td class="line">			diffcore_break(options-&gt;break_opt);</td></tr>
<tr><td class="num" id="LN4993">4993</td><td class="line">		<span class='keyword'>if</span> (options-&gt;detect_rename)</td></tr>
<tr><td class="num" id="LN4994">4994</td><td class="line">			diffcore_rename(options);</td></tr>
<tr><td class="num" id="LN4995">4995</td><td class="line">		<span class='keyword'>if</span> (options-&gt;break_opt != -1)</td></tr>
<tr><td class="num" id="LN4996">4996</td><td class="line">			diffcore_merge_broken();</td></tr>
<tr><td class="num" id="LN4997">4997</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN4998">4998</td><td class="line">	<span class='keyword'>if</span> (options-&gt;pickaxe)</td></tr>
<tr><td class="num" id="LN4999">4999</td><td class="line">		diffcore_pickaxe(options);</td></tr>
<tr><td class="num" id="LN5000">5000</td><td class="line">	<span class='keyword'>if</span> (options-&gt;orderfile)</td></tr>
<tr><td class="num" id="LN5001">5001</td><td class="line">		diffcore_order(options-&gt;orderfile);</td></tr>
<tr><td class="num" id="LN5002">5002</td><td class="line">	<span class='keyword'>if</span> (!options-&gt;found_follow)</td></tr>
<tr><td class="num" id="LN5003">5003</td><td class="line">		<span class='comment'>/* See try_to_follow_renames() in tree-diff.c */</span></td></tr>
<tr><td class="num" id="LN5004">5004</td><td class="line">		diff_resolve_rename_copy();</td></tr>
<tr><td class="num" id="LN5005">5005</td><td class="line">	diffcore_apply_filter(options);</td></tr>
<tr><td class="num" id="LN5006">5006</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5007">5007</td><td class="line">	<span class='keyword'>if</span> (diff_queued_diff.nr &amp;&amp; !<span class='macro'>DIFF_OPT_TST(options, DIFF_FROM_CONTENTS)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 22))</span></span>)</td></tr>
<tr><td class="num" id="LN5008">5008</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, HAS_CHANGES)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 10)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 10)))</span></span>;</td></tr>
<tr><td class="num" id="LN5009">5009</td><td class="line">	<span class='keyword'>else</span></td></tr>
<tr><td class="num" id="LN5010">5010</td><td class="line">		<span class='macro'>DIFF_OPT_CLR(options, HAS_CHANGES)<span class='expansion'>(((options)-&gt;flags &amp;= ~(1 &lt;&lt; 10)),((options)-&gt;<br>touched_flags |= (1 &lt;&lt; 10)))</span></span>;</td></tr>
<tr><td class="num" id="LN5011">5011</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5012">5012</td><td class="line">	options-&gt;found_follow = 0;</td></tr>
<tr><td class="num" id="LN5013">5013</td><td class="line">}</td></tr>
<tr><td class="num" id="LN5014">5014</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5015">5015</td><td class="line"><span class='keyword'>int</span> diff_result_code(<span class='keyword'>struct</span> diff_options *opt, <span class='keyword'>int</span> status)</td></tr>
<tr><td class="num" id="LN5016">5016</td><td class="line">{</td></tr>
<tr><td class="num" id="LN5017">5017</td><td class="line">	<span class='keyword'>int</span> result = 0;</td></tr>
<tr><td class="num" id="LN5018">5018</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5019">5019</td><td class="line">	diff_warn_rename_limit(<span class='string_literal'>"diff.renameLimit"</span>,</td></tr>
<tr><td class="num" id="LN5020">5020</td><td class="line">			       opt-&gt;needed_rename_limit,</td></tr>
<tr><td class="num" id="LN5021">5021</td><td class="line">			       opt-&gt;degraded_cc_to_c);</td></tr>
<tr><td class="num" id="LN5022">5022</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>DIFF_OPT_TST(opt, EXIT_WITH_STATUS)<span class='expansion'>((opt)-&gt;flags &amp; (1 &lt;&lt; 14))</span></span> &amp;&amp;</td></tr>
<tr><td class="num" id="LN5023">5023</td><td class="line">	    !(opt-&gt;output_format &amp; <span class='macro'>DIFF_FORMAT_CHECKDIFF<span class='expansion'>0x0400</span></span>))</td></tr>
<tr><td class="num" id="LN5024">5024</td><td class="line">		<span class='keyword'>return</span> status;</td></tr>
<tr><td class="num" id="LN5025">5025</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(opt, EXIT_WITH_STATUS)<span class='expansion'>((opt)-&gt;flags &amp; (1 &lt;&lt; 14))</span></span> &amp;&amp;</td></tr>
<tr><td class="num" id="LN5026">5026</td><td class="line">	    <span class='macro'>DIFF_OPT_TST(opt, HAS_CHANGES)<span class='expansion'>((opt)-&gt;flags &amp; (1 &lt;&lt; 10))</span></span>)</td></tr>
<tr><td class="num" id="LN5027">5027</td><td class="line">		result |= 01;</td></tr>
<tr><td class="num" id="LN5028">5028</td><td class="line">	<span class='keyword'>if</span> ((opt-&gt;output_format &amp; <span class='macro'>DIFF_FORMAT_CHECKDIFF<span class='expansion'>0x0400</span></span>) &amp;&amp;</td></tr>
<tr><td class="num" id="LN5029">5029</td><td class="line">	    <span class='macro'>DIFF_OPT_TST(opt, CHECK_FAILED)<span class='expansion'>((opt)-&gt;flags &amp; (1 &lt;&lt; 16))</span></span>)</td></tr>
<tr><td class="num" id="LN5030">5030</td><td class="line">		result |= 02;</td></tr>
<tr><td class="num" id="LN5031">5031</td><td class="line">	<span class='keyword'>return</span> result;</td></tr>
<tr><td class="num" id="LN5032">5032</td><td class="line">}</td></tr>
<tr><td class="num" id="LN5033">5033</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5034">5034</td><td class="line"><span class='keyword'>int</span> diff_can_quit_early(<span class='keyword'>struct</span> diff_options *opt)</td></tr>
<tr><td class="num" id="LN5035">5035</td><td class="line">{</td></tr>
<tr><td class="num" id="LN5036">5036</td><td class="line">	<span class='keyword'>return</span> (<span class='macro'>DIFF_OPT_TST(opt, QUICK)<span class='expansion'>((opt)-&gt;flags &amp; (1 &lt;&lt; 11))</span></span> &amp;&amp;</td></tr>
<tr><td class="num" id="LN5037">5037</td><td class="line">		!opt-&gt;filter &amp;&amp;</td></tr>
<tr><td class="num" id="LN5038">5038</td><td class="line">		<span class='macro'>DIFF_OPT_TST(opt, HAS_CHANGES)<span class='expansion'>((opt)-&gt;flags &amp; (1 &lt;&lt; 10))</span></span>);</td></tr>
<tr><td class="num" id="LN5039">5039</td><td class="line">}</td></tr>
<tr><td class="num" id="LN5040">5040</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5041">5041</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN5042">5042</td><td class="line"> <span class='comment'>* Shall changes to this submodule be ignored?</span></td></tr>
<tr><td class="num" id="LN5043">5043</td><td class="line"> <span class='comment'>*</span></td></tr>
<tr><td class="num" id="LN5044">5044</td><td class="line"> <span class='comment'>* Submodule changes can be configured to be ignored separately for each path,</span></td></tr>
<tr><td class="num" id="LN5045">5045</td><td class="line"> <span class='comment'>* but that configuration can be overridden from the command line.</span></td></tr>
<tr><td class="num" id="LN5046">5046</td><td class="line"> <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN5047">5047</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> is_submodule_ignored(<span class='keyword'>const</span> <span class='keyword'>char</span> *path, <span class='keyword'>struct</span> diff_options *options)</td></tr>
<tr><td class="num" id="LN5048">5048</td><td class="line">{</td></tr>
<tr><td class="num" id="LN5049">5049</td><td class="line">	<span class='keyword'>int</span> ignored = 0;</td></tr>
<tr><td class="num" id="LN5050">5050</td><td class="line">	<span class='keyword'>unsigned</span> orig_flags = options-&gt;flags;</td></tr>
<tr><td class="num" id="LN5051">5051</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>DIFF_OPT_TST(options, OVERRIDE_SUBMODULE_CONFIG)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 27))</span></span>)</td></tr>
<tr><td class="num" id="LN5052">5052</td><td class="line">		set_diffopt_flags_from_submodule_config(options, path);</td></tr>
<tr><td class="num" id="LN5053">5053</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(options, IGNORE_SUBMODULES)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 18))</span></span>)</td></tr>
<tr><td class="num" id="LN5054">5054</td><td class="line">		ignored = 1;</td></tr>
<tr><td class="num" id="LN5055">5055</td><td class="line">	options-&gt;flags = orig_flags;</td></tr>
<tr><td class="num" id="LN5056">5056</td><td class="line">	<span class='keyword'>return</span> ignored;</td></tr>
<tr><td class="num" id="LN5057">5057</td><td class="line">}</td></tr>
<tr><td class="num" id="LN5058">5058</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5059">5059</td><td class="line"><span class='keyword'>void</span> diff_addremove(<span class='keyword'>struct</span> diff_options *options,</td></tr>
<tr><td class="num" id="LN5060">5060</td><td class="line">		    <span class='keyword'>int</span> addremove, <span class='keyword'>unsigned</span> mode,</td></tr>
<tr><td class="num" id="LN5061">5061</td><td class="line">		    <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *sha1,</td></tr>
<tr><td class="num" id="LN5062">5062</td><td class="line">		    <span class='keyword'>int</span> sha1_valid,</td></tr>
<tr><td class="num" id="LN5063">5063</td><td class="line">		    <span class='keyword'>const</span> <span class='keyword'>char</span> *concatpath, <span class='keyword'>unsigned</span> dirty_submodule)</td></tr>
<tr><td class="num" id="LN5064">5064</td><td class="line">{</td></tr>
<tr><td class="num" id="LN5065">5065</td><td class="line">	<span class='keyword'>struct</span> diff_filespec *one, *two;</td></tr>
<tr><td class="num" id="LN5066">5066</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5067">5067</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>S_ISGITLINK(mode)<span class='expansion'>(((mode) &amp; 0170000) == 0160000)</span></span> &amp;&amp; is_submodule_ignored(concatpath, options))</td></tr>
<tr><td class="num" id="LN5068">5068</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN5069">5069</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5070">5070</td><td class="line">	<span class='comment'>/* This may look odd, but it is a preparation for</span></td></tr>
<tr><td class="num" id="LN5071">5071</td><td class="line">	 <span class='comment'>* feeding "there are unchanged files which should</span></td></tr>
<tr><td class="num" id="LN5072">5072</td><td class="line">	 <span class='comment'>* not produce diffs, but when you are doing copy</span></td></tr>
<tr><td class="num" id="LN5073">5073</td><td class="line">	 <span class='comment'>* detection you would need them, so here they are"</span></td></tr>
<tr><td class="num" id="LN5074">5074</td><td class="line">	 <span class='comment'>* entries to the diff-core.  They will be prefixed</span></td></tr>
<tr><td class="num" id="LN5075">5075</td><td class="line">	 <span class='comment'>* with something like '=' or '*' (I haven't decided</span></td></tr>
<tr><td class="num" id="LN5076">5076</td><td class="line">	 <span class='comment'>* which but should not make any difference).</span></td></tr>
<tr><td class="num" id="LN5077">5077</td><td class="line">	 <span class='comment'>* Feeding the same new and old to diff_change()</span></td></tr>
<tr><td class="num" id="LN5078">5078</td><td class="line">	 <span class='comment'>* also has the same effect.</span></td></tr>
<tr><td class="num" id="LN5079">5079</td><td class="line">	 <span class='comment'>* Before the final output happens, they are pruned after</span></td></tr>
<tr><td class="num" id="LN5080">5080</td><td class="line">	 <span class='comment'>* merged into rename/copy pairs as appropriate.</span></td></tr>
<tr><td class="num" id="LN5081">5081</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN5082">5082</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(options, REVERSE_DIFF)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 15))</span></span>)</td></tr>
<tr><td class="num" id="LN5083">5083</td><td class="line">		addremove = (addremove == '+' ? '-' :</td></tr>
<tr><td class="num" id="LN5084">5084</td><td class="line">			     addremove == '-' ? '+' : addremove);</td></tr>
<tr><td class="num" id="LN5085">5085</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5086">5086</td><td class="line">	<span class='keyword'>if</span> (options-&gt;prefix &amp;&amp;</td></tr>
<tr><td class="num" id="LN5087">5087</td><td class="line">	    strncmp(concatpath, options-&gt;prefix, options-&gt;prefix_length))</td></tr>
<tr><td class="num" id="LN5088">5088</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN5089">5089</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5090">5090</td><td class="line">	one = alloc_filespec(concatpath);</td></tr>
<tr><td class="num" id="LN5091">5091</td><td class="line">	two = alloc_filespec(concatpath);</td></tr>
<tr><td class="num" id="LN5092">5092</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5093">5093</td><td class="line">	<span class='keyword'>if</span> (addremove != '+')</td></tr>
<tr><td class="num" id="LN5094">5094</td><td class="line">		fill_filespec(one, sha1, sha1_valid, mode);</td></tr>
<tr><td class="num" id="LN5095">5095</td><td class="line">	<span class='keyword'>if</span> (addremove != '-') {</td></tr>
<tr><td class="num" id="LN5096">5096</td><td class="line">		fill_filespec(two, sha1, sha1_valid, mode);</td></tr>
<tr><td class="num" id="LN5097">5097</td><td class="line">		two-&gt;dirty_submodule = dirty_submodule;</td></tr>
<tr><td class="num" id="LN5098">5098</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN5099">5099</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5100">5100</td><td class="line">	diff_queue(&amp;diff_queued_diff, one, two);</td></tr>
<tr><td class="num" id="LN5101">5101</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>DIFF_OPT_TST(options, DIFF_FROM_CONTENTS)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 22))</span></span>)</td></tr>
<tr><td class="num" id="LN5102">5102</td><td class="line">		<span class='macro'>DIFF_OPT_SET(options, HAS_CHANGES)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 10)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 10)))</span></span>;</td></tr>
<tr><td class="num" id="LN5103">5103</td><td class="line">}</td></tr>
<tr><td class="num" id="LN5104">5104</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5105">5105</td><td class="line"><span class='keyword'>void</span> diff_change(<span class='keyword'>struct</span> diff_options *options,</td></tr>
<tr><td class="num" id="LN5106">5106</td><td class="line">		 <span class='keyword'>unsigned</span> old_mode, <span class='keyword'>unsigned</span> new_mode,</td></tr>
<tr><td class="num" id="LN5107">5107</td><td class="line">		 <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *old_sha1,</td></tr>
<tr><td class="num" id="LN5108">5108</td><td class="line">		 <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *new_sha1,</td></tr>
<tr><td class="num" id="LN5109">5109</td><td class="line">		 <span class='keyword'>int</span> old_sha1_valid, <span class='keyword'>int</span> new_sha1_valid,</td></tr>
<tr><td class="num" id="LN5110">5110</td><td class="line">		 <span class='keyword'>const</span> <span class='keyword'>char</span> *concatpath,</td></tr>
<tr><td class="num" id="LN5111">5111</td><td class="line">		 <span class='keyword'>unsigned</span> old_dirty_submodule, <span class='keyword'>unsigned</span> new_dirty_submodule)</td></tr>
<tr><td class="num" id="LN5112">5112</td><td class="line">{</td></tr>
<tr><td class="num" id="LN5113">5113</td><td class="line">	<span class='keyword'>struct</span> diff_filespec *one, *two;</td></tr>
<tr><td class="num" id="LN5114">5114</td><td class="line">	<span class='keyword'>struct</span> diff_filepair *p;</td></tr>
<tr><td class="num" id="LN5115">5115</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5116">5116</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>S_ISGITLINK(old_mode)<span class='expansion'>(((old_mode) &amp; 0170000) == 0160000)</span></span> &amp;&amp; <span class='macro'>S_ISGITLINK(new_mode)<span class='expansion'>(((new_mode) &amp; 0170000) == 0160000)</span></span> &amp;&amp;</td></tr>
<tr><td class="num" id="LN5117">5117</td><td class="line">	    is_submodule_ignored(concatpath, options))</td></tr>
<tr><td class="num" id="LN5118">5118</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN5119">5119</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5120">5120</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(options, REVERSE_DIFF)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 15))</span></span>) {</td></tr>
<tr><td class="num" id="LN5121">5121</td><td class="line">		<span class='macro'>SWAP(old_mode, new_mode)<span class='expansion'>do { void *_swap_a_ptr = &amp;(old_mode); void *_swap_b_ptr =<br> &amp;(new_mode); unsigned char _swap_buffer[sizeof(old_mode)<br>]; __builtin___memcpy_chk (_swap_buffer, _swap_a_ptr, sizeof(<br>old_mode), __builtin_object_size (_swap_buffer, 0)); __builtin___memcpy_chk<br> (_swap_a_ptr, _swap_b_ptr, sizeof(old_mode) + (sizeof(char [<br>1 - 2*!(sizeof(old_mode) == sizeof(new_mode))]) - 1), __builtin_object_size<br> (_swap_a_ptr, 0)); __builtin___memcpy_chk (_swap_b_ptr, _swap_buffer<br>, sizeof(old_mode), __builtin_object_size (_swap_b_ptr, 0)); }<br> while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN5122">5122</td><td class="line">		<span class='macro'>SWAP(old_sha1, new_sha1)<span class='expansion'>do { void *_swap_a_ptr = &amp;(old_sha1); void *_swap_b_ptr =<br> &amp;(new_sha1); unsigned char _swap_buffer[sizeof(old_sha1)<br>]; __builtin___memcpy_chk (_swap_buffer, _swap_a_ptr, sizeof(<br>old_sha1), __builtin_object_size (_swap_buffer, 0)); __builtin___memcpy_chk<br> (_swap_a_ptr, _swap_b_ptr, sizeof(old_sha1) + (sizeof(char [<br>1 - 2*!(sizeof(old_sha1) == sizeof(new_sha1))]) - 1), __builtin_object_size<br> (_swap_a_ptr, 0)); __builtin___memcpy_chk (_swap_b_ptr, _swap_buffer<br>, sizeof(old_sha1), __builtin_object_size (_swap_b_ptr, 0)); }<br> while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN5123">5123</td><td class="line">		<span class='macro'>SWAP(old_sha1_valid, new_sha1_valid)<span class='expansion'>do { void *_swap_a_ptr = &amp;(old_sha1_valid); void *_swap_b_ptr<br> = &amp;(new_sha1_valid); unsigned char _swap_buffer[sizeof(old_sha1_valid<br>)]; __builtin___memcpy_chk (_swap_buffer, _swap_a_ptr, sizeof<br>(old_sha1_valid), __builtin_object_size (_swap_buffer, 0)); __builtin___memcpy_chk<br> (_swap_a_ptr, _swap_b_ptr, sizeof(old_sha1_valid) + (sizeof(<br>char [1 - 2*!(sizeof(old_sha1_valid) == sizeof(new_sha1_valid<br>))]) - 1), __builtin_object_size (_swap_a_ptr, 0)); __builtin___memcpy_chk<br> (_swap_b_ptr, _swap_buffer, sizeof(old_sha1_valid), __builtin_object_size<br> (_swap_b_ptr, 0)); } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN5124">5124</td><td class="line">		<span class='macro'>SWAP(old_dirty_submodule, new_dirty_submodule)<span class='expansion'>do { void *_swap_a_ptr = &amp;(old_dirty_submodule); void *_swap_b_ptr<br> = &amp;(new_dirty_submodule); unsigned char _swap_buffer[sizeof<br>(old_dirty_submodule)]; __builtin___memcpy_chk (_swap_buffer,<br> _swap_a_ptr, sizeof(old_dirty_submodule), __builtin_object_size<br> (_swap_buffer, 0)); __builtin___memcpy_chk (_swap_a_ptr, _swap_b_ptr<br>, sizeof(old_dirty_submodule) + (sizeof(char [1 - 2*!(sizeof(<br>old_dirty_submodule) == sizeof(new_dirty_submodule))]) - 1), __builtin_object_size<br> (_swap_a_ptr, 0)); __builtin___memcpy_chk (_swap_b_ptr, _swap_buffer<br>, sizeof(old_dirty_submodule), __builtin_object_size (_swap_b_ptr<br>, 0)); } while (0)</span></span>;</td></tr>
<tr><td class="num" id="LN5125">5125</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN5126">5126</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5127">5127</td><td class="line">	<span class='keyword'>if</span> (options-&gt;prefix &amp;&amp;</td></tr>
<tr><td class="num" id="LN5128">5128</td><td class="line">	    strncmp(concatpath, options-&gt;prefix, options-&gt;prefix_length))</td></tr>
<tr><td class="num" id="LN5129">5129</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN5130">5130</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5131">5131</td><td class="line">	one = alloc_filespec(concatpath);</td></tr>
<tr><td class="num" id="LN5132">5132</td><td class="line">	two = alloc_filespec(concatpath);</td></tr>
<tr><td class="num" id="LN5133">5133</td><td class="line">	fill_filespec(one, old_sha1, old_sha1_valid, old_mode);</td></tr>
<tr><td class="num" id="LN5134">5134</td><td class="line">	fill_filespec(two, new_sha1, new_sha1_valid, new_mode);</td></tr>
<tr><td class="num" id="LN5135">5135</td><td class="line">	one-&gt;dirty_submodule = old_dirty_submodule;</td></tr>
<tr><td class="num" id="LN5136">5136</td><td class="line">	two-&gt;dirty_submodule = new_dirty_submodule;</td></tr>
<tr><td class="num" id="LN5137">5137</td><td class="line">	p = diff_queue(&amp;diff_queued_diff, one, two);</td></tr>
<tr><td class="num" id="LN5138">5138</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5139">5139</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(options, DIFF_FROM_CONTENTS)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 22))</span></span>)</td></tr>
<tr><td class="num" id="LN5140">5140</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN5141">5141</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5142">5142</td><td class="line">	<span class='keyword'>if</span> (<span class='macro'>DIFF_OPT_TST(options, QUICK)<span class='expansion'>((options)-&gt;flags &amp; (1 &lt;&lt; 11))</span></span> &amp;&amp; options-&gt;skip_stat_unmatch &amp;&amp;</td></tr>
<tr><td class="num" id="LN5143">5143</td><td class="line">	    !diff_filespec_check_stat_unmatch(p))</td></tr>
<tr><td class="num" id="LN5144">5144</td><td class="line">		<span class='keyword'>return</span>;</td></tr>
<tr><td class="num" id="LN5145">5145</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5146">5146</td><td class="line">	<span class='macro'>DIFF_OPT_SET(options, HAS_CHANGES)<span class='expansion'>(((options)-&gt;flags |= (1 &lt;&lt; 10)),((options)-&gt;touched_flags<br> |= (1 &lt;&lt; 10)))</span></span>;</td></tr>
<tr><td class="num" id="LN5147">5147</td><td class="line">}</td></tr>
<tr><td class="num" id="LN5148">5148</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5149">5149</td><td class="line"><span class='keyword'>struct</span> diff_filepair *diff_unmerge(<span class='keyword'>struct</span> diff_options *options, <span class='keyword'>const</span> <span class='keyword'>char</span> *path)</td></tr>
<tr><td class="num" id="LN5150">5150</td><td class="line">{</td></tr>
<tr><td class="num" id="LN5151">5151</td><td class="line">	<span class='keyword'>struct</span> diff_filepair *pair;</td></tr>
<tr><td class="num" id="LN5152">5152</td><td class="line">	<span class='keyword'>struct</span> diff_filespec *one, *two;</td></tr>
<tr><td class="num" id="LN5153">5153</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5154">5154</td><td class="line">	<span class='keyword'>if</span> (options-&gt;prefix &amp;&amp;</td></tr>
<tr><td class="num" id="LN5155">5155</td><td class="line">	    strncmp(path, options-&gt;prefix, options-&gt;prefix_length))</td></tr>
<tr><td class="num" id="LN5156">5156</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN5157">5157</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5158">5158</td><td class="line">	one = alloc_filespec(path);</td></tr>
<tr><td class="num" id="LN5159">5159</td><td class="line">	two = alloc_filespec(path);</td></tr>
<tr><td class="num" id="LN5160">5160</td><td class="line">	pair = diff_queue(&amp;diff_queued_diff, one, two);</td></tr>
<tr><td class="num" id="LN5161">5161</td><td class="line">	pair-&gt;is_unmerged = 1;</td></tr>
<tr><td class="num" id="LN5162">5162</td><td class="line">	<span class='keyword'>return</span> pair;</td></tr>
<tr><td class="num" id="LN5163">5163</td><td class="line">}</td></tr>
<tr><td class="num" id="LN5164">5164</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5165">5165</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>char</span> *run_textconv(<span class='keyword'>const</span> <span class='keyword'>char</span> *pgm, <span class='keyword'>struct</span> diff_filespec *spec,</td></tr>
<tr><td class="num" id="LN5166">5166</td><td class="line">		size_t *outsize)</td></tr>
<tr><td class="num" id="LN5167">5167</td><td class="line">{</td></tr>
<tr><td class="num" id="LN5168">5168</td><td class="line">	<span class='keyword'>struct</span> diff_tempfile *temp;</td></tr>
<tr><td class="num" id="LN5169">5169</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> *argv[3];</td></tr>
<tr><td class="num" id="LN5170">5170</td><td class="line">	<span class='keyword'>const</span> <span class='keyword'>char</span> **arg = argv;</td></tr>
<tr><td class="num" id="LN5171">5171</td><td class="line">	<span class='keyword'>struct</span> child_process child = <span class='macro'>CHILD_PROCESS_INIT<span class='expansion'>{ ((void*)0), { empty_argv, 0, 0 }, { empty_argv, 0, 0 } }</span></span>;</td></tr>
<tr><td class="num" id="LN5172">5172</td><td class="line">	<span class='keyword'>struct</span> strbuf buf = <span class='macro'>STRBUF_INIT<span class='expansion'>{ 0, 0, strbuf_slopbuf }</span></span>;</td></tr>
<tr><td class="num" id="LN5173">5173</td><td class="line">	<span class='keyword'>int</span> err = 0;</td></tr>
<tr><td class="num" id="LN5174">5174</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5175">5175</td><td class="line">	temp = prepare_temp_file(spec-&gt;path, spec);</td></tr>
<tr><td class="num" id="LN5176">5176</td><td class="line">	*arg++ = pgm;</td></tr>
<tr><td class="num" id="LN5177">5177</td><td class="line">	*arg++ = temp-&gt;name;</td></tr>
<tr><td class="num" id="LN5178">5178</td><td class="line">	*arg = <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN5179">5179</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5180">5180</td><td class="line">	child.use_shell = 1;</td></tr>
<tr><td class="num" id="LN5181">5181</td><td class="line">	child.argv = argv;</td></tr>
<tr><td class="num" id="LN5182">5182</td><td class="line">	child.out = -1;</td></tr>
<tr><td class="num" id="LN5183">5183</td><td class="line">	<span class='keyword'>if</span> (start_command(&amp;child)) {</td></tr>
<tr><td class="num" id="LN5184">5184</td><td class="line">		remove_tempfile();</td></tr>
<tr><td class="num" id="LN5185">5185</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN5186">5186</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN5187">5187</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5188">5188</td><td class="line">	<span class='keyword'>if</span> (strbuf_read(&amp;buf, child.out, 0) &lt; 0)</td></tr>
<tr><td class="num" id="LN5189">5189</td><td class="line">		err = <span class='macro'>error(<span class='string_literal'>"error reading from textconv command '%s'"</span>, pgm)<span class='expansion'>(error("error reading from textconv command '%s'", pgm), const_error<br>())</span></span>;</td></tr>
<tr><td class="num" id="LN5190">5190</td><td class="line">	close(child.out);</td></tr>
<tr><td class="num" id="LN5191">5191</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5192">5192</td><td class="line">	<span class='keyword'>if</span> (finish_command(&amp;child) || err) {</td></tr>
<tr><td class="num" id="LN5193">5193</td><td class="line">		strbuf_release(&amp;buf);</td></tr>
<tr><td class="num" id="LN5194">5194</td><td class="line">		remove_tempfile();</td></tr>
<tr><td class="num" id="LN5195">5195</td><td class="line">		<span class='keyword'>return</span> <span class='macro'>NULL<span class='expansion'>((void*)0)</span></span>;</td></tr>
<tr><td class="num" id="LN5196">5196</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN5197">5197</td><td class="line">	remove_tempfile();</td></tr>
<tr><td class="num" id="LN5198">5198</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5199">5199</td><td class="line">	<span class='keyword'>return</span> strbuf_detach(&amp;buf, outsize);</td></tr>
<tr><td class="num" id="LN5200">5200</td><td class="line">}</td></tr>
<tr><td class="num" id="LN5201">5201</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5202">5202</td><td class="line">size_t fill_textconv(<span class='keyword'>struct</span> userdiff_driver *driver,</td></tr>
<tr><td class="num" id="LN5203">5203</td><td class="line">		     <span class='keyword'>struct</span> diff_filespec *df,</td></tr>
<tr><td class="num" id="LN5204">5204</td><td class="line">		     <span class='keyword'>char</span> **outbuf)</td></tr>
<tr><td class="num" id="LN5205">5205</td><td class="line">{</td></tr>
<tr><td class="num" id="LN5206">5206</td><td class="line">	size_t size;</td></tr>
<tr><td class="num" id="LN5207">5207</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5208">5208</td><td class="line">	<span class='keyword'>if</span> (!driver) {</td></tr>
<tr><td class="num" id="LN5209">5209</td><td class="line">		<span class='keyword'>if</span> (!<span class='macro'>DIFF_FILE_VALID(df)<span class='expansion'>(((df)-&gt;mode) != 0)</span></span>) {</td></tr>
<tr><td class="num" id="LN5210">5210</td><td class="line">			*outbuf = <span class='string_literal'>""</span>;</td></tr>
<tr><td class="num" id="LN5211">5211</td><td class="line">			<span class='keyword'>return</span> 0;</td></tr>
<tr><td class="num" id="LN5212">5212</td><td class="line">		}</td></tr>
<tr><td class="num" id="LN5213">5213</td><td class="line">		<span class='keyword'>if</span> (diff_populate_filespec(df, 0))</td></tr>
<tr><td class="num" id="LN5214">5214</td><td class="line">			die(<span class='string_literal'>"unable to read files to diff"</span>);</td></tr>
<tr><td class="num" id="LN5215">5215</td><td class="line">		*outbuf = df-&gt;data;</td></tr>
<tr><td class="num" id="LN5216">5216</td><td class="line">		<span class='keyword'>return</span> df-&gt;size;</td></tr>
<tr><td class="num" id="LN5217">5217</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN5218">5218</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5219">5219</td><td class="line">	<span class='keyword'>if</span> (!driver-&gt;textconv)</td></tr>
<tr><td class="num" id="LN5220">5220</td><td class="line">		die(<span class='string_literal'>"BUG: fill_textconv called with non-textconv driver"</span>);</td></tr>
<tr><td class="num" id="LN5221">5221</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5222">5222</td><td class="line">	<span class='keyword'>if</span> (driver-&gt;textconv_cache &amp;&amp; df-&gt;oid_valid) {</td></tr>
<tr><td class="num" id="LN5223">5223</td><td class="line">		*outbuf = notes_cache_get(driver-&gt;textconv_cache,</td></tr>
<tr><td class="num" id="LN5224">5224</td><td class="line">					  df-&gt;oid.hash,</td></tr>
<tr><td class="num" id="LN5225">5225</td><td class="line">					  &amp;size);</td></tr>
<tr><td class="num" id="LN5226">5226</td><td class="line">		<span class='keyword'>if</span> (*outbuf)</td></tr>
<tr><td class="num" id="LN5227">5227</td><td class="line">			<span class='keyword'>return</span> size;</td></tr>
<tr><td class="num" id="LN5228">5228</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN5229">5229</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5230">5230</td><td class="line">	*outbuf = run_textconv(driver-&gt;textconv, df, &amp;size);</td></tr>
<tr><td class="num" id="LN5231">5231</td><td class="line">	<span class='keyword'>if</span> (!*outbuf)</td></tr>
<tr><td class="num" id="LN5232">5232</td><td class="line">		die(<span class='string_literal'>"unable to read files to diff"</span>);</td></tr>
<tr><td class="num" id="LN5233">5233</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5234">5234</td><td class="line">	<span class='keyword'>if</span> (driver-&gt;textconv_cache &amp;&amp; df-&gt;oid_valid) {</td></tr>
<tr><td class="num" id="LN5235">5235</td><td class="line">		<span class='comment'>/* ignore errors, as we might be in a readonly repository */</span></td></tr>
<tr><td class="num" id="LN5236">5236</td><td class="line">		notes_cache_put(driver-&gt;textconv_cache, df-&gt;oid.hash, *outbuf,</td></tr>
<tr><td class="num" id="LN5237">5237</td><td class="line">				size);</td></tr>
<tr><td class="num" id="LN5238">5238</td><td class="line">		<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN5239">5239</td><td class="line">		 <span class='comment'>* we could save up changes and flush them all at the end,</span></td></tr>
<tr><td class="num" id="LN5240">5240</td><td class="line">		 <span class='comment'>* but we would need an extra call after all diffing is done.</span></td></tr>
<tr><td class="num" id="LN5241">5241</td><td class="line">		 <span class='comment'>* Since generating a cache entry is the slow path anyway,</span></td></tr>
<tr><td class="num" id="LN5242">5242</td><td class="line">		 <span class='comment'>* this extra overhead probably isn't a big deal.</span></td></tr>
<tr><td class="num" id="LN5243">5243</td><td class="line">		 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN5244">5244</td><td class="line">		notes_cache_write(driver-&gt;textconv_cache);</td></tr>
<tr><td class="num" id="LN5245">5245</td><td class="line">	}</td></tr>
<tr><td class="num" id="LN5246">5246</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5247">5247</td><td class="line">	<span class='keyword'>return</span> size;</td></tr>
<tr><td class="num" id="LN5248">5248</td><td class="line">}</td></tr>
<tr><td class="num" id="LN5249">5249</td><td class="line"> </td></tr>
<tr><td class="num" id="LN5250">5250</td><td class="line"><span class='keyword'>void</span> setup_diff_pager(<span class='keyword'>struct</span> diff_options *opt)</td></tr>
<tr><td class="num" id="LN5251">5251</td><td class="line">{</td></tr>
<tr><td class="num" id="LN5252">5252</td><td class="line">	<span class='comment'>/*</span></td></tr>
<tr><td class="num" id="LN5253">5253</td><td class="line">	 <span class='comment'>* If the user asked for our exit code, then either they want --quiet</span></td></tr>
<tr><td class="num" id="LN5254">5254</td><td class="line">	 <span class='comment'>* or --exit-code. We should definitely not bother with a pager in the</span></td></tr>
<tr><td class="num" id="LN5255">5255</td><td class="line">	 <span class='comment'>* former case, as we will generate no output. Since we still properly</span></td></tr>
<tr><td class="num" id="LN5256">5256</td><td class="line">	 <span class='comment'>* report our exit code even when a pager is run, we _could_ run a</span></td></tr>
<tr><td class="num" id="LN5257">5257</td><td class="line">	 <span class='comment'>* pager with --exit-code. But since we have not done so historically,</span></td></tr>
<tr><td class="num" id="LN5258">5258</td><td class="line">	 <span class='comment'>* and because it is easy to find people oneline advising "git diff</span></td></tr>
<tr><td class="num" id="LN5259">5259</td><td class="line">	 <span class='comment'>* --exit-code" in hooks and other scripts, we do not do so.</span></td></tr>
<tr><td class="num" id="LN5260">5260</td><td class="line">	 <span class='comment'>*/</span></td></tr>
<tr><td class="num" id="LN5261">5261</td><td class="line">	<span class='keyword'>if</span> (!<span class='macro'>DIFF_OPT_TST(opt, EXIT_WITH_STATUS)<span class='expansion'>((opt)-&gt;flags &amp; (1 &lt;&lt; 14))</span></span> &amp;&amp;</td></tr>
<tr><td class="num" id="LN5262">5262</td><td class="line">	    check_pager_config(<span class='string_literal'>"diff"</span>) != 0)</td></tr>
<tr><td class="num" id="LN5263">5263</td><td class="line">		setup_pager();</td></tr>
<tr><td class="num" id="LN5264">5264</td><td class="line">}</td></tr>
</table></body></html>
